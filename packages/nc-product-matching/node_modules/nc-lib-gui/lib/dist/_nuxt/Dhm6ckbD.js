import{ca as at,r as E,a6 as it,J as z,mI as ct,aG as Q,h3 as et,a4 as H,eQ as Y,gn as lt,e as j,av as B,c as y,o as s,a as m,K as A,ao as X,L as t,t as S,ei as rt,I as b,ap as _t,w as p,b as v,N as J,O as M,ag as h,M as L,aH as nt,d as O,aA as ut,_ as G,k as dt,mJ as D,fq as mt,a8 as pt,cf as F,da as ft,Q as ot,db as vt,an as T,aq as Z,G as yt,mK as gt,ak as xt}from"./DRA9KN5F.js";import{_ as bt}from"./C2UaKEE0.js";import{_ as Nt}from"./C_VN1MCC.js";import{_ as kt}from"./DJYXGfCo.js";import{Y as tt}from"./D_txg4HT.js";const wt=et.CancelToken,V=at("notificationStore",()=>{const c=E([]),i=E([]),o=E(),u=E(),a=E(0),d=E("unread"),{api:r,isLoading:$}=it(),{token:l}=z();let g=null,f;const C=ct("notification",async()=>(f=wt.source(),await r.notification.poll({cancelToken:f.token})),{timeout:3e4}),R=async()=>{try{if(!l.value)return;const e=await C();e.status==="success"&&(d.value==="unread"&&(i.value=[JSON.parse(e.data),...i.value]),a.value=a.value+1),g=setTimeout(R,0)}catch(e){if(et.isCancel(e))return;g=setTimeout(R,2e3)}},k=async e=>{try{const n=await r.notification.list({is_read:!0,limit:10,offset:e?c.value.length:0});e?c.value=[...c.value,...n.list]:c.value=n.list,o.value=n.pageInfo,a.value=Number(n.unreadCount)}catch(n){console.log(n)}},w=async e=>{try{const n=await r.notification.list({is_read:!1,limit:10,offset:e?i.value.length:0});e?i.value=[...i.value,...n.list]:i.value=n.list,u.value=n.pageInfo,a.value=Number(n.unreadCount)}catch(n){console.log(n)}},x=(e,n)=>{n?(c.value=c.value.filter(_=>_.id!==e.id),i.value=[e,...i.value].sort((_,I)=>new Date(I.created_at).getTime()-new Date(_.created_at).getTime()),a.value=a.value+1):(c.value=[e,...c.value].sort((_,I)=>new Date(I.created_at).getTime()-new Date(_.created_at).getTime()),i.value=i.value.filter(_=>_.id!==e.id),a.value=a.value-1)},P=async(e,n)=>{if(n)return;const _=e.is_read;try{await r.notification.update(e.id,{is_read:!_}),e.is_read=!_,x(e,_)}catch(I){H.error(`Failed to update Notification: ${await Y(I)}`)}},K=async e=>{e.is_read||(await r.notification.markAllAsRead(),await Promise.allSettled([k(),w()]))},U=async e=>{try{c.value=c.value.filter(n=>n.id!==e.id),await r.notification.delete(e.id)}catch(n){c.value=[e,...c.value],H.error(`Failed to delete Notification: ${await Y(n)}`)}};Q(d,async e=>{e==="read"?await k():await w()});const W=async()=>{g&&(clearTimeout(g),g=null);const e=f;f=null,e==null||e.cancel()},q=async()=>{await Promise.allSettled([k(),w()]),lt()||(W().catch(e=>console.log(e)),R().catch(e=>console.log(e)))};return Q(l,async(e,n)=>{try{e&&e!==n?await q():e||W().catch(_=>console.log(_))}catch(_){console.error(_)}},{immediate:!0}),{unreadNotifications:i,readNotifications:c,loadUnReadNotifications:w,loadReadNotifications:k,deleteNotification:U,readPageInfo:o,unreadPageInfo:u,isLoading:$,notificationTab:d,toggleRead:P,markAllAsRead:K,unreadCount:a}}),It={class:"flex pl-6 pr-4 w-full overflow-x-hidden group py-4 hover:bg-gray-50 gap-3 relative cursor-pointer"},$t={class:"w-9.625"},ht={class:"text-[13px] min-h-12 w-full leading-5"},Ct={key:0,class:"text-xs whitespace-nowrap absolute right-4.1 bottom-5 text-gray-600"},Rt={class:"flex items-start"},St=j({__name:"Wrapper",props:{item:{}},setup(c){const o=B(c,"item"),{isMobileMode:u}=z(),a=V(),{toggleRead:d,deleteNotification:r}=a;return($,l)=>{const g=L,f=J,N=_t,C=bt,R=ut,k=Nt,w=nt;return s(),y("div",It,[m("div",$t,[X($.$slots,"avatar",{},()=>[l[4]||(l[4]=m("img",{src:kt,alt:"NocoDB",class:"w-8"},null,-1))])]),m("div",ht,[X($.$slots,"default")]),t(o)?(s(),y("div",Ct,S(t(rt)(t(o).created_at)),1)):A("",!0),m("div",Rt,[t(o).is_read?(s(),b(w,{key:1,class:h([{"!opacity-100":t(u)},"transition-all duration-100 opacity-0 !group-hover:opacity-100"]),placement:"bottomRight"},{overlay:p(()=>[v(k,{variant:"small"},{default:p(()=>[v(C,{onClick:l[2]||(l[2]=M(()=>t(d)(t(o)),["stop"]))},{default:p(()=>l[6]||(l[6]=[O(" Mark as unread ")])),_:1,__:[6]}),v(R),v(C,{danger:"",onClick:l[3]||(l[3]=M(x=>t(r)(t(o)),["stop"]))},{default:p(()=>l[7]||(l[7]=[O(" Delete ")])),_:1,__:[7]})]),_:1})]),default:p(()=>[v(f,{size:"xsmall",type:"secondary",onClick:l[1]||(l[1]=M(()=>{},["stop"]))},{default:p(()=>[v(g,{icon:"threeDotVertical"})]),_:1})]),_:1},8,["class"])):(s(),b(N,{key:0},{title:p(()=>l[5]||(l[5]=[m("span",null,"Mark as read",-1)])),default:p(()=>[v(f,{class:h([{"!opacity-100":t(u)},"!border-0 transition-all duration-100 opacity-0 !group-hover:opacity-100"]),type:"secondary",size:"xsmall",onClick:l[0]||(l[0]=M(()=>t(d)(t(o)),["stop"]))},{default:p(()=>[v(g,{icon:"check",class:"text-gray-700"})]),_:1},8,["class"])]),_:1}))])])}}}),st=Object.assign(St,{__name:"NotificationItemWrapper"}),Et=j({__name:"Welcome",props:{item:{}},setup(c){const o=B(c,"item");return(u,a)=>{const d=st;return s(),b(d,{item:t(o)},{default:p(()=>a[0]||(a[0]=[m("div",null,[O("Welcome to "),m("span",{class:"font-semibold"},"NocoDB!"),O(" Weâ€™re excited to have you onboard.")],-1)])),_:1,__:[0]},8,["item"])}}}),Tt=Object.assign(Et,{__name:"NotificationItemWelcome"}),At={class:"font-semibold"},Mt={class:"font-semibold"},Ot=j({__name:"ProjectInvite",props:{item:{}},setup(c){const i=c,{navigateToProject:o}=z(),u=B(i,"item");return(a,d)=>{const r=st;return s(),b(r,{item:t(u),onClick:d[0]||(d[0]=$=>t(o)({baseId:t(u).body.base.id}))},{default:p(()=>[m("div",null,[m("span",At,S(t(u).body.user.display_name??t(u).body.user.email),1),d[1]||(d[1]=O(" has invited you to collaborate on ")),m("span",Mt,S(t(u).body.base.title),1),d[2]||(d[2]=O(" base. "))])]),_:1},8,["item"])}}}),jt=Object.assign(Ot,{__name:"NotificationItemProjectInvite"}),Pt={};function Wt(c,i){return s(),y("div")}const Dt=Object.assign(G(Pt,[["render",Wt]]),{__name:"NotificationItemMentionEvent"}),Ut={};function zt(c,i){return s(),y("div")}const Bt=Object.assign(G(Ut,[["render",zt]]),{__name:"NotificationItemRowMentionEvent"}),Gt={};function Vt(c,i){return s(),y("div")}const Kt=Object.assign(G(Gt,[["render",Vt]]),{__name:"NotificationItemWorkspaceUpgradeRequest"}),qt={key:6},Ft=j({__name:"Item",props:{item:{}},setup(c){const o=B(c,"item"),u=V(),{toggleRead:a}=u;return(d,r)=>{const $=Tt,l=jt,g=dt("NotificationItemWorkspaceInvite"),f=Dt,N=Bt,C=Kt;return s(),y("div",{class:"select-none",onClick:r[0]||(r[0]=R=>t(a)(t(o),t(o).is_read))},[t(o).type===t(D).WELCOME?(s(),b($,{key:0,item:t(o)},null,8,["item"])):t(o).type===t(D).PROJECT_INVITE?(s(),b(l,{key:1,item:t(o)},null,8,["item"])):t(o).type===t(D).WORKSPACE_USER_INVITE?(s(),b(g,{key:2,item:t(o)},null,8,["item"])):["mention"].includes(t(o).type)?(s(),b(f,{key:3,item:t(o)},null,8,["item"])):t(D).ROW_USER_MENTION===t(o).type?(s(),b(N,{key:4,item:t(o)},null,8,["item"])):t(o).type===t(D).WORKSPACE_UPGRADE_REQUEST?(s(),b(C,{key:5,item:t(o)},null,8,["item"])):(s(),y("span",qt))])}}}),Jt=Object.assign(Ft,{__name:"NotificationItem"}),Lt={class:"space-y-3"},Qt={class:"flex px-6 justify-between items-center"},Ht={class:"text-sm !text-gray-500"},Yt={class:"text-sm text-gray-500"},Xt=j({__name:"Card",emits:["close"],setup(c,{emit:i}){const o=i,u=V(),{isMobileMode:a}=z(),d=E(),{height:r}=mt(d),{loadUnReadNotifications:$,loadReadNotifications:l,markAllAsRead:g}=u,{unreadNotifications:f,readNotifications:N,readPageInfo:C,unreadPageInfo:R,notificationTab:k}=pt(u);return(w,x)=>{var e;const P=L,K=J,U=Jt,W=vt,q=ft;return s(),y("div",{ref_key:"container",ref:d,style:F([{"box-shadow":"0px -12px 16px -4px rgba(0, 0, 0, 0.1), 0px -4px 6px -2px rgba(0, 0, 0, 0.06)"},t(a)?"":"width: min(80svw, 520px);"]),class:h([{"max-h-[70vh] h-[620px]":!t(a),"h-[100svh] w-[100svw]":t(a)},"!rounded-lg pt-4"])},[m("div",Lt,[m("div",Qt,[m("span",{class:"text-md font-bold text-gray-800",onClick:x[0]||(x[0]=M(()=>{},["stop"]))},S(w.$t("general.notification"))+"s ",1),t(a)?(s(),b(K,{key:0,size:"small",type:"secondary",onClick:x[1]||(x[1]=n=>o("close"))},{default:p(()=>[v(P,{icon:"close",class:"text-gray-700"})]),_:1})):A("",!0)]),t(k)!=="read"?(s(),y("div",{key:0,class:h([{"text-gray-400":!((e=t(f))!=null&&e.length)},"cursor-pointer right-5 pointer-events-auto top-12.5 z-2 absolute text-[13px] text-gray-600 font-weight-semibold"]),onClick:x[2]||(x[2]=M((...n)=>t(g)&&t(g)(...n),["stop"]))},S(w.$t("activity.markAllAsRead")),3)):A("",!0),v(q,{"active-key":t(k),"onUpdate:activeKey":x[5]||(x[5]=n=>ot(k)?k.value=n:null)},{default:p(()=>[v(W,{key:"unread"},{tab:p(()=>[m("span",{class:h([{"font-semibold":t(k)==="unread"},"text-xs"])},S(w.$t("general.unread")),3)]),default:p(()=>{var n,_;return[m("div",{class:h(["overflow-y-auto",{"flex flex-col items-center min-h-[48svh] justify-center":!((n=t(f))!=null&&n.length)}]),style:F(`height: ${t(r)-72}px`)},[(_=t(f))!=null&&_.length?(s(),y(T,{key:1},[(s(!0),y(T,null,Z(t(f),I=>(s(),b(U,{key:I.id,item:I},null,8,["item"]))),128)),t(f)&&t(R)&&t(R).totalRows>t(f).length?(s(),b(t(tt),{key:0,onInfinite:x[3]||(x[3]=I=>t($)(!0))})):A("",!0)],64)):(s(),y(T,{key:0},[m("div",Ht,S(w.$t("msg.noNewNotifications")),1),v(P,{icon:"inbox",class:"!text-40px !text-gray-500"})],64))],6)]}),_:1}),v(W,{key:"read"},{tab:p(()=>[m("span",{class:h([{"font-semibold":t(k)==="read"},"text-xs"])},S(w.$t("general.read")),3)]),default:p(()=>{var n,_;return[m("div",{class:h(["overflow-y-auto",{"flex flex-col items-center min-h-[48svh] justify-center":!((n=t(N))!=null&&n.length)}]),style:F(t(a)?"":`height: ${t(r)-72}px`)},[(_=t(N))!=null&&_.length?(s(),y(T,{key:1},[(s(!0),y(T,null,Z(t(N),I=>(s(),b(U,{key:I.id,item:I},null,8,["item"]))),128)),t(N)&&t(C)&&t(C).totalRows>t(N).length?(s(),b(t(tt),{key:0,onInfinite:x[4]||(x[4]=I=>t(l)(!0))})):A("",!0)],64)):(s(),y(T,{key:0},[m("div",Yt,S(w.$t("msg.noNewNotifications")),1),v(P,{icon:"inbox",class:"!text-40px text-gray-500"})],64))],6)]}),_:1})]),_:1},8,["active-key"])])],6)}}}),Zt=Object.assign(G(Xt,[["__scopeId","data-v-4998a298"]]),{__name:"NotificationCard"}),te={class:"cursor-pointer flex items-center"},ee=j({__name:"Menu",setup(c){const i=yt(gt,void 0),o=V(),{unreadCount:u}=xt(o),a=E(!1);return(d,r)=>{const $=L,l=J,g=Zt,f=nt;return s(),y("div",te,[v(f,{visible:t(a),"onUpdate:visible":r[1]||(r[1]=N=>ot(a)?a.value=N:null),"overlay-class-name":"!shadow-none",placement:t(i)?"right":"bottomRight",trigger:["click"]},{overlay:p(()=>[v(g,{onClose:r[0]||(r[0]=N=>a.value=!1)})]),default:p(()=>[m("div",{class:h({"nc-mini-sidebar-btn-full-width":t(i),flex:!t(i)})},[v(l,{size:t(i)?"xs":"small",class:h(["!border-none nc-mini-sidebar-btn",{hovered:t(a)}]),type:"text","data-testid":"nc-sidebar-notification-btn"},{default:p(()=>[t(u)?(s(),y("span",{key:t(u),class:"bg-red-500 w-2 h-2 border-1 border-white rounded-[6px] absolute top-[5px] left-[15px]"})):A("",!0),v($,{icon:"notification",class:h({"h-4 w-4":t(i)})},null,8,["class"])]),_:1},8,["size","class"])],2)]),_:1},8,["visible","placement"])])}}}),ce=Object.assign(ee,{__name:"NotificationMenu"});export{ce as default};
