import{jy as N,r as u,f as C,a9 as J,n as c,a4 as l,a5 as v,y as M}from"./DRA9KN5F.js";var T=(s=>(s.Save="save",s.Test="test",s))(T||{});const[x,j]=N(()=>{const s=u([]),{$api:i,$e:w}=C(),{t:p}=J(),a=u(null),g=u({}),f=u(!1),r=u(null),y=u(!1),S=c(()=>s.value.filter(e=>e.category==="Email")),m=c(()=>s.value.filter(e=>e.category==="Storage")),h=c(()=>S.value.find(e=>e.active)),A=c(()=>m.value.find(e=>e.active)),P=u(!1),D=u(!1),I=c(()=>s.value.reduce((e,t)=>{const n=t.category.toLowerCase();return e[n]||(e[n]=[]),e[n].push(t),e},{})),d=async()=>{try{const e=(await i.plugin.list()).list??[];s.value=e.map(t=>({...t,tags:t.tags?t.tags.split(","):[],parsedInput:t.input&&JSON.parse(t.input)}))}catch(e){l.error(await v(e))}};return{apps:s,emailApps:S,storageApps:m,loadSetupApps:d,categorizeApps:I,activePlugin:a,readPluginDetails:async e=>{try{f.value=!0;const t=await i.plugin.read(e),n=JSON.parse(t.input_schema??"{}"),O=n.array?[{}]:{},o=typeof t.input=="string"?JSON.parse(t.input):O;"secure"in o&&typeof o.secure=="string"&&(o.secure=o.secure==="true"),a.value={...t,formDetails:n,parsedInput:o},g.value=a.value.parsedInput}catch(t){console.log(t)}finally{f.value=!1}},activePluginFormData:g,isLoading:f,testSettings:async()=>{r.value="test";try{a.value&&(await i.plugin.test({input:JSON.stringify(g.value),title:a.value.title,category:a.value.category})?l.success(p("msg.success.pluginTested")):l.info(p("msg.info.invalidCredentials")))}catch(e){l.error(await v(e))}finally{r.value=null}},saveSettings:async()=>{var e,t;r.value="save";try{await i.plugin.update((e=a.value)==null?void 0:e.id,{input:JSON.stringify(g.value),active:!0}),l.success(((t=a.value)==null?void 0:t.formDetails.msgOnInstall)||p("msg.success.pluginSettingsSaved")),d().catch(console.error),M("/account/setup")}catch(n){l.error(await v(n))}finally{r.value=null}},loadingAction:r,emailConfigured:h,storageConfigured:A,listModalDlg:P,configModalDlg:D,showPluginUninstallModal:y,resetPlugin:async()=>{try{await i.plugin.update(a.value.id,{input:null,active:!1}),l.success(p("msg.success.pluginUninstalled")),y.value=!1,await d()}catch(e){l.error(await v(e))}w("a:appstore:reset",{app:a.value.title})}}});function z(){const s=j();return s??x()}export{T as A,z as a,x as u};
