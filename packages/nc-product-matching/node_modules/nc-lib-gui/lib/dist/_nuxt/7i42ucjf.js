import{e as oe,ak as he,dk as se,G as _,r as v,bc as ie,bd as ne,n as B,aj as d,aC as re,jg as ye,aD as ae,fP as U,iX as le,c as f,o as s,b as I,L as e,b5 as ke,fL as we,bX as Ce,J as Oe,al as Ie,j8 as Te,gd as De,fN as Me,aG as xe,g as Le,ac as $e,I as p,w as c,ap as Be,ag as w,ad as M,N as Ee,a as g,K as x,b9 as L,bo as $,t as C,d as A,O,an as Q,aq as ee,bB as Ne,eJ as Ve,aH as Ue,Q as te,ah as Re,f3 as je,_ as Fe}from"./DRA9KN5F.js";import{_ as Pe}from"./I4_ApCDr.js";import{u as pe}from"./D7poRkS0.js";import{u as de}from"./CC4cUItJ.js";import ze from"./xLIsHrMo.js";import{_ as Ge}from"./GU4raMbz.js";import{g as Ae,a as Qe}from"./CKrOnbU4.js";import{u as We}from"./CQa0sIfA.js";import{u as He}from"./Bw607vNV.js";import{u as Je}from"./Bfaa-xBo.js";import"./DkDj6Z7Z.js";import"./EcM5l_HA.js";import"./C2UaKEE0.js";import"./BLPDl4Qg.js";import"./CsX17Y_h.js";import"./CHRPOXXy.js";import"./gByPF8bR.js";import"./BCBMEREK.js";import"./C_gbauhL.js";import"./C_VN1MCC.js";import"./BmscXXs6.js";import"./gAYHr7Gr.js";import"./By5RWL3d.js";import"./DWLi1ZcL.js";import"./C2xdh4Xe.js";import"./boyBAVNN.js";import"./C316Za7m.js";import"./B94p8ToD.js";import"./Cd4chHHL.js";import"./yMSt-9W5.js";import"./BYKJ-MHf.js";import"./CI3EriLB.js";import"./owbQkEXm.js";import"./DlXIlcns.js";import"./DP83Cqnl.js";import"./CVZBrAgI.js";import"./LhVKWcKT.js";import"./QeWwuUYP.js";import"./B89wxTuy.js";import"./DjPyxH1k.js";import"./DCa6wpIA.js";import"./B8gs0dG7.js";import"./mXY_vhPu.js";import"./B1qoNiTF.js";import"./CbX26EBz.js";import"./CYKJe2Bk.js";import"./DkpDpjnr.js";import"./Dv0nYk-Y.js";import"./DGFEr0h-.js";import"./DfIS_byq.js";import"./YbUkeyWR.js";import"./lL-0_K96.js";import"./CIOK9Y4w.js";import"./CNwEZGnv.js";import"./BVqTF1QK.js";import"./Ce4xoeky.js";import"./C3FZdmXk.js";import"./DDmv9w84.js";import"./BALLsGq5.js";import"./DCm6TF8M.js";import"./Bj4kMpzI.js";import"./CbSESqy_.js";import"./Bxzk9hCO.js";import"./Bm6QmuXP.js";import"./CkpISeXq.js";import"./zMMvJhqz.js";import"./ytmFgNfN.js";import"./DxC2Oool.js";import"./CG-5KGUk.js";import"./CkvAmLZt.js";import"./D7OHpRdS.js";import"./DvtLu3FC.js";import"./D_txg4HT.js";import"./JqUqXTOd.js";import"./I4o4wRE2.js";import"./BMPzbwPk.js";import"./CwPFbl3n.js";import"./C5HnjaiI.js";import"./CBhmoxRW.js";import"./Bc3_tI4-.js";import"./CJAyvGKH.js";import"./D43249YX.js";import"./U3gU45AW.js";import"./BBg0y0zb.js";import"./-iDxnmJF.js";import"./C1XMFoVa.js";import"./C-ZUx0lq.js";import"./YYodiGXA.js";const Xe={class:"nc-sort-create-modal"},qe=oe({__name:"CreateSort",props:{isParentOpen:{type:Boolean}},emits:["created"],setup(W,{emit:E}){const R=W,r=E,{isParentOpen:T}=he(R),j=se(),F=_(ie,v()),N=_(ne,v()),{showSystemFields:a,metaColumnById:h}=pe(),{sorts:V}=de(F),P=B(()=>{var b,y;return(((y=j((b=N.value)==null?void 0:b.columns))==null?void 0:y.filter(i=>{var l;return i.uidt===d.Links?!0:re((l=h==null?void 0:h.value)==null?void 0:l[i.id])?ye(i,N.value)?!1:a.value:!(ae(i)&&![U.BELONGS_TO,U.ONE_TO_ONE].includes(i.colOptions.type))}).filter(i=>!V.value.find(l=>l.fk_column_id===i.id)))??[]).map(i=>([d.QrCode,d.Barcode,d.ID,d.Button].includes(i.uidt)&&(i.ncItemDisabled=!0,i.ncItemTooltip=`Sorting is not supported for ${le[i.uidt]} field`),i))}),z=b=>{r("created",b)};return(b,y)=>{const i=Pe;return s(),f("div",Xe,[I(i,{"is-parent-open":e(T),"search-input-placeholder":b.$t("msg.selectFieldToSort"),options:e(P),"toolbar-menu":"sort",onSelected:z},null,8,["is-parent-open","search-input-placeholder","options"])])}}}),Ke=Object.assign(qe,{__name:"SmartsheetToolbarCreateSort"}),Ye={class:"flex items-center gap-1 min-h-5"},Ze={class:"flex items-center gap-2"},et={key:0,class:"text-capitalize !text-[13px] font-medium"},tt={key:1,class:"pt-2 pb-2 pl-4 nc-filter-list max-h-[max(80vh,30rem)] min-w-102","data-testid":"nc-sorts-menu"},ot={class:"w-full flex items-center justify-between gap-2"},st={class:"truncate flex-1"},it={class:"flex gap-1 items-center"},nt={key:1},rt={class:"flex gap-1 items-center"},at=oe({__name:"SortListMenu",setup(W){const E=_(ne,v()),R=_(ie,v()),r=_(ke,v(!1)),T=_(we),j=_(Ce,v(!1)),F=se(),{eventBus:N}=We(),{sorts:a,saveOrUpdate:h,loadSorts:V,addSort:P,deleteSort:z}=de(R,()=>T==null?void 0:T.trigger()),{showSystemFields:b,metaColumnById:y}=pe(),{appearanceConfig:i}=He(),l=v(!1),{isMobileMode:H}=Oe(),{getPlanLimit:me}=Ie(),J=_(Te,v(!1)),X=_(De,B(()=>!1));N.on(o=>{o===Me.SORT_RELOAD&&V()});const G=B(()=>{var o;return F(((o=E.value)==null?void 0:o.columns)||[]).map(t=>([d.QrCode,d.Barcode,d.ID,d.Button].includes(t.uidt)&&(t.ncItemDisabled=!0,t.ncItemTooltip=`Sorting is not supported for ${le[t.uidt]} field`),t))}),ce=B(()=>G.value.reduce((o,t)=>(o[t.id]=t,o),{})),ue=B(()=>{var o;return(o=G.value)==null?void 0:o.filter(t=>{var u;return t.uidt===d.Links?!0:re((u=y==null?void 0:y.value)==null?void 0:u[t.id])?b.value:t.uidt===d.QrCode||t.uidt===d.Barcode||t.uidt===d.ID||t.uidt===d.Button?!1:!(ae(t)&&![U.BELONGS_TO,U.ONE_TO_ONE].includes(t.colOptions.type))}).filter(t=>!a.value.find(u=>u.fk_column_id===t.id))}),fe=o=>Qe(o,ce.value),S=v(!1);Je(S);const q=o=>{P(!0,o);const t=a.value[a.value.length-1];h(t,a.value.length-1),l.value=!1};return xe(S,()=>{S.value||(l.value=!1)}),Le(()=>{V()}),(o,t)=>{const u=Ee,K=Be,Y=Ke,_e=ze,ve=Ve,be=Ne,Z=Ue,Se=Ge,D=$e("e");return s(),p(Z,{visible:e(S),"onUpdate:visible":t[7]||(t[7]=n=>te(S)?S.value=n:null),trigger:["click"],class:"!xs:hidden","overlay-class-name":"nc-dropdown-sort-menu nc-toolbar-dropdown overflow-hidden"},{overlay:c(()=>[g("div",{class:w({"nc-locked-view":e(r)})},[e(a).length?(s(),f("div",tt,[g("div",{class:"sort-grid max-h-120 nc-scrollbar-thin pr-4 my-2 py-1",onClick:t[2]||(t[2]=O(()=>{},["stop"]))},[(s(!0),f(Q,null,ee(e(a),(n,k)=>(s(),f("div",{key:k,class:"flex first:mb-0 !mb-1.5 !last:mb-0 items-center"},[I(_e,{modelValue:n.fk_column_id,"onUpdate:modelValue":[m=>n.fk_column_id=m,m=>e(h)(n,k)],class:"flex caption nc-sort-field-select !w-44 flex-grow",columns:e(G),"is-sort":"",meta:e(E),disabled:e(r),onClick:t[0]||(t[0]=O(()=>{},["stop"]))},null,8,["modelValue","onUpdate:modelValue","columns","meta","disabled"]),I(be,{value:n.direction,"onUpdate:value":m=>n.direction=m,class:"flex flex-grow-1 w-full nc-sort-dir-select",label:o.$t("labels.operation"),"dropdown-class-name":"sort-dir-dropdown nc-dropdown-sort-dir !rounded-lg",disabled:e(r),onClick:t[1]||(t[1]=O(()=>{},["stop"])),onSelect:m=>e(h)(n,k)},{default:c(()=>[(s(!0),f(Q,null,ee(("getSortDirectionOptions"in o?o.getSortDirectionOptions:e(Ae))(fe(n.fk_column_id)),(m,ge)=>M((s(),p(ve,{key:ge,value:m.value},{default:c(()=>[g("div",ot,[g("div",st,C(m.text),1),n.direction===m.value?(s(),p(L(("iconMap"in o?o.iconMap:e($)).check),{key:0,id:"nc-selected-item-icon",class:"text-primary w-4 h-4"})):x("",!0)])]),_:2},1032,["value"])),[[D,["c:sort:operation:select"]]])),128))]),_:2},1032,["value","onUpdate:value","label","disabled","onSelect"]),I(K,{placement:"top",title:"Remove",class:"flex-none"},{default:c(()=>[M((s(),p(u,{size:"small",type:"secondary",shadow:!1,disabled:e(r),class:"nc-sort-item-remove-btn !max-w-8 !border-l-transparent !rounded-l-none",onClick:O(m=>e(z)(n,k),["stop"])},{default:c(()=>[(s(),p(L(("iconMap"in o?o.iconMap:e($)).deleteListItem)))]),_:2},1032,["disabled","onClick"])),[[D,["c:sort:delete"]]])]),_:2},1024)]))),128))]),e(ue).length?(s(),p(Z,{key:0,visible:e(l),"onUpdate:visible":t[5]||(t[5]=n=>te(l)?l.value=n:null),trigger:["click"],disabled:e(r),"overlay-class-name":"nc-toolbar-dropdown"},{overlay:c(()=>[I(Y,{"is-parent-open":e(l),onCreated:q},null,8,["is-parent-open"])]),default:c(()=>[("isEeUI"in o?o.isEeUI:e(Re))&&!e(j)?(s(),f(Q,{key:0},[e(a).length<e(me)(e(je).LIMIT_SORT_PER_VIEW)?M((s(),p(u,{key:0,class:w(["mt-1 mb-2",{"!text-brand-500":!e(r)}]),type:"text",size:"small",disabled:e(r),onClick:t[3]||(t[3]=O(n=>l.value=!0,["stop"]))},{default:c(()=>[g("div",it,[(s(),p(L(("iconMap"in o?o.iconMap:e($)).plus))),A(" "+C(o.$t("activity.addSort")),1)])]),_:1},8,["class","disabled"])),[[D,["c:sort:add"]]]):(s(),f("span",nt))],64)):M((s(),p(u,{key:1,class:w(["mt-1 mb-2",{"!text-brand-500":!e(r)}]),type:"text",size:"small",disabled:e(r),onClick:t[4]||(t[4]=O(n=>l.value=!0,["stop"]))},{default:c(()=>[g("div",rt,[(s(),p(L(("iconMap"in o?o.iconMap:e($)).plus))),A(" "+C(o.$t("activity.addSort")),1)])]),_:1},8,["class","disabled"])),[[D,["c:sort:add"]]])]),_:1},8,["visible","disabled"])):x("",!0)])):(s(),p(Y,{key:0,"is-parent-open":e(S),disabled:e(r),onCreated:q},null,8,["is-parent-open","disabled"])),e(r)?(s(),p(Se,{key:2,class:w({"-mt-2":e(a).length}),onOnOpen:t[6]||(t[6]=n=>S.value=!1)},null,8,["class"])):x("",!0)],2)]),default:c(()=>{var n;return[I(K,{disabled:!e(H)&&!e(X),class:w({"nc-active-btn":(n=e(a))==null?void 0:n.length})},{title:c(()=>[A(C(o.$t("activity.sort")),1)]),default:c(()=>{var k;return[M((s(),p(u,{class:w([{"!border-1 !rounded-md":e(J),"!border-0":!e(J),[e(i).SORTED.toolbarBgClass]:(k=e(a))==null?void 0:k.length},"nc-sort-menu-btn nc-toolbar-btn !h-7 group"]),size:"small",type:"secondary","show-as-disabled":e(r)},{default:c(()=>{var m;return[g("div",Ye,[g("div",Ze,[(s(),p(L(("iconMap"in o?o.iconMap:e($)).sort),{class:"h-4 w-4 text-inherit"})),!e(H)&&!e(X)?(s(),f("span",et,C(o.$t("activity.sort")),1)):x("",!0)]),(m=e(a))!=null&&m.length?(s(),f("span",{key:0,class:w(["nc-toolbar-btn-chip",{[e(i).SORTED.toolbarChipBgClass]:!0,[e(i).SORTED.toolbarTextClass]:!0}])},C(e(a).length),3)):x("",!0)])]}),_:1},8,["class","show-as-disabled"])),[[D,["c:sort"]]])]}),_:1},8,["disabled","class"])]}),_:1},8,["visible"])}}}),Go=Object.assign(Fe(at,[["__scopeId","data-v-d802fe1f"]]),{__name:"SmartsheetToolbarSortListMenu"});export{Go as default};
