import{fY as S,jj as N,g$ as O,jk as T,jl as F,ih as R,jm as C,im as b,jn as Y,io as U,ip as L,jo as x,ik as I,ii as P,iE as B,ij as M,il as E,jp as J,jq as q,jr as z,js as H,jt as X,iR as G,hX as W,i2 as Z,fZ as Q,go as K,g5 as w,h5 as v,iu as V,aC as tt,fV as it,aj as y,aF as g,g_ as rt,el as d,hW as nt,jh as st,hy as et,hY as ft,h$ as at,i$ as $,i9 as ct,fP as ot,gZ as ut,ju as pt}from"./DRA9KN5F.js";const Ft=(t,r)=>{if(!t||!r)return null;const i=r.filter(n=>n.pk);if(i.length>1)return i.map(n=>{var s,f;return((f=(s=t==null?void 0:t[n.title])==null?void 0:s.toString)==null?void 0:f.call(s).replaceAll("_","\\_"))??null}).join("___");if(i.length){const n=(t==null?void 0:t[i[0].title])??null;return n===null?null:`${n}`}},Rt=(t,r)=>{const i={},n=r==null?void 0:r.filter(s=>s.pk);if(t&&n&&n.length)for(const s of n)s.title&&(i[s.title]=t[s.title]);return i},Ct=t=>!t&&!Array.isArray(t)?null:t.filter(r=>r.pk).map(r=>r.title).join("___"),bt=(t,r)=>{for(const[i,n]of Object.entries(r))if(Object.keys(t).every(s=>t[s]===n.row[s]))return parseInt(i);return-1};async function Yt({getMeta:t,row:r,meta:i,ltarState:n,throwError:s,undo:f=!1}){var c;const e=new Set,a=await((c=i.columns)==null?void 0:c.reduce(async(u,o)=>{const _=await u;if(n&&o.uidt===y.LinkToAnotherRecord&&o.colOptions.type===ot.BELONGS_TO&&(n[o.title]||r[o.title])){const p=n[o.title]||r[o.title],k=o.colOptions,l=i.columns.find(j=>k.fk_child_column_id===j.id),m=await t(k.fk_related_model_id);m&&l&&(_[l.title]=p[m.columns.find(j=>j.id===k.fk_parent_column_id).title],_[l.title]!==null&&_[l.title]!==void 0&&e.delete(l.title))}return ut(o,r)&&e.add(o.title),(!o.ai||f)&&(r==null?void 0:r[o.title])!==null&&(_[o.title]=r==null?void 0:r[o.title]),_},Promise.resolve({})));if(s&&e.size)throw new Error(`Missing required columns: ${[...e].join(", ")}`);return{missingRequiredColumns:e,insertObj:a}}const Ut=(t=[])=>t.reduce((i,n)=>{if(!tt(n)&&!it(n)&&![y.Attachment,y.Rollup,y.Lookup,y.Formula,y.Barcode,y.QrCode].includes(n.uidt)&&S(n==null?void 0:n.cdf)&&!/^\w+\(\)|CURRENT_TIMESTAMP$/.test(n.cdf)){const s=n.cdf;i[n.title]=typeof s=="string"?s.replace(/^['"]|['"]$/g,""):s}return i},{}),Lt=(t,r)=>!t||!r||!r.title?!0:!S(t.row[r.title]);function xt(t,r,i,n,s,f){return pt({filters:t,data:r,columns:i,client:n,metas:s,options:f})}const It=t=>t?!!(N(t)||O(t)):!1,_t=t=>!!t&&t!=="0"&&t!==0&&t!=="false",dt=(t,r)=>{const{col:i,isMysql:n}=r;return t?t?Array.isArray(t)?t.join(", "):t.toString():n(i.source_id)?t.toString().split(",").join(", "):t.split(", "):""},yt=(t,r)=>{var n;const i=((n=g(r.meta))==null?void 0:n.date_format)??"YYYY-MM-DD";if(t){if(d(t).isValid())return d(/^\d+$/.test(String(t))?+t:t).format(i);{const s=nt(t);if(s)return s.format(i)}}else return"";return""},gt=t=>t&&d(t).isValid()?d(t.toString(),"YYYY").format("YYYY"):"",A=(t,r)=>{var p,k;const{col:i,isXcdbBase:n}=r;if(!t||!d(t).isValid())return"";const s=g(i.meta),f=(s==null?void 0:s.date_format)??st[0],e=(s==null?void 0:s.time_format)??et[0],a=`${f} ${e}`,c=void 0,{timezonize:u}=ft(c==null?void 0:c.name),o="";return n(i.source_id)?((k=u(d(t)))==null?void 0:k.format(a))+o:((p=u(d(/^\d+$/.test(t)?+t:t)))==null?void 0:p.format(a))+o},kt=(t,r)=>{var s;const i=(s=g(r==null?void 0:r.meta))!=null&&s.is12hrFormat?"hh:mm A":"HH:mm";if(!t)return"";let n=d(t);return n.isValid()||(n=d(t,"HH:mm:ss")),n.isValid()||(n=d(`1999-01-01 ${t}`)),n.isValid()?n.format(i):""},lt=(t,r)=>{var n;const i=((n=g(r.meta))==null?void 0:n.duration)||0;return at(t,i)},ht=t=>t?`${t}%`:"",jt=(t,r)=>{const i={currency_locale:"en-US",currency_code:"USD",...g(r.meta)};try{return t==null||isNaN(t)?t??"":new Intl.NumberFormat(i.currency_locale||"en-US",{style:"currency",currency:i.currency_code||"USD"}).format(+t)}catch{return t}},D=(t,r)=>{const{meta:i,baseUsers:n=new Map}=r;if(!t)return"";const s=i!=null&&i.base_id?n.get(i==null?void 0:i.base_id)||[]:[];return typeof t=="string"?t.split(",").map(e=>{const a=s.find(c=>c.id===e||c.email===e);return a?a.display_name||a.email:e.id}).join(", "):Array.isArray(t)?t.map(f=>{const e=s.find(a=>a.id===f.id||a.email===f.email);return e?e.display_name||e.email:f.id}).join(", "):t?t.display_name||t.email:""},mt=(t,r)=>{if(!$(t)&&!t||isNaN(Number(t)))return"";const i=g(r.meta);return Number(t).toFixed((i==null?void 0:i.precision)??1)},At=t=>!$(t)&&!t||isNaN(Number(t))?"":Number(t).toString(),Dt=(t,r)=>g(r.meta).richMode?(t==null?void 0:t.replace(/[*_~\[\]]|<\/?[^>]+(>|$)/g,""))||"":rt(r)?(t==null?void 0:t.value)||"":t||"",St=(t,r)=>{var o,_;const{col:i,meta:n,metas:s}=r,f=i.colOptions,e=f.fk_relation_column_id?(_=(o=n==null?void 0:n.columns)==null?void 0:o.find(p=>p.id===f.fk_relation_column_id))==null?void 0:_.colOptions:null,a=(e==null?void 0:e.fk_related_model_id)&&(s==null?void 0:s[e.fk_related_model_id]);let c=a==null?void 0:a.columns.find(p=>p.id===f.fk_rollup_column_id);if(!c)return(t==null?void 0:t.toString())??"";c={...c};const u=ct(c.uidt??y.SingleLineText);return c.meta={...g(c==null?void 0:c.meta),...g(i==null?void 0:i.meta)},u.includes(f.rollup_function??"")&&(c.uidt=y.Decimal),h(t,{...r,col:c})},$t=(t,r)=>{var u,o,_;const{col:i,meta:n,metas:s}=r,f=i.colOptions,e=f.fk_relation_column_id?(_=(o=(u=(n==null?void 0:n.value)??n)==null?void 0:u.columns)==null?void 0:o.find(p=>p.id===f.fk_relation_column_id))==null?void 0:_.colOptions:i.colOptions,a=(e==null?void 0:e.fk_related_model_id)&&(s==null?void 0:s[e.fk_related_model_id]),c=a==null?void 0:a.columns.find(p=>p.id===((f==null?void 0:f.fk_lookup_column_id)??(a==null?void 0:a.columns.find(k=>k.pv).id)));return Array.isArray(t)?t.map(p=>h(p,{...r,col:c})).join(", "):h(t,{...r,col:c})},Nt=t=>Array.isArray(t)?t.map(r=>`${r.title}`).join(", "):t,Ot=(t,r)=>{var f,e,a;const{col:i,t:n}=r;typeof(i==null?void 0:i.meta)=="string"&&(i.meta=JSON.parse(i.meta));const s=+t||0;return s?s===1?`1 ${((e=i==null?void 0:i.meta)==null?void 0:e.singular)||n("general.link")}`:`${s} ${((a=i==null?void 0:i.meta)==null?void 0:a.plural)||n("general.links")}`:`0 ${((f=i==null?void 0:i.meta)==null?void 0:f.plural)||n("general.links")}`},h=(t,r)=>{var f,e,a,c;const{col:i,abstractType:n,isUnderLookup:s}=r;if(!i)return"";if(T(i)){const[u,o]=(t||"").split(";");return u&&o?`${u}; ${o}`:t}if(F(i))return Dt(t,i);if(R(i,n))return _t(t)?"Checked":"Unchecked";if(C(i))return dt(t,r);if(b(i,n))return yt(t,i);if(Y(i,n))return gt(t);if(U(i,n))return A(t,r);if(L(i,n))return kt(t,i);if(x(i))return lt(t,i);if(I(i))return ht(t);if(P(i))return jt(t,i);if(B(i))return D(t,r);if(M(i))return mt(t,i);if(E(i))return t?`${t}`:"0";if(J(i,n))return At(t);if(q(i))try{return s?JSON.stringify(typeof t=="string"?JSON.parse(t):t):JSON.stringify(JSON.parse(t),null,2)}catch{return t}if(z(i))return St(t,r);if(H(i))return Ot(t,r);if(X(i)||G(i.uidt,i.colOptions))return $t(t,r);if(W(i))return A(t,r);if(Z(i))return D(t,r);if(Q(i))return Nt(t);if(K(i))if((f=i==null?void 0:i.meta)!=null&&f.display_type){const u={uidt:(e=i==null?void 0:i.meta)==null?void 0:e.display_type,...(a=i==null?void 0:i.meta)==null?void 0:a.display_column_meta};return h(t,{...r,col:u})}else{const u=w(t,!0);if(u&&v(u))return u}return V(i)?i.colOptions.type==="url"?t:(c=i.colOptions)==null?void 0:c.label:t};export{kt as a,h as b,Ut as c,Ct as d,Ft as e,It as f,_t as g,bt as h,Lt as i,Yt as p,Rt as r,xt as v};
