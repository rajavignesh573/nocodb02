import{bi as ee,c as f,o as c,a as s,e as se,a9 as te,f as oe,aR as ae,a7 as le,r as $,eL as _,X as M,n as I,oN as ne,I as p,w as l,b as a,d as g,t as i,at as ie,au as re,L as n,b9 as C,bo as R,ad as ce,a0 as de,a1 as me,ar as ue,O as _e,bB as pe,an as ve,aq as fe,eJ as xe,K as he,ap as ye,M as ge,af as we,ah as be,ag as ke,bU as Ue,a4 as v,a5 as $e,kZ as Me,_ as Ie}from"./DRA9KN5F.js";import{u as Ce}from"./DCa6wpIA.js";import{T as Re}from"./D9Lj0wrL.js";import{_ as Te}from"./BCBMEREK.js";const Ee={class:"nc-icon",viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"};function Be(T,d){return c(),f("svg",Ee,d[0]||(d[0]=[s("path",{fill:"currentColor",d:"M3 20V4l19 8zm2-3l11.85-5L5 7v3.5l6 1.5l-6 1.5zm0 0V7z"},null,-1)]))}const Ve=ee({name:"material-symbols-send-outline",render:Be}),je={class:"flex flex-col"},Ne={class:"flex flex-row justify-between items-center pb-1.5 mb-2 border-b-1 w-full"},Se={class:"px-2 mt-1.5"},De={key:0,class:"flex flex-col mt-1 pb-5"},Le={class:"flex flex-row items-center pl-1.5 pb-1 h-[1.1rem]"},Oe={class:"text-xs ml-0.5 mt-0.5","data-rec":"true"},ze={class:"flex flex-row justify-between items-center py-1"},Fe={class:"flex pl-2 text-green-700 text-xs","data-rec":"true"},qe={class:"flex text-xs text-gray-500 mt-2 justify-start ml-2","data-rec":"true"},Ae={class:"flex flex-row justify-end mt-4 ml-2"},Pe={class:"flex flex-row justify-center items-center space-x-0.5"},We={class:"text-xs text-gray-600","data-rec":"true"},Ge={key:1,class:"flex flex-col pb-4"},Je={class:"border-1 py-3 px-4 rounded-md mt-1"},Ke={class:"flex flex-row space-x-4"},Xe={class:"flex flex-col w-3/4"},Ze={class:"ml-1 mb-1 text-xs text-gray-500","data-rec":"true"},He={class:"flex flex-col w-2/4"},Qe={class:"ml-1 mb-1 text-xs text-gray-500"},Ye={class:"w-full flex items-start gap-1"},es={class:"flex-1 max-w-[calc(100%_-_16px)]"},ss={class:"nc-select-hide-item text-gray-500 text-xs whitespace-normal","data-rec":"true"},ts={class:"flex flex-row justify-end"},os={class:"flex flex-row justify-center items-center space-x-1.5"},as={"data-rec":"true"},ls=se({__name:"UsersModal",props:{show:{type:Boolean},selectedUser:{}},emits:["closed","reload"],setup(T,{emit:d}){const x=d,{t:w}=te(),{$api:E,$e:h}=oe(),{copy:B}=ae(),{dashboardUrl:V}=Ce(),{clearBasesUser:j}=le(),t=$({emails:"",role:_.VIEWER,invitationToken:void 0}),b=$(),N=M.useForm,S=I(()=>({emails:[ne]})),{validateInfos:D}=N(t.value,S),L=async()=>{var e;h("a:org-user:invite",{role:t.value.role}),await((e=b.value)==null?void 0:e.validateFields());try{const o=await E.orgUsers.add({roles:t.value.role,email:t.value.emails});t.value.invitationToken=o.invite_token,x("reload"),v.success(w("msg.success.userAdded")),j()}catch(o){console.error(o),v.error(await $e(o))}},y=I(()=>t.value.invitationToken?`${V.value}#/signup/${t.value.invitationToken}`:null),O=async()=>{if(y.value){try{await B(y.value),v.success(w("msg.toast.inviteUrlCopy"))}catch(e){v.error(e.message)}h("c:shared-base:copy-url")}},z=()=>{h("c:user:invite-more"),t.value.invitationToken=void 0,t.value.role=_.VIEWER,t.value.emails=""},F=e=>e==null?void 0:e.focus(),q=e=>{var m;const o=((m=e.clipboardData)==null?void 0:m.getData("text"))??"";t.value.emails=Me(o)||o},A=[{title:"objects.roleType.orgLevelCreator",subtitle:"msg.info.roles.orgCreator",value:_.CREATOR},{title:"objects.roleType.orgLevelViewer",subtitle:"msg.info.roles.orgViewer",value:_.VIEWER}];return(e,o)=>{const m=Re,P=re,u=ie,W=Te,k=Ve,G=ue,U=de,J=ye,K=ge,X=xe,Z=pe,H=M,Q=Ue;return c(),p(Q,{class:ke({active:e.show}),footer:null,centered:"",visible:e.show,closable:!1,width:"max(50vw, 44rem)","wrap-class-name":"nc-modal-invite-user",onCancel:o[3]||(o[3]=r=>x("closed"))},{default:l(()=>[s("div",je,[s("div",Ne,[a(m,{class:"select-none",level:4,"data-rec":"true"},{default:l(()=>[g(i(e.$t("activity.inviteUser")),1)]),_:1}),a(u,{type:"text",class:"!rounded-md mr-1 -mt-1.5",onClick:o[0]||(o[0]=r=>x("closed"))},{icon:l(()=>[a(P,{"data-testid":"nc-root-user-invite-modal-close",class:"flex mx-auto"})]),_:1})]),s("div",Se,[n(t).invitationToken?(c(),f("div",De,[s("div",Le,[(c(),p(C(("iconMap"in e?e.iconMap:n(R)).account))),s("div",Oe,i(e.$t("activity.copyInviteURL")),1)]),a(W,{class:"!mt-2",type:"success","show-icon":""},{message:l(()=>[s("div",ze,[s("div",Fe,i(n(y)),1),a(u,{type:"text",class:"!rounded-md -mt-0.5",onClick:O},{icon:l(()=>[(c(),p(C(("iconMap"in e?e.iconMap:n(R)).copy),{class:"flex mx-auto text-green-700 h-[1rem]"}))]),_:1})])]),_:1}),s("div",qe,i(e.$t("msg.info.userInviteNoSMTP"))+" "+i(n(t).invitationToken&&n(t).emails),1),s("div",Ae,[a(u,{size:"middle",outlined:"",onClick:z},{default:l(()=>[s("div",Pe,[a(k,{class:"flex mx-auto text-gray-600 h-[0.8rem]"}),s("div",We,i(e.$t("activity.inviteMore")),1)])]),_:1})])])):(c(),f("div",Ge,[s("div",Je,[a(H,{ref_key:"formRef",ref:b,"validate-on-rule-change":!1,model:n(t),"validate-trigger":"onBlur",onFinish:L},{default:l(()=>[s("div",Ke,[s("div",Xe,[a(U,me(n(D).emails,{"validate-trigger":"onBlur",name:"emails",rules:[{required:!0,message:e.$t("msg.plsInputEmail")}]}),{default:l(()=>[s("div",Ze,i(e.$t("datatype.Email"))+":",1),a(G,{ref:F,value:n(t).emails,"onUpdate:value":o[1]||(o[1]=r=>n(t).emails=r),size:"middle",class:"nc-input-sm","validate-trigger":"onBlur",placeholder:e.$t("labels.email"),onPaste:_e(q,["prevent"])},null,8,["value","placeholder"])]),_:1},16,["rules"])]),ce(s("div",He,[a(U,{name:"role",rules:[{required:!0,message:e.$t("msg.roleRequired")}]},{default:l(()=>[s("div",Qe,i(e.$t("labels.selectUserRole")),1),a(Z,{value:n(t).role,"onUpdate:value":o[2]||(o[2]=r=>n(t).role=r),class:"w-55 nc-user-roles","dropdown-match-select-width":!1,"dropdown-class-name":"nc-dropdown-user-role max-w-64"},{default:l(()=>[(c(),f(ve,null,fe(A,(r,Y)=>a(X,{key:Y,class:"nc-role-option",value:r.value},{default:l(()=>[s("div",Ye,[s("div",es,[a(J,{"show-on-truncate-only":"",class:"truncate","data-rec":"true"},{title:l(()=>[g(i(e.$t(r.title)),1)]),default:l(()=>[g(" "+i(e.$t(r.title)),1)]),_:2},1024),s("div",ss,i(e.$t(r.subtitle)),1)]),n(t).role===r.value?(c(),p(K,{key:0,id:"nc-selected-item-icon",icon:"check",class:"w-4 h-4 text-primary"})):he("",!0)])]),_:2},1032,["value"])),64))]),_:1},8,["value"])]),_:1},8,["rules"])],512),[[we,!("isEeUI"in e?e.isEeUI:n(be))]])]),s("div",ts,[a(u,{type:"primary",class:"!rounded-md","html-type":"submit"},{default:l(()=>[s("div",os,[a(k,{class:"flex h-[0.8rem]"}),s("div",as,i(e.$t("activity.invite")),1)])]),_:1})])]),_:1},8,["model"])])]))])])]),_:1},8,["class","visible"])}}}),ds=Object.assign(Ie(ls,[["__scopeId","data-v-3e85fefd"]]),{__name:"AccountUsersModal"});export{ds as default};
