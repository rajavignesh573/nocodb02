import{e as Be,J as Oe,a9 as Ke,G as i,bd as Te,r as u,o0 as Ae,fO as Ge,g6 as ze,kU as Pe,kn as qe,a7 as He,a8 as Je,n as f,ef as Qe,k5 as We,j9 as Ye,kV as Xe,gu as Ze,gy as ea,as as aa,bm as ta,aF as la,be as P,aG as ie,bx as sa,bv as na,gz as oa,j1 as ia,j7 as ra,kk as ca,Y as ua,iw as da,g as ma,iU as fa,kW as pa,c as b,o as r,I as S,L as a,a as g,K as C,O as re,b as y,w as c,M as va,Q as ce,ar as ga,an as B,aq as ue,b9 as de,bD as ya,ag as h,bV as ha,ap as ba,d as E,t as w,oA as O,ok as d,oj as wa,eP as me,eJ as _a,bN as xa,j as ka,ol as fe,cf as Ia,aL as pe,es as Ca,_ as Ea}from"./DRA9KN5F.js";import{a as ja,g as Ua}from"./zMMvJhqz.js";import{M as Fa}from"./GfahIbp6.js";import{u as ve}from"./CbX26EBz.js";import{R as $a,_ as Sa}from"./YbUkeyWR.js";const Ma={key:0,class:"w-full max-w-full"},Na={class:"rounded-lg border-1 border-nc-border-gray-medium w-full max-w-full"},La={class:"w-full max-w-full max-h-[328px] nc-scrollbar-thin p-1"},Va={class:"w-full flex gap-2 items-center py-1.5"},Ra={class:"flex flex-col w-[calc(100%_-_40px)]"},Da={class:"w-full flex gap-3"},Ba={key:0,class:"h-full text-center flex items-center justify-center gap-3 mt-4"},Oa={key:0,class:"absolute -bottom-1 w-[calc(100%_+_16px)] border-b-1 border-nc-border-gray-medium -ml-4"},Ka={class:"w-full flex gap-2 items-center"},Ta={class:"w-full flex gap-3"},Aa=Be({__name:"Editor",props:{modelValue:{},rowIndex:{},location:{},forceMulti:{type:Boolean},options:{}},emits:["update:modelValue"],setup(K,{emit:ge}){const q=ge,{isMobileMode:ye}=Oe(),{t:Ga}=Ke(),H=i(Te),J=i(Ae,u(!1)),x=i(Ge),M=i(ze),Q=i(Pe,u(!1)),W=i(qe,u(!1)),he=He(),{basesUser:be}=Je(he),Y=f(()=>H.value.base_id?be.value.get(H.value.base_id)||[]:[]),we=f(()=>Y.value.reduce((e,l)=>(e[l.id]=l,e[l.email]=l,e),{})),T=f(()=>W.value||Q.value),V=i(Qe,u(!1)),A=i(We,u(!1)),U=f(()=>{var e;return K.forceMulti||((e=x.value.meta)==null?void 0:e.is_multi)}),X=i(Ye,u(void 0)),_e=i(Xe,u(!1)),F=u(),o=u(!1),G=u(!1),Z=i(Ze,u(!1)),N=i(ea,null),p=u(),{isUIAllowed:xe}=aa(),{showUpgradeToUseCurrentUserFilter:za}=ta(),ee=f(()=>{var e;return!A.value&&V.value&&((e=la(x.value.meta))==null?void 0:e.isList)}),k=f(()=>[...[],...K.options??ja(x.value,!1,V.value,Y.value)]),z=f(()=>k.value.filter(e=>!e.deleted)),ke=f(()=>z.value.filter(e=>p.value?P([e.display_name,e.email],p.value):!0)),Ie=f(()=>k.value.reduce((e,l)=>(l.id&&(e[l.id]=l),l.email&&(e[l.email.trim()]=l),e),{})),ae=f(()=>xe("dataEdit")),_=f(()=>(ae.value||V.value)&&T.value),m=f({get:()=>Ua(Ie.value,K.modelValue),set:e=>{p.value="";const l=[];e&&e.length&&e.forEach(n=>{const v=k.value.find(I=>I.id===n);v&&l.push(v.id)}),U.value?q("update:modelValue",e!=null&&e.length?l.join(","):null):(q("update:modelValue",e!=null&&e.length?l[l.length-1]:null),o.value=!1)}}),Ce=f(()=>{var e,l;return U.value?(m.value||[]).map(n=>n.value):((l=(e=m.value||[])==null?void 0:e[0])==null?void 0:l.value)||""});ie(o,(e,l)=>{var n,v,I,j,R,D;ee.value||(e||(p.value=""),_.value&&(e?(D=(R=(j=F.value)==null?void 0:j.$el)==null?void 0:R.querySelector("input"))==null||D.focus():(I=(v=(n=F.value)==null?void 0:n.$el)==null?void 0:v.querySelector("input"))==null||I.blur()))}),ie(T,(e,l)=>{e||(o.value=!1)}),ve(W,e=>{var l;switch(e.key){case"Escape":if(N){N.trigger();return}o.value=!1;break;case"Enter":_.value&&T.value&&!o.value&&(e.stopPropagation(),te(),o.value=!0);break;case" ":break;case"ArrowUp":case"ArrowDown":case"ArrowRight":case"ArrowLeft":case"Delete":break;default:if(!_.value){e.preventDefault();break}!(e.metaKey||e.ctrlKey||e.altKey)&&((l=e.key)==null?void 0:l.length)===1&&!sa()&&(e.stopPropagation(),o.value=!0);break}},{immediate:!0,isGridCell:!0}),ve(o,e=>{e.key==="Escape"&&(o.value=!1,N==null||N.trigger())},{isGridCell:!1,immediate:!0});const Ee=()=>{var e,l,n;p.value=(n=(l=(e=F.value)==null?void 0:e.$el)==null?void 0:l.querySelector(".ant-select-selection-search-input"))==null?void 0:n.value},je=(e,l)=>{var n,v;((n=e.target)!=null&&n.classList.contains("ant-tag-close-icon")||(v=e.target)!=null&&v.closest(".ant-tag-close-icon"))&&(e.stopPropagation(),l())};function te(){G.value||(o.value=_.value&&!o.value)}na(document,"click",e=>{var l;o.value&&F.value&&!F.value.$el.contains(e.target)&&!((l=document.querySelector(".nc-dropdown-user-select-cell.active"))!=null&&l.contains(e.target))&&(Q.value=!1,o.value=!1)},!0);const Ue=(e,l)=>{const n=k.value.find(v=>v.id===l.value);return n?P([n.display_name,n.email],e):!1},L=e=>{var l,n;return!((n=(l=we.value)==null?void 0:l[e])!=null&&n.deleted)},Fe=e=>{if(e.key==="Tab"){o.value=!1;return}else if(e.key==="Escape"&&V.value){o.value=!1;return}e.stopPropagation()},le=()=>{var e;G.value=!0,setTimeout(()=>{G.value=!1},250),!(_e.value&&((e=m.value)!=null&&e.length))&&(o.value=!0)},$e=i(oa,u(!1)),Se=i(ia,!1),Me=i(ra,u(!1)),Ne=i(ca,u(!1)),Le=i(da,ua({}));return ma(()=>{Me.value&&Se&&!$e.value&&!A.value&&!Ne.value&&fa(()=>{le();const e=Le.keyboardKey;e&&pa(e)&&(p.value=e)})}),(e,l)=>{const n=va,v=ga,I=ha,j=ba,R=me,D=_a,Ve=xa,Re=Ca;return r(),b("div",{class:h(["nc-cell-field nc-user-select h-full w-full flex items-center",{"read-only":a(M)}]),onClick:te},[a(ee)?(r(),b("div",Ma,[g("div",Na,[a(z).length>6?(r(),b("div",{key:0,class:"border-b-1 border-nc-border-gray-medium pl-1 group",onClick:l[1]||(l[1]=re(()=>{},["stop"]))},[y(v,{ref:"inputRef",value:a(p),"onUpdate:value":l[0]||(l[0]=t=>ce(p)?p.value=t:null),placeholder:e.$t("general.search"),class:"nc-user-select-search-field-input !pl-2 !pr-1.5 flex-1 !py-2","allow-clear":"",autocomplete:"off",bordered:!1},{prefix:c(()=>[y(n,{icon:"search",class:"nc-search-icon text-nc-content-gray-muted opacity-50 h-4 w-4 mr-1.5"})]),_:1},8,["value","placeholder"])])):C("",!0),g("div",La,[(r(),S(de(a(U)?a(wa):a(Sa)),{value:a(Ce),disabled:a(M)||!a(_),class:"nc-field-layout-list nc-user-select-list","onUpdate:value":l[2]||(l[2]=t=>{m.value=a(U)?t:[t]})},{default:c(()=>[(r(!0),b(B,null,ue(a(k),t=>(r(),b(B,{key:t.id||t.email},[t.deleted?C("",!0):(r(),S(de(a(U)?a(ya):a($a)),{key:t.id||t.email,value:t.id,"data-testid":`select-option-${a(x).title}-${e.location==="filter"?"filter":e.rowIndex}`,class:h([`nc-select-option-${a(x).title}-${t.email}`,{"!hidden nc-hidden-option":!("searchCompare"in e?e.searchCompare:a(P))([t.display_name,t.email],a(p)??"")}])},{default:c(()=>[g("div",Va,[y(I,{user:t,size:"base",class:"flex-none",disabled:!L(t.id||t.email)},null,8,["user","disabled"]),g("div",Ra,[g("div",Da,[y(j,{class:h(["text-bodyDefaultSmBold !leading-5 capitalize truncate max-w-full text-gray-800",{"!text-gray-500":!L(t.id||t.email)}]),"show-on-truncate-only":"",placement:"bottom"},{title:c(()=>{var s;return[E(w(((s=t.display_name)==null?void 0:s.trim())||("extractNameFromEmail"in e?e.extractNameFromEmail:a(O))(t.email)),1)]}),default:c(()=>{var s;return[E(" "+w(((s=t.display_name)==null?void 0:s.trim())||("extractNameFromEmail"in e?e.extractNameFromEmail:a(O))(t.email)),1)]}),_:2},1032,["class"])]),y(j,{class:"text-xs !leading-4 text-nc-content-gray-muted truncate max-w-full","show-on-truncate-only":"",placement:"bottom"},{title:c(()=>[E(w(t.email===a(d)?e.$t("title.filteredByLoggedInUser"):t.email),1)]),default:c(()=>[E(" "+w(t.email===a(d)?e.$t("title.filteredByLoggedInUser"):t.email),1)]),_:2},1024)])])]),_:2},1032,["value","data-testid","class"]))],64))),128))]),_:1},40,["value","disabled"])),a(z).length&&a(p)&&!a(ke).length?(r(),b("div",Ba,[y(R,{image:("Empty"in e?e.Empty:a(me)).PRESENTED_IMAGE_SIMPLE,description:e.$t("labels.noData"),class:"!my-0"},null,8,["image","description"])])):C("",!0)])]),!a(M)&&!a(U)&&a(m).length?(r(),b("div",{key:0,class:"inline-block px-2 pt-2 cursor-pointer text-xs text-gray-500 hover:text-gray-800",onClick:l[3]||(l[3]=t=>m.value=[])},w(e.$t("labels.clearSelection")),1)):C("",!0)])):(r(),S(Re,{key:1,ref_key:"aselect",ref:F,value:a(m),"onUpdate:value":l[5]||(l[5]=t=>ce(m)?m.value=t:null),mode:"multiple",class:h(["w-full overflow-hidden",{"caret-transparent":!a(ae)}]),placeholder:a(A)?e.$t("labels.optional"):"",bordered:!1,"clear-icon":"","show-search":!a(ye),"show-arrow":a(_)&&!a(M),open:a(o)&&a(_),disabled:a(M)||!a(_),"dropdown-class-name":`nc-dropdown-user-select-cell !min-w-256px ${a(J)?"!min-w-256px":"!min-w-180px"}  ${a(o)?"active":""}`,"filter-option":Ue,"search-value":a(p)??"",onSearch:Ee,onFocus:le,onBlur:l[6]||(l[6]=t=>o.value=!1),onKeydown:Fe},{suffixIcon:c(()=>[y(n,{icon:"arrowDown",class:"text-gray-700 nc-select-expand-btn"})]),tagRender:c(({label:t,value:s,onClose:se})=>{var ne,oe;return[a(k).find($=>$.id===s)?(r(),S(Ve,{key:0,class:h(["rounded-tag nc-selected-option !pl-0",{"!my-0":!a(X)||a(X)===1}]),style:{display:"flex",alignItems:"center"},color:s===a(d)?("themeV4Colors"in e?e.themeV4Colors:a(fe)).brand[50]:e.location==="filter"?("themeV4Colors"in e?e.themeV4Colors:a(fe)).gray[200]:"#ccc",closable:a(_)&&((((ne=a(m))==null?void 0:ne.length)??0)>1||!((oe=a(x))!=null&&oe.rqd)),"close-icon":("h"in e?e.h:a(ka))(a(Fa),{class:["ms-close-icon"]}),onClick:$=>je($,se),onClose:se},{default:c(()=>{var $;return[g("span",{style:Ia({color:a(pe).isReadable("#ccc","#fff",{level:"AA",size:"large"})?"#fff":a(pe).mostReadable("#ccc",["#0b1d05","#fff"]).toHex8String()}),class:h(["flex items-stretch gap-2",{"text-sm":a(Z),"text-small":!a(Z)}])},[g("div",null,[y(I,{size:"auto",user:{display_name:t!=null&&t.includes("@")?"":t.trim(),email:t,meta:($=a(k).find(De=>De.id===s))==null?void 0:$.meta},class:h(["!text-[0.5rem] !h-[16.8px]",{"!bg-white":s===a(d)}]),"is-deleted":!L(s),disabled:!L(s),"show-placeholder-icon":s===a(d)},null,8,["user","class","is-deleted","disabled","show-placeholder-icon"])]),g("span",{class:h({"text-gray-500":!L(s)&&s!==a(d),"text-nc-content-brand":s===a(d),"font-600":a(J)})},w(t),3)],6)]}),_:2},1032,["class","color","closable","close-icon","onClick","onClose"])):C("",!0)]}),default:c(()=>[(r(!0),b(B,null,ue(a(k),t=>(r(),b(B,{key:t.id||t.email},[t.deleted?C("",!0):(r(),S(D,{key:0,value:t.id,"data-testid":`select-option-${a(x).title}-${e.location==="filter"?"filter":e.rowIndex}`,class:h([`nc-select-option-${a(x).title}-${t.email}`,{"nc-select-option-current-user mb-2":t.email===a(d)}]),onClick:l[4]||(l[4]=re(()=>{},["stop"]))},{default:c(()=>[t.email===a(d)?(r(),b("div",Oa)):C("",!0),g("div",Ka,[y(I,{user:t,size:"base",class:"flex-none","show-placeholder-icon":t.email===a(d)},null,8,["user","show-placeholder-icon"]),g("div",{class:h(["flex flex-col",{"w-[calc(100%_-_32px)]":!a(m).find(s=>s.email===t.email),"w-[calc(100%_-_68px)]":!!a(m).find(s=>s.email===t.email)}])},[g("div",Ta,[y(j,{class:h(["text-bodyDefaultSmBold !leading-5 capitalize truncate max-w-full",{"text-nc-content-brand":t.email===a(d),"text-gray-800":t.email!==a(d)}]),"show-on-truncate-only":"",placement:"bottom"},{title:c(()=>{var s;return[E(w(((s=t.display_name)==null?void 0:s.trim())||("extractNameFromEmail"in e?e.extractNameFromEmail:a(O))(t.email)),1)]}),default:c(()=>{var s;return[E(" "+w(((s=t.display_name)==null?void 0:s.trim())||("extractNameFromEmail"in e?e.extractNameFromEmail:a(O))(t.email)),1)]}),_:2},1032,["class"])]),y(j,{class:"text-xs !leading-4 text-nc-content-gray-muted truncate max-w-full","show-on-truncate-only":"",placement:"bottom"},{title:c(()=>[E(w(t.email===a(d)?e.$t("title.filteredByLoggedInUser"):t.email),1)]),default:c(()=>[E(" "+w(t.email===a(d)?e.$t("title.filteredByLoggedInUser"):t.email),1)]),_:2},1024)],2),a(m).find(s=>s.email===t.email)?(r(),S(n,{key:0,id:"nc-selected-item-icon",icon:"check",class:"flex-none text-primary w-4 h-4"})):C("",!0)])]),_:2},1032,["value","data-testid","class"]))],64))),128))]),_:1},8,["value","placeholder","show-search","show-arrow","open","disabled","class","dropdown-class-name","search-value"]))],2)}}}),Ya=Object.assign(Ea(Aa,[["__scopeId","data-v-6d35d994"]]),{__name:"CellUserEditor"});export{Ya as default};
