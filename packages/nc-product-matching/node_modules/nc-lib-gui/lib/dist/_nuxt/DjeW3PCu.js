import{bi as U,c as h,o as l,a as t,e as $,G as d,r as i,bd as z,bc as R,b5 as H,bX as K,aG as Q,n as v,fN as X,aj as Y,ac as q,I as p,K as w,L as o,w as m,ad as J,at as W,b as u,d as Z,t as _,b9 as ee,bo as ae,O as g,bC as te,es as oe,Q as b,eC as se}from"./DRA9KN5F.js";import{u as ne}from"./CQa0sIfA.js";import{u as ie}from"./D7poRkS0.js";import{a as le}from"./CSKT8BGh.js";import"./DkDj6Z7Z.js";import"./gAYHr7Gr.js";const ce={class:"nc-icon",viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"};function de(y,c){return l(),h("svg",ce,c[0]||(c[0]=[t("path",{fill:"currentColor",d:"M12 2A10 10 0 0 0 2 12a10 10 0 0 0 10 10a10 10 0 0 0 10-10A10 10 0 0 0 12 2m0 2a8 8 0 0 1 8 8a8 8 0 0 1-8 8a8 8 0 0 1-8-8a8 8 0 0 1 8-8m-5 6l5 5l5-5z"},null,-1)]))}const re=U({name:"mdi-arrow-down-drop-circle-outline",render:de}),pe={class:"nc-map-btn"},me={class:"flex items-center gap-1"},ue={class:"text-capitalize !text-sm font-weight-normal"},_e={class:"font-bold"},fe={class:"font-bold"},ve={class:"nc-fields-list py-1"},we={class:"grouping-field"},ge=$({__name:"MappedBy",setup(y){const{eventBus:c}=ne(),M=d(z,i()),f=d(R,i()),k=d(H,i(!1)),C=d(K,i(!1)),{fields:B,loadViewColumns:D,metaColumnById:x}=ie(),{loadMapData:I,loadMapMeta:S,updateMapMeta:V,mapMetaData:j,geoDataFieldColumn:N}=le(),n=i(!1);Q(()=>{var a;return(a=f.value)==null?void 0:a.id},async(a,e)=>{a!==e&&M.value&&await D()},{immediate:!0});const r=v({get:()=>j.value.fk_geo_data_col_id,set:async a=>{var e;a&&(await V({fk_geo_data_col_id:a}),await S(),await I(),((e=f.value)==null?void 0:e.view).fk_geo_data_col_id=a,c.emit(X.MAPPED_BY_COLUMN_CHANGE))}}),O=v(()=>{var a;return(a=B.value)==null?void 0:a.filter(e=>e.fk_column_id&&x.value[e.fk_column_id].uidt===Y.GeoData).map(e=>({value:e.fk_column_id,label:e.title}))}),T=()=>{n.value=!1};return(a,e)=>{const A=re,F=W,E=te,G=oe,L=se,P=q("e");return o(C)?w("",!0):(l(),p(L,{key:0,visible:o(n),"onUpdate:visible":e[3]||(e[3]=s=>b(n)?n.value=s:null),trigger:["click"],class:"!xs:hidden"},{overlay:m(()=>[o(n)?(l(),h("div",{key:0,class:"p-3 min-w-[280px] bg-gray-50 shadow-lg nc-table-toolbar-menu max-h-[max(80vh,500px)] overflow-auto !border",onClick:e[2]||(e[2]=g(()=>{},["stop"]))},[t("div",null,[t("span",fe,_(a.$t("activity.map.chooseMappingField")),1),u(E,{class:"!my-2"})]),t("div",ve,[t("div",we,[u(G,{value:o(r),"onUpdate:value":e[0]||(e[0]=s=>b(r)?r.value=s:null),class:"w-full nc-msp-grouping-field-select",options:o(O),placeholder:"Select a Mapping Field",onChange:T,onClick:e[1]||(e[1]=g(()=>{},["stop"]))},null,8,["value","options"])])])])):w("",!0)]),default:m(()=>[t("div",pe,[J((l(),p(F,{class:"nc-map-stacked-by-menu-btn nc-toolbar-btn",disabled:o(k)},{default:m(()=>{var s;return[t("div",me,[u(A),t("span",ue,[Z(_(a.$t("activity.map.mappedBy"))+" ",1),t("span",_e,_((s=o(N))==null?void 0:s.title),1)]),(l(),p(ee(("iconMap"in a?a.iconMap:o(ae)).arrowDown),{class:"text-grey"}))])]}),_:1},8,["disabled"])),[[P,["c:map:change-grouping-field"]]])])]),_:1},8,["visible"]))}}}),Be=Object.assign(ge,{__name:"SmartsheetToolbarMappedBy"});export{Be as default};
