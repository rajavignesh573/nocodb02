import{aj as h,kv as Lt,el as re,r as Y,f as jt,a9 as Ut,u as Jt,as as Gt,W as Wt,U as Qt,V as qt,a8 as Ht,S as Pt,J as zt,ge as Xt,n as K,fk as Yt,bm as Zt,s as Kt,je as et,jf as tt,i as kt,fN as ot,aG as Vt,gi as bt,kw as eo,a4 as te,h7 as to,gG as oo,iy as ro,a5 as ae,id as no,gS as so,gQ as ao,aC as io,i2 as uo,hX as co,fB as rt,fA as lo,g_ as wo,fY as fo,bM as ho}from"./DRA9KN5F.js";import{e as P,v as nt,r as Ee,c as vo,p as Ro}from"./gAYHr7Gr.js";import{u as go}from"./CQa0sIfA.js";import{a as yo}from"./BmscXXs6.js";import{b as mo}from"./C2xdh4Xe.js";import{g as po}from"./C316Za7m.js";const _o=(Z,x)=>{const w=x?[{text:"Count (9 → 1)",value:"count-desc"},{text:"Count (1 → 9)",value:"count-asc"}]:[];switch(Z){case h.Year:case h.Number:case h.Decimal:case h.Rating:case h.Count:case h.AutoNumber:case h.Time:case h.Currency:case h.Percent:case h.Duration:case h.PhoneNumber:case h.Date:case h.DateTime:case h.CreatedTime:case h.LastModifiedTime:return[{text:"1 → 9",value:"asc"},{text:"9 → 1",value:"desc"}].concat(w);case h.Checkbox:return[{text:"▢ → ✓",value:"asc"},{text:"✓ → ▢",value:"desc"}].concat(w);default:return[{text:"A → Z",value:"asc"},{text:"Z → A",value:"desc"}].concat(w)}},Oe=({uidt:Z,a:x,b:w,options:{caseSensitive:D=!0,direction:e}})=>{let z=e!=="asc";if([h.Formula,h.User].includes(Z)&&(z=!z),x==null)return z?1:-1;if(w==null)return z?-1:1;if(x===""&&w!=="")return z?1:-1;if(w===""&&x!=="")return z?-1:1;let T=0;switch(Z){case h.Number:case h.Decimal:case h.Currency:case h.Percent:case h.Rating:case h.Duration:case h.ID:case h.Rollup:T=Number(x)-Number(w);break;case h.Links:{const I=J=>J===null?null:typeof J=="number"?J:J&&typeof J=="object"?Object.values(J)[0]:J,F=I(x),Q=I(w);typeof F=="number"&&typeof Q=="number"?T=F-Q:T=String(F).localeCompare(String(Q));break}case h.DateTime:case h.CreatedTime:case h.LastModifiedTime:T=re(x).valueOf()-re(w).valueOf();break;case h.Time:{const I=J=>{if(re.isDayjs(J))return re(`1999-01-01 ${J.format("HH:mm:ss")}`);if(typeof J=="string"&&/^\d{2}:\d{2}:\d{2}$/.test(J))return re(`1999-01-01 ${J}`);if(typeof J=="string"&&/^\d{2}:\d{2}$/.test(J))return re(`1999-01-01 ${J}:00`);let b=re(J);return b.isValid()||(b=re(J,"HH:mm:ss")),b.isValid()||(b=re(`1999-01-01 ${J}`)),b},F=I(x),Q=I(w);T=F.valueOf()-Q.valueOf();break}case h.Year:T=Number(x)-Number(w);break;case h.Checkbox:T=x===w?0:x?-1:1;break;case h.SingleSelect:case h.MultiSelect:T=String(x).localeCompare(String(w));break;case h.Attachment:{const I=F=>Array.isArray(F)&&F.length>0&&(F[0].title||F[0].path)||"";T=I(x).localeCompare(I(w));break}case h.User:case h.CreatedBy:case h.LastModifiedBy:{const I=F=>Array.isArray(F)&&F.length>0?F[0].display_name||F[0].email||"":F&&typeof F=="object"?F.display_name||F.email||"":String(F);T=I(x).localeCompare(I(w));break}case h.SingleLineText:case h.LongText:case h.Email:case h.URL:case h.PhoneNumber:case h.Formula:D?T=String(x).localeCompare(String(w)):T=String(x).toLowerCase().localeCompare(String(w).toLowerCase());break;case h.JSON:T=JSON.stringify(x).localeCompare(JSON.stringify(w));break;default:T=String(x).localeCompare(String(w))}return e==="desc"?-T:T},xo=(Z,x,w)=>{const D=new Set(x.map(e=>{var z;return(z=w[e.fk_column_id])==null?void 0:z.title}).filter(Boolean));return Z.some(e=>D.has(e))},Do=(Z,x)=>{let w={};if(!Z||!x||(Array.isArray(x)?w=x.reduce((z,T)=>(T.id&&(z[T.id]=T),z),{}):w=x,!w[Z]))return"";const D=w[Z];let e=D.uidt;return D.uidt===h.Formula&&(e=Lt({formulaColumn:D})||e),e||""},st=(Z,x,w,D=[],e)=>{if(x!=null&&x.page&&(x!=null&&x.pageSize))return Z.map((T,I)=>{const F=(x.page-1)*x.pageSize+I;return{row:{...T},oldRow:{...T},rowMeta:{rowIndex:F,isLastRow:F===x.totalRows-1,path:D,...(e==null?void 0:e(T))??{}}}});const z=(w==null?void 0:w.offset)??0;return Z.map((T,I)=>({row:{...T},oldRow:{...T},rowMeta:{rowIndex:z+I,path:D,...(e==null?void 0:e(T))??{}}}))};function Eo(Z){const x="noco",{meta:w,viewMeta:D,callbacks:e,where:z,disableSmartsheet:T,isPublic:I,groupByColumns:F=Y(null)}=Z,{$api:Q,$ncSocket:J}=jt(),{t:b}=Ut(),Fe=Jt(),{isUIAllowed:ne}=Gt(),{addUndo:ve,clone:G,defineViewScope:Re}=Wt(),at=Qt(),Be=qt(),{base:U}=Ht(Be),{getBaseType:$e}=Be,{getMeta:it,metas:Me}=Pt(),{user:Ie}=zt(),{fetchSharedViewData:ut,fetchCount:Ne,fetchBulkListData:dt}=Xt(),{nestedFilters:se,allFilters:Le,sorts:ee,isExternalSource:ge,isAlreadyShownUpgradeModal:je,validFiltersFromUrlParams:ct,totalRowsWithSearchQuery:lt,totalRowsWithoutSearchQuery:Ue,fetchTotalRowsWithSearchQuery:wt,whereQueryFromUrl:Je,eventBus:ft}=T?{nestedFilters:Y([]),allFilters:Y([]),sorts:Y([]),isExternalSource:K(()=>!1),isAlreadyShownUpgradeModal:Y(!1),totalRowsWithSearchQuery:Y(0),totalRowsWithoutSearchQuery:Y(0),fetchTotalRowsWithSearchQuery:K(()=>!1),whereQueryFromUrl:K(()=>""),eventBus:Yt(eo.SmartsheetStore)}:go(),{isGroupBy:ht}=T?{isGroupBy:K(()=>!1)}:yo(),{blockExternalSourceRecordVisibility:Ce,showUpgradeToSeeMoreRecordsModal:vt}=Zt(),{getEvaluatedRowMetaRowColorInfo:ie}=T?{getEvaluatedRowMetaRowColorInfo:t=>({})}:mo(),Rt=Y(!1),Ge=Y(0),We=Y(0),ye=Y(new Map),Qe=Y([]),me=Kt(new Map),oe=K(()=>Fe.currentRoute.value.query),qe=K(()=>{var t,o,r;return(o=(t=w.value)==null?void 0:t.columns)!=null&&o.length?(r=w.value)==null?void 0:r.columns.reduce((a,n)=>(a[n.title]=n,a),{}):{}}),le=K(()=>{var t,o,r;return(o=(t=w.value)==null?void 0:t.columns)!=null&&o.length?(r=w.value)==null?void 0:r.columns.reduce((a,n)=>(a[n.id]=n,a),{}):{}}),gt=K(()=>{const{filters:t}=et({api_version:tt.V1},(z==null?void 0:z.value)??"",qe.value);return t!=null&&t.length?t==null?void 0:t.map(o=>{var r;return{...o,value:o.value?(r=o.value)==null?void 0:r.toString().replace(/(^%)(.*?)(%$)/,"$2"):o.value}}):[]}),He=K(()=>Array.from(ye.value.values()).filter(t=>{var o;return(o=t.rowMeta)==null?void 0:o.selected})),Pe=K(()=>Array.from(ye.value.values()).filter(t=>{var o;return(o=t.rowMeta)==null?void 0:o.isRowOrderUpdated})),B=(t=[])=>{var s;if(t.length===0)return{cachedRows:ye,chunkStates:Qe,totalRows:Ge,actualTotalRows:We,isRowSortRequiredRows:Pe,selectedRows:He};const o=t.join("-"),r=me.value.get(o);if(r)return r;const a=(s=e==null?void 0:e.getCount)==null?void 0:s.call(e,t),n={cachedRows:Y(new Map),chunkStates:Y([]),totalRows:K({get:()=>{var d;const i=(d=e==null?void 0:e.findGroupByPath)==null?void 0:d.call(e,t);return i?i.count:0},set:i=>{var u;const d=(u=e==null?void 0:e.findGroupByPath)==null?void 0:u.call(e,t);d&&(d.count=i)}}),actualTotalRows:Y(0),selectedRows:K(()=>Array.from(n.cachedRows.value.values()).filter(i=>{var d;return(d=i.rowMeta)==null?void 0:d.selected})),isRowSortRequiredRows:K(()=>Array.from(n.cachedRows.value.values()).filter(i=>{var d;return(d=i.rowMeta)==null?void 0:d.isRowOrderUpdated}))};return a===null&&De(t),me.value.set(o,n),n},yt=200,V=50,X=t=>Math.floor(t/V);let ue=[],we=null;const mt=50,pt=200;async function xt(t){var a;if(!ne("commentCount")||I!=null&&I.value||t.length===0)return;const o=[],r=new Map;for(const{rows:n}of t)for(const s of n){const i=P(s.row,(a=w==null?void 0:w.value)==null?void 0:a.columns);i&&(o.push(i),r.set(i,s))}if(o.length!==0)try{const n=await Q.utils.commentCount({ids:o,fk_model_id:w.value.id});n==null||n.forEach(s=>{const i=r.get(s.row_id);i&&(i.rowMeta.commentCount=+s.count||0)})}catch(n){console.error("Failed to load bulk aggregate comment count:",n)}}async function St(t,o){const r=B(o);r.chunkStates.value[t]="loading";const a=t*V;try{const n=await Ae({offset:a,limit:V},!1,o);if(!n){r.chunkStates.value[t]=void 0;return}n.forEach(s=>{r.cachedRows.value.set(s.rowMeta.rowIndex,s)}),r.chunkStates.value[t]="loaded"}catch(n){throw console.error("Error fetching chunk:",n),r.chunkStates.value[t]=void 0,n}}async function ze(){var o,r;if(ue.length===0)return;we&&(clearTimeout(we),we=null);const t=[...ue];ue=[];try{const a=[];for(let d=0;d<t.length;d++){const u=t[d],l=await((o=e==null?void 0:e.getWhereFilter)==null?void 0:o.call(e,u.path)),y=await(e==null?void 0:e.getWhereFilterArr(u.path))??[];a.push({where:l,offset:u.chunkId*V,limit:V,alias:`chunk_${u.chunkId}_${u.path.join("_")}`,...ne("sortSync")?{}:{sortArrJson:JSON.stringify(ee.value)},...ne("filterSync")?{filterArrJson:JSON.stringify(y)}:{filterArrJson:JSON.stringify([...se.value??[],...y])}})}const n=I!=null&&I.value?await dt({},a):await Q.dbDataTableBulkList.dbDataTableBulkList(w.value.id,{viewId:(r=D.value)==null?void 0:r.id},a,{}),s=[],i=[];for(const d of t)try{const u=`chunk_${d.chunkId}_${d.path.join("_")}`,l=n[u],y=B(d.path);if(l&&l.list){const R=st(l.list,l.pageInfo,void 0,d.path,ie);R.forEach(g=>{y.cachedRows.value.set(g.rowMeta.rowIndex,g)}),y.chunkStates.value[d.chunkId]="loaded",s.push({rows:R,path:d.path}),i.push({request:d,rows:R,dataCache:y})}else y.chunkStates.value[d.chunkId]=void 0;d.resolve(void 0)}catch(u){console.error(`Error processing chunk ${d.chunkId}:`,u);const l=B(d.path);l.chunkStates.value[d.chunkId]=void 0,d.reject(u)}await xt(s);for(const{request:d,rows:u,dataCache:l}of i)try{u.forEach(y=>{l.cachedRows.value.set(y.rowMeta.rowIndex,y)}),l.chunkStates.value[d.chunkId]="loaded",d.resolve(void 0)}catch(y){console.error(`Error caching chunk ${d.chunkId}:`,y),l.chunkStates.value[d.chunkId]=void 0,d.reject(y)}}catch(a){console.error("Bulk chunk request failed, falling back to individual requests:",a);const n=t.map(s=>St(s.chunkId,s.path).then(()=>s.resolve(void 0)).catch(i=>s.reject(i)));await Promise.allSettled(n)}}const Te=async(t,o=[],r=!1)=>{const a=B(o);if(a.chunkStates.value[t]&&!r)return;const n=ue.find(s=>s.chunkId===t&&s.path.join(",")===o.join(","));return n&&!r?new Promise((s,i)=>{const d=n.resolve,u=n.reject;n.resolve=l=>{d(l),s(l)},n.reject=l=>{u(l),i(l)}}):new Promise((s,i)=>{ue.push({chunkId:t,path:o,forceFetch:r,resolve:s,reject:i}),a.chunkStates.value[t]="loading",ue.length>=mt?ze():we||(we=setTimeout(()=>{ze()},pt))})},Mt=(t,o,r=[])=>{var R,g,c;const a=B(r);if(o===Number.POSITIVE_INFINITY&&t===Number.NEGATIVE_INFINITY){a.cachedRows.value.clear(),a.chunkStates.value=[];return}if(a.cachedRows.value.size<=yt)return;const n=Math.max(0,t),s=Math.min(a.totalRows.value-1,o),i=X(n),d=X(s),u=new Set;let l=0;for(const v of a.cachedRows.value.keys()){const p=X(v);l=Math.max(l,p);const S=a.cachedRows.value.get(v);S&&((R=S.rowMeta)!=null&&R.selected||(g=S.rowMeta)!=null&&g.new||(c=S.rowMeta)!=null&&c.isDragging)&&u.add(p)}const y=new Map;for(let v=0;v<=l;v++)if(v>=i&&v<=d||u.has(v)){const S=v*V,m=S+V;for(let M=S;M<m;M++){const W=a.cachedRows.value.get(M);W&&y.set(M,W)}}a.cachedRows.value=y,a.chunkStates.value=a.chunkStates.value.map((v,p)=>p>=i&&p<=d||u.has(p)?v:void 0)};async function Xe(t,o=[]){if(!ne("commentCount")||I!=null&&I.value)return;const r=t.filter(({rowMeta:{new:n}})=>!n).map(({row:n})=>{var s;return P(n,(s=w==null?void 0:w.value)==null?void 0:s.columns)}).filter(Boolean);if(!r.length)return;const a=B(o);try{const n=await Q.utils.commentCount({ids:r,fk_model_id:w.value.id});t.forEach(s=>{var l,y;const i=Array.from(a.cachedRows.value.values()).find(R=>R.rowMeta.rowIndex===s.rowMeta.rowIndex);if(!i)return;const d=P(s.row,(l=w.value)==null?void 0:l.columns),u=((y=n==null?void 0:n.find(R=>R.row_id===d))==null?void 0:y.count)||0;i.rowMeta.commentCount=+u})}catch(n){console.error("Failed to load aggregate comment count:",n)}}let fe;kt(()=>{clearTimeout(fe)});async function Ae(t={},o,r=[]){var s,i,d,u,l,y,R,g;if((!((s=U==null?void 0:U.value)!=null&&s.id)||!((i=w.value)!=null&&i.id)||!((d=D.value)!=null&&d.id))&&!(I!=null&&I.value))return[];const a=await((u=e==null?void 0:e.getWhereFilter)==null?void 0:u.call(e,r)),n=await((l=e==null?void 0:e.getWhereFilterArr)==null?void 0:l.call(e,r))??[];if(!T&&!r.length&&t.offset&&Ce(ge.value)&&(!je.value&&t.offset>=oo&&(je.value=!0,fe&&clearTimeout(fe),fe=setTimeout(()=>{vt({isExternalSource:ge.value}),clearTimeout(fe)},1e3)),t.offset>=ro))return[];try{const c=I!=null&&I.value?await ut({sortsArr:ee.value,filtersArr:[...se.value||[],...n],where:a,offset:t.offset,limit:t.limit},{isInfiniteScroll:!0}):await Q.dbViewRow.list("noco",U.value.id,w.value.id,D.value.id,{...t,...ne("sortSync")?{}:{sortArrJson:JSON.stringify(ee.value)},...ne("filterSync")?{filterArrJson:JSON.stringify(n)}:{filterArrJson:JSON.stringify([...se.value||[],...n])},includeSortAndFilterColumns:!0,where:a,include_row_color:!0}),v=st(c.list,c.pageInfo,t,r,ie);return Xe(v,r),v}catch(c){return((y=c==null?void 0:c.response)==null?void 0:y.data.error)==="INVALID_OFFSET_VALUE"?[]:((g=(R=c==null?void 0:c.response)==null?void 0:R.data)==null?void 0:g.error)==="FORMULA_ERROR"?(await at.reloadTableMeta(w.value.id),Ae(t)):(console.error(c),te.error(await ae(c)),[])}}const It=async(t,o,r=!1,a=!1,n=[])=>{var m,M,W;const s=B(n),i=s.cachedRows.value.get(t);if(!i)return;const d=P(i.row,(m=w.value)==null?void 0:m.columns),u=new Map(s.cachedRows.value.entries()),l=s.cachedRows.value.get(t+1),y=l?P(l.row,(M=w.value)==null?void 0:M.columns):null;let R=null,g=null,c;if(o===null)c=s.cachedRows.value.size-1;else{if(c=o>t?o-1:o,R=s.cachedRows.value.get(o)??null,!R)return;g=P(R.row,(W=w.value)==null?void 0:W.columns)||null}if(c<t)for(let A=t-1;A>=c;A--){const f=u.get(A);if(f){const _=A+1;f.rowMeta.rowIndex=_,u.set(_,f)}}else for(let A=t+1;A<=c;A++){const f=u.get(A);if(f){const _=A-1;f.rowMeta.rowIndex=_,u.set(_,f)}}i.rowMeta.rowIndex=c,u.set(c,i);const v=new Set;for(const[A,f]of u){if(v.has(f.rowMeta.rowIndex)){console.error("Duplicate index detected:",A,f.rowMeta.rowIndex);break}v.add(f.rowMeta.rowIndex)}const p=X(c),S=X(t);a||Q.dbDataTableRow.move(w.value.id,d,{before:o===null?null:g}).then(()=>{var A;(A=e==null?void 0:e.syncVisibleData)==null||A.call(e)}).catch(A=>{var f;(f=e==null?void 0:e.syncVisibleData)==null||f.call(e),te.error(`Failed to update record order: ${A}`)}),r||ve({undo:{fn:async(A,f,_,$)=>{var O;await Q.dbDataTableRow.move(w.value.id,f,{before:A}),await((O=e==null?void 0:e.syncVisibleData)==null?void 0:O.call(e))},args:[y,d,p,S]},redo:{fn:async(A,f,_,$)=>{var O;await Q.dbDataTableRow.move(w.value.id,f,{before:A}),await((O=e==null?void 0:e.syncVisibleData)==null?void 0:O.call(e))},args:[o===null?null:g,d,p,S]},scope:Re({view:D.value})}),s.cachedRows.value=u},Ct=async t=>{var d,u,l,y,R;const o=((u=(d=oe.value)==null?void 0:d.path)==null?void 0:u.length)===0?[]:(((y=(l=oe.value)==null?void 0:l.path)==null?void 0:y.split("-"))??[]).map(g=>+g),r=await Bt(o);if(r===-1)return;const a=B(o),n=r+(t===to.NEXT?1:-1);if(n<0||n>=a.totalRows.value)return te.info(b("msg.info.noMoreRecords"));let s=a.cachedRows.value.get(n);if(s||(await be(n,V,o),s=a.cachedRows.value.get(n)),!s)return;const i=P(s.row,(R=w.value)==null?void 0:R.columns);i&&await Fe.push({query:{...oe.value,rowId:i}})},Tt=async(t,o,r=[])=>{const a=Math.floor(t/V),n=Math.floor(o/V),s=B(r),i=Array.from({length:n-a+1},(d,u)=>a+u).filter(d=>!s.chunkStates.value[d]);await Promise.all(i.map(Te,r))};function At(t=[],o){var d,u,l,y,R;const r=B(t),a=Array.from(r.cachedRows.value.entries()).sort(([g],[c])=>g-c),n=a.filter(([g,c])=>c.rowMeta.isValidationFailed||c.rowMeta.isGroupChanged).map(([g])=>g);if(n.length===0)return;for(const g of n){const c=r.cachedRows.value.get(g);if((d=c.rowMeta)!=null&&d.isGroupChanged){const v=F.value[c.rowMeta.changedGroupIndex],p=(u=v==null?void 0:v.column)==null?void 0:u.title;(l=o==null?void 0:o.onGroupRowChange)==null||l.call(o,{row:c,property:p,groupByColumn:v,level:c.rowMeta.changedGroupIndex,path:c.rowMeta.path})}r.cachedRows.value.delete(g)}const s=new Map;for(const[g,c]of a)if(!n.includes(g)){const v=g-n.filter(p=>p<g).length;c.rowMeta.rowIndex=v,s.set(v,c)}r.chunkStates.value[X(Math.max(...n))]=void 0;const i=new Set;for(const[g,c]of s){if(i.has(c.rowMeta.rowIndex)){console.error("Op: clearInvalidRows:  Duplicate index detected:",c.rowMeta.rowIndex);break}i.add(c.rowMeta.rowIndex)}r.cachedRows.value=s,r.totalRows.value=Math.max(0,(r.totalRows.value||0)-n.length),r.actualTotalRows.value=Math.max(0,(r.actualTotalRows.value||0)-n.length),(y=e==null?void 0:e.syncVisibleData)==null||y.call(e),(R=e==null?void 0:e.reloadAggregate)==null||R.call(e,{path:t})}const Ye=({row:t,newData:o,path:r})=>{if(!ee.value.length)return!1;const a=t.rowMeta.rowIndex;if(a===void 0)return!0;const n=B(r),s=Array.from(n.cachedRows.value.keys()).sort((y,R)=>y-R),i=s.indexOf(a),d=i>0?n.cachedRows.value.get(s[i-1]):null,u=i<s.length-1?n.cachedRows.value.get(s[i+1]):null,l={...t,row:{...t.row,...o}};if(d){let y=!1,R=!1;for(const g of ee.value){const c=le.value[g.fk_column_id];if(!(c!=null&&c.title))continue;const v=g.direction||"asc",p=Oe({uidt:c.uidt,a:l.row[c.title],b:d.row[c.title],options:{direction:v}});if(p!==0){R=!0,y=p<0;break}}if(R&&y)return!0}if(u){let y=!1,R=!1;for(const g of ee.value){const c=le.value[g.fk_column_id];if(!(c!=null&&c.title))continue;const v=g.direction||"asc",p=Oe({uidt:c.uidt,a:l.row[c.title],b:u.row[c.title],options:{direction:v}});if(p!==0){R=!0,y=p>0;break}}if(R&&y)return!0}return!1},_t=t=>{const o=Array.from(t.keys()).sort((s,i)=>s-i),r=[];let a=o[0],n=o[0];for(let s=1;s<=o.length;s++){const i=o[s];i!==n+1&&(r.push({start:a,end:n}),a=i),n=i}return r},Ze=(t,o=[])=>{var i;if(!ee.value.length)return;const r=B(o),a=ee.value.sort((d,u)=>(d.order??0)-(u.order??0)),n=Array.isArray(t)?t:[t],s=_t(r.cachedRows.value);n.forEach(d=>{const u=d.rowMeta.rowIndex,l=s.find(S=>u>=S.start&&u<=S.end);if(!l)return;const R=Array.from(r.cachedRows.value.entries()).filter(([S])=>S>=l.start&&S<=l.end).map(([S,m])=>{var M;return{currentIndex:S,row:m,pk:P(m.row,((M=w.value)==null?void 0:M.columns)??[])}}).sort((S,m)=>{var M;for(const W of a){const A=(M=le.value[W.fk_column_id])==null?void 0:M.title;if(!A)continue;const f=W.direction||"asc",_=Oe({uidt:le.value[W.fk_column_id].uidt,a:S.row.row[A],b:m.row.row[A],options:{direction:f}});if(_!==0)return _}return S.currentIndex-m.currentIndex}),g=R.find(S=>{var m;return S.pk===P(d.row,((m=w.value)==null?void 0:m.columns)??[])});if(!g)return;const c=l.start+R.indexOf(g),v=new Map(r.cachedRows.value);if(c!==u){if(c<u)for(let m=u-1;m>=c;m--){const M=v.get(m);M&&(M.rowMeta.rowIndex=m+1,M.rowMeta.isRowOrderUpdated=!1,v.set(m+1,M))}else for(let m=u+1;m<=c;m++){const M=v.get(m);M&&(M.rowMeta.rowIndex=m-1,M.rowMeta.isRowOrderUpdated=!1,v.set(m-1,M))}d.rowMeta.rowIndex=c,d.rowMeta.isRowOrderUpdated=!1,v.set(c,d);const S=X(c);if(c<=l.start||c>=l.end){if(c<=l.start)for(let m=0;m<=S;m++)r.chunkStates.value[m]=void 0;else if(c>=l.end)for(let m=S;m<=X(r.totalRows.value-1);m++)r.chunkStates.value[m]=void 0}}else d.rowMeta.isRowOrderUpdated=!1;const p=new Set;for(const[S,m]of v){if(p.has(m.rowMeta.rowIndex)){console.error("Op: applySorting:  Duplicate index detected:",m.rowMeta.rowIndex);break}p.add(m.rowMeta.rowIndex)}r.cachedRows.value=v}),(i=e==null?void 0:e.syncVisibleData)==null||i.call(e)};function Dt(t,o=w.value,r={},a=[]){var d;const n=B(a);if((rt(t)||lo(t))&&(t=n.totalRows.value),n.cachedRows.value.has(t)){const u=Array.from(n.cachedRows.value.entries()).filter(([l])=>l>=t).sort((l,y)=>y[0]-l[0]);for(const[l,y]of u){const R={...y,rowMeta:{...y.rowMeta,rowIndex:l+1}};n.cachedRows.value.set(l+1,R)}}const s=po([...Le.value,...ct.value],o==null?void 0:o.columns,{currentUser:Ie.value??void 0}),i={row:{...vo(o==null?void 0:o.columns),...s,...r},oldRow:{},rowMeta:{new:!0,rowIndex:t,path:a}};return n.cachedRows.value.set(t,i),n.totalRows.value++,(d=e==null?void 0:e.syncVisibleData)==null||d.call(e),i}const Ke=async(t,o,r,a,{metaValue:n=w.value}={},s)=>{var i;try{await Q.dbTableRow.nestedAdd(x,(n==null?void 0:n.base_id)??U.value.id,n==null?void 0:n.id,encodeURIComponent(t),a,r.title,encodeURIComponent(o))}catch(d){if(!(s!=null&&s.suppressError)){const u=await ae(d);te.error(`Failed to link record: ${u}`)}throw d}(i=e==null?void 0:e.syncVisibleData)==null||i.call(e)},ke=async(t,{metaValue:o=w.value}={},r)=>{var n,s;const a=P(t,o==null?void 0:o.columns);if(a){for(const i of(o==null?void 0:o.columns)??[]){if(i.uidt!==h.LinkToAnotherRecord)continue;const d=i.colOptions,u=(n=Me.value)==null?void 0:n[d==null?void 0:d.fk_related_model_id];if(no(i)||so(i)){const l=t[i.title]??[];for(const y of l){const R=P(y,u==null?void 0:u.columns);R&&await Ke(a,R,i,d.type,{metaValue:u},r)}}else if(ao(i)&&t[i.title]){const l=P(t[i.title],u.columns);l&&await Ke(a,l,i,d.type,{metaValue:u},r)}}(s=e==null?void 0:e.syncVisibleData)==null||s.call(e)}};async function Ve(t,o=!1,r=[]){var n,s,i,d,u;const a=B(r);try{const l=a.cachedRows.value.get(t);if(!l)return;if(!l.rowMeta.new){const g=(s=(n=w==null?void 0:w.value)==null?void 0:n.columns)==null?void 0:s.filter(p=>p.pk).map(p=>l.row[p.title]).join("___"),c=await Q.dbTableRow.read(x,((i=w.value)==null?void 0:i.base_id)??(U==null?void 0:U.value.id),(d=w.value)==null?void 0:d.id,encodeURIComponent(g),{getHiddenColumn:!0});if(!await _e(g,void 0,r))return;l.row=c,o||ve({undo:{fn:async(p,S,m)=>{var W;const M=Ee(p.row,(W=w==null?void 0:w.value)==null?void 0:W.columns);p.row={...M,...p.row},await pe(p,S,{},!0,void 0,void 0,m),a.cachedRows.value.clear(),a.chunkStates.value=[];try{await ke(p.row,void 0,{suppressError:!0})}catch{}},args:[G(l),{},G(r)]},redo:{fn:async(p,S)=>{await Ve(p,!1,S)},args:[t,G(r)]},scope:Re({view:D.value})})}a.cachedRows.value.delete(t);const R=Array.from(a.cachedRows.value.entries()).filter(([g])=>g>t);R.sort((g,c)=>g[0]-c[0]);for(const[g,c]of R){const v=g-1;c.rowMeta.rowIndex=v,a.cachedRows.value.delete(g),a.cachedRows.value.set(v,c)}R.length&&(a.chunkStates.value[X(R[R.length-1][0])]=void 0),a.totalRows.value=(a.totalRows.value||0)-1,a.actualTotalRows.value=Math.max(0,(a.actualTotalRows.value||0)-1),await De(r),(u=e==null?void 0:e.syncVisibleData)==null||u.call(e)}catch(l){console.error(l),te.error(`${b("msg.error.deleteRowFailed")}: ${await ae(l)}`)}}async function pe(t,o={},{metaValue:r=w.value,viewMetaValue:a=D.value}={},n=!1,s=!1,i,d=[]){var l,y;if(!t.rowMeta)throw new Error("Row metadata is missing");const u=B(d);t.rowMeta.saving=!0;try{const{missingRequiredColumns:R,insertObj:g}=await Ro({meta:r,ltarState:o,getMeta:it,row:t.row,undo:n});if(R.size)return g;const c=await Q.dbViewRow.create(x,(r==null?void 0:r.base_id)??(U==null?void 0:U.value.id),r==null?void 0:r.id,a==null?void 0:a.id,{...g,...o||{}},{before:i,undo:n});t.rowMeta.new=!1,Object.assign(t.row,{...t.row??{},...Ee(c,r==null?void 0:r.columns)});const v=t.rowMeta.rowIndex;if(!n){Object.assign(t.oldRow,c);const p=P(c,r.columns),S=Ee(c,r==null?void 0:r.columns);ve({undo:{fn:async(m,M,W,A,f,_)=>{var $;u.cachedRows.value=new Map(M),u.totalRows.value=W,u.actualTotalRows.value=_,u.chunkStates.value=A,await _e(m,void 0,f),u.cachedRows.value.delete(v);for(const[O,q]of u.cachedRows.value)O>v&&(q.rowMeta.rowIndex=O-1,u.cachedRows.value.set(O-1,q));u.totalRows.value=u.totalRows.value-1,u.actualTotalRows.value=Math.max(0,(u.actualTotalRows.value||0)-1),($=e==null?void 0:e.syncVisibleData)==null||$.call(e)},args:[p,G(new Map(u.cachedRows.value)),G(u.totalRows.value),G(u.chunkStates.value),G(d),G(u.actualTotalRows.value)]},redo:{fn:async(m,M,W,A,f,_,$,O)=>{var E;u.cachedRows.value=new Map(W),u.totalRows.value=A,u.actualTotalRows.value=O,u.chunkStates.value=f,m.row={...S,...m.row};const q=await pe(m,M,void 0,!0,!0,_),H=Ye({row:m,newData:q,path:$});if(H){const L=u.cachedRows.value.get(m.rowMeta.rowIndex);L&&(L.rowMeta.isRowOrderUpdated=H)}(E=e==null?void 0:e.syncVisibleData)==null||E.call(e)},args:[G(t),G(o),G(new Map(u.cachedRows.value)),G(u.totalRows.value),G(u.chunkStates.value),G(i),G(d),G(u.actualTotalRows.value)]},scope:Re({view:D.value})})}if(u.cachedRows.value.has(v)&&!s){const S=Array.from(u.cachedRows.value.entries()).filter(([m])=>m>=v);S.sort((m,M)=>M[0]-m[0]);for(const[m,M]of S)M.rowMeta.rowIndex=m+1,u.cachedRows.value.set(m+1,M)}return u.cachedRows.value.set(v,{row:{...c,...t.row},oldRow:{...c},rowMeta:{...t.rowMeta,rowIndex:v,new:!1,saving:!1,...ie({...c,...t.row})}}),s||u.totalRows.value++,(l=e==null?void 0:e.reloadAggregate)==null||l.call(e,{path:d}),(y=e==null?void 0:e.syncVisibleData)==null||y.call(e),c}catch(R){const g=await ae(R);throw te.error(`Failed to insert row: ${g}`),R}finally{t.rowMeta.saving=!1}}async function xe(t,o,{metaValue:r=w.value,viewMetaValue:a=D.value}={},n=!1,s=[]){var d,u,l;if(!t.rowMeta)throw new Error("Row metadata is missing");const i=B(s);t.rowMeta.saving=!0;try{const y=P(t.row,r==null?void 0:r.columns),R=await Q.dbViewRow.update(x,(r==null?void 0:r.base_id)??(U==null?void 0:U.value.id),r==null?void 0:r.id,a==null?void 0:a.id,encodeURIComponent(y),{[o]:t.row[o]??null});n||ve({undo:{fn:async(c,v,p,S,m,M)=>{i.cachedRows.value=new Map(p),i.totalRows.value=S,i.actualTotalRows.value=M,await xe({row:c.oldRow,oldRow:c.row,rowMeta:c.rowMeta},v,void 0,!0,m)},args:[G(t),o,G(new Map(i.cachedRows.value)),G(i.totalRows.value),G(s),G(i.actualTotalRows.value)]},redo:{fn:async(c,v,p)=>{await xe(c,v,void 0,!0,p)},args:[G(t),o,G(s)]},scope:Re({view:D.value})});const g=new Set([h.Formula,h.QrCode,h.Barcode,h.Rollup,h.Checkbox,h.User,h.LastModifiedTime,h.LastModifiedBy,h.Lookup,h.Button,h.Attachment,h.DateTime,h.Date]);return Object.assign(t.row,(d=r==null?void 0:r.columns)==null?void 0:d.reduce((c,v)=>(v.title&&v.title in R&&(g.has(v.uidt)||wo(v)||v.au||fo(v==null?void 0:v.cdf)&&/ on update /i.test(v.cdf))&&(c[v.title]=R[v.title]),c),{})),Object.assign(t.oldRow,R),Object.assign(t.rowMeta,ie(t.row)),t.rowMeta.rowIndex!==void 0&&i.cachedRows.value.set(t.rowMeta.rowIndex,t),(u=e==null?void 0:e.reloadAggregate)==null||u.call(e,{fields:[{title:o}],path:s}),(l=e==null?void 0:e.syncVisibleData)==null||l.call(e),n&&Ze(t,s),R}catch(y){t.row[o]=t.oldRow[o];const R=await ae(y);throw te.error(`${b("msg.error.rowUpdateFailed")}: ${R}`),y}finally{t.rowMeta.saving=!1}}async function Et(t,o,r,a={},n,s=[]){var c,v,p,S,m,M,W,A,f,_,$,O,q,H;if(!t.rowMeta)throw new Error("Row metadata is missing");const i=B(s);t.rowMeta.changed=!1;let d;await new Promise(E=>{const L=()=>{var N,j;d=i.cachedRows.value.get(t.rowMeta.rowIndex),!((N=d==null?void 0:d.rowMeta)!=null&&N.saving)||!((j=d==null?void 0:d.rowMeta)!=null&&j.new)?E(!0):setTimeout(L,100)};L()});let u;const l=(v=(c=w.value)==null?void 0:c.columns)==null?void 0:v.filter(E=>io(E)||uo(E)||co(E)||[h.Formula,h.QrCode,h.Barcode,h.Rollup,h.Checkbox,h.User,h.Lookup,h.Button,h.Attachment].includes(E.uidt));t.rowMeta.new?u=await pe(t,r,a,!1,!0,n,s):o&&(d&&(l==null||l.reduce((E,L)=>(rt(d.row[L.title])||(E[L.title]=d.row[L.title]),E),t.row)),u=await xe(t,o,a,!1,s));const y=!nt([...Le.value,...gt.value],u,(p=w.value)==null?void 0:p.columns,$e((m=(S=D.value)==null?void 0:S.view)==null?void 0:m.source_id),Me.value,{currentUser:Ie.value}),R=i.cachedRows.value.get(t.rowMeta.rowIndex);if(R&&(R.rowMeta.isValidationFailed=y),(W=(M=t.rowMeta)==null?void 0:M.path)!=null&&W.length&&(F!=null&&F.value)){const E=await((f=e==null?void 0:e.getWhereFilter)==null?void 0:f.call(e,(A=t.rowMeta)==null?void 0:A.path,!0)),L=F.value.findIndex(j=>j.column.title===o)??0,{filters:C}=et({api_version:tt.V1},E??"",qe.value),N=!nt([...C??[]],u,(_=w.value)==null?void 0:_.columns,$e((O=($=D.value)==null?void 0:$.view)==null?void 0:O.source_id),Me.value,{currentUser:Ie.value});t.rowMeta.isGroupChanged=N,t.rowMeta.changedGroupIndex=L}const g=o?[o]:Object.keys(t.row);if(g.push(...((q=w.value)==null?void 0:q.columns.filter(E=>[h.LastModifiedBy,h.LastModifiedTime,h.Formula,h.Lookup,h.Rollup,h.LinkToAnotherRecord].includes(E.uidt)).map(E=>E.title))||[]),xo(g,ee.value,le.value)||R){const E=Ye({row:t,newData:u,sorts:ee.value,path:s});R&&(R.rowMeta.isRowOrderUpdated=E)}(H=e==null?void 0:e.syncVisibleData)==null||H.call(e)}async function Ot(t,{metaValue:o=w.value,viewMetaValue:r=D.value}={},a=[]){var n,s;if(!r)throw new Error("View meta value is missing");await Q.dbTableRow.bulkUpdateAll(x,o==null?void 0:o.base_id,o==null?void 0:o.id,t,{viewId:r.id}),(n=e==null?void 0:e.reloadAggregate)==null||n.call(e,{path:a}),(s=e==null?void 0:e.syncVisibleData)==null||s.call(e)}async function _e(t,{metaValue:o=w.value,viewMetaValue:r=D.value}={},a=[]){var n;if(!t)throw new Error("Delete not allowed for table which doesn't have primary Key");try{const s=await Q.dbViewRow.delete("noco",(o==null?void 0:o.base_id)??U.value.id,o==null?void 0:o.id,r==null?void 0:r.id,encodeURIComponent(t));if((n=e==null?void 0:e.reloadAggregate)==null||n.call(e,{path:a}),s.message){const i=`Unable to delete record with ID ${t} because of the following:
${s.message.join(`
`)}.
Clear the data first & try again`;return te.info(`Record delete failed: ${i}`),!1}return!0}catch(s){const i=await ae(s);return te.error(`${b("msg.error.deleteRowFailed")}: ${i}`),!1}}const Ft=(t,o=[])=>{var n,s,i;o=((n=t==null?void 0:t.rowMeta)==null?void 0:n.path)??[];const r=B(o),a=(s=Array.from(r.cachedRows.value.entries()).find(([d,u])=>u.rowMeta.rowIndex===t.rowMeta.rowIndex))==null?void 0:s[0];return a!==void 0&&t.rowMeta.new?(r.cachedRows.value.delete(a),r.totalRows.value--,!0):((i=e==null?void 0:e.syncVisibleData)==null||i.call(e),!1)};async function De(t=[]){var a,n,s,i,d,u,l,y,R;if(!(I!=null&&I.value)&&(!((a=U==null?void 0:U.value)!=null&&a.id)||!((n=w.value)!=null&&n.id)||!((s=D.value)!=null&&s.id)))return;const o=B(t),r=await((i=e==null?void 0:e.getWhereFilter)==null?void 0:i.call(e,t));try{const{count:g}=I!=null&&I.value?await Ne({filtersArr:se.value,where:r}):await Q.dbViewRow.count(x,(d=U==null?void 0:U.value)==null?void 0:d.id,w.value.id,(u=D==null?void 0:D.value)==null?void 0:u.id,{where:r,...ne("filterSync")?{}:{filterArrJson:JSON.stringify(se.value)}});if(wt.value){const{count:c}=I!=null&&I.value?await Ne({filtersArr:se.value,where:Je.value}):await Q.dbViewRow.count(x,(l=U==null?void 0:U.value)==null?void 0:l.id,w.value.id,(y=D==null?void 0:D.value)==null?void 0:y.id,{where:Je.value,...ne("filterSync")?{}:{filterArrJson:JSON.stringify(se.value)}});!T&&!t.length&&Ce(ge.value)?Ue.value=Math.max(Math.min(200,c),c):Ue.value=c}!T&&!t.length&&Ce(ge.value)?o.totalRows.value=Math.min(200,g):o.totalRows.value=g,o.actualTotalRows.value=g,lt.value=Math.max(o.totalRows.value,o.actualTotalRows.value),(R=e==null?void 0:e.syncVisibleData)==null||R.call(e)}catch(g){const c=await ae(g);throw te.error(`Failed to sync count: ${c}`),g}}function Se(t){var a;const o=oe.value.rowId;if(!o)return-1;const r=B(t);for(const[n,s]of r.cachedRows.value.entries())if(P(s.row,(a=w.value)==null?void 0:a.columns)===o)return s.rowMeta.rowIndex;return-1}async function Bt(t){if(!oe.value.rowId)return-1;const r=B(t);return await ho(()=>{var a;return(a=r.chunkStates.value)==null?void 0:a.every(n=>n!=="loading")}).toBeTruthy({timeout:5e3}),Se(t)}const $t=K(()=>{var a,n,s,i;const t=(n=(a=oe.value)==null?void 0:a.path)!=null&&n.trim()?(i=(s=oe.value)==null?void 0:s.path)==null?void 0:i.split("-").map(d=>+d):[],o=B(t),r=Se(t);return r===-1?!1:r===o.totalRows.value-1}),Nt=K(()=>{var r,a,n,s;const t=(a=(r=oe.value)==null?void 0:r.path)!=null&&a.trim()?(s=(n=oe.value)==null?void 0:n.path)==null?void 0:s.split("-").map(i=>+i):[],o=Se(t);return o===-1?!1:o===0});async function be(t,o,r=[]){var u;const a=X(t),n=X(o),s=new Set;for(let l=a;l<=n;l++)s.add(l);await Promise.all([...s].map(l=>Te(l,r)));const i=B(r),d=[];for(let l=t;l<=o;l++)i.cachedRows.value.has(l)&&d.push(i.cachedRows.value.get(l));return(u=e==null?void 0:e.syncVisibleData)==null||u.call(e),d}ft.on(t=>{if([ot.TRIGGER_RE_RENDER,ot.ON_ROW_COLOUR_INFO_UPDATE].includes(t))if(ht.value)me.value.forEach(o=>{o.cachedRows.value.forEach(r=>{Object.assign(r.rowMeta,ie(r.row))})});else{const{cachedRows:o}=B();o.value.forEach(r=>{Object.assign(r.rowMeta,ie(r.row))})}});const he=Y(null);return Vt(w,(t,o)=>{if(t!=null&&t.fk_workspace_id&&(t!=null&&t.base_id)&&(t!=null&&t.id)){if(o!=null&&o.id&&o.id===t.id)return;he.value&&J.offMessage(he.value),he.value=`${bt.DATA_EVENT}:${t.fk_workspace_id}:${t.base_id}:${t.id}`,J.subscribe(he.value),J.onMessage(he.value,r=>{var d,u,l,y,R,g,c,v,p,S,m,M,W,A;const{id:a,action:n,payload:s,before:i}=r;if(n==="add")try{const f=B();if(i)for(const[$,O]of f.cachedRows.value.entries()){const q=P(O.row,(d=w.value)==null?void 0:d.columns);if(q&&`${q}`==`${i}`){const H=$;f.cachedRows.value.set(H,{row:s,oldRow:{},rowMeta:{new:!1,rowIndex:H,path:[]}});const L=Array.from(f.cachedRows.value.entries()).filter(([C])=>C>$);L.sort((C,N)=>C[0]-N[0]);for(const[C,N]of L){const j=C+1;N.rowMeta.rowIndex=j,f.cachedRows.value.delete(C),f.cachedRows.value.set(j,N)}L.length&&(f.chunkStates.value[X(L[L.length-1][0])]=void 0),f.totalRows.value++,f.actualTotalRows.value=Math.max(f.actualTotalRows.value||0,f.totalRows.value),(u=e==null?void 0:e.syncVisibleData)==null||u.call(e);return}}const _=f.totalRows.value;f.cachedRows.value.set(_,{row:s,oldRow:{},rowMeta:{new:!1,rowIndex:_,path:[]}}),f.totalRows.value++,f.actualTotalRows.value=Math.max(f.actualTotalRows.value||0,f.totalRows.value),(l=e==null?void 0:e.syncVisibleData)==null||l.call(e)}catch(f){console.error("Failed to add cached row on socket event",f)}else if(n==="update")try{const f=B();let _=!1;for(const $ of f.cachedRows.value.values()){const O=P($.row,(y=w.value)==null?void 0:y.columns);if(O&&`${O}`==`${a}`){Object.assign($.row,s),Object.assign($.oldRow,s),$.rowMeta.changed=!1,_=!0;break}}_&&((R=e==null?void 0:e.syncVisibleData)==null||R.call(e))}catch(f){console.error("Failed to update cached row on socket event",f)}else if(n==="delete")try{const f=B();for(const[_,$]of f.cachedRows.value.entries()){const O=P($.row,(g=w.value)==null?void 0:g.columns);if(O&&`${O}`==`${a}`){f.cachedRows.value.delete(_);const H=Array.from(f.cachedRows.value.entries()).filter(([E])=>E>_);H.sort((E,L)=>E[0]-L[0]);for(const[E,L]of H){const C=E-1;L.rowMeta.rowIndex=C,f.cachedRows.value.delete(E),f.cachedRows.value.set(C,L)}H.length&&(f.chunkStates.value[X(H[H.length-1][0])]=void 0),f.totalRows.value=(f.totalRows.value||0)-1,f.actualTotalRows.value=Math.max(0,(f.actualTotalRows.value||0)-1),(c=e==null?void 0:e.syncVisibleData)==null||c.call(e)}}(v=e==null?void 0:e.syncVisibleData)==null||v.call(e)}catch(f){console.error("Failed to delete cached row on socket event",f)}else if(n==="reorder")try{const f=B();let _=null,$=null;for(const[C,N]of f.cachedRows.value.entries()){const j=P(N.row,(p=w.value)==null?void 0:p.columns);if(j&&`${j}`==`${a}`){_=N,$=C;break}}if(!_||$===null){if(console.warn("Row to move not found in cache:",a),i){let C=null;for(const[N,j]of f.cachedRows.value.entries()){const k=P(j.row,(S=w.value)==null?void 0:S.columns);if(k&&`${k}`==`${i}`){C=N;break}}if(C!==null){const N=new Map(f.cachedRows.value.entries()),j=Array.from(f.cachedRows.value.entries()).filter(([k])=>k>=C).sort((k,de)=>de[0]-k[0]);for(const[k,de]of j){const ce=k+1;de.rowMeta.rowIndex=ce,N.delete(k),N.set(ce,de)}if(j.length>0){const k=X(C),de=X(j[j.length-1][0]+1);for(let ce=k;ce<=de;ce++)f.chunkStates.value[ce]=void 0}f.cachedRows.value=N,(m=e==null?void 0:e.syncVisibleData)==null||m.call(e)}else console.log("Before row not in cache, skipping reorder operation")}else console.log("Row moved to end, no cache changes needed"),(M=e==null?void 0:e.syncVisibleData)==null||M.call(e);return}let O;if(i){let C=null;for(const[N,j]of f.cachedRows.value.entries()){const k=P(j.row,(W=w.value)==null?void 0:W.columns);if(k&&`${k}`==`${i}`){C=N;break}}C!==null?O=C:O=Math.max(...Array.from(f.cachedRows.value.keys()))+1}else O=Math.max(...Array.from(f.cachedRows.value.keys()))+1;if($===O)return;const q=new Map(f.cachedRows.value.entries());q.delete($);const H=O>$?O-1:O;if(H<$)for(let C=$-1;C>=H;C--){const N=q.get(C);if(N){const j=C+1;N.rowMeta.rowIndex=j,q.delete(C),q.set(j,N)}}else for(let C=$+1;C<=H;C++){const N=q.get(C);if(N){const j=C-1;N.rowMeta.rowIndex=j,q.delete(C),q.set(j,N)}}_.rowMeta.rowIndex=H,q.set(H,_),s&&typeof s=="object"&&(Object.assign(_.row,s),Object.assign(_.oldRow,s)),_.rowMeta.changed=!1;const E=X(H),L=X($);for(let C=Math.min(L,E);C<=Math.max(L,E);C++)f.chunkStates.value[C]=void 0;f.cachedRows.value=q,(A=e==null?void 0:e.syncVisibleData)==null||A.call(e)}catch(f){console.error("Failed to reorder cached row on socket event",f)}})}},{immediate:!0}),{getDataCache:B,insertRow:pe,updateRowProperty:xe,addEmptyRow:Dt,deleteRow:Ve,deleteRowById:_e,getChunkIndex:X,fetchMissingChunks:Tt,fetchChunk:Te,updateOrSaveRow:Et,bulkUpdateView:Ot,removeRowIfNew:Ft,cachedRows:ye,recoverLTARRefs:ke,totalRows:Ge,actualTotalRows:We,clearCache:Mt,syncCount:De,selectedRows:He,chunkStates:Qe,isRowSortRequiredRows:Pe,clearInvalidRows:At,applySorting:Ze,CHUNK_SIZE:V,loadData:Ae,isLastRow:$t,isFirstRow:Nt,getExpandedRowIndex:Se,loadAggCommentsCount:Xe,navigateToSiblingRow:Ct,updateRecordOrder:It,selectedAllRecords:Rt,getRows:be,groupDataCache:me}}export{Do as a,_o as g,Eo as u};
