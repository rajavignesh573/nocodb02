import{e as _t,el as Ne,hZ as kt,a9 as wt,S as Ct,G as Se,r as O,bd as xt,n as le,b_ as Tt,bZ as $t,aj as R,dM as Dt,fL as Ft,X as Pe,f as It,a7 as Et,a8 as ge,V as Nt,U as St,ld as Pt,Y as Ot,bn as Rt,fr as Ut,cT as Oe,nV as Mt,jz as Vt,aG as he,g as At,$ as Bt,a4 as K,c as k,o as c,I,b as g,K as T,w as u,L as i,t as E,an as L,aq as Q,ag as ee,a as M,ap as Lt,bO as qt,d as te,M as jt,a0 as Kt,bB as Ht,eJ as zt,b9 as Re,jH as Wt,bo as Yt,Q as _e,ah as Ue,a3 as oe,a1 as Me,ar as Zt,O as H,N as Gt,cS as Xt,aC as Ve,fV as Jt,fZ as Qt,nW as Ae,d3 as en,nX as tn,_ as nn}from"./DRA9KN5F.js";import{_ as an}from"./QeWwuUYP.js";import{_ as sn}from"./BhKW-HeQ.js";import{u as ln}from"./By5RWL3d.js";import{_ as on,C as rn}from"./-iDxnmJF.js";import{_ as cn}from"./CkpISeXq.js";import"./ytmFgNfN.js";const un=[{title:"Enabled",key:"enabled",padding:"0px 0px 0px 12px",minWidth:0,width:33},{title:"Column Name",name:"Column Name",dataIndex:"column_name",key:"column_name",minWidth:200,padding:"0px 12px 0 9px"}],dn=[{title:"Field",dataIndex:"source_column",key:"source_column",minWidth:200,padding:"0px 0px 0px 12px"},{title:"NocoDB Field",dataIndex:"destination_column",key:"destination_column",minWidth:200,padding:"0px 12px 0px 0px"}];var mn={};const fn={class:"relative text-nc-content-gray"},pn={key:0},yn={key:0,class:"text-center"},vn={class:"w-8 h-8 flex items-center justify-center bg-nc-bg-gray-extralight rounded-md"},bn={key:1,class:"w-[150px]"},gn={key:0,class:"bg-gray-50 pl-4 flex-1 flex"},hn={key:0,class:"w-full"},_n={class:"w-full flex items-center gap-3 h-full"},kn={key:0,class:"absolute h-1 border-t border-nc-border-gray-medium top-0 left-3 right-3 cursor-default"},wn={class:"flex items-center gap-2 w-full"},Cn={key:1,class:"pt-4 pr-2"},xn={class:"flex"},Tn={class:"ml-2"},$n=["onClick"],Dn={key:3,class:"w-[150px]"},Fn={key:0,class:"bg-nc-bg-gray-extralight pl-3 flex-1 flex"},In={class:"font-weight-700 text-small text-nc-content-gray-subtle2"},En=["onClick"],Nn={class:"font-weight-500 text-nc-content-gray max-w-[300px] inline-block truncate nc-import-table-field-name"},Sn={key:3,class:"absolute h-1 border-t border-nc-border-gray-medium top-0 left-3 right-3"},Pn=_t({__name:"Editor",props:{quickImportType:{},baseTemplate:{},importData:{},importColumns:{},importDataOnly:{type:Boolean},maxRowsToParse:{},baseId:{},sourceId:{},importWorker:{},tableIcon:{}},emits:["import","error","change"],setup(f,{expose:Be,emit:Le}){const ne=Le;Ne.extend(kt);const{t:P}=wt(),{getMeta:qe}=Ct(),{isAllowed:je}=ln(),ie=Se(xt,O()),Ke=e=>[R.ForeignKey,R.ID].includes(e.uidt)?!0:!Ve(e)&&!Jt(e)&&!Qt(e),W=le(()=>{var e,t;return(t=((e=ie.value)==null?void 0:e.columns)||[])==null?void 0:t.filter(n=>Ke(n)).map(n=>{const a=f.importDataOnly?je(Tt.FIELD,n.id,$t.RECORD_FIELD_EDIT):!0,l=n.readonly&&n.uidt!==R.ForeignKey;return{...n,readonly:l||!a,permissions:{isEditAllowed:a,tooltip:l?P("msg.info.fieldReadonly"):a?"":P("tooltip.youDontHavePermissionToEditThisField")}}})}),He=Se(Ft,Dt()),ze=Pe.useForm,{$api:ce,$state:We}=It(),Ye=Et(),{bases:Ze}=ge(Ye),ke=Nt(),{isMysql:Ge,isPg:Xe}=ke,{base:Je}=ge(ke),A=le(()=>Ze.value.get(f.baseId)||Je.value),we=St(),{openTable:Qe,loadProjectTables:et}=we,{baseTables:tt}=ge(we),Ce=le(()=>{const e={};for(const t of A.value.sources??[])t.id&&(e[t.id]=Pt.create({client:t.type}));return e}),ue=le(()=>Ce.value[f.sourceId]||Object.values(Ce.value)[0]),de=O([]),q=O([]),ae=O(!1),xe=O([]),N=O(!1),nt=O({}),me=O({}),z=O(),S=O({}),h=Ot({title:null,name:"Base Name",tables:[]}),at=le(()=>h.tables.reduce((e,t,n)=>{var a;return e[`tables.${n}.table_name`]=[Rt,{validator:(l,s)=>new Promise((v,p)=>{if(!f.importDataOnly&&h.tables.some((_,w)=>w!==n&&_.table_name===s))return p(new Error(P("msg.error.duplicateTableName")));v()})},{validator:(l,s)=>new Promise((v,p)=>{if(s!==(s==null?void 0:s.trim()))return p(new Error("Table names should not have whitespace in the beginning or their end."));v()})},{validator:(l,s)=>new Promise((v,p)=>{var C;let _=255;if(Ge(f.sourceId)?_=64:Xe(f.sourceId)&&(_=63),((((C=A==null?void 0:A.value)==null?void 0:C.prefix)||"")+s).length>_)return p(new Error(`Table name exceeds ${_} characters`));v()})}],e[`tables.${n}.columns`]=[{validator:(l,s)=>new Promise((v,p)=>{if(!f.importDataOnly&&Ut(s)&&!s.some(_=>_.selected))return p(new Error(P("msg.error.selectAtleastOneColumn")));v()})}],de.value[n]=!1,(a=t.columns)==null||a.forEach((l,s)=>{e[`tables.${n}.columns.${s}.title`]=[Oe(),{validator:(v,p)=>new Promise((_,w)=>{const C=t.columns.find((m,V)=>V===s);if(!C||!(C!=null&&C.selected))return _();if(t.columns.filter(m=>m.selected).length&&t.columns.some((m,V)=>V!==s&&m.selected&&m.title===p))return w(new Error(P("msg.error.duplicateColumnName")));_()})},{validator:(v,p)=>new Promise((_,w)=>{const C=t.columns.find((b,m)=>m===s);return!C||!(C!=null&&C.selected)?_():Mt().validator(v,p).then(()=>{_()}).catch(b=>{w(b)})})},{validator:(v,p)=>new Promise((_,w)=>{const C=t.columns.find((b,m)=>m===s);return!C||!(C!=null&&C.selected)?_():Vt().validator(v,p).then(()=>{_()}).catch(b=>{w(b)})})}],e[`tables.${n}.columns.${s}.uidt`]=[Oe()],it(l)&&(de.value[n]=!0)}),e},{})),{validate:fe,validateInfos:pe,modelRef:st}=ze(h,at),Te=O(!f.importDataOnly),$e=O(""),De=O();he([()=>S.value],()=>{let e=!0;if(f.importDataOnly)for(const t of Object.keys(S.value)){let n=!1;Fe(t)&&(e=!1);for(const a of S.value[t])if(!mt(a,t)){e=!1,n=!0;break}if(n)break}else for(const[t,n]of Object.entries(pe))n!=null&&n.validateStatus&&n.validateStatus==="error"&&(e=!1);Te.value=e},{deep:!0}),At(()=>{ot(),f.importDataOnly&&pt(),Bt(()=>{var e;(e=xe.value[0])==null||e.focus()})});function lt(e,t){return t.value.toUpperCase().includes(e.toUpperCase())}function ot(){f.baseTemplate&&(rt(f.baseTemplate),q.value=Array.from({length:h.tables.length||0},(e,t)=>t),de.value=Array.from({length:h.tables.length||0},()=>!1))}function rt({tables:e=[],...t}){const n={...t,tables:e.map(({v:a=[],columns:l=[],...s})=>({...s,columns:[...l.map((v,p)=>{var _;if(!f.importDataOnly&&((_=v.column_name)==null?void 0:_.toLowerCase())==="id"){const w=bt("id",[],l);v.column_name=w}return v.key=p,v.selected=!0,v}),...a.map(v=>({column_name:v.title,selected:!0,table_name:{...v}}))]}))};Object.assign(h,n)}function it(e){return e.uidt==="MultiSelect"||e.uidt==="SingleSelect"}function ct(e,t){const n={};return e.map(a=>(t||[]).reduce((l,s)=>{var _;if(s.uidt===R.ID)return l;const v=s.title in a?s.title:s.ref_column_name;let p=a[v];if(s.uidt===R.Date&&p){let w;(_=s==null?void 0:s.meta)!=null&&_.date_format?(w=s.meta.date_format,n[s.key]=w):s.key in n?w=n[s.key]:(w=en(p),n[s.key]=w),p=Ae(p,w)}else if(s.uidt===R.DateTime&&p){const w=tn(a[v]);p=Ne(a[v],w).format("YYYY-MM-DD HH:mm")}return{...l,[s.title]:p}},{}))}function ut(e,t=!1){const n=W.value.filter(a=>{var l;return(a.pk?!a.ai&&!a.cdf&&!((l=a.meta)!=null&&l.ag):!a.cdf&&a.rqd)&&!S.value[e].some(s=>s.destCn===a.title)});if(n.length){const a=`${P("msg.error.columnsRequired")} : ${n.map(l=>l.title).join(", ")}`;if(t)K.error(a);else return a;return!0}return!1}function Fe(e,t=!1){if(S.value[e].filter(n=>n.enabled===!0).length===0){const n=P("msg.error.selectAtleastOneColumn");if(t)K.error(n);else return n;return!0}return!1}function dt(e,t){const n=S.value[t];return W.value.filter(a=>!(n!=null&&n.some(l=>l.srcTitle!==e.srcTitle&&l.destCn===a.title)))}function mt(e,t){if(!e.enabled)return!0;if(!e.destCn)return K.error(`${P("msg.error.columnDescriptionNotFound")} ${e.srcTitle}`),!1;if(S.value[t].filter(a=>a.destCn===e.destCn).length>1)return K.error(P("msg.error.duplicateMappingFound")),!1;const n=W.value.find(a=>a.title===e.destCn);for(const a of Object.keys(f.importData))switch((n.pk?!n.ai&&!n.cdf:!n.cdf&&n.rqd)&&f.importData[a].slice(0,f.maxRowsToParse).some(l=>l[e.srcCn]===null||l[e.srcCn]===void 0||l[e.srcCn]==="")&&K.error(P("msg.error.nullValueViolatesNotNull")),n.uidt){case R.Number:if(f.importData[a].slice(0,f.maxRowsToParse).some(l=>l[e.sourceCn]!==null&&l[e.srcCn]!==void 0&&isNaN(+l[e.srcCn])))return K.error(P("msg.error.sourceHasInvalidNumbers")),!1;break;case R.Checkbox:if(f.importData[a].slice(0,f.maxRowsToParse).some(l=>{if(l[e.srcCn]!==null&&l[e.srcCn]!==void 0){let s=l[e.srcCn];return typeof s=="string"?(s=s.replace(/["']/g,"").toLowerCase().trim(),!(s==="false"||s==="no"||s==="n"||s==="0"||s==="true"||s==="yes"||s==="y"||s==="1")):s!==1&&s!==0&&s!==!0&&s!==!1}return!1}))return K.error(P("msg.error.sourceHasInvalidBoolean")),!1;break}return!0}function ye(e,t,n,a){nt.value[`${e}-${t}`]=`Importing data to ${e} - ${t}: ${n}/${a} records`,me.value[t]=parseInt(`${n/a*100}`)}async function ft(){var n,a,l,s,v,p,_,w,C;if(f.importDataOnly){for(const b of h.tables){const m=be(b.table_name);if(m.length)throw new Error(`${m[0]}`)}try{N.value=!0,q.value=[];const b=(n=ie.value)==null?void 0:n.id,m=A.value.id,V=h.tables.map(U=>U.table_name);await Promise.all(Object.keys(f.importData).map(U=>(async y=>{var d;if(!V.includes(y))return;const B=f.importData[y],r=B.length;let x;for(let o=0,G=0;o<r;o+=f.maxRowsToParse){const F=B.slice(o,o+f.maxRowsToParse).map(j=>S.value[y].reduce((X,se)=>{if(se.enabled&&se.destCn){const J=W.value.find(ht=>ht.title===se.destCn);let D=j[se.srcCn];J.uidt===R.Checkbox?(typeof D=="string"&&(D=D?D.replace(/["']/g,"").toLowerCase().trim():"false"),D=D??"false",D==="false"||D==="no"||D==="n"?D="0":(D==="true"||D==="yes"||D==="y")&&(D="1")):J.uidt===R.Number||J.uidt===R.SingleSelect||J.uidt===R.MultiSelect?D===""&&(D=null):J.uidt===R.Date&&D&&(D=Ae(D,J.meta.date_format)),X[se.destCn]=D}return X},{}));x=(d=(await ce.dbTableRow.bulkCreate("noco",m,b,F,{wrapped:"true","headers[nc-import-type]":f.quickImportType,operation_id:x,typecast:Ue&&ae.value?"true":void 0},{headers:{"xc-auth":We.token.value,"nc-operation-id":x,"nc-import-type":f.quickImportType}})).headers)==null?void 0:d["nc-operation-id"],ye(m,b,G,r),G+=F.length,ae.value&&await qe(b,!0)}})(U))),He.trigger(),K.success(P("msg.success.tableDataImported"))}catch(b){throw console.log(b),b}finally{N.value=!1}}else{try{await fe()}catch{throw new Error("Please fill all the required values")}try{N.value=!0,q.value=[];const b={id:"",title:"",baseId:""};for(const m of h.tables){const V=ue==null?void 0:ue.value.getNewTableColumns().filter(y=>y.column_name!=="title");for(const y of V)(a=m.columns)!=null&&a.some(B=>{var r;return((r=B.column_name)==null?void 0:r.toLowerCase())===y.column_name.toLowerCase()})||(l=m.columns)==null||l.push(y);if(m.columns=(s=m.columns)==null?void 0:s.filter(y=>!("selected"in y)||y.selected),m.columns)for(const y of m.columns)((v=y.column_name)==null?void 0:v.toLowerCase())==="id"&&!("pk"in y)&&(y.pk=!0,y.rqd=!0),(!Ve(y)||["created_at","updated_at"].includes(y.column_name))&&y.uidt!==R.SingleSelect&&y.uidt!==R.MultiSelect&&delete y.dtxp;const U=await ce.source.tableCreate((p=A.value)==null?void 0:p.id,f.sourceId||((w=(_=A.value)==null?void 0:_.sources)==null?void 0:w[0].id),{table_name:m.table_name,title:"",columns:m.columns||[]});mn.NC_SANITIZE_COLUMN_NAME!=="false"&&U.columns.forEach((y,B)=>{m.columns[B]&&(m.columns[B].column_name=y.column_name)}),m.id=U.id,m.title=U.title,b.id===""&&b.title===""&&b.baseId===""&&(b.id=U.id,b.title=U.title,b.baseId=A.value.id)}if(f.importData){const m=f.maxRowsToParse,V=A.value.title;await Promise.all(h.tables.map(U=>(async y=>{let B=0,r=0;const x=f.importData[y.ref_table_name];if(x){r+=x.length;for(let d=0;d<x.length;d+=m){ye(V,y.title,B,r);const o=ct(x.slice(d,d+m),y.columns);await ce.dbTableRow.bulkCreate("noco",A.value.id,y.id,o),B+=o.length}ye(V,y.title,r,r)}})(U)))}K.success(P(`msg.success.${h.tables.length>1?"tableImportedPlural":"tableImported"}`)),await et(A.value.id,!0)}catch(b){throw console.log(b),b}finally{N.value=!1}}if(!((C=h.tables)!=null&&C.length))return;const e=tt.value.get(A.value.id),t=e==null?void 0:e.find(b=>b.id===h.tables[0].id);t&&Qe(t)}function pt(){S.value={};for(let e=0;e<h.tables.length;e++)for(const t of f.importColumns[e]){const n={srcCn:t.column_name,srcTitle:t.title,destCn:void 0,enabled:!0};if(W.value){const a=W.value.find(l=>!l.readonly&&(l.title===t.title||l.column_name===t.column_name));a?n.destCn=a.title:n.enabled=!1}h.tables[e].table_name in S.value||(S.value[h.tables[e].table_name]=[]),S.value[h.tables[e].table_name].push(n)}}Be({importTemplate:ft,isValid:Te,importError:$e,updateImportError:e=>{$e.value=e}});function re(e){return(S.value[e]||[]).filter(t=>t.destCn)}function ve(e){return!!re(e).length&&re(e).every(n=>n.enabled)}function yt(e){return re(e).length&&re(e).some(n=>n.destCn&&n.enabled)}function vt(e,t){const n=e.target.checked;for(const a of S.value[t])!a.destCn&&n||(a.enabled=n)}const Ie=(e=[])=>{const t={};for(const n of e)t[n.name]=n.errors;z.value=t};function bt(e,t=[],n){let a=2,l=`${e}1`;for(;t.includes(l)||n!=null&&n.some(s=>s.column_name===l||s.title===l);)l=`${e}${a++}`;return l}he(De,()=>{setTimeout(async()=>{try{await fe(),ne("change"),z.value=null}catch(e){ne("error",e),Ie(e==null?void 0:e.errorFields)}},500)}),he(st,async()=>{try{await fe(),ne("change"),z.value=null}catch(e){ne("error",e),Ie(e==null?void 0:e.errorFields)}});function gt(e){if(e.columns.every(t=>t.selected))for(const t of e.columns)t.selected=!1;else for(const t of e.columns)t.selected=!0}const Y=O(""),Z=O(),Ee=e=>{var t,n;return(((t=z.value)==null?void 0:t[`tables.${e}.table_name`])||[]).concat(((n=z.value)==null?void 0:n[`tables.${e}.columns`])||[])};function be(e){const t=[],n=Fe(e);n&&t.push(n);const a=ut(e);return a&&t.push(a),t}return(e,t)=>{const n=Pe,a=jt,l=Lt,s=an,v=cn,p=qt,_=zt,w=Ht,C=Kt,b=sn,m=on,V=rn,U=Zt,y=Gt,B=Xt;return c(),k("div",fn,[e.importDataOnly?(c(),k("div",pn,[g(n,{model:i(h),name:"import-only"},{default:u(()=>[i(h).tables&&e.quickImportType==="excel"?(c(),k("p",yn,E(i(h).tables.length)+" sheet"+E(i(h).tables.length>1?"s":"")+" available for import ",1)):T("",!0)]),_:1},8,["model"]),i(h).tables&&i(h).tables.length?(c(),I(V,{key:0,"active-key":i(q),"onUpdate:activeKey":t[0]||(t[0]=r=>_e(q)?q.value=r:null),class:"template-collapse !rounded-lg !overflow-hidden",accordion:"","expand-icon-position":"right"},{expandIcon:u(({isActive:r})=>[i(N)?T("",!0):(c(),I(a,{key:0,icon:"ncChevronDown",class:ee(["text-lg !-translate-y-1/2 !transition text-nc-content-gray-subtle",{"!transform !rotate-180":r}])},null,8,["class"]))]),default:u(()=>[(c(!0),k(L,null,Q(i(h).tables,(r,x)=>(c(),I(m,{key:x,class:ee(["nc-import-table-box nc-upload-box !overflow-hidden",{"pointer-events-none":i(N)}])},{header:u(()=>[M("div",{class:ee(["flex items-center space-x-3 group min-h-8",{"w-[calc(100%_-_30px)]":!i(N),"w-full":i(N)}])},[M("div",vn,[g(a,{icon:e.tableIcon,class:"w-5 h-5"},null,8,["icon"])]),g(l,{title:r.table_name,"show-on-truncate-only":"",class:"flex-1 truncate text-nc-content-gray"},{default:u(()=>[M("span",null,E(r.table_name),1)]),_:2},1032,["title"]),!i(N)&&be(r.table_name).length?(c(),I(l,{key:0,class:"ml-2"},{title:u(()=>[(c(!0),k(L,null,Q(be(r.table_name),(d,o)=>(c(),k("div",{key:o,class:"mb-1 last-of-type:mb-0"},E(o>0?`${o+1}.`:"")+" "+E(d),1))),128))]),default:u(()=>[g(s,{color:"red",border:!1,class:"w-8 !px-2 flex-none !bg-nc-bg-red-light"},{default:u(()=>[g(a,{icon:"ncInfo",class:"text-nc-content-red-dark"})]),_:1})]),_:2},1024)):T("",!0),i(N)?(c(),k("div",bn,[g(v,{percent:i(me)[i(ie).id]??0,size:"small",status:"normal","stroke-color":"#3366FF","trail-color":"#F0F3FF"},null,8,["percent"])])):T("",!0)],2)]),default:u(()=>[i(S)?(c(),k("div",gn,[g(b,{class:"template-form flex-1 max-h-[310px]","header-row-class-name":"relative","body-row-class-name":"template-form-row",data:i(S)[r.table_name],columns:i(dn),bordered:!1,"header-row-height":"40px","row-height":"40px"},{headerCell:u(({column:d})=>[d.key==="source_column"?(c(),k(L,{key:0},[g(l,null,{title:u(()=>[te(E(ve(r.table_name)?e.$t("activity.deselectAllFields"):e.$t("tooltip.selectAllMappedFields")),1)]),default:u(()=>[M("div",null,[g(p,{indeterminate:!ve(r.table_name)&&yt(r.table_name),checked:ve(r.table_name),onChange:o=>vt(o,r.table_name)},null,8,["indeterminate","checked","onChange"])])]),_:2},1024),t[11]||(t[11]=M("div",{class:"absolute h-1 border-b bottom-0 border-nc-border-gray-medium left-3 right-3"},null,-1))],64)):T("",!0),d.key!=="action"?(c(),k("span",{key:1,class:ee(["font-weight-700 text-nc-content-gray-subtle2 text-small",{"pl-3":d.key!=="source_column"}])},E(d.title),3)):T("",!0)]),bodyCell:u(({column:d,record:o,recordIndex:G})=>[d.key==="source_column"?(c(),k("div",hn,[M("label",_n,[g(l,{disabled:o.enabled||!!o.destCn},{title:u(()=>t[12]||(t[12]=[te("Select NocoDB field to map")])),default:u(()=>[g(p,{checked:o.enabled,"onUpdate:checked":F=>o.enabled=F,disabled:!o.destCn},null,8,["checked","onUpdate:checked","disabled"])]),_:2},1032,["disabled"]),g(l,{class:"inline-block flex-1 max-w-[calc(100%_-_50px)] truncate text-nc-content-gray text-sm font-weight-500","show-on-truncate-only":""},{title:u(()=>[te(E(o.srcTitle),1)]),default:u(()=>[te(" "+E(o.srcTitle),1)]),_:2},1024),g(a,{icon:"ncArrowRight",class:"w-4 h-4 flex-shrink-0 mr-2"})]),G?(c(),k("div",kn)):T("",!0)])):d.key==="destination_column"?(c(),I(C,{key:1,class:"!my-0 w-full"},{default:u(()=>[g(w,{value:o.destCn,"onUpdate:value":[F=>o.destCn=F,F=>{o.enabled=!!F}],class:"nc-field-select-input w-full nc-select-shadow !border-none","show-search":"","allow-clear":"",placeholder:`-${e.$t("labels.multiField.selectField").toLowerCase()}-`,"filter-option":lt,"dropdown-class-name":"nc-dropdown-filter-field"},{suffixIcon:u(()=>[g(a,{icon:"arrowDown",class:"text-current"})]),default:u(()=>[(c(!0),k(L,null,Q(dt(o,r.table_name),(F,$)=>(c(),I(_,{key:$,value:F.title,disabled:F.readonly},{default:u(()=>[M("div",wn,[(c(),I(Re(("getUIDTIcon"in e?e.getUIDTIcon:i(Wt))(F.uidt)),{class:"flex-none w-3.5 h-3.5"})),g(l,{class:"truncate flex-1","show-on-truncate-only":!F.readonly},{title:u(()=>{var j;return[te(E(F.readonly?((j=F.permissions)==null?void 0:j.tooltip)||i(P)("msg.info.fieldReadonly"):F.title),1)]}),default:u(()=>[te(" "+E(F.title),1)]),_:2},1032,["show-on-truncate-only"]),o.destCn===F.title?(c(),I(Re(("iconMap"in e?e.iconMap:i(Yt)).check),{key:0,id:"nc-selected-item-icon",class:"flex-none text-primary w-4 h-4"})):T("",!0)])]),_:2},1032,["value","disabled"]))),128))]),_:2},1032,["value","onUpdate:value","placeholder"])]),_:2},1024)):T("",!0)]),_:2},1032,["data","columns"])])):T("",!0)]),_:2},1032,["class"]))),128))]),_:1},8,["active-key"])):T("",!0),("isEeUI"in e?e.isEeUI:i(Ue))?(c(),k("div",Cn,[M("label",xn,[g(p,{checked:i(ae),"onUpdate:checked":t[1]||(t[1]=r=>_e(ae)?ae.value=r:null),disabled:i(N)},null,8,["checked","disabled"]),M("span",Tn,E(e.$t("labels.autoCreateMissingSelectionOptions")),1)])])):T("",!0)])):(c(),I(B,{key:1,class:"!border-none !px-0 !mx-0","body-style":{padding:"0 !important"}},{default:u(()=>[g(n,{ref_key:"formRef",ref:De,model:i(h),name:"template-editor-form",onKeydown:t[10]||(t[10]=oe(r=>ne("import"),["enter"]))},{default:u(()=>[i(h).tables&&i(h).tables.length?(c(),I(V,{key:0,"active-key":i(q),"onUpdate:activeKey":t[9]||(t[9]=r=>_e(q)?q.value=r:null),class:"template-collapse !rounded-lg !overflow-hidden",accordion:"","expand-icon-position":"right"},{expandIcon:u(({isActive:r})=>[i(N)?T("",!0):(c(),I(a,{key:0,icon:"ncChevronDown",class:ee(["text-lg !-translate-y-1/2 !transition text-nc-content-gray-subtle",{"!transform !rotate-180":r}])},null,8,["class"]))]),default:u(()=>[(c(!0),k(L,null,Q(i(h).tables,(r,x)=>(c(),I(m,{key:x,class:"nc-import-table-box !overflow-hidden"},{header:u(()=>[M("div",{class:ee(["flex items-center space-x-3 nc-table-name-wrapper group min-h-6",{"w-[calc(100%_-_30px)]":!i(N),"w-full":i(N)}])},[g(a,{icon:"table",class:"w-4 h-4 text-nc-content-gray-subtle"}),!i(N)&&i(Z)===x?(c(),I(C,Me({key:0,ref_for:!0},i(pe)[`tables.${x}.table_name`],{class:"!flex-1 !-my-1"}),{default:u(()=>[g(U,{ref_for:!0,ref:d=>{var o;return(o=d==null?void 0:d.focus)==null?void 0:o.call(d)},value:r.table_name,"onUpdate:value":d=>r.table_name=d,class:"!rounded-md animate-sidebar-node-input-padding !text-nc-content-gray","hide-details":"",bordered:!0,onClick:t[2]||(t[2]=H(()=>{},["stop"])),onKeydown:[t[3]||(t[3]=oe(H(d=>Z.value=void 0,["prevent","stop"]),["enter"])),t[4]||(t[4]=oe(H(d=>Z.value=void 0,["prevent","stop"]),["esc"]))],onBlur:t[5]||(t[5]=H(d=>Z.value=void 0,["prevent","stop"]))},null,8,["value","onUpdate:value"])]),_:2},1040)):(c(),k(L,{key:1},[g(l,{title:r.table_name,"show-on-truncate-only":"",class:"flex-1 truncate text-nc-content-gray"},{default:u(()=>[M("span",{class:"nc-import-table-name",onClick:H(d=>Z.value=x,["stop"])},E(r.table_name),9,$n)]),_:2},1032,["title"]),i(N)?T("",!0):(c(),I(y,{key:0,type:"text",size:"xsmall",class:"!hidden group-hover:!block !h-6 !w-6","icon-only":"",onClick:H(d=>Z.value=x,["stop"])},{icon:u(()=>[g(a,{icon:"pencil",class:"text-nc-content-gray-subtle2"})]),_:2},1032,["onClick"]))],64)),!i(N)&&Ee(x).length?(c(),I(l,{key:2,class:"ml-2"},{title:u(()=>[(c(!0),k(L,null,Q(Ee(x),(d,o)=>(c(),k("div",{key:o,class:"mb-1 last-of-type:mb-0"},E(o>0?`${o+1}.`:"")+" "+E(d),1))),128))]),default:u(()=>[g(s,{color:"red",border:!1,class:"w-8 !px-2 flex-none !bg-nc-bg-red-light"},{default:u(()=>[g(a,{icon:"ncInfo",class:"text-nc-content-red-dark"})]),_:1})]),_:2},1024)):T("",!0),i(N)?(c(),k("div",Dn,[g(v,{percent:i(me)[r.title]??0,size:"small",status:"normal","stroke-color":"#3366FF","trail-color":"#F0F3FF"},null,8,["percent"])])):T("",!0)],2)]),default:u(()=>[r.columns&&r.columns.length?(c(),k("div",Fn,[g(b,{class:"template-form flex-1 max-h-[310px]","body-row-class-name":"template-form-row","header-row-class-name":"relative",data:r.columns,columns:i(un),bordered:!1,"header-row-height":"40px","row-height":"40px",pagination:r.columns.length>50?{defaultPageSize:50,position:["bottomCenter"]}:!1},{headerCell:u(({column:d})=>[d.key==="enabled"?(c(),I(p,{key:0,indeterminate:r.columns.length&&r.columns.some(o=>o.selected)&&!r.columns.every(o=>o.selected),checked:r.columns.every(o=>o.selected),onClick:o=>gt(r)},null,8,["indeterminate","checked","onClick"])):T("",!0),d.key==="column_name"?(c(),k(L,{key:1},[M("span",In,E(r.columns.every(o=>o.selected)?e.$t("activity.deselectAllFields"):e.$t("activity.selectAllFields")),1),t[13]||(t[13]=M("div",{class:"absolute h-1 border-b bottom-0 border-nc-border-gray-medium left-3 right-3"},null,-1))],64)):T("",!0)]),bodyCell:u(({column:d,record:o,recordIndex:G})=>{var F;return[d.key==="enabled"?(c(),I(p,{key:0,checked:o.selected,"onUpdate:checked":$=>o.selected=$},null,8,["checked","onUpdate:checked"])):T("",!0),d.key==="column_name"?(c(),k(L,{key:1},[`${x}-${o.column_name}`===i(Y)?(c(),I(C,Me({key:0,ref_for:!0},i(pe)[`tables.${x}.columns.${o.key}.title`],{class:"nc-table-field-name !mb-0 w-full"}),{default:u(()=>[g(U,{ref_for:!0,ref:$=>{var j;return i(xe)[o.key]=$,(j=$==null?void 0:$.focus)==null||j.call($),$},value:o.title,"onUpdate:value":$=>o.title=$,class:"!rounded-md animate-sidebar-node-input-padding !font-weight-500 !text-nc-content-gray",autofocus:!0,onKeydown:[t[6]||(t[6]=oe(H($=>Y.value="",["prevent","stop"]),["enter"])),t[7]||(t[7]=oe(H($=>Y.value="",["prevent","stop"]),["esc"]))],onBlur:t[8]||(t[8]=H($=>Y.value="",["prevent","stop"]))},null,8,["value","onUpdate:value"])]),_:2},1040)):(c(),k("div",{key:1,class:"relative group w-full flex items-center min-h-6",onClick:$=>Y.value=`${x}-${o.column_name}`},[M("span",Nn,E(o.title),1),g(y,{type:"text",size:"small",class:"!absolute right-0 top-1/2 transform -translate-y-1/2 opacity-0 group-hover:opacity-100 pointer-events-none group-hover:pointer-events-auto",onClick:$=>Y.value=`${x}-${o.column_name}`},{default:u(()=>[g(a,{icon:"pencil"})]),_:2},1032,["onClick"])],8,En)),(F=i(z))!=null&&F[`tables.${x}.columns.${o.key}.title`]?(c(),I(l,{key:2,class:"flex"},{title:u(()=>{var $;return[(c(!0),k(L,null,Q((($=i(z))==null?void 0:$[`tables.${x}.columns.${o.key}.title`])||[],(j,X)=>(c(),k("div",{key:X,class:"mb-1 last-of-type:mb-0"},E(X>0?`${X+1}.`:"")+" "+E(j),1))),128))]}),default:u(()=>[g(a,{icon:"info",class:"h-4 w-4 text-nc-content-red-medium flex-none ml-2"})]),_:2},1024)):T("",!0),G?(c(),k("div",Sn)):T("",!0)],64)):T("",!0)]}),_:2},1032,["data","columns","pagination"])])):T("",!0)]),_:2},1024))),128))]),_:1},8,["active-key"])):T("",!0)]),_:1},8,["model"])]),_:1}))])}}}),Ln=Object.assign(nn(Pn,[["__scopeId","data-v-d9fbc9fa"]]),{__name:"TemplateEditor"});export{Ln as default};
