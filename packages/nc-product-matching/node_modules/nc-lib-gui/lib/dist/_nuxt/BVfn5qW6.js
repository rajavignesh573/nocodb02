import{e as R,f as D,r as k,a9 as ee,g as se,c as r,L as s,o as t,b as f,aS as le,a as i,K as C,ag as te,t as U,w as v,au as ae,at as ne,an as g,aq as m,d as P,a0 as oe,I as c,cU as re,a2 as ie,eS as ce,ar as pe,b9 as J,bo as T,N as ue,a1 as de,X as _e,a4 as b,a5 as V}from"./DRA9KN5F.js";const ye={key:0,class:"flex flex-row w-full justify-center items-center h-52"},fe={key:1,class:"flex flex-col"},ve={class:"w-full relative"},he={class:"flex flex-row justify-center pb-4 mb-2 border-b-1 w-full gap-x-1"},ke=["alt","src"],ge={class:"font-semibold text-lg"},me={class:"absolute -right-2 -top-0.5"},be={key:0,class:"flex flex-row justify-center"},xe={class:"text-center font-normal mb-2"},Se={key:0,class:"text-red-600"},we={key:4,class:"absolute flex flex-col justify-start mt-2 -right-6 top-0"},Ce=["colspan"],Ue={class:"flex flex-row space-x-4 justify-center mt-4"},Ne=R({__name:"AppInstall",props:{id:{}},emits:["saved","close"],setup(N,{emit:E}){const q=E,{$api:x}=D(),M=k(),{t:S}=ee(),a=k(null),o=k({}),w=k(!0),y=k(null),z={labelCol:{span:14,pull:4},wrapperCol:{span:20,pull:4}},K=()=>o.value.push({}),X=async()=>{var n,u;y.value="save";try{await((n=M.value)==null?void 0:n.validateFields()),await x.plugin.update(N.id,{input:JSON.stringify(o.value),active:!0}),q("saved"),b.success(((u=a.value)==null?void 0:u.formDetails.msgOnInstall)||S("msg.success.pluginSettingsSaved"))}catch(h){b.error(await V(h))}finally{y.value=null}},G=async()=>{y.value="test";try{a.value&&(await x.plugin.test({input:JSON.stringify(o.value),title:a.value.title,category:a.value.category})?b.success(S("msg.success.pluginTested")):b.info(S("msg.info.invalidCredentials")))}catch(n){b.error(await V(n))}finally{y.value=null}},H=async n=>{switch(n){case"save":await X();break;case"test":await G();break}},Q=async()=>{try{w.value=!0;const n=await x.plugin.read(N.id),u=JSON.parse(n.input_schema??"{}"),h=u.array?[{}]:{},_=typeof n.input=="string"?JSON.parse(n.input):h;"secure"in _&&typeof _.secure=="string"&&(_.secure=_.secure==="true"),a.value={...n,formDetails:u,parsedInput:_},o.value=a.value.parsedInput}catch(n){console.log(n)}finally{w.value=!1}},W=n=>o.value.splice(n,1);return se(async()=>{a.value||await Q()}),(n,u)=>{var F;const h=le,_=ae,j=ne,A=re,I=ie,$=ce,B=pe,O=oe,Y=ue,Z=_e;return s(w)?(t(),r("div",ye,[f(h,{size:"large"})])):(t(),r("div",fe,[i("div",ve,[i("div",he,[s(a).logo?(t(),r("div",{key:0,class:te(["mr-1 flex items-center justify-center",[s(a).title==="SES"?"p-2 bg-[#242f3e]":""]])},[i("img",{alt:s(a).title||"plugin",src:s(a).logo,class:"h-6"},null,8,ke)],2)):C("",!0),i("span",ge,U(s(a).formDetails.title),1)]),i("div",me,[f(j,{type:"text",class:"!rounded-md mr-1",onClick:u[0]||(u[0]=e=>q("close"))},{icon:v(()=>[f(_,{class:"flex mx-auto"})]),_:1})])]),f(Z,de({ref_key:"formRef",ref:M},(F=s(a))!=null&&F.formDetails.array?{}:z,{model:s(o),class:"mx-4 mt-3"}),{default:v(()=>[s(a).formDetails.array?(t(),r("div",be,[i("table",null,[i("thead",null,[i("tr",null,[(t(!0),r(g,null,m(s(a).formDetails.items,(e,p)=>(t(),r("th",{key:p},[i("div",xe,[P(U(e.label)+" ",1),e.required?(t(),r("span",Se,"*")):C("",!0)])]))),128))])]),i("tbody",null,[(t(!0),r(g,null,m(s(a).parsedInput,(e,p)=>(t(),r("tr",{key:p},[(t(!0),r(g,null,m(s(a).formDetails.items,(l,L)=>(t(),r("td",{key:L,class:"px-2"},[f(O,{class:"relative mb-3",name:[`${p}`,l.key],rules:[{required:l.required,message:`${l.label} is required`}]},{default:v(()=>[l.type==="Password"?(t(),c(A,{key:0,value:e[l.key],"onUpdate:value":d=>e[l.key]=d,placeholder:l.placeholder},null,8,["value","onUpdate:value","placeholder"])):l.type==="LongText"?(t(),c(I,{key:1,value:e[l.key],"onUpdate:value":d=>e[l.key]=d,placeholder:l.placeholder},null,8,["value","onUpdate:value","placeholder"])):l.type==="Checkbox"?(t(),c($,{key:2,value:e[l.key],"onUpdate:value":d=>e[l.key]=d,placeholder:l.placeholder},null,8,["value","onUpdate:value","placeholder"])):(t(),c(B,{key:3,value:e[l.key],"onUpdate:value":d=>e[l.key]=d,placeholder:l.placeholder},null,8,["value","onUpdate:value","placeholder"])),p!==0&&L===s(a).formDetails.items.length-1?(t(),r("div",we,[(t(),c(J(("iconMap"in n?n.iconMap:s(T)).delete),{class:"hover:text-red-400 cursor-pointer",onClick:d=>W(p)},null,8,["onClick"]))])):C("",!0)]),_:2},1032,["name","rules"])]))),128))]))),128))]),i("tfoot",null,[i("tr",null,[i("td",{colspan:s(a).formDetails.items.length,class:"text-center"},[f(j,{type:"default",class:"!bg-gray-100 rounded-md border-none mr-1",onClick:K},{icon:v(()=>[(t(),c(J(("iconMap"in n?n.iconMap:s(T)).plus),{class:"flex mx-auto"}))]),_:1})],8,Ce)])])])])):(t(!0),r(g,{key:1},m(s(a).formDetails.items,(e,p)=>(t(),c(O,{key:p,label:e.label,name:e.key,rules:[{required:e.required,message:`${e.label} is required`}]},{default:v(()=>[e.type==="Password"?(t(),c(A,{key:0,value:s(o)[e.key],"onUpdate:value":l=>s(o)[e.key]=l,placeholder:e.placeholder},null,8,["value","onUpdate:value","placeholder"])):e.type==="LongText"?(t(),c(I,{key:1,value:s(o)[e.key],"onUpdate:value":l=>s(o)[e.key]=l,placeholder:e.placeholder},null,8,["value","onUpdate:value","placeholder"])):e.type==="Checkbox"?(t(),c($,{key:2,checked:s(o)[e.key],"onUpdate:checked":l=>s(o)[e.key]=l,placeholder:e.placeholder},null,8,["checked","onUpdate:checked","placeholder"])):(t(),c(B,{key:3,value:s(o)[e.key],"onUpdate:value":l=>s(o)[e.key]=l,placeholder:e.placeholder},null,8,["value","onUpdate:value","placeholder"]))]),_:2},1032,["label","name","rules"]))),128)),i("div",Ue,[(t(!0),r(g,null,m(s(a).formDetails.actions,(e,p)=>(t(),c(Y,{key:p,class:"!px-5",loading:s(y)===e.key,type:e.key==="save"?"primary":"default",disabled:!!s(y),onClick:l=>H(e.key)},{default:v(()=>[P(U(e.label),1)]),_:2},1032,["loading","type","disabled","onClick"]))),128))])]),_:1},16,["model"])]))}}}),Me=Object.assign(Ne,{__name:"DashboardSettingsAppStoreAppInstall"});export{Me as default};
