import{e as Gt,r as T,T as _l,n as G,ak as gl,aG as Me,bw as it,o7 as hl,I as b,o as r,w as s,a as u,ag as M,L as l,ao as Te,c as S,K as D,b as n,M as qt,d as y,t as c,N as Qt,a1 as ot,Q as We,P as yl,_ as Yt,a9 as bl,f as kl,S as wl,G as Pt,b5 as xl,ef as Cl,al as $l,am as Fl,a8 as Il,a$ as Tl,fU as Al,aC as Ae,du as Ol,as as Sl,aj as w,ic as he,g_ as Bl,bv as Ml,aY as Dl,dm as Oe,aQ as Ll,o8 as Nt,g as Pl,bM as Nl,gN as Rt,jv as Rl,$ as Se,fm as Ul,o9 as El,oa as Vl,an as He,ar as zl,aH as jl,ap as Kl,O as oe,ad as Ut,b9 as ye,jH as Be,af as Et,cf as Hl,a2 as Wl,a3 as at,b3 as Gl,aq as Vt,bN as ql,ks as Ql,aw as Yl,bo as zt,bO as Xl,fX as Jl,fV as Zl,fW as eo,aA as to,by as lo,j0 as oo,la as ao,a4 as ue,fM as io,aD as so,gU as jt,bu as no,fN as ro,gF as Kt,fr as uo,ax as co}from"./DRA9KN5F.js";import{u as po}from"./CbX26EBz.js";import{_ as fo}from"./C2UaKEE0.js";import{_ as mo}from"./C_VN1MCC.js";import{_ as vo}from"./GU4raMbz.js";import{_ as _o}from"./QeWwuUYP.js";import{_ as go}from"./EcM5l_HA.js";import{_ as ho}from"./CG-5KGUk.js";import{r as Ht,a as yo}from"./DGFEr0h-.js";import{a as bo}from"./Bw607vNV.js";import{d as Wt}from"./G4Pt-Lbf.js";import{D as ko}from"./D7OHpRdS.js";import{u as wo}from"./CQa0sIfA.js";import{u as xo}from"./D7poRkS0.js";import{d as Co}from"./CkvAmLZt.js";import{S as $o}from"./DlXIlcns.js";import"./DWLi1ZcL.js";import"./BLPDl4Qg.js";import"./C3FZdmXk.js";import"./JqUqXTOd.js";import"./I4o4wRE2.js";import"./BMPzbwPk.js";import"./CwPFbl3n.js";import"./YbUkeyWR.js";import"./C5HnjaiI.js";import"./CBhmoxRW.js";import"./DkDj6Z7Z.js";import"./DjPyxH1k.js";import"./Bc3_tI4-.js";import"./gAYHr7Gr.js";import"./CsX17Y_h.js";import"./BCBMEREK.js";import"./CJAyvGKH.js";import"./Dv0nYk-Y.js";import"./D43249YX.js";import"./CNwEZGnv.js";import"./DP83Cqnl.js";import"./BVqTF1QK.js";import"./Ce4xoeky.js";import"./U3gU45AW.js";import"./BYKJ-MHf.js";import"./B94p8ToD.js";import"./Cd4chHHL.js";import"./boyBAVNN.js";import"./BBg0y0zb.js";import"./-iDxnmJF.js";import"./yMSt-9W5.js";import"./By5RWL3d.js";import"./C2xdh4Xe.js";import"./CI3EriLB.js";import"./owbQkEXm.js";import"./CVZBrAgI.js";import"./LhVKWcKT.js";import"./B89wxTuy.js";import"./DCa6wpIA.js";import"./B8gs0dG7.js";import"./mXY_vhPu.js";import"./B1qoNiTF.js";import"./CYKJe2Bk.js";import"./DkpDpjnr.js";import"./CHRPOXXy.js";import"./gByPF8bR.js";import"./DfIS_byq.js";import"./lL-0_K96.js";import"./CIOK9Y4w.js";import"./DDmv9w84.js";import"./BALLsGq5.js";import"./DCm6TF8M.js";import"./Bj4kMpzI.js";import"./CbSESqy_.js";import"./Bxzk9hCO.js";import"./Bm6QmuXP.js";import"./CkpISeXq.js";import"./zMMvJhqz.js";import"./ytmFgNfN.js";import"./DxC2Oool.js";import"./CC4cUItJ.js";import"./C_gbauhL.js";import"./BmscXXs6.js";import"./C1XMFoVa.js";import"./C-ZUx0lq.js";import"./YYodiGXA.js";import"./C316Za7m.js";import"./CKrOnbU4.js";import"./DvtLu3FC.js";import"./D_txg4HT.js";const Fo={class:"flex gap-4"},Io={key:0,class:"nc-modal-confirm-icon-wrapper"},To={class:"flex-1 flex flex-col gap-2"},Ao={class:"flex items-start gap-3"},Oo={class:"flex flex-row w-full justify-end gap-2"},So=Gt({__name:"ModalConfirm",props:{type:{default:"warning"},showIcon:{type:Boolean,default:!0},title:{default:""},titleClass:{default:""},content:{default:""},contentClass:{default:""},okText:{default:""},okClass:{default:""},showOkBtn:{type:Boolean,default:!0},okProps:{},cancelText:{default:""},cancelClass:{default:""},showCancelBtn:{type:Boolean,default:!0},cancelProps:{},focusBtn:{default:"ok"},visible:{type:Boolean},width:{},height:{default:"auto"},size:{default:"xs"},destroyOnClose:{type:Boolean},maskClosable:{type:Boolean,default:!1},keyboard:{type:Boolean},showSeparator:{type:Boolean,default:!1},wrapClassName:{},closable:{type:Boolean},ncModalClassName:{},stopEventPropogation:{type:Boolean},class:{}},emits:["update:visible","cancel","clickCancel","ok"],setup(st,{emit:V}){const q=st,ne=V,{visible:R,showOkBtn:ce,showCancelBtn:nt,...pe}=q,Z=T(!1),De=_l(q,"visible",ne,{defaultValue:!1}),re=G({get:()=>De.value,set:h=>{De.value=h,ne("update:visible",h),h||ne("cancel")}}),{type:ee,showCancelBtn:Le,showOkBtn:Pe}=gl(q),Ne=G(()=>ee.value==="success"?"circleCheckSolid":ee.value==="error"?"ncAlertCircleFilled":ee.value==="warning"?"alertTriangleSolid":ee.value==="info"?"ncInfoSolid":"alertTriangleSolid"),te=T(),j=T(),Q=()=>{re.value=!1,ne("clickCancel")};return Me(te,()=>{var h,A,L;!Le.value||!((h=te.value)!=null&&h.$el)||q.focusBtn!=="cancel"||((L=(A=te.value)==null?void 0:A.$el)==null||L.focus(),Z.value=!0)}),Me(j,()=>{var h,A,L;!Pe.value||!((h=j.value)!=null&&h.$el)||q.focusBtn!=="ok"||((L=(A=j.value)==null?void 0:A.$el)==null||L.focus(),Z.value=!0)}),po(re,h=>{var A,L,z,de,ae;switch(h.key){case"Enter":if(it()||hl()||!((A=document.activeElement)!=null&&A.closest(".nc-modal-confirm-wrapper")))return;ne("ok");break;case"Tab":Z.value&&(h.preventDefault(),Z.value=!1,q.focusBtn==="cancel"?(z=(L=te.value)==null?void 0:L.$el)==null||z.focus():(ae=(de=j.value)==null?void 0:de.$el)==null||ae.focus());break}},{immediate:!0,isGridCell:!1}),(h,A)=>{const L=qt,z=Qt,de=yl;return r(),b(de,ot(pe,{visible:l(re),"onUpdate:visible":A[1]||(A[1]=ae=>We(re)?re.value=ae:null),title:"","wrap-class-name":"nc-modal-confirm-wrapper"}),{default:s(()=>{var ae,Re;return[u("div",{class:M(["nc-modal-confirm flex flex-col gap-5",[`nc-modal-confirm-type-${l(ee)}`]])},[u("div",Fo,[h.showIcon?(r(),S("div",Io,[Te(h.$slots,"icon",{},()=>[n(L,{icon:l(Ne),class:"nc-confirm-modal-icon"},null,8,["icon"])],!0)])):D("",!0),u("div",To,[u("div",Ao,[u("div",{class:M(["nc-modal-confirm-title",h.titleClass])},[Te(h.$slots,"title",{},()=>[y(c(h.title),1)],!0)],2),Te(h.$slots,"headerAction",{},void 0,!0)]),h.content||h.$slots.content?(r(),S("div",{key:0,class:M(["nc-modal-confirm-content",h.contentClass])},[Te(h.$slots,"content",{},()=>[y(c(h.content),1)],!0)],2)):D("",!0)])]),Te(h.$slots,"extraContent",{},void 0,!0),u("div",Oo,[l(Le)?(r(),b(z,ot({key:0,ref_key:"cancelBtnRef",ref:te,type:((ae=h.cancelProps)==null?void 0:ae.type)??"secondary",size:"small",class:h.cancelClass},h.cancelProps,{"hide-focus":l(Z),onClick:Q}),{default:s(()=>[y(c(h.cancelText||h.$t("general.cancel")),1)]),_:1},16,["type","class","hide-focus"])):D("",!0),l(Pe)?(r(),b(z,ot({key:1,ref_key:"okBtnRef",ref:j,type:((Re=h.okProps)==null?void 0:Re.type)??"primary",size:"small",class:h.okClass},h.okProps,{"hide-focus":l(Z),onClick:A[0]||(A[0]=rt=>ne("ok"))}),{default:s(()=>[y(c(h.okText||h.$t("general.ok")),1)]),_:1},16,["type","class","hide-focus"])):D("",!0)])],2)]}),_:3},16,["visible"])}}}),Bo=Object.assign(Yt(So,[["__scopeId","data-v-d828ccc0"]]),{__name:"NcModalConfirm"}),Mo=""+new URL("multi-field-editor.DjOPELNE.png",import.meta.url).href,Do={class:"nc-fields-wrapper w-full p-4"},Lo={class:"max-w-250 h-full w-full mx-auto flex flex-col gap-6"},Po={key:0,class:"flex flex-row justify-between mt-2"},No={class:"flex flex-row gap-x-4"},Ro={class:"flex w-full justify-between pt-2"},Uo={class:"flex gap-2"},Eo={class:"flex gap-2"},Vo={key:0,class:"nc-fields-add-new-field-btn-wrapper rounded-lg shadow-nc-sm"},zo={class:"flex items-center gap-2"},jo={key:1,class:"nc-fields-add-new-field-btn-wrapper shadow-sm"},Ko={class:"flex items-center gap-2"},Ho={class:"flex flex-row rounded-lg border-1 overflow-clip border-gray-200",style:{height:"calc(100vh - (var(--topbar-height) * 3.6) - 24px)"}},Wo={key:0,class:"pt-3 bg-nc-bg-gray-extralight border-b-1 border-b-nc-border-gray-medium"},Go={class:"px-5 pt-4 pb-5"},qo={key:0,class:"flex items-center"},Qo={class:"flex-1 flex items-center gap-3"},Yo={class:"text-sm text-nc-content-gray-subtle flex-1"},Xo={key:1,class:"w-full flex items-center gap-3"},Jo={key:2},Zo={class:"text-nc-content-purple-light text-sm h-7 flex items-center gap-2"},ea={class:"nc-animate-dots"},ta={key:3},la={class:"flex gap-3 items-start"},oa={class:"flex-1 flex gap-2 flex-wrap"},aa={class:"w-[150px]"},ia={class:"flex flex-row items-center gap-1.5 py-[3px] text-small leading-[18px]"},sa={key:1,class:"text-nc-content-purple-light"},na={key:2,class:"text-nc-content-gray-subtle2"},ra={class:"flex items-center gap-1"},da={key:0,class:"-mx-5 -mb-5 pt-5"},ua={class:"px-5 pt-4 pb-5 flex flex-col gap-4"},ca={key:0,class:"flex items-center"},pa={class:"flex-1 flex items-center gap-3"},fa={class:"text-sm text-nc-content-gray-subtle flex-1"},ma={class:"relative"},va={key:0,class:"w-full flex items-center gap-3"},_a={key:1,class:"flex flex-col gap-3"},ga={class:"flex gap-2 flex-wrap"},ha={class:"w-[150px]"},ya={class:"flex flex-row items-center gap-1.5 py-[3px] text-small leading-[18px]"},ba={key:1,class:"text-nc-content-purple-light"},ka={key:2,class:"text-nc-content-gray-subtle2"},wa=["data-testid","onClick"],xa={class:"flex items-center flex-1 py-2.5 gap-1 w-2/6"},Ca={"data-testid":"nc-field-title"},$a={class:"flex items-center justify-end gap-1"},Fa={class:"nc-field-status-wrapper flex items-center"},Ia={class:"flex items-center text-xs gap-1"},Ta=["data-testid"],Aa={class:"flex items-center flex-1 py-2.5 gap-1 w-2/6"},Oa={"data-testid":"nc-field-title"},Sa={class:"flex items-center justify-end gap-1"},Ba={class:"flex items-center"},Ma={class:"flex items-center text-xs gap-1"},Da={key:1,class:"w-[25rem] flex flex-col justify-center p-4 items-center"},La={class:"text-2xl text-gray-600 font-bold text-center pt-6"},Pa={class:"text-center text-sm px-2 text-gray-500 pt-6"},Na=Gt({__name:"Fields",setup(st){const{t:V}=bl(),{$api:q}=kl(),{getMeta:ne}=wl(),{meta:R,view:ce,eventBus:nt}=wo(),pe=Pt(xl,T(!1)),Z=Pt(Cl,T(!1)),De=$l(),re=Fl(),{openedViewsTab:ee}=Il(re),{isAiFeaturesEnabled:Le,isAiBetaFeaturesEnabled:Pe,aiIntegrationAvailable:Ne,aiLoading:te,aiError:j}=Tl(),Q=T([]),h=T([]),A=T([]),L=T([]),z=T(),{fields:de,toggleFieldVisibility:ae,loadViewColumns:Re,isViewColumnsLoading:rt,showSystemFields:Ue}=xo(),N=T(!1),Ee=T(),K=T([]),_=(e,t)=>e!=null&&e.id&&(t!=null&&t.id)?e.id===t.id:e!=null&&e.temp_id&&(t!=null&&t.temp_id)?e.temp_id===t.temp_id:!1,fe=G(()=>{const e={};if(de.value)for(const t of de.value)t.fk_column_id&&(e[t.fk_column_id]=t);return e}),xe=e=>{if(!e)return-1;const t=A.value.find(o=>_(o.column,e));if(t)return t.order;if(e.id){const o=fe.value[e.id];if(o)return o.order}return-1},me=T(Ue.value),k=G({get:()=>(Q.value??[]).filter(t=>{const o=Z.value?!Al.includes(V.name):!0;return!t.fk_column_id&&(me.value?!!fe.value[t.id]:!Ae(t))&&o}).concat(K.value).map(t=>gt(t)).sort((t,o)=>xe(t)-xe(o)),set:e=>{var t;Q.value=(t=Q.value)==null?void 0:t.map(o=>{const i=e.find(f=>_(f,o));return i||o})}}),dt=G(()=>k.value.every(e=>{var t,o;return!!(((t=L.value.find(i=>i.column.fk_column_id===e.id))==null?void 0:t.visible)??((o=fe.value[e.id])==null?void 0:o.show))})),p=T(),ve=T(""),{aiMode:_e,aiModeStep:ut,predicted:Xt,activeTabPredictedFields:Jt,activeTabSelectedFields:H,activeTabPredictHistory:Ge,calledFunction:qe,prompt:be,oldPrompt:Zt,isPromtAlreadyGenerated:el,maxSelectionCount:le,activeAiTab:Ve,isPredictFromPromptLoading:ct,isFormulaPredictionMode:ke,fieldPredictionMode:Qe,onInit:Ye,toggleAiMode:tl,disableAiMode:ll,predictMore:ol,predictRefresh:al,predictFromPrompt:il,handleRefreshOnError:pt,onToggleTag:ft}=Co(T(!0),k),Ce=G(()=>Jt.value.filter(e=>!e.selected));Ol(()=>{Ye()});const Xe=(e,t=!1)=>{if(!de.value)return-1;if(e<=0){const C=k.value.find(B=>B.pv);return C?C.order||0:-1}if(e>=k.value.length-1){const C=k.value.map(B=>xe(B));return Math.max(...C)+1}let o=-1,i=-1;const f=k.value[e+(t?-1:0)],d=k.value[e+(t?0:1)];return f&&(o=xe(f)),d&&(i=xe(d),i===-1&&(i=o+1)),(o+i)/2},v=T([]),sl=T(0),ie=T(!1),$e=T(),ze=T(),Fe=G(()=>v.value.length>0||A.value.length>0||L.value.length>0||me.value!==Ue.value),nl=(e,t=!1)=>{const o=k.value.findIndex(i=>_(i,e));o!==-1&&($e.value=t?o:o+1)},{isMetaReadOnly:rl}=Sl(),mt=e=>!(rl.value&&!oo.includes(e==null?void 0:e.uidt)&&!ao.includes(e==null?void 0:e.uidt)&&!Ae(e)),U=(e,t)=>{if(e!=null&&e.id&&(e!=null&&e.uidt)&&!mt(e))return ue.info(V("msg.info.schemaReadOnly"));if(e&&(e!=null&&e.pk)){ue.info(V("msg.info.editingPKnotSupported"));return}t&&t.target instanceof HTMLElement&&t.target.closest(".no-action")||_(e,p.value)||e===void 0&&p.value===void 0||(ie.value=!0,Se(()=>{p.value=e,ie.value=!1}))},we=(e,t=!1)=>{e&&nl(e,t),U({}),setTimeout(()=>{!e&&!t&&z.value&&(z.value.scrollTop=z.value.scrollHeight)},100)},O=G(()=>{if(Q.value)return Q.value.find(e=>e.pv)}),dl=async e=>{var i,f;if(!Q.value)return;const t=io(`${e.title} copy`,[...Q.value,...K.value]);let o={};switch(e.uidt){case w.LinkToAnotherRecord:case w.Links:case w.Lookup:case w.Rollup:case w.Formula:case w.Button:return ue.info(V("msg.info.notAvailableAtTheMoment"));case w.SingleSelect:case w.MultiSelect:o={...e,title:t,column_name:t,id:void 0,order:void 0,pv:!1,colOptions:{options:((f=(i=e.colOptions)==null?void 0:i.options)==null?void 0:f.map(d=>({...d,id:void 0})))??[]}};break;default:o={...e,title:t,column_name:t,id:void 0,colOptions:void 0,order:void 0,pv:!1};break}we(e),ze.value=o},vt=e=>{for(const t of e)if(t.status||t.is_group&&vt(t.children||[]))return!0},Je=(e,t=!1)=>{var d,F,C,B,x,m;const o=k.value.find(P=>_(P,e));if(!o)return;e.colOptions&&[w.SingleSelect,w.MultiSelect].includes(o.uidt)&&(e={...e,colOptions:{...e.colOptions||{},options:(((d=e.colOptions)==null?void 0:d.options)||[]).map(P=>((P==null?void 0:P.index)!==void 0&&delete P.index,P))}});const i=Wt(o,e),f=Object.fromEntries(Object.entries(i).filter(([P,X])=>X!==void 0));if(Object.keys(f).length===0||Object.keys(f).length===1&&"custom"in f&&Object.keys(f.custom).length===0||Object.keys(f).length===1&&"altered"in f)v.value=v.value.filter(P=>P.op==="add"||!_(P.column,e));else{const P=v.value.find(g=>_(g.column,e)),X=A.value.find(g=>_(g.column,e));if(K.value.find(g=>_(g,e))){K.value=K.value.map(g=>_(g,e)?(v.value=v.value.filter($=>$.op==="add"&&!_($.column,e)),v.value=[...v.value,{op:"add",column:e}],e):g);return}P||P&&X?P.column=e:so(e)&&!t?(["title","column_name","meta"].some(g=>g in f)||"childViewId"in f&&f.childViewId!==((F=o.colOptions)==null?void 0:F.fk_target_view_id)||vt(f.filters||[]))&&(v.value=[...v.value,{op:"update",column:e}]):v.value=[...v.value,{op:"update",column:e}],p.value&&Object.keys(p.value).length&&(e!=null&&e.id&&((C=p.value)!=null&&C.id)&&(e==null?void 0:e.id)===((B=p.value)==null?void 0:B.id)||e!=null&&e.temp_id&&((x=p.value)!=null&&x.temp_id)&&(e==null?void 0:e.temp_id)===((m=p.value)==null?void 0:m.temp_id))&&(p.value=e)}},Ze=e=>{const t=v.value.find(o=>_(o.column,e));if(t)if(t.op==="delete")v.value=v.value.filter(o=>o.column.id!==e.id);else if(t.op==="add"){if(p.value&&_(p.value,e)&&U(),v.value=v.value.filter(o=>o.column.temp_id!==e.temp_id),K.value=K.value.filter(o=>o.temp_id!==e.temp_id),e.is_ai_field){const o=Xt.value.find(i=>i.ai_temp_id===e.ai_temp_id);if(!o)return;ft(o)}}else t.op="delete",t.column=e;else v.value=[...v.value,{op:"delete",column:e}]},_t=e=>{var t;ze.value&&(e=ze.value,ze.value=void 0),e.temp_id=`temp_${++sl.value}`,e.view_id=(t=ce.value)==null?void 0:t.id,v.value=[...v.value,{op:"add",column:e}],K.value=[...K.value,e],$e.value?(A.value.push({op:"move",column:e,index:$e.value,order:Xe($e.value)}),$e.value=void 0):A.value.push({op:"move",column:e,index:k.value.length,order:Xe(k.value.length)}),U(e)},ul=e=>{var d,F;const t=k.value[e.moved.oldIndex],o=Xe(e.moved.newIndex,e.moved.newIndex<e.moved.oldIndex),i=v.value.find(C=>_(C.column,t));if((i==null?void 0:i.op)==="update"){const C=Wt(i.column,t);if(!(Object.keys(C).length===1&&"column_order"in C)){ue.warning(V("msg.warning.multiField.moveEditedField"));return}}if((i==null?void 0:i.op)==="delete"){ue.warning(V("msg.warning.multiField.moveDeletedField"));return}const f=A.value.find(C=>_(C.column,k.value[e.moved.oldIndex]));f?(f.index=e.moved.newIndex,f.order=o):A.value.push({op:"move",column:k.value[e.moved.oldIndex],index:e.moved.newIndex,order:o}),Je(i?{...i.column,column_order:{order:o,view_id:(d=ce.value)==null?void 0:d.id}}:{...t,column_order:{order:o,view_id:(F=ce.value)==null?void 0:F.id}},!0)},Ie=e=>{var i,f,d,F,C,B;const t=v.value.find(x=>_(e,x.column)&&x.op==="delete"),o=v.value.find(x=>_(e,x.column)&&x.op==="add");if(t)return!0;if(!e.title&&!o||(e.uidt===w.Links||e.uidt===w.LinkToAnotherRecord)&&o&&(!e.childColumn||!e.childTable||!e.childId)&&(!((i=e.custom)!=null&&i.ref_model_id)||!((f=e.custom)!=null&&f.ref_column_id))||e.uidt===w.Lookup&&o&&(!e.fk_relation_column_id||!e.fk_lookup_column_id)||e.uidt===w.Rollup&&o&&(!e.fk_relation_column_id||!e.fk_rollup_column_id||!e.rollup_function)||e.uidt===w.Formula&&o&&!e.formula_raw)return!1;if(e.uidt===w.Button){if(o&&(e.type===he.Url&&!e.formula_raw||e.type===he.Webhook&&!e.fk_webhook_id))return!1;if(e.type===he.Ai)return!(!e.fk_integration_id||!((d=e.formula_raw)!=null&&d.trim())||!((F=e.output_column_ids)!=null&&F.length)||!((B=(C=e.output_column_ids)==null?void 0:C.split(","))!=null&&B.length))}return!0};function gt(e){var t,o,i,f,d,F,C,B,x;if(e.uidt===w.QrCode&&((t=e.colOptions)!=null&&t.fk_qr_value_column_id)&&(e!=null&&e.fk_qr_value_column_id||(e.fk_qr_value_column_id=e.colOptions.fk_qr_value_column_id)),e.uidt===w.Barcode&&((o=e.colOptions)!=null&&o.fk_barcode_value_column_id)&&(e!=null&&e.fk_barcode_value_column_id||(e.fk_barcode_value_column_id=e.colOptions.fk_barcode_value_column_id)),e.uidt===w.Lookup&&((i=e==null?void 0:e.colOptions)!=null&&i.fk_lookup_column_id)&&((f=e==null?void 0:e.colOptions)!=null&&f.fk_relation_column_id)&&(e!=null&&e.fk_lookup_column_id||(e.fk_lookup_column_id=e.colOptions.fk_lookup_column_id),e!=null&&e.fk_relation_column_id||(e.fk_relation_column_id=e.colOptions.fk_relation_column_id)),e.uidt===w.Rollup&&((d=e==null?void 0:e.colOptions)!=null&&d.fk_relation_column_id)&&((F=e==null?void 0:e.colOptions)!=null&&F.fk_rollup_column_id)&&((C=e==null?void 0:e.colOptions)!=null&&C.rollup_function)&&(e!=null&&e.fk_relation_column_id||(e.fk_relation_column_id=e.colOptions.fk_relation_column_id),e!=null&&e.fk_rollup_column_id||(e.fk_rollup_column_id=e.colOptions.fk_rollup_column_id),e!=null&&e.rollup_function||(e.rollup_function=e.colOptions.rollup_function)),e.uidt===w.Formula&&((B=e.colOptions)!=null&&B.formula_raw)&&!(e!=null&&e.formula_raw)&&(e.formula_raw=(x=e.colOptions)==null?void 0:x.formula_raw),e.uidt===w.Button)if(e!=null&&e.id){const m=e.colOptions;e.type=m==null?void 0:m.type,e.theme=m==null?void 0:m.theme,e.label=m==null?void 0:m.label,e.color=m==null?void 0:m.color,e.fk_webhook_id=m==null?void 0:m.fk_webhook_id,e.fk_script_id=m==null?void 0:m.fk_script_id,e.icon=m==null?void 0:m.icon,e.formula_raw=(m==null?void 0:m.formula_raw)||"",e.type===he.Ai&&(e.output_column_ids=(m==null?void 0:m.output_column_ids)||"",e.fk_integration_id=m==null?void 0:m.fk_integration_id)}else e.type=(e==null?void 0:e.type)||he.Url,e.type===he.Ai?(e.theme=e.theme||"text",e.label=e.label||"Generate data",e.color=e.color||"purple",e.icon=e.icon||"ncAutoAwesome",e.output_column_ids=(e==null?void 0:e.output_column_ids)||""):(e.theme=e.theme||"solid",e.label=e.label||"Button",e.color=e.color||"brand",e.fk_webhook_id=(e==null?void 0:e.fk_webhook_id)||""),e.formula_raw=e.formula_raw||"";if(e.uidt===w.LongText&&Bl(e))if(e!=null&&e.id){const m=e.colOptions;e.prompt_raw=m==null?void 0:m.prompt_raw}else e.prompt_raw=e.prompt_raw||"";return e}const ht=e=>{const t=v.value.find(o=>_(o.column,e));t&&(t.op==="delete"?v.value=v.value.filter(o=>!_(o.column,e)):t.op==="update"&&(v.value=v.value.filter(o=>!_(o.column,e)),A.value=A.value.filter(o=>!_(o.column,e))),p.value=null,U(k.value.filter(o=>o.id===e.id)[0]))},Y=e=>{const t=k.value.find(o=>_(o,e));if(t){const o=v.value.find(i=>_(i.column,t));if(o)return o.column}return null},yt=G(()=>{const e={};for(const t of v.value)t.op==="add"?t.column.temp_id&&(e[t.column.temp_id]="add"):t.op==="update"?t.column.id&&(e[t.column.id]="update"):t.op==="delete"&&t.column.id&&(e[t.column.id]="delete");return e}),W=e=>{const t=(e==null?void 0:e.id)||(e==null?void 0:e.temp_id);return t?yt.value[t]:""},cl=G(()=>{const e={};for(const t of v.value)if(t!=null&&t.error){const o=t.column.id||t.column.temp_id;o&&(e[o]=t.error)}return e}),bt=e=>{const t=(e==null?void 0:e.id)||(e==null?void 0:e.temp_id);return t?cl.value[t]:""},kt=()=>{v.value=[],A.value=[],K.value=[],L.value=[],h.value=[],me.value=Ue.value,U(),Ye()},wt=G(()=>k.value.every(e=>Ie(e))),xt=()=>{var e,t,o;if(Q.value=(t=(e=R.value)==null?void 0:e.columns)==null?void 0:t.map(i=>{const f=i.uidt?jt.getColumnDefaultMeta(i.uidt):{};return no(f)||(i.meta||(i.meta={}),i.meta={...f,...i.meta||{}}),{...i}}),(o=p.value)!=null&&o.id){const i=k.value.find(f=>{var d;return f.id===((d=p.value)==null?void 0:d.id)});i&&(U(i),ie.value=!0,Se(()=>{p.value=i,ie.value=!1}))}},je=async()=>{var e,t,o,i,f,d,F,C,B,x,m;if(wt.value){if(!N.value&&!Fe.value)return}else{ue.error(V("msg.error.multiFieldSaveValidation"));return}try{if(!((e=R.value)!=null&&e.id))return;N.value=!0;const P=[];for(const g of A.value){const $=v.value.find(J=>_(J.column,g.column));if($&&$.op==="add"){if(!((t=$.column)!=null&&t.userHasChangedTitle)&&!$.column.title){const J=Rt({formState:$.column,tableExplorerColumns:k.value||[],metaColumns:((o=R.value)==null?void 0:o.columns)||[],newFieldTitles:P});P.push(J),$.column.title=J,$.column.column_name=J}$.column.column_order={order:g.order,view_id:(i=ce.value)==null?void 0:i.id}}$&&$.op==="update"&&($.column.column_order={order:g.order,view_id:(f=ce.value)==null?void 0:f.id}),$&&($.column.view_id=(d=ce.value)==null?void 0:d.id)}const X=new Set;for(const g of v.value)if(g.op==="add")p.value&&_(p.value,g.column)&&U();else if(g.op==="delete")X.add(g.column.id),p.value&&_(p.value,g.column)&&U();else if(g.op==="update"){const $=(C=(F=R.value)==null?void 0:F.columns)==null?void 0:C.find(J=>J.id===g.column.id);($==null?void 0:$.uidt)===w.Attachment&&($==null?void 0:$.uidt)!==g.column.uidt&&X.add(g.column.id)}for(const g of L.value)await ae(g.visible,{...g.column,show:g.visible});v.value=v.value.map(({error:g,...$})=>$);const se=await q.dbTableColumn.bulk((B=R.value)==null?void 0:B.id,{hash:Ee.value,ops:v.value});await Re(),se&&(v.value=se.failedOps&&((x=se.failedOps)!=null&&x.length)?se.failedOps:[],K.value=K.value.filter(g=>!!(se.failedOps&&se.failedOps.find(J=>J.column.temp_id===g.temp_id))),A.value=[]);for(const g of v.value)X.has(g.column.id)&&(g.op==="delete"||g.op==="update")&&X.delete(g.column.id);return await ne(R.value.id,!0),xt(),Ye(),re.updateViewCoverImageColumnId({metaId:R.value.id,columnIds:X}),Ee.value=(await q.dbTableColumn.hash((m=R.value)==null?void 0:m.id)).hash,Ue.value=me.value,L.value=[],nt.emit(ro.ROW_COLOR_UPDATE),!Fe.value}catch{ue.error(V("msg.error.somethingWentWrong"))}finally{N.value=!1}},Ct=async(e,t)=>{if(t.fk_column_id&&yt.value[t.fk_column_id]){ue.warning(V("msg.warning.multiField.fieldVisibility"));return}const o=L.value.findIndex(i=>i.column.fk_column_id===t.fk_column_id);if(o!==-1){t.show===e?L.value=L.value.filter(i=>i.column.fk_column_id!==t.fk_column_id):L.value[o].visible=e;return}L.value.push({visible:e,column:t})},pl=(e=!1)=>{k.value.forEach(t=>Ct(!e,fe.value[t.id]))};Ml(document,"keydown",async e=>{if((Dl()?e.metaKey:e.ctrlKey)&&e.key.toLowerCase()==="s"){if(ee.value!=="field")return;e.preventDefault();return}if(e.altKey&&e.key.toLowerCase()==="c"||e.altKey&&e.code==="KeyC"){if(ee.value!=="field")return;e.preventDefault(),we()}}),Oe("ArrowDown",()=>{const e=k.value.findIndex(t=>_(t,p.value));e===-1||e===k.value.length-1?U(k.value[0]):U(k.value[e+1])}),Oe("ArrowUp",()=>{const e=k.value.findIndex(t=>_(t,p.value));U(e===-1?k.value[0]:e===0?k.value[k.value.length-1]:k.value[e-1])}),Oe("Delete",()=>{var t;if((t=p.value)!=null&&t.pv||it())return;!(W(p.value)==="delete")&&p.value&&Ze(p.value)}),Oe("Backspace",()=>{var t;if((t=p.value)!=null&&t.pv||it())return;!(W(p.value)==="delete")&&p.value&&Ze(p.value)}),Oe("ArrowRight",()=>{var e;if(((e=document.activeElement)==null?void 0:e.tagName)!=="TEXTAREA"&&p.value){const t=document.querySelector(".nc-fields-input");t&&t.focus()}});const $t=Ll();Nt($t.meta_s,()=>{var e;(e=R.value)!=null&&e.id&&ee.value==="field"&&je()}),Nt($t.ctrl_s,()=>{var e;(e=R.value)!=null&&e.id&&ee.value==="field"&&je()}),Me(R,async e=>{e!=null&&e.id&&(Ee.value=(await q.dbTableColumn.hash(e.id)).hash)},{deep:!0}),Pl(async()=>{await Nl(()=>{var e,t;return!!((e=R.value)!=null&&e.id&&((t=R.value)!=null&&t.columns))}).toBeTruthy(),R.value&&R.value.id&&(Ee.value=(await q.dbTableColumn.hash(R.value.id)).hash),xt()}),Me(()=>{var e;return(e=p.value)==null?void 0:e.temp_id},(e,t)=>{if(!t)return;const o=k.value.find(d=>d.temp_id===t);if(!o||o&&(o.title||!v.value.find(d=>d.op==="add"&&d.column.temp_id===o.temp_id)||o!=null&&o.userHasChangedTitle||!Ie(o)))return;const i=v.value.filter(d=>d.op==="add"&&d.column.title).map(d=>d.column.title).filter(d=>d),f=Rt({formState:o,tableExplorerColumns:k.value||[],metaColumns:Q.value||[],newFieldTitles:i});o.title=f,o.column_name=f});const fl=e=>{if([w.SingleSelect,w.MultiSelect].includes(e.type)&&e.options){const o=[];for(const i of e.options)o.find(f=>f.title===i)||o.push({title:i,index:o.length,color:Kt.light[o.length%Kt.light.length]});e.colOptions={options:o}}const t=Qe.value==="formula"?w.Formula:Qe.value==="button"?w.Button:e.type;_t(gt({title:e.title,uidt:t,column_name:e.title.toLowerCase().replace(/\\W/g,"_"),...e.formula?{formula_raw:e.formula}:{},...e.colOptions?{colOptions:e.colOptions}:{},meta:jt.getColumnDefaultMeta(t),...Qe.value==="button"?{type:he.Ai,output_column_ids:e.output_column_ids,formula_raw:e.formula_raw}:{},is_ai_field:!0,ai_temp_id:e.ai_temp_id}))},Ft=e=>{if(N.value)return;ft(e)&&(fl(e),setTimeout(()=>{z.value&&(z.value.scrollTop=z.value.scrollHeight)},100))},It=()=>{De.navigateToIntegrations(void 0,void 0,{categories:"ai"})},Ke=(...e)=>{tl(...e),ie.value=!0,Se(()=>{ie.value=!1})},Tt=()=>{ll(),ie.value=!0,Se(()=>{ie.value=!1})},At=T();Me(Ve,e=>{e===Rl.PROMPT&&Se(()=>{var t;(t=At.value)==null||t.focus()})});const Ot=T(),et=T(),{width:tt}=Ul(Ot),St=G(()=>(tt.value&&tt.value!==et.value&&(et.value=tt.value),et.value)),Bt=(e,t)=>{var F,C,B;if(!Fe.value||!(uo((F=e.params)==null?void 0:F.slugs)&&((B=(C=e.params)==null?void 0:C.slugs)!=null&&B.includes("field")))){t();return}const o=T(!0),i=T({loading:!1}),{close:f}=co(Bo,{visible:o,title:V("msg.info.unsavedChanges"),content:V("activity.doYouWantToSaveTheChanges"),okText:V("tooltip.saveChanges"),cancelText:V("labels.discard"),onCancel:d,onOk:async()=>{i.value.loading=!0;const x=await je();i.value.loading=!1,x?t():t(!1),d(!1)},okProps:i,"update:visible":d,showIcon:!1,keyboard:!1,loading:N.value,maskClosable:!1});function d(x=!0){x&&(kt(),t()),o.value=!1,f(1e3)}};return El((e,t,o)=>{Bt(t,o)}),Vl((e,t,o)=>{Bt(t,o)}),(e,t)=>{const o=$o,i=qt,f=zl,d=Qt,F=fo,C=mo,B=jl,x=Kl,m=Gl,P=ql,X=vo,se=Wl,g=Ql,$=Xl,J=eo,Mt=Jl,ge=_o,Dt=go,ml=to,Lt=bo,vl=ho;return r(),S("div",Do,[u("div",Lo,[l(rt)?(r(),S("div",Po,[n(o,{class:"!h-8 !w-68 !rounded !overflow-hidden",active:"",size:"small"}),u("div",No,[n(o,{class:"!h-8 !w-22 !rounded !overflow-hidden",active:"",size:"small"}),n(o,{class:"!h-8 !w-22 !rounded !overflow-hidden",active:"",size:"small"}),n(o,{class:"!h-8 !w-22 !rounded !overflow-hidden",active:"",size:"small"})])])):(r(),S(He,{key:1},[u("div",Ro,[u("div",Uo,[n(f,{value:l(ve),"onUpdate:value":t[1]||(t[1]=a=>We(ve)?ve.value=a:null),"data-testid":"nc-field-search-input",class:"!h-8 !px-1 !rounded-lg !w-72",placeholder:e.$t("placeholder.searchFields")},{prefix:s(()=>[n(i,{icon:"search",class:"mx-1 h-3.5 w-3.5 text-gray-500 group-hover:text-black"})]),suffix:s(()=>[l(ve).length>0?(r(),b(i,{key:0,icon:"close",class:"mx-1 h-3.5 w-3.5 text-gray-500 group-hover:text-black","data-testid":"nc-field-clear-search",onClick:t[0]||(t[0]=a=>ve.value="")})):D("",!0)]),_:1},8,["value","placeholder"]),l(pe)?D("",!0):(r(),b(B,{key:0,trigger:["hover"],placement:"bottomRight"},{overlay:s(()=>[n(C,{variant:"small"},{default:s(()=>[n(F,{class:"!children:w-full",onClick:t[2]||(t[2]=a=>pl(l(dt)))},{default:s(()=>[y(c(l(dt)?e.$t("general.hideAll"):e.$t("general.showAll"))+" "+c(e.$t("objects.fields").toLowerCase()),1)]),_:1}),n(F,{class:"!children:w-full",onClick:t[3]||(t[3]=a=>me.value=!l(me))},{default:s(()=>[y(c(l(me)?e.$t("title.hideSystemFields"):e.$t("activity.showSystemFields")),1)]),_:1})]),_:1})]),default:s(()=>[n(d,{size:"small",type:"secondary","icon-only":"",shadow:!1},{icon:s(()=>[n(i,{icon:"threeDotVertical",class:"text-xs !text-current w-4 h-4"})]),_:1})]),_:1}))]),u("div",Eo,[l(Le)?(r(),S("div",Vo,[n(x,null,{title:s(()=>[y(c(`${("renderAltOrOptlKey"in e?e.renderAltOrOptlKey:l(Ht))()} + C`),1)]),default:s(()=>[n(d,{"data-testid":"nc-field-add-new",type:"secondary",size:"small",class:"nc-field-add-new !rounded-r-none !border-r-transparent",disabled:l(N),shadow:!1,onClick:t[4]||(t[4]=a=>we())},{default:s(()=>[u("div",zo,[n(i,{icon:"plus",class:"w-3"}),y(" "+c(e.$t("labels.multiField.newField")),1)])]),_:1},8,["disabled"])]),_:1}),n(x,{title:l(_e)?e.$t("labels.disableNocoAI"):"",disabled:!l(_e)},{default:s(()=>[n(B,{trigger:["hover"],placement:"bottomRight","overlay-class-name":"!border-purple-200"},{overlay:s(()=>[n(C,{variant:"medium"},{default:s(()=>[n(F,{class:"!children:w-full !text-nc-content-purple-dark",onClick:t[6]||(t[6]=a=>Ke())},{default:s(()=>[(r(),b(ye(("getUIDTIcon"in e?e.getUIDTIcon:l(Be))(l(w).SingleLineText)),{class:"flex-none w-3.5 h-3.5"})),y(" "+c(e.$t("labels.autoSuggestFields")),1)]),_:1}),Ut(n(F,{class:"!children:w-full !text-nc-content-purple-dark",onClick:t[7]||(t[7]=a=>Ke("formula"))},{default:s(()=>[(r(),b(ye(("getUIDTIcon"in e?e.getUIDTIcon:l(Be))(l(w).Formula)),{class:"flex-none w-3.5 h-3.5"})),y(" "+c(e.$t("labels.autoSuggestFormulas")),1)]),_:1},512),[[Et,!l(Z)]]),Ut(n(F,{class:"!children:w-full !text-nc-content-purple-dark",onClick:t[8]||(t[8]=a=>Ke("button"))},{default:s(()=>[(r(),b(ye(("getUIDTIcon"in e?e.getUIDTIcon:l(Be))(l(w).Button)),{class:"flex-none w-3.5 h-3.5"})),t[23]||(t[23]=y(" Auto suggest actions "))]),_:1,__:[23]},512),[[Et,!l(Z)&&l(Pe)]])]),_:1})]),default:s(()=>[n(d,{size:"small",type:l(_e)?"primary":"secondary",theme:"ai",class:M(["nc-field-ai-toggle-btn",{"!pointer-events-none !cursor-not-allowed":l(te),"nc-ai-mode":l(_e)}]),"icon-only":"",shadow:!1,onClick:t[5]||(t[5]=oe(a=>l(_e)?Tt():Ke(),["stop"]))},{icon:s(()=>[n(i,{icon:"ncAutoAwesome",class:"text-xs !text-current w-4 h-4"})]),_:1},8,["type","class"])]),_:1})]),_:1},8,["title","disabled"])])):(r(),S("div",jo,[n(x,null,{title:s(()=>[y(c(`${("renderAltOrOptlKey"in e?e.renderAltOrOptlKey:l(Ht))()} + C`),1)]),default:s(()=>[n(d,{"data-testid":"nc-field-add-new",type:"secondary",size:"small",class:"nc-field-add-new",disabled:l(N),shadow:!1,onClick:t[9]||(t[9]=a=>we())},{default:s(()=>[u("div",Ko,[n(i,{icon:"plus",class:"w-3"}),y(" "+c(e.$t("labels.multiField.newField")),1)])]),_:1},8,["disabled"])]),_:1})])),n(d,{"data-testid":"nc-field-reset",type:"secondary",size:"small",disabled:!l(N)&&!l(Fe),onClick:t[10]||(t[10]=a=>kt())},{default:s(()=>[y(c(e.$t("general.reset")),1)]),_:1},8,["disabled"]),n(x,null,{title:s(()=>[y(c(`${("renderCmdOrCtrlKey"in e?e.renderCmdOrCtrlKey:l(yo))()} + S`),1)]),default:s(()=>[n(d,{"data-testid":"nc-field-save-changes",type:"primary",size:"small",loading:l(N),disabled:l(wt)?!l(N)&&!l(Fe):!0,onClick:t[11]||(t[11]=a=>je())},{default:s(()=>[y(c(e.$t("labels.multiField.saveChanges")),1)]),_:1},8,["loading","disabled"])]),_:1})])]),u("div",Ho,[u("div",{class:"flex-1 h-full flex flex-col",style:Hl({width:l(St)?`calc(100% - ${l(St)}px)`:void 0})},[l(_e)?(r(),S("div",Wo,[n(g,{"active-tab":l(Ve),"onUpdate:activeTab":t[14]||(t[14]=a=>We(Ve)?Ve.value=a:null),"show-close-btn":"",onClose:t[15]||(t[15]=a=>Tt())},{AutoSuggestedContent:s(()=>{var a;return[u("div",Go,[l(Ne)?l(j)?(r(),S("div",Xo,[n(i,{icon:"ncInfoSolid",class:"flex-none !text-nc-content-red-dark w-4 h-4"}),n(x,{class:"truncate flex-1 text-sm text-nc-content-gray-subtle","show-on-truncate-only":""},{title:s(()=>[y(c(l(j)),1)]),default:s(()=>[y(" "+c(l(j)),1)]),_:1}),n(d,{size:"small",type:"text",class:"!text-nc-content-brand",onClick:oe(l(pt),["stop"])},{default:s(()=>[y(c(e.$t("general.refresh")),1)]),_:1},8,["onClick"])])):l(ut)==="init"?(r(),S("div",Jo,[u("div",Zo,[n(m,{size:"regular",class:"!text-nc-content-purple-dark"}),u("div",ea," Auto suggesting "+c(l(ke)?"formula":"")+" fields for "+c((a=l(R))==null?void 0:a.title),1)])])):l(ut)==="pick"?(r(),S("div",ta,[u("div",la,[u("div",oa,[l(Ce).length?(r(!0),S(He,{key:0},Vt(l(Ce),I=>(r(),b(x,{key:I.title,disabled:l(H).length<l(le)||I.selected},{title:s(()=>[u("div",aa," You can only select "+c(l(le))+" fields to create at a time. ",1)]),default:s(()=>[n(P,{class:M(["nc-ai-suggested-tag",{"nc-disabled":l(N)||!I.selected&&l(H).length>=l(le),"nc-selected":I.selected}]),disabled:l(H).length>=l(le),onClick:lt=>Ft(I)},{default:s(()=>[u("div",ia,[l(ke)||I!=null&&I.type?(r(),b(ye(("getUIDTIcon"in e?e.getUIDTIcon:l(Be))(l(ke)?l(w).Formula:I.type)),{key:0,class:M(["flex-none w-3.5 h-3.5",{"opacity-60":l(N)||!I.selected&&l(H).length>=l(le)}])},null,8,["class"])):D("",!0),u("div",null,c(I.title),1)])]),_:2},1032,["class","disabled","onClick"])]),_:2},1032,["disabled"]))),128)):l(H).length?(r(),S("div",sa," To generate more "+c(l(ke)?"formula":"")+" field suggestions, click the + or ⟳ icon on the right ",1)):(r(),S("div",na,c(e.$t("labels.noData")),1))]),u("div",ra,[(l(Ge).length<l(H).length?l(Ge).length+l(H).length<10:l(Ge).length<10)?(r(),b(x,{key:0,title:"Suggest more",placement:"top"},{default:s(()=>[n(d,{size:"xs",class:"!px-1",type:"text",theme:"ai",loading:l(te)&&l(qe)==="predictMore",disabled:l(N),"icon-only":"",onClick:l(ol)},{icon:s(()=>[n(i,{icon:"ncPlusAi",class:"!text-current"})]),_:1},8,["loading","disabled","onClick"])]),_:1})):D("",!0),n(x,{title:"Re-suggest",placement:"top"},{default:s(()=>[n(d,{size:"xs",class:"!px-1",type:"text",theme:"ai",disabled:l(N),loading:l(te)&&l(qe)==="predictRefresh",onClick:l(al)},{loadingIcon:s(()=>t[25]||(t[25]=[u("template",null,null,-1)])),default:s(()=>[n(i,{icon:"refresh",class:M(["!text-current",{"animate-infinite animate-spin":l(te)&&l(qe)==="predictRefresh"}])},null,8,["class"])]),_:1},8,["disabled","loading","onClick"])]),_:1})])]),l(Ce).length?(r(),S("div",da,[n(X,{"show-unlock-button":!1,class:"!px-5"},{icon:s(()=>[n(i,{icon:"ncInfo",class:"text-nc-content-gray-muted w-3.5 h-3.5"})]),title:s(()=>t[26]||(t[26]=[u("span",{class:"truncate"}," Click on suggested fields to add ",-1)])),_:1})])):D("",!0)])):D("",!0):(r(),S("div",qo,[u("div",Qo,[n(i,{icon:"alertTriangleSolid",class:"!text-nc-content-orange-medium w-4 h-4"}),u("div",Yo,c(e.$t("title.noAiIntegrationAvailable")),1)]),n(d,{type:"text",size:"small",onClick:oe(It,["stop"])},{icon:s(()=>[n(i,{icon:"plus",class:"h-4 w-4"})]),default:s(()=>[t[24]||(t[24]=y(" Add Integration "))]),_:1,__:[24]})]))])]}),PromptContent:s(()=>[u("div",ua,[l(Ne)?(r(),S(He,{key:1},[u("div",ma,[n(se,{ref_key:"aiPromptInputRef",ref:At,value:l(be),"onUpdate:value":t[12]||(t[12]=a=>We(be)?be.value=a:null),disabled:l(N),placeholder:"Enter your prompt to get field suggestions..",class:"nc-ai-input nc-input-shadow !px-3 !pt-2 !pb-3 !text-sm !min-h-[68px] !rounded-lg",onKeydown:t[13]||(t[13]=at(oe(()=>{},["stop"]),["enter"]))},null,8,["value","disabled"]),n(d,{size:"xs",type:"primary",theme:"ai",class:"!px-1 !absolute bottom-2 right-2",disabled:!l(be).trim()||l(ct)||!!l(be).trim()&&l(be).trim()===l(Zt).trim()||l(N),loading:l(ct),"icon-only":"",onClick:l(il)},{loadingIcon:s(()=>[n(m,{class:"!text-purple-700",size:"medium"})]),icon:s(()=>[n(i,{icon:"send",class:"flex-none h-4 w-4"})]),_:1},8,["disabled","loading","onClick"])]),l(j)?(r(),S("div",va,[n(i,{icon:"ncInfoSolid",class:"flex-none !text-nc-content-red-dark w-4 h-4"}),n(x,{class:"truncate flex-1 text-sm text-nc-content-gray-subtle","show-on-truncate-only":""},{title:s(()=>[y(c(l(j)),1)]),default:s(()=>[y(" "+c(l(j)),1)]),_:1}),n(d,{size:"small",type:"text",class:"!text-nc-content-brand",onClick:oe(l(pt),["stop"])},{default:s(()=>[y(c(e.$t("general.refresh")),1)]),_:1},8,["onClick"])])):l(el)?(r(),S("div",_a,[t[28]||(t[28]=u("div",{class:"text-nc-content-purple-dark font-semibold text-xs"},"Generated Field(s)",-1)),u("div",ga,[l(Ce).length?(r(!0),S(He,{key:0},Vt(l(Ce),a=>(r(),b(x,{key:a.title,disabled:l(H).length<l(le)||a.selected},{title:s(()=>[u("div",ha," You can only select "+c(l(le))+" fields to create at a time. ",1)]),default:s(()=>[n(P,{class:M(["nc-ai-suggested-tag",{"nc-disabled":l(N)||!a.selected&&l(H).length>=l(le),"nc-selected":a.selected}]),disabled:l(H).length>=l(le),onClick:I=>Ft(a)},{default:s(()=>[u("div",ya,[l(ke)||a!=null&&a.type?(r(),b(ye(("getUIDTIcon"in e?e.getUIDTIcon:l(Be))(l(ke)?l(w).Formula:a.type)),{key:0,class:M(["flex-none w-3.5 h-3.5",{"opacity-60":l(N)||!a.selected&&l(H).length>=l(le)}])},null,8,["class"])):D("",!0),u("div",null,c(a.title),1)])]),_:2},1032,["class","disabled","onClick"])]),_:2},1032,["disabled"]))),128)):l(H).length?(r(),S("div",ba," No suggestions remaining. To generate more fields, prompt again... ")):(r(),S("div",ka,c(e.$t("labels.noData")),1))])])):D("",!0)],64)):(r(),S("div",ca,[u("div",pa,[n(i,{icon:"alertTriangleSolid",class:"!text-nc-content-orange-medium w-4 h-4"}),u("div",fa,c(e.$t("title.noAiIntegrationAvailable")),1)]),n(d,{type:"text",size:"small",onClick:oe(It,["stop"])},{icon:s(()=>[n(i,{icon:"plus",class:"h-4 w-4"})]),default:s(()=>[t[27]||(t[27]=y(" Add Integration "))]),_:1,__:[27]})]))])]),_:1},8,["active-tab"])])):D("",!0),u("div",{ref_key:"fieldsListWrapperDomRef",ref:z,class:"flex-1 flex-grow-1 nc-scrollbar-md !overflow-auto"},[n(l(ko),{"model-value":l(k),disabled:l(pe),"item-key":"id","data-testid":"nc-field-list-wrapper",onChange:t[20]||(t[20]=a=>ul(a))},Yl({item:s(({element:a})=>{var I,lt;return[a.title.toLowerCase().includes(l(ve).toLowerCase())&&!a.pv?(r(),S("div",{key:0,class:M(["flex px-2 border-b-1 border-gray-200 pl-5 group",{selected:_(a,l(p)),"cursor-not-allowed":!mt(a),"hover:bg-gray-100":!l(Ae)(a)}]),"data-testid":`nc-field-item-${((I=Y(a))==null?void 0:I.title)||a.title}`,onClick:E=>U(a,E)},[u("div",xa,[(r(),b(ye(("iconMap"in e?e.iconMap:l(zt)).drag),{class:M(["cursor-move !h-3.75 text-gray-600 mr-1",{"opacity-0 !cursor-default":l(pe)}])},null,8,["class"])),a.id&&l(fe)[a.id]?(r(),b($,{key:0,disabled:l(pe),checked:!!(((lt=l(L).find(E=>E.column.fk_column_id===a.id))==null?void 0:lt.visible)??l(fe)[a.id].show),"data-testid":"nc-field-visibility-checkbox",onChange:E=>{Ct(E.target.checked,l(fe)[a.id])}},null,8,["disabled","checked","onChange"])):(r(),b($,{key:1,disabled:!0,class:"opacity-0",checked:!0})),a&&l(Zl)(Y(a)||a)?(r(),b(J,{key:2,"column-meta":Y(a)||a,class:M({"text-brand-500":_(a,l(p))})},null,8,["column-meta","class"])):(r(),b(Mt,{key:3,"column-meta":Y(a)||a,class:M({"text-brand-500":_(a,l(p))})},null,8,["column-meta","class"])),n(x,{class:M([{"text-brand-500":_(a,l(p))},"truncate flex-1"]),"show-on-truncate-only":""},{title:s(()=>{var E;return[y(c(((E=Y(a))==null?void 0:E.title)||a.title),1)]}),default:s(()=>{var E;return[u("span",Ca,c(((E=Y(a))==null?void 0:E.title)||a.title),1)]}),_:2},1032,["class"])]),u("div",$a,[u("div",Fa,[W(a)==="delete"?(r(),b(ge,{key:0,color:"red",border:!1,class:"bg-red-50 text-red-700 text-small leading-[18px]","data-testid":"nc-field-status-deleted-field"},{default:s(()=>[y(c(e.$t("labels.multiField.deletedField")),1)]),_:1})):Ie(a)&&W(a)==="add"?(r(),b(ge,{key:1,color:a!=null&&a.is_ai_field?"purple":"green",border:!!(a!=null&&a.is_ai_field),class:M(["text-small leading-[18px]",{"!bg-purple-50 text-purple-700 !border-purple-100":a==null?void 0:a.is_ai_field,"bg-green-50 text-green-700":!(a!=null&&a.is_ai_field)}]),"data-testid":"nc-field-status-new-field"},{default:s(()=>[a!=null&&a.is_ai_field?(r(),b(i,{key:0,icon:"ncAutoAwesome",class:"mr-1 h-4 w-4"})):D("",!0),y(" "+c(e.$t("labels.multiField.newField")),1)]),_:2},1032,["color","border","class"])):W(a)==="update"?(r(),b(ge,{key:2,color:"orange",border:!1,class:"bg-orange-50 text-orange-700 text-small leading-[18px]","data-testid":"nc-field-status-updated-field"},{default:s(()=>[y(c(e.$t("labels.multiField.updatedField")),1)]),_:1})):D("",!0),Ie(a)?D("",!0):(r(),b(ge,{key:3,color:"yellow",border:!1,class:"ml-1 bg-yellow-50 text-yellow-700 text-small leading-[18px]","data-testid":"nc-field-status-incomplete-configuration"},{default:s(()=>[y(c(e.$t("labels.multiField.incompleteConfiguration")),1)]),_:1})),bt(a)?(r(),b(x,{key:4,class:"cursor-pointer"},{title:s(()=>[y(c(bt(a)),1)]),default:s(()=>[n(ge,{color:"red",border:!1,class:"ml-1 bg-red-50 text-red-700 text-small leading-[18px]","data-testid":"nc-field-status-error-configuration"},{default:s(()=>[n(i,{icon:"info",class:"!text-current"})]),_:1})]),_:2},1024)):D("",!0)]),W(a)==="delete"||W(a)==="update"?(r(),b(d,{key:0,type:"secondary",size:"small",class:"no-action mr-2",disabled:l(N),"data-testid":"nc-field-restore-changes",onClick:E=>ht(a)},{default:s(()=>[u("div",Ia,[n(i,{icon:"reload"}),y(" "+c(e.$t("general.restore")),1)])]),_:2},1032,["disabled","onClick"])):(r(),b(B,{key:1,trigger:["click"],"overlay-class-name":"nc-field-item-action-dropdown nc-dropdown-table-explorer",onClick:t[16]||(t[16]=oe(()=>{},["stop"]))},{overlay:s(()=>[n(C,{variant:"small",class:"!mt-1 !min-w-55"},{default:s(()=>[W(a)!=="add"?(r(),b(Dt,{key:0,id:a.id,"data-testid":"nc-field-item-action-copy-id",tooltip:e.$t("msg.clickToCopyFieldId"),label:e.$t("labels.idColon",{id:a.id})},null,8,["id","tooltip","label"])):D("",!0),n(F,{key:"table-explorer-duplicate","data-testid":"nc-field-item-action-duplicate",disabled:l(Ae)(a),onClick:E=>dl(a)},{default:s(()=>[n(i,{icon:"duplicate"}),u("span",null,c(e.$t("general.duplicate"))+" "+c(e.$t("objects.field").toLowerCase()),1)]),_:2},1032,["disabled","onClick"]),a.pv?D("",!0):(r(),b(F,{key:"table-explorer-insert-above","data-testid":"nc-field-item-action-insert-above",onClick:E=>we(a,!0)},{default:s(()=>[n(i,{icon:"ncArrowUp"}),u("span",null,c(e.$t("general.insertAbove")),1)]),_:2},1032,["onClick"])),n(F,{key:"table-explorer-insert-below","data-testid":"nc-field-item-action-insert-below",onClick:E=>we(a)},{default:s(()=>[n(i,{icon:"ncArrowDown"}),u("span",null,c(e.$t("general.insertBelow")),1)]),_:2},1032,["onClick"]),n(ml),n(F,{key:"table-explorer-delete","data-testid":"nc-field-item-action-delete",disabled:l(Ae)(a),danger:"",onClick:E=>Ze(a)},{default:s(()=>[n(i,{icon:"delete"}),y(" "+c(e.$t("general.delete"))+" "+c(e.$t("objects.field").toLowerCase()),1)]),_:2},1032,["disabled","onClick"])]),_:2},1024)]),default:s(()=>[n(d,{size:"xsmall",type:"text",class:M(["!opacity-0 !group-hover:opacity-100",{"!hover:text-brand-700 !hover:bg-brand-100 !group-hover:text-brand-500":_(a,l(p)),"!hover:text-gray-700 !hover:bg-gray-200 !group-hover:text-gray-500":!_(a,l(p))}]),"data-testid":"nc-field-item-action-button"},{default:s(()=>[n(i,{icon:"threeDotVertical",class:"no-action text-inherit"})]),_:2},1032,["class"])]),_:2},1024)),n(Lt,{class:M(["text-brand-500 opacity-0",{"opacity-100":_(a,l(p))}])},null,8,["class"])])],10,wa)):D("",!0)]}),_:2},[l(O)&&l(O).title&&l(O).title.toLowerCase().includes(l(ve).toLowerCase())?{name:"header",fn:s(()=>{var a;return[u("div",{class:M(["flex px-2 bg-white hover:bg-gray-100 border-b-1 border-gray-200 last:border-b-1 pl-5 group",{selected:_(l(O),l(p)),"first:rounded-tl-lg":!l(_e)}]),"data-testid":`nc-field-item-${((a=Y(l(O)))==null?void 0:a.title)||l(O).title}`,onClick:t[19]||(t[19]=I=>U(l(O),I))},[u("div",Aa,[(r(),b(ye(("iconMap"in e?e.iconMap:l(zt)).drag),{class:M(["cursor-move !h-3.75 text-gray-200 mr-1",{"opacity-0 !cursor-default":l(pe)}])},null,8,["class"])),n($,{disabled:!0,checked:!0,"data-testid":"nc-field-visibility-checkbox"}),l(O)?(r(),b(Mt,{key:0,"column-meta":Y(l(O))||l(O),class:M({"text-brand-500":_(l(O),l(p))})},null,8,["column-meta","class"])):D("",!0),n(x,{class:M(["truncate flex-1",{"text-brand-500":_(l(O),l(p))}]),"show-on-truncate-only":""},{title:s(()=>{var I;return[y(c(((I=Y(l(O)))==null?void 0:I.title)||l(O).title),1)]}),default:s(()=>{var I;return[u("span",Oa,c(((I=Y(l(O)))==null?void 0:I.title)||l(O).title),1)]}),_:1},8,["class"])]),u("div",Sa,[u("div",Ba,[W(l(O))==="delete"?(r(),b(ge,{key:0,color:"red",border:!1,class:"bg-red-50 text-red-700 text-small leading-[18px]","data-testid":"nc-field-status-deleted-field"},{default:s(()=>[y(c(e.$t("labels.multiField.deletedField")),1)]),_:1})):W(l(O))==="update"?(r(),b(ge,{key:1,color:"orange",border:!1,class:"bg-orange-50 text-orange-700 text-small leading-[18px]","data-testid":"nc-field-status-updated-field"},{default:s(()=>[y(c(e.$t("labels.multiField.updatedField")),1)]),_:1})):D("",!0)]),W(l(O))==="delete"||W(l(O))==="update"?(r(),b(d,{key:0,type:"secondary",size:"small",class:"no-action mr-2",disabled:l(N),"data-testid":"nc-field-restore-changes",onClick:t[17]||(t[17]=I=>ht(l(O)))},{default:s(()=>[u("div",Ma,[n(i,{icon:"reload"}),y(" "+c(e.$t("general.restore")),1)])]),_:1},8,["disabled"])):(r(),b(B,{key:1,trigger:["click"],"overlay-class-name":"nc-field-item-action-dropdown-display-column nc-dropdown-table-explorer-display-column",onClick:t[18]||(t[18]=oe(()=>{},["stop"]))},{overlay:s(()=>[n(C,{variant:"small",class:"!min-w-55"},{default:s(()=>[n(Dt,{id:l(O).id,"data-testid":"nc-field-item-action-copy-id",tooltip:e.$t("msg.clickToCopyFieldId"),label:e.$t("labels.idColon",{id:l(O).id})},null,8,["id","tooltip","label"])]),_:1})]),default:s(()=>[n(d,{size:"xsmall",type:"text",class:M(["!opacity-0 !group-hover:opacity-100",{"!hover:text-brand-700 !hover:bg-brand-100 !group-hover:text-brand-500":_(l(O),l(p)),"!hover:text-gray-700 !hover:bg-gray-200 !group-hover:text-gray-500":!_(l(O),l(p))}]),"data-testid":"nc-field-item-action-button"},{default:s(()=>[n(i,{icon:"threeDotVertical",class:"no-action text-inherit"})]),_:1},8,["class"])]),_:1})),n(Lt,{class:M(["text-brand-500 opacity-0",{"opacity-100":_(l(O),l(p))}])},null,8,["class"])])],10,Ta)]}),key:"0"}:void 0]),1032,["model-value","disabled"])],512)],4),n(lo,{name:"slide-fade"},{default:s(()=>{var a,I;return[l(ie)?D("",!0):(r(),S("div",{key:0,ref_key:"rightPanelRef",ref:Ot,class:"flex-none border-gray-200 border-l-1 nc-scrollbar-md h-full !overflow-y-auto",onKeydown:[t[21]||(t[21]=at(oe(()=>{},["stop"]),["up"])),t[22]||(t[22]=at(oe(()=>{},["stop"]),["down"]))]},[l(p)?(r(),b(vl,{key:0,class:"p-4 w-[25rem] flex-none",column:l(p),preload:Y(l(p)),"table-explorer-columns":l(k),"is-column-valid":Ie,"embed-mode":"","from-table-explorer":"","disable-title-focus":!!((a=l(p))!=null&&a.id)||!!((I=l(p))!=null&&I.title),onUpdate:Je,onAdd:_t},null,8,["column","preload","table-explorer-columns","disable-title-focus"])):(r(),S("div",Da,[t[29]||(t[29]=u("img",{src:Mo,class:"!w-[18rem]"},null,-1)),u("div",La,c(e.$t("labels.multiField.selectField")),1),u("div",Pa,c(e.$t("labels.multiField.selectFieldLabel")),1)]))],544))]}),_:1})])],64))])])}}}),_s=Object.assign(Yt(Na,[["__scopeId","data-v-7a92060f"]]),{__name:"SmartsheetDetailsFields"});export{_s as default};
