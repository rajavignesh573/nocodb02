import{e as Y,a9 as Z,f as ee,a8 as j,V as te,G as ae,r as b,eT as se,n as y,a7 as ne,J as le,g as ie,c as u,o as n,a as c,b as o,w as l,d as r,t as a,L as d,ap as oe,I as v,b9 as x,bo as k,Q as ce,ar as de,ag as V,at as pe,N as ue,b2 as re,bO as me,K as U,an as _e,a4 as B,a5 as fe}from"./DRA9KN5F.js";import{_ as he}from"./CJAyvGKH.js";import{_ as be}from"./BhKW-HeQ.js";import"./ytmFgNfN.js";const ve={class:"h-full flex flex-row w-full items-center justify-center"},ye={class:"w-full h-full flex flex-col"},we={class:"flex flex-row items-center w-full mb-4 gap-2 justify-between"},ge={class:"flex"},xe={class:"flex items-center gap-2 text-gray-600 font-light"},ke={class:"flex flex-row items-center w-full gap-x-1"},Ce={class:"flex"},Ie={key:1,class:"flex flex-row gap-x-2"},$e={class:"flex"},Ne={key:0,class:"flex items-center gap-2 max-w-full"},Me={class:"min-w-5 flex items-center justify-center"},Te={key:1,class:"flex items-center gap-2 max-w-full"},je={class:"min-w-5 flex items-center justify-center"},Ve={key:2},Ue={key:0},Be={key:1},Le=Y({__name:"UIAcl",props:{sourceId:{}},setup(L){const A=L,{t:m}=Z(),{$api:C,$e:R}=ee(),{base:S}=j(te()),W=ae(se,b()),f=y(()=>{var e;return W.value??((e=S.value)==null?void 0:e.id)}),{bases:G}=j(ne()),z=y(()=>G.value.get(f.value)??{}),{includeM2M:D}=le(),E=b(["editor","commenter","viewer"]),w=b(!1),_=b([]),h=b(""),I=y(()=>_.value.filter(e=>(e==null?void 0:e.source_id)===A.sourceId&&(typeof(e==null?void 0:e._ptn)=="string"&&e._ptn.toLowerCase().includes(h.value.toLowerCase())||typeof(e==null?void 0:e.title)=="string"&&e.title.toLowerCase().includes(h.value.toLowerCase())))),g=y(()=>E.value.reduce((e,i)=>({...e,[i]:_.value.filter(p=>p.disabled[i]).length===0}),{})),F=e=>{const i=!g.value[e];_.value.forEach(p=>{p.disabled[e]=i,p.edited=!0})};async function $(){try{if(!f.value)return;w.value=!0,_.value=await C.base.modelVisibilityList(f.value,{includeM2M:D.value})}catch(e){console.error(e)}finally{w.value=!1}}async function O(){try{if(!f.value)return;await C.base.modelVisibilitySet(f.value,_.value.filter(e=>e.edited)),B.success(m("msg.success.updatedUIACL"))}catch(e){B.error(await fe(e))}R("a:proj-meta:ui-acl")}const H=(e,i)=>{e.disabled[i]=!e.disabled[i],e.edited=!0};ie(async()=>{_.value.length===0&&await $()});const J=[{key:"name",title:m("labels.tableName"),name:"Table Name",minWidth:220,padding:"0px 12px",dataIndex:"_ptn"},{key:"name",title:m("labels.viewName"),name:"View Name",minWidth:220,padding:"0px 12px",dataIndex:"title"},{key:"action",title:m("objects.roleType.editor"),name:"editor",width:120,minWidth:120,padding:"0px 12px"},{key:"action",title:m("objects.roleType.commenter"),name:"commenter",width:135,minWidth:135,padding:"0px 12px"},{key:"action",title:m("objects.roleType.viewer"),name:"viewer",width:120,minWidth:120,padding:"0px 12px"}];return(e,i)=>{const p=oe,K=de,P=pe,Q=ue,N=me,M=he,q=re,X=be;return n(),u("div",ve,[c("div",ye,[o(p,{class:"mb-4 first-letter:capital","show-on-truncate-only":""},{title:l(()=>[r(a(d(z).title),1)]),default:l(()=>[i[1]||(i[1]=c("span",null," Control view visibility for different roles to manage access efficiently. ",-1))]),_:1,__:[1]}),c("div",we,[o(K,{value:d(h),"onUpdate:value":i[0]||(i[0]=s=>ce(h)?h.value=s:null),placeholder:e.$t("placeholder.searchModels"),"allow-clear":"",class:"nc-acl-search nc-input-border-on-value !w-[400px] nc-input-sm"},{prefix:l(()=>[(n(),v(x(("iconMap"in e?e.iconMap:d(k)).search),{class:"text-gray-600"}))]),_:1},8,["value","placeholder"]),c("div",ge,[o(P,{type:"text",ghost:"",class:"self-start !rounded-md nc-acl-reload",onClick:$},{default:l(()=>[c("div",xe,[(n(),v(x(("iconMap"in e?e.iconMap:d(k)).reload),{class:V({"animate-infinite animate-spin !text-success":d(w)})},null,8,["class"])),r(" "+a(e.$t("general.reload")),1)])]),_:1}),o(Q,{size:"large",class:"z-10 !rounded-lg !px-2 mr-2.5",type:"primary",onClick:O},{default:l(()=>[c("div",ke,[(n(),v(x(("iconMap"in e?e.iconMap:d(k)).save))),c("div",Ce,a(e.$t("general.save")),1)])]),_:1})])]),o(X,{columns:J,data:d(I),"row-height":"44px","header-row-height":"44px",class:"h-[calc(100%_-_88px)] w-full"},{headerCell:l(({column:s})=>[s.key==="name"?(n(),u(_e,{key:0},[r(a(s.title),1)],64)):U("",!0),s.key==="action"?(n(),u("div",Ie,[o(N,{checked:d(g)[s.name],"onUpdate:checked":t=>d(g)[s.name]=t,disabled:!d(I).length,class:"!m-0 !top-0",onChange:t=>F(s.name)},null,8,["checked","onUpdate:checked","disabled","onChange"]),c("div",$e,a(s.title),1)])):U("",!0)]),bodyCell:l(({column:s,record:t})=>{var T;return[s.name==="Table Name"?(n(),u("div",Ne,[c("div",Me,[o(M,{meta:{meta:t.table_meta,type:t.ptype},class:"text-gray-500"},null,8,["meta"])]),o(p,{class:"truncate","show-on-truncate-only":""},{title:l(()=>[r(a(t._ptn),1)]),default:l(()=>[r(" "+a(t._ptn),1)]),_:2},1024)])):s.name==="View Name"?(n(),u("div",Te,[c("div",je,[(T=t==null?void 0:t.meta)!=null&&T.icon?(n(),v(M,{key:0,meta:{meta:t.meta,type:"view"},class:"text-gray-500 !text-sm !children:w-5 !children:h-5"},null,8,["meta"])):(n(),v(q,{key:1,meta:t,class:"text-gray-500"},null,8,["meta"]))]),o(p,{class:"truncate","show-on-truncate-only":""},{title:l(()=>[r(a(t.is_default?e.$t("title.defaultView"):t.title),1)]),default:l(()=>[r(" "+a(t.is_default?e.$t("title.defaultView"):t.title),1)]),_:2},1024)])):(n(),u("div",Ve,[o(p,null,{title:l(()=>[t.disabled[s.name]?(n(),u("span",Ue,a(e.$t("labels.clickToMake"))+" '"+a(t.title)+"' "+a(e.$t("labels.visibleForRole"))+" "+a(s.name)+" "+a(e.$t("labels.inUI"))+" dashboard",1)):(n(),u("span",Be,a(e.$t("labels.clickToHide"))+" '"+a(t.title)+"' "+a(e.$t("labels.forRole"))+":"+a(s.name)+" "+a(e.$t("labels.inUI")),1))]),default:l(()=>[o(N,{checked:!t.disabled[s.name],class:V(`nc-acl-${t.title}-${s.name}-chkbox !ml-0.25`),onChange:Ae=>H(t,s.name)},null,8,["checked","class","onChange"])]),_:2},1024)]))]}),_:1},8,["data"])])])}}}),ze=Object.assign(Le,{__name:"DashboardSettingsUIAcl"});export{ze as default};
