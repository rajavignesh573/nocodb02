import{_ as P,a as J}from"./Celp1trF.js";import{u as K}from"./DCa6wpIA.js";import{e as O,f as Q,aR as q,r as y,a8 as z,V as F,J as H,n as R,g as W,ac as X,c as _,o as r,a as f,K as k,ad as $,t as w,L as s,I as D,eS as Y,b as A,Q as Z,a4 as i,a5 as n}from"./DRA9KN5F.js";import"./CQa0sIfA.js";import"./DkDj6Z7Z.js";import"./YbUkeyWR.js";import"./C_gbauhL.js";import"./629XNRmr.js";import"./C_-gdvC5.js";const ee={class:"flex flex-col py-2 px-3 gap-2 w-full","data-testid":"nc-share-base-sub-modal"},ae={class:"flex flex-col w-full p-3 border-1 border-gray-100 rounded-md"},se={class:"flex flex-row w-full justify-between"},te={class:"text-gray-900 font-medium"},le={key:1,class:"text-nc-content-gray-muted"},oe={key:0,class:"flex flex-col gap-3 w-full mt-3 border-t-1 pt-3 border-gray-100"},re={key:1,class:"flex flex-row justify-between bg-gray-50 px-3 py-2 rounded-md"},ie={class:"text-black"},ne=O({__name:"ShareBase",setup(ue){const{dashboardUrl:I}=K(),{$api:v,$e:B}=Q(),{copy:N}=q(),a=y(null),{base:t,isPrivateBase:p}=z(F()),{appInfo:m}=H(),u=R(()=>!a.value||!a.value.uuid?"":encodeURI(`${I.value}#/base/${a.value.uuid}`)),T=async()=>{try{if(!t.value.id)return;const e=await v.base.sharedBaseGet(t.value.id);a.value={uuid:e.uuid,url:e.url,role:e.roles,fk_custom_url_id:(e==null?void 0:e.fk_custom_url_id)||null}}catch(e){i.error(await n(e))}},b=async(e="viewer",o=void 0)=>{try{if(!t.value.id)return;const l=await v.base.sharedBaseUpdate(t.value.id,{roles:e,original_url:u.value,...o!==void 0?{custom_url_path:o??null}:{}});a.value=l??{},a.value.role=e,t.value.uuid=l.uuid,o!==void 0&&(a.value.fk_custom_url_id=l.fk_custom_url_id,t.value.fk_custom_url_id=l.fk_custom_url_id)}catch(l){i.error(await n(l))}B("a:shared-base:enable",{role:e})},V=async()=>{try{if(!t.value.id)return;await v.base.sharedBaseDisable(t.value.id),a.value=null,t.value.uuid=void 0}catch(e){i.error(await n(e))}B("a:shared-base:disable")};W(()=>{a.value||T()});const h=R(()=>{var e;return p.value?!1:!!((e=a.value)!=null&&e.uuid)}),c=y(!1),d=y(!1),j=async()=>{if(!c.value){c.value=!0;try{h.value?await V():await b()}catch(e){i.error(await n(e))}finally{c.value=!1}}},E=async()=>{if(a.value&&!d.value){d.value=!0;try{await b("viewer")}catch(e){i.error(await n(e))}finally{d.value=!1}}},G=async(e="")=>await N(`${m.value.ncSiteUrl}/p/${encodeURIComponent(e)}`);return(e,o)=>{var S,C,U;const l=Y,L=P,M=J,x=X("e");return r(),_("div",ee,[f("div",ae,[f("div",se,[f("div",te,w(e.$t("activity.enablePublicAccess")),1),s(p)?(r(),_("div",le,w(e.$t("labels.sharingRestricted")),1)):$((r(),D(l,{key:0,checked:s(h),loading:s(c),class:"ml-2",onClick:j},null,8,["checked","loading"])),[[x,["c:share:base:enable:toggle"]]])]),s(h)?(r(),_("div",oe,[A(L,{url:s(u),"onUpdate:url":o[0]||(o[0]=g=>Z(u)?u.value=g:null)},null,8,["url"]),(S=s(a))!=null&&S.uuid?(r(),D(M,{key:0,id:s(a).fk_custom_url_id,"backend-url":s(m).ncSiteUrl,"copy-custom-url":G,disabled:s(p),onUpdateCustomUrl:o[1]||(o[1]=g=>b(void 0,g))},null,8,["id","backend-url","disabled"])):k("",!0),!s(m).ee&&((C=s(a))==null?void 0:C.role)==="editor"?(r(),_("div",re,[f("div",ie,w(e.$t("activity.editingAccess")),1),$(A(l,{loading:s(d),checked:((U=s(a))==null?void 0:U.role)==="editor",class:"ml-2",onClick:E},null,8,["loading","checked"]),[[x,["c:share:base:role:toggle"]]])])):k("",!0)])):k("",!0)])])}}}),ge=Object.assign(ne,{__name:"DlgShareAndCollaborateShareBase"});export{ge as default};
