const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./CDTi0oRk.js","./DRA9KN5F.js","./entry.CNP42Mi6.css","./By5RWL3d.js","./Cell.DrFrP4_9.css","./CfTpfQ4B.js","./VirtualCell.krPvGNjk.css"])))=>i.map(i=>d[i]);
import{e as ee,n as T,mP as se,f as le,aD as B,aG as Z,I,o as w,L as e,w as O,a as Y,c as z,K as j,ag as M,b as x,t as W,an as K,aq as U,aX as oe,fV as ae,a_ as ne,bb as ie,bd as re,_ as ue,r as de,mQ as X,S as ce,fP as g,aL as me,aj as F,ak as fe,dt as _e,ao as pe,M as he,by as ye,d as ge,a1 as ve,Q as be,$ as ke}from"./DRA9KN5F.js";import{_ as we}from"./CJAyvGKH.js";import{_ as xe,l as Ae,d as Q,a as $e}from"./D187WxNH.js";import{u as te,P as R,a as H,i as D,b as q,M as Ce,W as Ne,R as J,G as Me,O as Oe,c as Te}from"./KAvfy7MV.js";const Le=oe(()=>ne(()=>import("./CDTi0oRk.js"),__vite__mapDeps([0,1,2,3,4]),import.meta.url).then(v=>v.default||v)),Ee=oe(()=>ne(()=>import("./CfTpfQ4B.js"),__vite__mapDeps([5,1,2,3,6]),import.meta.url).then(v=>v.default||v)),ze={class:"capitalize"},Ye={key:0},Se={key:1,class:"py-1 pr-0.5"},Pe=ee({__name:"TableNode",props:{data:{},showSkeleton:{type:Boolean},dragging:{type:Boolean}},setup(v){const{viewport:S}=te(),r=T(()=>v.data.table),L=se(!1,200);ie(re,r);const{$e:A}=le(),h=a=>a.type==="mm"?a.fk_parent_column_id:a.fk_child_column_id,k=T(()=>v.data.pkAndFkColumns.length||v.data.nonPkColumns.length),b=T(()=>v.data.nonPkColumns.filter(a=>!(a.system&&B(a)&&/.*_nc_m2m_.*/.test(a.title))));return Z(()=>S.value.zoom,()=>{L.value=!0}),(a,$)=>{const P=we,E=Le,N=Ee,C=xe;return w(),I(C,{class:"h-full flex flex-1 justify-center items-center","modifier-key":a.showSkeleton||e(S).zoom>.35?"Alt":void 0,disabled:a.dragging||e(L)},{title:O(()=>[Y("div",ze,W(e(r).table_name),1)]),default:O(()=>[Y("div",{class:M(["relative h-full max-w-76 flex flex-col justify-center bg-white min-w-16 min-h-8 rounded-lg nc-erd-table-node",[`nc-erd-table-node-${e(r).table_name}`,a.showSkeleton?"cursor-pointer items-center min-h-200px min-w-300px":""]]),onClick:$[0]||($[0]=i=>e(A)("c:erd:node-click"))},[Y("div",{class:M([[(a.showSkeleton,""),(e(k),"")],"text-gray-800 text-sm py-4 border-b-1 border-gray-200 rounded-t-lg w-full h-full px-3 font-medium flex items-center"])},[x(P,{class:M(["text-primary",{"!text-6xl !w-auto mr-2 !h-18":a.showSkeleton}]),meta:e(r)},null,8,["class","meta"]),Y("div",{class:M([a.showSkeleton?"text-6xl":"","flex pr-2 pl-1"])},W(e(r).title),3)],2),a.showSkeleton?(w(),z("div",Ye,[x(e(H),{style:{left:"-20px"},class:"opacity-0",position:e(R).Left,type:"target",connectable:!1},null,8,["position"]),x(e(H),{style:{right:"-15px"},class:"opacity-0",position:e(R).Right,type:"source",connectable:!1},null,8,["position"])])):e(k)?(w(),z("div",Se,[(w(!0),z(K,null,U(a.data.pkAndFkColumns,i=>(w(),z("div",{key:i.title,class:M(["w-full h-full min-w-32 py-2 px-1",`nc-erd-table-node-${e(r).table_name}-column-${i.column_name}`])},[i?(w(),I(E,{key:0,class:"nc-erd-table-node-column",column:i,"hide-menu":!0},null,8,["column"])):j("",!0)],2))),128)),(w(!0),z(K,null,U(e(b),(i,V)=>{var o;return w(),z("div",{key:i.title},[Y("div",{class:M(["relative w-full h-full flex items-center min-w-32 py-2 px-1",V+1===e(b).length?"rounded-b-lg":""])},[e(B)(i)?(w(),z("div",{key:0,class:M(["flex w-full",`nc-erd-table-node-${e(r).table_name}-column-${(o=i.title)==null?void 0:o.toLowerCase().replace(" ","_")}`])},[x(e(H),{id:`s-${h(i.colOptions)}-${e(r).id}`,class:"opacity-0 !right-[-1px]",type:"source",position:e(R).Right,connectable:!1},null,8,["id","position"]),x(e(H),{id:`d-${h(i.colOptions)}-${e(r).id}`,class:"opacity-0 !left-[-1px]",type:"target",position:e(R).Left,connectable:!1},null,8,["id","position"]),x(N,{class:"nc-erd-table-node-column",column:i,"hide-menu":!0},null,8,["column"])],2)):e(ae)(i)?(w(),I(N,{key:1,column:i,"hide-menu":!0,class:M(`nc-erd-table-node-column nc-erd-table-node-${e(r).table_name}-column-${i.column_name}`)},null,8,["column","class"])):(w(),I(E,{key:2,column:i,"hide-menu":!0,class:M(`nc-erd-table-node-column nc-erd-table-node-${e(r).table_name}-column-${i.column_name}`)},null,8,["column","class"]))],2)])}),128))])):j("",!0)],2)]),_:1},8,["modifier-key","disabled"])}}}),Ve=Object.assign(ue(Pe,[["__scopeId","data-v-12643fac"]]),{__name:"ErdTableNode"});function Ie(v,S){const r=de([]),L=Ae().domain([0,2]).range([X["royal-blue"].DEFAULT,X.pink[500]]),A=new Q.graphlib.Graph;A.setDefaultEdgeLabel(()=>({})),A.setGraph({rankdir:"LR",align:"UL",nodesep:50,ranksep:100});const{metasWithIdAsKey:h}=ce(),k=T(()=>e(v)),b=T(()=>e(S)),a=300,$=T(()=>b.value.showViews&&b.value.showAllColumns?50:40),P=T(()=>k.value.reduce((o,l)=>{var y,t;const p=((y=h.value[l.id].columns)==null?void 0:y.filter(s=>B(s)&&s.system!==1))||[];for(const s of p){const d=s.colOptions,n=s.fk_model_id,c=d.fk_related_model_id,m=k.value.find(f=>f.id===n),_=k.value.find(f=>f.id===c);if(n&&c&&m&&_){const f={source:n,target:c,childColId:d.fk_child_column_id,parentColId:d.fk_parent_column_id,modelId:d.fk_mm_model_id,type:g.HAS_MANY};if(d.type===g.HAS_MANY){f.type=g.HAS_MANY,o.push(f);continue}if(d.type===g.ONE_TO_ONE){if(f.type=g.ONE_TO_ONE,(t=s.meta)!=null&&t.bt)continue;o.push(f);continue}if(d.type===g.MANY_TO_MANY&&!o.find(G=>G.type===g.MANY_TO_MANY&&G.parentColId===d.fk_child_column_id&&G.childColId===d.fk_parent_column_id)){f.type=g.MANY_TO_MANY,o.push(f);continue}}}return o},[]));function E({type:o,source:l,target:u,modelId:p,childColId:y,parentColId:t}){var c,m;let s;o===g.HAS_MANY?s="has many":o===g.MANY_TO_MANY?s="many to many":o==="oo"&&(s="one to one");const d=(c=h.value[l].columns)==null?void 0:c.find(_=>{const f=_.colOptions;return f?f.fk_child_column_id===y&&f.fk_parent_column_id===t&&f.fk_mm_model_id===p:!1}),n=(m=h.value[u].columns)==null?void 0:m.find(_=>{const f=_.colOptions;return f?f.fk_parent_column_id===(o===g.MANY_TO_MANY?y:t):!1});if(!d||!n)return"";if(o===g.MANY_TO_MANY&&b.value.showJunctionTableNames){if(!p)return"";const _=h.value[p];return _?_.title!==_.table_name?[`${_.title} (${_.table_name})`]:[_.title]:""}return[`[${h.value[l].title}] ${d.title} - ${s} - ${n.title} [${h.value[u].title}]`,`${h.value[l].title} - ${s} - ${h.value[u].title}`]}function N(){return k.value.reduce((o,l)=>{var t;if(!l.id)return o;const u=((t=h.value[l.id].columns)==null?void 0:t.filter(s=>[F.CreatedBy,F.LastModifiedBy].includes(s.uidt)&&s.system?!1:b.value.showAllColumns||!b.value.showAllColumns&&B(s)))||[],p=u.filter(()=>b.value.showPkAndFk).filter(s=>s.pk||s.uidt===F.ForeignKey),y=u.filter(s=>!s.pk&&s.uidt!==F.ForeignKey);return o.push({id:l.id,data:{table:h.value[l.id],pkAndFkColumns:p,nonPkColumns:y,showPkAndFk:b.value.showPkAndFk,showAllColumns:b.value.showAllColumns,columnLength:u.length,color:""},type:"custom",position:{x:0,y:0}}),o},[])}function C(){return P.value.reduce((o,{source:l,target:u,childColId:p,parentColId:y,type:t,modelId:s})=>{let d,n;(t===g.HAS_MANY||t==="oo")&&(d=p,n=p),t===g.MANY_TO_MANY&&(d=y,n=p);const[c,m]=E({source:l,target:u,type:t,childColId:p,parentColId:y,modelId:s});return o.push({id:`e-${d}-${l}-${n}-${u}-#${c}`,source:`${l}`,target:`${u}`,sourceHandle:`s-${d}-${l}`,targetHandle:`d-${n}-${u}`,type:"custom",markerEnd:{id:"arrow-colored",type:Ce.ArrowClosed},data:{isManyToMany:t===g.MANY_TO_MANY,isOneToOne:t==="oo",isSelfRelation:l===u&&d===n,label:c,simpleLabel:m,color:""}}),o},[])}const i=(o,l)=>({});return{elements:r,layout:async(o=!1)=>new Promise(l=>{r.value=[...N(),...C()];for(const n of r.value)if(D(n)){const m=n.data.columnLength,_=o?a*3:a,f=$.value+(o?250:m>0?$.value*m:$.value);A.setNode(n.id,{width:_,height:f})}else q(n)&&A.setEdge(n.source,n.target);Q.layout(A);let u=1/0,p=1/0,y=-1/0,t=-1/0;for(const n of r.value)if(D(n)){const c=A.node(n.id),m=o?a*3:a,_=$.value+(o?250:n.data.columnLength>0?$.value*n.data.columnLength:$.value);u=Math.min(u,c.x-m/2),p=Math.min(p,c.y-_/2),y=Math.max(y,c.x+m/2),t=Math.max(t,c.y+_/2)}const s=-(u+y)/2,d=-(p+t)/2;for(const n of r.value)if(D(n)){const c=L(A.predecessors(n.id).length),m=A.node(n.id);n.targetPosition=R.Left,n.sourcePosition=R.Right,n.position={x:m.x+s,y:m.y+d},n.class=["rounded-lg border-1 border-gray-200 shadow-lg"].join(" "),n.data.color=c,n.style=_=>(_.selected,i())}else if(q(n)){const c=r.value.find(m=>m.id===n.source);if(c){const m=c.data.color;n.data.color=m,n.markerEnd.color=`#${me(m).toHex()}`}}l()})}}const Re=ee({__name:"Flow",props:{tables:{},config:{}},setup(v){const S=v,{tables:r,config:L}=fe(S),{$destroy:A,fitView:h,viewport:k,setMaxZoom:b,onNodeDoubleClick:a,zoomIn:$,zoomOut:P}=te({minZoom:.05,maxZoom:2}),{layout:E,elements:N}=Ie(r,L),C=T(()=>k.value.zoom<.15);async function i(){await E(C.value),await ke(),setTimeout(()=>{h({duration:200,padding:.1,minZoom:k.value.zoom||1,maxZoom:k.value.zoom||1})},100)}function V(o){h({nodes:o?[o]:void 0,duration:200,minZoom:.2})}return a(({node:o})=>{C.value&&V(),setTimeout(()=>{V(o.id)},250)}),Z(r,i,{flush:"post",immediate:!0}),Z(C,async o=>{E(o).then(()=>{o&&h({duration:300,padding:.1,minZoom:k.value.zoom,maxZoom:k.value.zoom})})}),Z(N,o=>{o.length>3?b(2):b(1.25)}),_e(A),(o,l)=>{const u=he,p=Ve,y=$e;return w(),I(e(Te),{modelValue:e(N),"onUpdate:modelValue":l[2]||(l[2]=t=>be(N)?N.value=t:null),class:"nc-erd-flow"},{"node-custom":O(({data:t,dragging:s})=>[x(p,{data:t,dragging:s,"show-skeleton":e(C)},null,8,["data","dragging","show-skeleton"])]),"edge-custom":O(t=>[x(y,ve(t,{"show-skeleton":e(C)}),null,16,["show-skeleton"])]),default:O(()=>[x(e(Ne),{class:"bg-transparent rounded-lg shadow-md border-1 border-gray-200",position:e(J).BottomLeft,"show-fit-view":!1,"show-interactive":!1},{"control-zoom-in":O(()=>[Y("div",{class:"nc-erd-zoom-btn rounded-t-md",onClick:l[0]||(l[0]=(...t)=>e($)&&e($)(...t))},[x(u,{icon:"plus"})])]),"control-zoom-out":O(()=>[Y("div",{class:"nc-erd-zoom-btn border-t-1 border-gray-200 rounded-b-lg",onClick:l[1]||(l[1]=(...t)=>e(P)&&e(P)(...t))},[x(u,{icon:"minus"})])]),_:1},8,["position"]),x(e(Me),{size:e(C)?2:void 0,gap:e(C)?50:void 0},null,8,["size","gap"]),x(ye,{name:"layout"},{default:O(()=>[e(C)&&e(L).showAllColumns?(w(),I(e(Oe),{key:0,position:e(J).BottomCenter,class:"color-transition z-5 cursor-pointer rounded shadow-sm text-slate-400 font-semibold px-4 py-2 bg-slate-100/50 hover:text-slate-900 hover:ring hover:ring-accent hover:ring-opacity-100 hover:bg-slate-100/90",onClick:V},{default:O(()=>[ge(W(o.$t("labels.zoomInToViewColumns")),1)]),_:1},8,["position"])):j("",!0)]),_:1}),pe(o.$slots,"default")]),_:3},8,["modelValue"])}}}),De=Object.assign(Re,{__name:"ErdFlow"});export{De as default};
