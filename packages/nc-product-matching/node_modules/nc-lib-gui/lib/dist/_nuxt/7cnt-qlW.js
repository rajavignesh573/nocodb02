const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./DzI8hkox.js","./DRA9KN5F.js","./entry.CNP42Mi6.css","./gAYHr7Gr.js","./PlainCell.CJha1QXQ.css","./BKua7nEo.js","./BUnSBgDC.js","./RecordCard.pwDI-3DF.css","./Bw607vNV.js","./CQa0sIfA.js","./DkDj6Z7Z.js","./B94p8ToD.js","./Cd4chHHL.js","./boyBAVNN.js","./yMSt-9W5.js","./BYKJ-MHf.js","./By5RWL3d.js","./D7poRkS0.js","./C2xdh4Xe.js","./CI3EriLB.js","./C2UaKEE0.js","./Item.GTPiKSkc.css","./C_VN1MCC.js","./index.CMurbi1o.css","./owbQkEXm.js","./DivDataCell.3R8zfazT.css","./DlXIlcns.js","./DP83Cqnl.js","./CVZBrAgI.js","./LhVKWcKT.js","./QeWwuUYP.js","./index._6B72PDH.css","./B89wxTuy.js","./DjPyxH1k.js","./Markdown.CUPXKfeQ.css","./DCa6wpIA.js","./B8gs0dG7.js","./mXY_vhPu.js","./Comments.DTONmK0N.css","./B1qoNiTF.js","./CbX26EBz.js","./TimeSelector.DAR2lbHN.css","./CYKJe2Bk.js","./DkpDpjnr.js","./Dv0nYk-Y.js","./Cell.BBaBjsLL.css","./CHRPOXXy.js","./gByPF8bR.js","./Modal.CB1oWLel.css","./BCBMEREK.js","./DGFEr0h-.js","./DfIS_byq.js","./YbUkeyWR.js","./lL-0_K96.js","./CIOK9Y4w.js","./CNwEZGnv.js","./BVqTF1QK.js","./Ce4xoeky.js","./C3FZdmXk.js","./index.C8L8AhJa.css","./DDmv9w84.js","./DWLi1ZcL.js","./LockView.BWC8JyQk.css","./BALLsGq5.js","./DCm6TF8M.js","./Bj4kMpzI.js","./CbSESqy_.js","./Bxzk9hCO.js","./Bm6QmuXP.js","./CkpISeXq.js","./index.N-A1gxk9.css","./zMMvJhqz.js","./FilterInput.7KjqjE1F.css","./ytmFgNfN.js","./Pagination.Cmvjwryu.css","./DxC2Oool.js","./VirtualCell.6f0pX0MN.css","./CC4cUItJ.js","./EcM5l_HA.js","./BLPDl4Qg.js","./CsX17Y_h.js","./C_gbauhL.js","./BmscXXs6.js","./ColumnMenu.tCfxYPwr.css","./CG-5KGUk.js","./CkvAmLZt.js","./D7OHpRdS.js","./DvtLu3FC.js","./D_txg4HT.js","./SelectOptions.BDAXdwVJ.css","./JqUqXTOd.js","./I4o4wRE2.js","./BMPzbwPk.js","./CwPFbl3n.js","./C5HnjaiI.js","./CBhmoxRW.js","./Bc3_tI4-.js","./CJAyvGKH.js","./D43249YX.js","./U3gU45AW.js","./BBg0y0zb.js","./-iDxnmJF.js","./EditOrAddProvider.C1S70ahv.css","./C1XMFoVa.js","./C-ZUx0lq.js","./YYodiGXA.js","./C316Za7m.js","./CKrOnbU4.js","./index.DA-8lYYb.css"])))=>i.map(i=>d[i]);
import{e as ze,n as T,r as R,f as Pe,fq as Ve,as as Oe,G as de,bd as Be,gg as Ie,el as o,o5 as $e,c as M,o as b,a as Y,an as V,aq as X,ag as ce,L as v,t as Ae,K as ve,O as fe,cf as Fe,b as me,w as pe,aX as Q,I as Te,ba as Xe,a_ as Z,_ as qe}from"./DRA9KN5F.js";import{i as Ne,e as $}from"./gAYHr7Gr.js";import{a as je}from"./15xfm8CF.js";import{u as Ue}from"./CQa0sIfA.js";import{u as We}from"./D7poRkS0.js";import"./DkDj6Z7Z.js";import"./C2xdh4Xe.js";import"./boyBAVNN.js";const Ge=Q(()=>Z(()=>import("./DzI8hkox.js"),__vite__mapDeps([0,1,2,3,4]),import.meta.url).then(D=>D.default||D)),He=Q(()=>Z(()=>import("./BKua7nEo.js"),__vite__mapDeps([5,1,2,6,7]),import.meta.url).then(D=>D.default||D)),Je=Q(()=>Z(()=>import("./Bw607vNV.js").then(D=>D.R),__vite__mapDeps([8,1,2,9,10,11,3,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100,101,102,103,104,105,106,107,108]),import.meta.url).then(D=>D.default||D)),Ke={class:"flex h-6"},Ye=["onClick","onDblclick"],Qe=["onClick","onDblclick"],Ze={class:"absolute nc-scrollbar-md overflow-y-auto z-2 mt-6 pointer-events-none inset-0","data-testid":"nc-calendar-week-record-container"},et=["data-testid","data-unique-id","onMouseover","onMousedown"],tt=ze({__name:"DateField",emits:["expandRecord","newRecord"],setup(D,{emit:we}){const q=we,{selectedDateRange:g,formattedData:k,formattedSideBarData:ee,calendarRange:A,selectedDate:N,displayField:ye,updateRowProperty:j,viewMetaProperties:ge,updateFormat:O,isSyncedFromColumn:_e}=je(),{isSyncedTable:he}=Ue(),x=T(()=>{var e;return(e=ge.value)!=null&&e.hide_weekend?5:7}),L=R(null),{$e:Re}=Pe(),{width:De}=Ve(L),{isUIAllowed:S}=Oe(),B=de(Be,R()),be=de(Ie,R()),{fields:te}=We(),xe=T(()=>te.value?new Map(te.value.map(e=>[e.fk_column_id,{underline:e.underline,bold:e.bold,italic:e.italic}])):new Map),U=e=>xe.value.get(e.id),ae=T(()=>{let e=o(g.value.start),n=o(g.value.end);x.value===5&&(n=n.subtract(2,"day"));const a=[];for(;e.isBefore(n)||e.isSame(n,"day");)a.push(o(e)),e=e.add(1,"day");return a}),Ee=(e,n,a)=>{let i=0;for(;;){let r=!0;for(let t=0;t<a;t++){const l=n+t;if(e[l]||(e[l]={}),e[l][i]){r=!1;break}}if(r)return i;i++}},ne=e=>{const n=x.value===5?o(g.value.end).subtract(2,"day"):o(g.value.end);return e&&e.isBetween(o(g.value.start).startOf("day"),o(n).endOf("day"),"day","[]")},Me=T(()=>{if(!k.value||!A.value)return[];const e=Array.from({length:7},()=>({})),n=[],a=De.value/x.value;return A.value.forEach(({fk_from_col:i,fk_to_col:r})=>{if(!i)return;const t=l=>{const u=l.rowMeta.id??$e();let s=o(l.row[i.title]);const p=s.clone(),c=r?o(l.row[r.title]):s;s.isBefore(g.value.start)&&(s=o(g.value.start));const w=s.diff(g.value.start,"day"),h=r?Math.min(Math.max(c.diff(s,"day")+1,1),x.value-w):1,f=Ee(e,w,h);for(let y=0;y<h;y++){const E=w+y;e[E]||(e[E]={}),e[E][f]=!0}const d=ne(p),C=ne(c);let P="none";d&&C?P="rounded":d?P="leftRounded":C&&(P="rightRounded"),n.push({...l,rowMeta:{...l.rowMeta,range:{fk_from_col:i,fk_to_col:r},position:P,id:u,spanningDays:Math.abs(p.diff(c,"day"))-Math.abs(s.diff(c,"day")),style:{width:`calc(max(${h*a+.5}px, ${a+.5}px))`,left:`${w*a-1}px`,top:`${f*28+Math.max(f+1,1)*8}px`}}})};r?k.value.filter(l=>{const u=o(l.row[i.title]),s=o(l.row[r.title]);return u.isValid()&&s.isValid()&&!s.isBefore(u)&&!s.isBefore(g.value.start,"day")}).forEach(t):k.value.forEach(t)}),n}),z=R(null),W=R(!1),G=R(),I=R(!1),m=R(),F=R(),_=R(null),H=R(),ke=Xe((e,n,a)=>{j(e,n,a)},500),oe=e=>{var h,f;if(!S("dataEdit")||!L.value||!_.value)return;const{width:n,left:a}=L.value.getBoundingClientRect(),i=(e.clientX-a-window.scrollX)/n,r=(h=_.value.rowMeta.range)==null?void 0:h.fk_from_col,t=(f=_.value.rowMeta.range)==null?void 0:f.fk_to_col;if(!r||!t)return;const l=o(_.value.row[t.title]),u=o(_.value.row[r.title]),s=Math.floor(i*x.value);let p=[],c;if(F.value==="right"){let d=o(g.value.start).add(s,"day");if(p=[t.title],o(d).isBefore(u,"day")&&(d=u.clone()),!d.isValid())return;c={..._.value,row:{..._.value.row,[t.title]:d.format(O.value)}}}else if(F.value==="left"){let d=o(g.value.start).add(s,"day");if(p=[r.title],o(d).isAfter(l)&&(d=o(o(l)).clone()),!d)return;c={..._.value,row:{..._.value.row,[r.title]:o(d).format(O.value)}}}const w=$(c.row,B.value.columns);k.value=k.value.map(d=>$(d.row,B.value.columns)===w?c:d),ke(c,p,!1)},le=()=>{W.value=!1,F.value=null,_.value=null,document.removeEventListener("mousemove",oe),document.removeEventListener("mouseup",le)},Se=(e,n,a)=>{S("dataEdit")&&(W.value=!0,F.value=e,_.value=a,document.addEventListener("mousemove",oe),document.addEventListener("mouseup",le))},J=R({x:null,y:null}),K=(e,n)=>{var d,C,P;const{width:a,left:i}=(d=L.value)==null?void 0:d.getBoundingClientRect(),r=e.clientX-i,t=r/a,l=(C=m.value.rowMeta.range)==null?void 0:C.fk_from_col,u=(P=m.value.rowMeta.range)==null?void 0:P.fk_to_col;if(!l)return{updatedProperty:[],newRow:null};const s=Math.floor(t*x.value-m.value.rowMeta.spanningDays-Math.max(0,Math.min(1,r/a))),p=o(g.value.start).add(s,"day");if(!p)return{updatedProperty:[],newRow:null};let c;const w={...m.value,row:{...m.value.row,[l.title]:o(p).format(O.value)}},h=[l.title];if(u){const y=m.value.row[l.title]?o(m.value.row[l.title]):null,E=m.value.row[u.title]?o(m.value.row[u.title]):null;y&&E?c=o(p).add(E.diff(y,"day"),"day"):y&&!E?c=o(p).endOf("day"):!y&&E?c=o(p).endOf("day"):c=p.clone(),w.row[u.title]=o(c).format(O.value),h.push(u.title)}const f=$(w.row,B.value.columns);return n?(k.value=[...k.value,w],ee.value=ee.value.filter(y=>$(y.row,B.value.columns)!==f)):k.value=k.value.map(y=>$(y.row,B.value.columns)===f?w:y),{updateProperty:h,newRow:w}},re=e=>{S("dataEdit")&&(!L.value||!m.value||(e.preventDefault(),K(e,!1)))},se=e=>{if(e.preventDefault(),clearTimeout(G.value),!S("dataEdit")||!I.value||!L.value||!m.value)return;const{updateProperty:n,newRow:a}=K(e);if(!a)return;document.querySelectorAll(".draggable-record").forEach(r=>{r.style.visibility="",r.style.opacity="100%"}),z.value&&(z.value.style.boxShadow="none",z.value=null),m.value=void 0,j(a,n,!1),J.value={x:null,y:null},document.removeEventListener("mousemove",re),document.removeEventListener("mouseup",se)},Ce=(e,n)=>{if(W.value||_e.value)return;let a=e.target;I.value=!1,J.value={x:e.clientX-a.getBoundingClientRect().left,y:e.clientY-a.getBoundingClientRect().top},G.value=setTimeout(()=>{if(!S("dataEdit"))return;for(I.value=!0;!a.classList.contains("draggable-record");)a=a.parentElement;document.querySelectorAll(".draggable-record").forEach(t=>{t.getAttribute("data-unique-id").includes(n.rowMeta.id)||(t.style.opacity="30%")}),I.value=!0,z.value=a,m.value=n,document.addEventListener("mousemove",re),document.addEventListener("mouseup",se)},200);const i=()=>{clearTimeout(G.value),J.value={x:null,y:null},document.removeEventListener("mouseup",i),I.value||q("expandRecord",n)};document.addEventListener("mouseup",i)},Le=e=>{var a;if(!S("dataEdit"))return;e.preventDefault();const n=(a=e.dataTransfer)==null?void 0:a.getData("text/plain");if(n){const{record:i}=JSON.parse(n);m.value=i;const{updateProperty:r,newRow:t}=K(e,!0);z.value&&(z.value.style.boxShadow="none",z.value=null),j(t,r,!1),Re("c:calendar:day:drag-record")}},ie=e=>{N.value=e,m.value=void 0},ue=e=>{if(!S("dataEdit")||!A.value||!he.value)return;const n=A.value[0].fk_from_col;if(!n)return;const a={row:{[n.title]:e.format(O.value)}};q("newRecord",a)};return(e,n)=>{const a=Ge,i=He,r=Je;return b(),M("div",{class:"flex relative flex-col prevent-select","data-testid":"nc-calendar-week-view",onDrop:Le},[Y("div",Ke,[(b(!0),M(V,null,X(v(ae),(t,l)=>(b(),M("div",{key:l,class:ce([{"selected-date-header":v(o)(t).isSame(v(N),"day"),"w-1/5":v(x)===5,"w-1/7":v(x)===7},"cursor-pointer text-center text-[10px] font-semibold leading-4 flex items-center justify-center uppercase text-gray-500 w-full py-1 border-gray-200 border-l-gray-50 border-t-gray-50 last:border-r-0 border-1 bg-gray-50"]),onClick:u=>ie(t),onDblclick:u=>ue(t)},Ae(v(o)(t).format("DD ddd")),43,Ye))),128))]),Y("div",{ref_key:"container",ref:L,class:"flex h-[calc(100vh-7.3rem)] w-full"},[(b(!0),M(V,null,X(v(ae),(t,l)=>(b(),M("div",{key:l,class:ce([{"selected-date":v(o)(t).isSame(v(N),"day"),"!bg-gray-50":t.get("day")===0||t.get("day")===6,"w-1/5":v(x)===5,"w-1/7":v(x)===7},"flex cursor-pointer flex-col border-r-1 min-h-[100vh] last:border-r-0 items-center"]),"data-testid":"nc-calendar-week-day",onClick:u=>ie(t),onDblclick:u=>ue(t)},null,42,Qe))),128))],512),Y("div",Ze,[(b(!0),M(V,null,X(v(Me),(t,l)=>{var u;return b(),M(V,{key:l},[((u=t.rowMeta.style)==null?void 0:u.display)!=="none"?(b(),M("div",{key:0,"data-testid":`nc-calendar-week-record-${t.row[v(ye).title]}`,"data-unique-id":t.rowMeta.id,style:Fe({...t.rowMeta.style,lineHeight:"18px"}),class:"absolute group draggable-record pointer-events-auto nc-calendar-week-record-card",onMouseleave:n[0]||(n[0]=s=>H.value=null),onMouseover:s=>H.value=t.rowMeta.id,onMousedown:fe(s=>Ce(s,t),["stop"])},[me(r,{row:t},{default:pe(()=>{var s,p,c,w,h;return[me(i,{hover:v(H)===t.rowMeta.id,dragging:t.rowMeta.id===((p=(s=v(m))==null?void 0:s.rowMeta)==null?void 0:p.id)||t.rowMeta.id===((w=(c=v(_))==null?void 0:c.rowMeta)==null?void 0:w.id),position:t.rowMeta.position,record:t,resize:!!((h=t.rowMeta.range)!=null&&h.fk_to_col)&&v(S)("dataEdit"),onDblclick:fe(f=>q("expandRecord",t),["stop"]),onResizeStart:Se},{default:pe(()=>[(b(!0),M(V,null,X(v(be),(f,d)=>(b(),M(V,{key:d},[("isRowEmpty"in e?e.isRowEmpty:v(Ne))(t,f)?ve("",!0):(b(),Te(a,{key:0,modelValue:t.row[f.title],"onUpdate:modelValue":C=>t.row[f.title]=C,class:"text-xs",bold:U(f).bold,column:f,italic:U(f).italic,underline:U(f).underline},null,8,["modelValue","onUpdate:modelValue","bold","column","italic","underline"]))],64))),128))]),_:2},1032,["hover","dragging","position","record","resize","onDblclick"])]}),_:2},1032,["row"])],44,et)):ve("",!0)],64)}),128))])],32)}}}),dt=Object.assign(qe(tt,[["__scopeId","data-v-a5caf81e"]]),{__name:"SmartsheetCalendarWeekViewDateField"});export{dt as default};
