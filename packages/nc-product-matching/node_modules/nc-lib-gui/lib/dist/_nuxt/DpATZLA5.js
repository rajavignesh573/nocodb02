import{e as Y,bb as Z,r as d,gu as ee,G as g,bd as ae,bc as te,bX as se,b5 as ne,n as y,gd as oe,W as le,aG as ie,aF as L,aj as ce,ac as de,I as u,K as _,L as t,o as l,w as o,b as p,ap as re,ad as ue,N as _e,a as n,c as S,M as pe,t as i,ag as me,d as C,O as T,es as fe,Q as V,an as ge,aq as ve,eJ as be,b9 as we,j as ke,ae as ye,aH as xe,fW as he,fX as Ie,fV as Se}from"./DRA9KN5F.js";import{_ as Ce}from"./GU4raMbz.js";import{u as Ve}from"./D7poRkS0.js";import{a as Be}from"./C2xdh4Xe.js";import{u as je}from"./Bfaa-xBo.js";import"./DWLi1ZcL.js";import"./DkDj6Z7Z.js";import"./CQa0sIfA.js";import"./gAYHr7Gr.js";import"./boyBAVNN.js";const Me={class:"flex items-center gap-2"},Fe={key:0,class:"flex items-center gap-0.5"},Ne={class:"text-capitalize !text-[13px] font-medium flex items-center gap-1"},Oe={class:"!text-[13px] font-medium truncate !leading-5"},De={class:"flex flex-col gap-2"},Le={class:"nc-fields-list"},Te={class:"grouping-field"},$e=["title"],Ee={class:"flex items-center gap-1 max-w-[calc(100%_-_20px)]"},Ge={class:"flex items-center gap-1"},Ke={class:"text-sm text-gray-800"},Ue=Y({__name:"StackedBy",setup(ze){Z(ee,d(!0));const $=g(ae,d()),m=g(te,d()),E=g(se,d(!1)),f=g(ne,d(!1)),B=g(oe,y(()=>!1)),{fields:G,loadViewColumns:K,metaColumnById:j}=Ve(),{kanbanMetaData:v,loadKanbanMeta:M,loadKanbanData:U,updateKanbanMeta:F,groupingField:z}=Be(),{addUndo:N,defineViewScope:O}=le(),c=d(!1);je(c),ie(()=>{var e;return(e=m.value)==null?void 0:e.id},async(e,a)=>{e!==a&&$.value&&await K()},{immediate:!0});const x=async e=>{var a;await F({fk_grp_col_id:e}),await M(),await U(),((a=m.value)==null?void 0:a.view).fk_grp_col_id=e},b=y({get:()=>v.value.fk_grp_col_id,set:async e=>{e&&(N({undo:{fn:await x,args:[v.value.fk_grp_col_id]},redo:{fn:await x,args:[e]},scope:O({view:m.value})}),await x(e))}}),h=async e=>{var r,k;const a={...L((r=v.value)==null?void 0:r.meta),hide_empty_stack:e};await F({meta:a}),await M(),((k=m.value)==null?void 0:k.view).meta=a},I=d(null),w=y({get:()=>{var e;return L((e=v.value)==null?void 0:e.meta).hide_empty_stack||!1},set:async e=>{I.value="hideEmptyStack",N({undo:{fn:h,args:[w.value]},redo:{fn:h,args:[e]},scope:O({view:m.value})}),await h(e),I.value=null}}),P=y(()=>{var e;return(e=G.value)==null?void 0:e.filter(a=>a.fk_column_id&&j.value[a.fk_column_id].uidt===ce.SingleSelect).map(a=>({value:a.fk_column_id,label:a.title}))}),H=()=>{c.value=!1},R=e=>ke(Se(e)?he:Ie,{columnMeta:e});return(e,a)=>{const r=pe,k=_e,D=re,W=be,X=fe,q=ye,A=Ce,J=xe,Q=de("e");return t(E)?_("",!0):(l(),u(J,{key:0,visible:t(c),"onUpdate:visible":a[5]||(a[5]=s=>V(c)?c.value=s:null),trigger:["click"],"overlay-class-name":"nc-dropdown-kanban-stacked-by-menu overflow-hidden",class:"!xs:hidden"},{overlay:o(()=>[t(c)?(l(),S("div",{key:0,class:"p-4 w-90 bg-white nc-table-toolbar-menu rounded-lg flex flex-col gap-5",onClick:a[4]||(a[4]=T(()=>{},["stop"]))},[n("div",De,[n("div",null,i(e.$t("general.groupingField")),1),n("div",Le,[n("div",Te,[p(X,{value:t(b),"onUpdate:value":a[0]||(a[0]=s=>V(b)?b.value=s:null),class:"nc-select-shadow w-full nc-kanban-grouping-field-select !rounded-lg","dropdown-class-name":"!rounded-lg",placeholder:"Select a Grouping Field",disabled:t(f),onChange:H,onClick:a[1]||(a[1]=T(()=>{},["stop"]))},{suffixIcon:o(()=>[p(r,{icon:"arrowDown",class:"text-gray-700"})]),default:o(()=>[(l(!0),S(ge,null,ve(t(P),s=>(l(),u(W,{key:s.value,value:s.value},{default:o(()=>[n("div",{class:"w-full flex gap-2 items-center justify-between",title:s.label},[n("div",Ee,[s.value?(l(),u(we(R(t(j)[s.value])),{key:0,class:"!w-3.5 !h-3.5 !text-current opacity-80 !ml-0"})):_("",!0),p(D,{class:"flex-1 max-w-[calc(100%_-_20px)] truncate","show-on-truncate-only":""},{title:o(()=>[C(i(s.label),1)]),default:o(()=>[C(i(s.label),1)]),_:2},1024)]),t(b)===s.value?(l(),u(r,{key:0,id:"nc-selected-item-icon",icon:"check",class:"flex-none text-primary w-4 h-4"})):_("",!0)],8,$e)]),_:2},1032,["value"]))),128))]),_:1},8,["value","disabled"])])])]),n("div",Ge,[p(q,{checked:t(w),"onUpdate:checked":a[2]||(a[2]=s=>V(w)?w.value=s:null),size:"small",class:"nc-switch",loading:t(I)==="hideEmptyStack",disabled:t(f)},{default:o(()=>[n("div",Ke,i(e.$t("general.hide"))+" "+i(e.$t("general.empty").toLowerCase())+" "+i(e.$t("general.stack").toLowerCase()),1)]),_:1},8,["checked","loading","disabled"])]),t(f)?(l(),u(A,{key:0,class:"-mb-4 -mx-4",onOnOpen:a[3]||(a[3]=s=>c.value=!1)})):_("",!0)])):_("",!0)]),default:o(()=>[p(D,{disabled:!t(B),class:"nc-kanban-btn"},{title:o(()=>[C(i(e.$t("activity.kanban.stackedBy")),1)]),default:o(()=>[ue((l(),u(k,{class:"nc-kanban-stacked-by-menu-btn nc-toolbar-btn !border-0 !h-7 group",size:"small",type:"secondary","show-as-disabled":t(f)},{default:o(()=>[n("div",Me,[p(r,{icon:"settings",class:"h-4 w-4"}),t(B)?_("",!0):(l(),S("div",Fe,[n("span",Ne,i(e.$t("activity.kanban.stackedBy")),1),n("div",{class:me(["flex items-center rounded-md transition-colors duration-0.3s bg-gray-100 px-1 min-h-5 max-w-[108px]",{"group-hover:bg-gray-200":!t(f)}])},[n("span",Oe,i(t(z)),1)],2)]))])]),_:1},8,["show-as-disabled"])),[[Q,["c:kanban:change-grouping-field"]]])]),_:1},8,["disabled"])]),_:1},8,["visible"]))}}}),Ze=Object.assign(Ue,{__name:"SmartsheetToolbarStackedBy"});export{Ze as default};
