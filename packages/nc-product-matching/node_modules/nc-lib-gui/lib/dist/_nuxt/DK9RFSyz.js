const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./BALLsGq5.js","./DRA9KN5F.js","./entry.CNP42Mi6.css","./DCm6TF8M.js","./Bj4kMpzI.js","./CbSESqy_.js","./Bxzk9hCO.js","./CbX26EBz.js","./TimeSelector.DAR2lbHN.css","./Bm6QmuXP.js","./CkpISeXq.js","./index.N-A1gxk9.css","./zMMvJhqz.js","./FilterInput.7KjqjE1F.css","./CI3EriLB.js","./ytmFgNfN.js","./Pagination.Cmvjwryu.css","./gAYHr7Gr.js","./DkDj6Z7Z.js","./CQa0sIfA.js","./DxC2Oool.js","./By5RWL3d.js","./Cd4chHHL.js","./boyBAVNN.js","./B94p8ToD.js","./DfIS_byq.js","./BVqTF1QK.js","./DP83Cqnl.js","./CNwEZGnv.js","./DlXIlcns.js","./Ce4xoeky.js","./VirtualCell.6f0pX0MN.css","./B1qoNiTF.js","./CYKJe2Bk.js","./DkpDpjnr.js","./Dv0nYk-Y.js","./Cell.BBaBjsLL.css"])))=>i.map(i=>d[i]);
import{e as Re,S as Ve,G as c,r as u,fO as Me,kM as Pe,kL as Be,j4 as De,j7 as $e,gz as Fe,ef as Ge,gx as Ue,mj as ze,j1 as He,Y as ce,iZ as Ke,j2 as We,kk as de,iw as Ye,gA as qe,j9 as me,n as y,aG as M,fZ as v,aj as a,fP as I,fr as P,fA as Xe,gT as B,bb as D,h9 as Ze,be as Qe,kn as Je,g as el,eI as ll,bz as tl,gX as fe,f_ as al,fS as nl,c as i,I as b,L as e,o as n,w as W,a as T,cf as ve,ag as w,K as C,an as O,fV as pe,aq as $,aX as he,b as Y,t as q,a3 as sl,ar as ol,Q as il,M as ul,d as rl,f2 as cl,aH as dl,bw as ml,hL as fl,a_ as ye,bd as vl}from"./DRA9KN5F.js";import{g as pl}from"./gAYHr7Gr.js";import{u as hl}from"./BJUOFlKy.js";import{u as yl}from"./CbX26EBz.js";const gl=he(()=>ye(()=>import("./BALLsGq5.js").then(k=>k.V),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31]),import.meta.url).then(k=>k.default||k)),kl=he(()=>ye(()=>import("./B1qoNiTF.js").then(k=>k.C),__vite__mapDeps([32,1,2,7,8,33,34,35,24,18,17,22,23,36]),import.meta.url).then(k=>k.default||k)),_l=["src"],bl={key:0,class:"flex h-full virtual-lookup-cells"},Il={key:0},wl={key:0,class:"text-left text-wrap mt-2 text-[#e65100] text-xs"},Ol={key:1,class:"text-left text-wrap mt-2 text-[#e65100] text-xs"},Al={class:"flex flex-wrap gap-2 items-start overflow-y-auto px-3 py-2"},jl={key:0,class:"px-2 text-gray-500 flex flex-col items-center gap-6 text-center"},xl=Re({__name:"Lookup",setup(k){const{metas:F,getMeta:X}=Ve(),S=c(Me,u()),Z=c(Pe),m=c(Be,u()),ge=c(De,u(!1)),Q=c($e,u(!1)),J=c(Fe,u(!1)),ke=c(Ge,u(!1)),x=c(Ue,null),E=c(ze,null),_e=c(He,!1),be=c(We,ce(Ke)),Ie=c(de,u(!1)),we=c(Ye,ce({})),G=c(qe,null),U=u(1),g=c(me,u(1));D(me,U);const z=u(0),A=y(()=>{var l,s,d;if((l=S.value)!=null&&l.fk_model_id)return(d=(s=F.value[S.value.fk_model_id])==null?void 0:s.columns)==null?void 0:d.find(h=>{var _,j;return h.id===((j=(_=S.value)==null?void 0:_.colOptions)==null?void 0:j.fk_relation_column_id)})});M(S,async l=>{!(l!=null&&l.fk_model_id)||F.value[l==null?void 0:l.fk_model_id]||await X(l.fk_model_id)},{immediate:!0}),M(A,async l=>{l&&l.colOptions&&await X(l.colOptions.fk_related_model_id)},{immediate:!0});const ee=y(()=>{var l;if(A.value&&((l=A.value)!=null&&l.colOptions))return F.value[A.value.colOptions.fk_related_model_id]}),t=y(()=>{var l,s;return(s=(l=ee.value)==null?void 0:l.columns)==null?void 0:s.find(d=>{var h,_;return d.id===((_=(h=S.value)==null?void 0:h.colOptions)==null?void 0:_.fk_lookup_column_id)})});M([t,g],()=>{t.value&&!v(t.value)?U.value=1:U.value=g.value},{immediate:!0});const f=y(()=>{var l,s,d,h,_,j,V,r;if(((l=t.value)==null?void 0:l.uidt)===a.Checkbox&&[I.BELONGS_TO,I.ONE_TO_ONE].includes((d=(s=A.value)==null?void 0:s.colOptions)==null?void 0:d.type)){const o=!!(Z&&((_=Z.value)!=null&&_.row[(h=A.value)==null?void 0:h.title]));return!m.value&&!o?[]:(P(m.value)?m.value:[m.value]).map(pl)}if(!m.value)return[];if(((j=t.value)==null?void 0:j.uidt)===a.Attachment){if([I.BELONGS_TO,I.ONE_TO_ONE].includes((r=(V=A.value)==null?void 0:V.colOptions)==null?void 0:r.type))return P(m.value)?m.value:[m.value];if(P(m.value)&&m.value.every(o=>Xe(o)?!0:P(o)?!o.length||B(o[0]):!1))return m.value.filter(o=>o!==null).reduce((o,Te)=>(o.push(...Te),o),[])}return Array.isArray(m.value)?m.value.filter(o=>o!==null):[m.value]});D(vl,ee),D(de,u(!0)),D(Ze,u(!0));const{showEditNonEditableFieldWarning:Oe,showClearNonEditableFieldWarning:Ae,activateShowEditNonEditableFieldWarning:le}=hl(),L=u(""),je=[a.ID,a.SingleLineText,a.LongText,a.SingleSelect,a.MultiSelect,a.Year,a.PhoneNumber,a.Email,a.Number,a.Decimal,a.Currency,a.Percent,a.Duration,a.Rating,a.Formula],xe=y(()=>t.value?je.includes(t.value.uidt):!1),te=y(()=>!t.value||f.value.length<2),H=y(()=>f.value.filter(l=>Qe(l,L.value))),p=u(!1),ae=u(null),ne=`lookup-${Math.floor(Math.random()*99999)}`,Ee=y(()=>{var l;return(l=ae.value)==null?void 0:l.closest("td, .nc-data-cell")}),N=u(null),se=c(Je,u(!1));function R(l){l.type==="click"&&(J.value||ke.value||se.value)&&(p.value=!p.value)}const oe=l=>{if(!(!(l instanceof KeyboardEvent)||!l.target||ml(l))&&fl(l))return p.value=!p.value,!0};el(()=>{ll(Ee.value,l=>{var s;(s=l.target)!=null&&s.closest(`.${ne}`)||(p.value=!1)}),E==null||E.on(R),x==null||x.on(R),G==null||G.on(oe),!(Ie.value||!_e||!be||J.value||!Q.value)&&(oe(we.event)||(p.value=!0))}),tl(()=>{E==null||E.off(R),x==null||x.off(R)}),M(p,l=>{setTimeout(()=>{var s,d;l&&N.value&&((d=(s=N.value)==null?void 0:s.querySelector(".lookup-search-input input"))==null||d.focus(),N.value.clientHeight&&(z.value=N.value.clientHeight))},200)}),yl(se,l=>{switch(l.key){case"Enter":p.value=!0,l.stopPropagation();break}});const ie=y(()=>{const l=v(t.value);return[`${[a.MultiSelect,a.SingleSelect,a.User].includes(t.value.uidt)?"pl-2":l?"":"px-1"}`,{"min-h-0 min-w-0":l,"!w-auto ":!l}]}),Ce=y(()=>ge.value||t.value&&v(t.value)?void 0:g.value?`${g.value===1?fe[1]-4:fe[`${g.value}`]-(Q.value?17:0)}px`:"2.85rem"),K=l=>{l.target&&l.target.closest(".nc-attachment-item")&&(l.stopPropagation(),p.value=!1)},Se=[a.Rollup,a.Formula],ue=y(()=>{var l;return Se.includes((l=t.value)==null?void 0:l.uidt)}),Le=c(al,u({isPageDesignerPreviewPanel:!1})),{getPossibleAttachmentSrc:Ne}=nl(),re=y(()=>{var l;return((l=Ne(f.value[0]))==null?void 0:l[0])??""});return(l,s)=>{const d=gl,h=kl,_=ul,j=ol,V=dl;return e(Le).isPageDesignerPreviewPanel&&e(re)?(n(),i("img",{key:0,src:e(re),class:"object-contain h-full w-full"},null,8,_l)):(n(),b(V,{key:1,disabled:e(te),trigger:[],visible:!e(te)&&e(p),"auto-close":!1,"overlay-class-name":`!min-w-[300px] nc-links-dropdown ${e(p)?"active":""}`},{overlay:W(()=>[e(t)?(n(),i("div",{key:0,ref_key:"dropdownOverlayRef",ref:N,class:w(["w-[300px] max-h-[320px] flex flex-col rounded-sm lookup-dropdown outline-none",[ne]]),style:ve({minHeight:e(z)?`${e(z)}px`:void 0}),tabindex:"0",onKeydown:s[2]||(s[2]=sl(r=>p.value=!1,["esc"]))},[e(xe)?(n(),b(j,{key:0,value:e(L),"onUpdate:value":s[1]||(s[1]=r=>il(L)?L.value=r:null),placeholder:l.$t("general.search"),class:"lookup-search-input"},{prefix:W(()=>[Y(_,{icon:"search",class:"text-nc-content-gray-muted"})]),_:1},8,["value","placeholder"])):C("",!0),T("div",Al,[e(L)&&!e(H).length?(n(),i("div",jl,[s[3]||(s[3]=T("img",{src:cl,class:"!w-[164px] flex-none",alt:"No search results found"},null,-1)),rl(" "+q(l.$t("title.noResultsMatchedYourSearch")),1)])):e(pe)(e(t))&&!e(ue)?(n(),i(O,{key:1},[e(t).uidt!==e(a).LinkToAnotherRecord||e(t).uidt===e(a).LinkToAnotherRecord&&[e(I).BELONGS_TO,e(I).ONE_TO_ONE].includes(e(t).colOptions.type)?(n(!0),i(O,{key:0},$(e(H),(r,o)=>(n(),b(d,{key:o,"edit-enabled":!1,"model-value":r,column:e(t),"read-only":!0},null,8,["model-value","column"]))),128)):C("",!0)],64)):(n(),i(O,{key:2},[("isAttachment"in l?l.isAttachment:e(v))(e(t))&&e(f)[0]&&("ncIsObject"in l?l.ncIsObject:e(B))(e(f)[0])?(n(),i("div",{key:0,class:"nc-lookup-attachment-wrapper",onClick:K},[Y(h,{"model-value":e(f),column:e(t),"edit-enabled":!1,"read-only":!0},null,8,["model-value","column"])])):(n(!0),i(O,{key:1},$(e(H),(r,o)=>(n(),i("div",{key:o,class:w(["flex-none",{"bg-nc-bg-default rounded-full":!("isAttachment"in l?l.isAttachment:e(v))(e(t)),"border-gray-200 rounded border-1 max-w-full":![e(a).Attachment,e(a).MultiSelect,e(a).SingleSelect,e(a).User,e(a).CreatedBy,e(a).LastModifiedBy].includes(e(t).uidt),"min-h-0 min-w-0":("isAttachment"in l?l.isAttachment:e(v))(e(t))}]),onClick:K},[e(t).uidt===e(a).Rollup?(n(),b(d,{key:0,"edit-enabled":!1,"read-only":!0,"model-value":r,column:e(t),class:"px-2"},null,8,["model-value","column"])):(n(),b(h,{key:1,"model-value":r,column:e(t),"edit-enabled":!1,virtual:!0,"read-only":!0,class:w(e(ie))},null,8,["model-value","column","class"]))],2))),128))],64))])],38)):C("",!0)]),default:W(()=>[T("div",{ref_key:"triggerRef",ref:ae,class:"nc-cell-field h-full w-full nc-lookup-cell",tabindex:"-1",style:ve({height:e(Ce)}),onDblclick:s[0]||(s[0]=(...r)=>e(le)&&e(le)(...r))},[T("div",{class:w(["h-full w-full overflow-hidden",{"nc-cell-lookup-scroll":e(g)===1,"flex gap-1":!(e(t)&&("isAttachment"in l?l.isAttachment:e(v))(e(t))&&e(f)[0]&&("ncIsObject"in l?l.ncIsObject:e(B))(e(f)[0]))}]),onClick:K},[e(t)?(n(),i(O,{key:0},[e(pe)(e(t))&&!e(ue)?(n(),i("div",bl,[e(t).uidt!==e(a).LinkToAnotherRecord||e(t).uidt===e(a).LinkToAnotherRecord&&[e(I).BELONGS_TO,e(I).ONE_TO_ONE].includes(e(t).colOptions.type)?(n(!0),i(O,{key:0},$(e(f),(r,o)=>(n(),b(d,{key:o,"edit-enabled":!1,"model-value":r,column:e(t),"read-only":!0},null,8,["model-value","column"]))),128)):(n(),b(d,{key:1,"edit-enabled":!1,"read-only":!0,"model-value":e(f),column:e(t)},null,8,["model-value","column"]))])):(n(),i(O,{key:1},[("isAttachment"in l?l.isAttachment:e(v))(e(t))&&e(f)[0]&&("ncIsObject"in l?l.ncIsObject:e(B))(e(f)[0])?(n(),i("div",Il,[Y(h,{"model-value":e(f),column:e(t),"edit-enabled":!1,"read-only":!0},null,8,["model-value","column"])])):(n(),i("div",{key:1,class:w(["max-h-full max-w-full w-full nc-cell-lookup-scroll !overflow-x-hidden",{"nc-scrollbar-thin ":e(g)!==1&&!("isAttachment"in l?l.isAttachment:e(v))(e(t))}])},[T("div",{class:w(["flex gap-1.5 w-full h-full",{"flex-wrap":e(g)!==1&&!("isAttachment"in l?l.isAttachment:e(v))(e(t)),"!overflow-hidden nc-cell-lookup-scroll":e(g)===1||("isAttachment"in l?l.isAttachment:e(v))(e(t)),"items-center":e(g)===1,"items-start":e(g)!==1,"py-[3px]":!("isAttachment"in l?l.isAttachment:e(v))(e(t))}])},[(n(!0),i(O,null,$(e(f),(r,o)=>(n(),i("div",{key:o,class:w(["flex-none",{"bg-nc-bg-default rounded-full":!("isAttachment"in l?l.isAttachment:e(v))(e(t)),"border-gray-200 rounded border-1 max-w-full":![e(a).Attachment,e(a).MultiSelect,e(a).SingleSelect,e(a).User,e(a).CreatedBy,e(a).LastModifiedBy].includes(e(t).uidt),"min-h-0 min-w-0":("isAttachment"in l?l.isAttachment:e(v))(e(t))}])},[e(t).uidt===e(a).Rollup?(n(),b(d,{key:0,"edit-enabled":!1,"read-only":!0,"model-value":r,column:e(t),class:"px-2"},null,8,["model-value","column"])):(n(),b(h,{key:1,"model-value":r,column:e(t),"edit-enabled":!1,virtual:!0,"read-only":!0,class:w(e(ie))},null,8,["model-value","column","class"]))],2))),128))],2),e(Oe)?(n(),i("div",wl,q(l.$t("msg.info.computedFieldEditWarning")),1)):C("",!0),e(Ae)?(n(),i("div",Ol,q(l.$t("msg.info.computedFieldDeleteWarning")),1)):C("",!0)],2))],64))],64)):C("",!0)],2)],36)]),_:1},8,["disabled","visible","overlay-class-name"]))}}}),Nl=Object.assign(xl,{__name:"VirtualCellLookup"});export{Nl as default};
