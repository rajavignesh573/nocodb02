import{e as ye,T as we,G as ge,r as w,ef as he,f as be,as as xe,J as Ve,a8 as ee,V as $e,am as Le,n as te,b7 as l,Y as Te,ab as Ie,aG as ae,c as r,I as se,L as e,o as i,a as c,K as L,t as s,d as g,w as u,b as m,M as Be,N as Ue,aw as Se,X as Ce,a0 as De,a2 as Ne,ag as ze,a3 as Fe,Q as Me,P as Re,aF as oe,a4 as le,b4 as je,a5 as Ae,_ as Ee}from"./DRA9KN5F.js";const Ge={key:0,class:"nc-unlock-view-wrapper rounded-2xl bg-white p-6 w-full max-w-[384px] flex flex-col gap-5"},Ke={class:"flex flex-col gap-2"},Pe={class:"text-base font-bold text-nc-content-gray-emphasis"},Je={key:0,class:"text-sm bg-nc-bg-gray-light rounded-lg px-2 py-2"},Oe={class:"text-sm text-nc-content-gray"},Qe={class:"text-sm text-nc-content-gray"},Xe={key:0,class:"font-bold"},Ye={key:1,class:"font-bold"},qe={class:"flex flex-col gap-2 w-full"},He={class:"text-base font-bold text-nc-content-gray-emphasis"},We={class:"text-sm font-normal text-nc-content-gray-subtle"},Ze={key:0,class:"flex flex-col gap-5"},et={key:1,class:"flex flex-col gap-2"},tt={class:"text-base font-bold text-nc-content-gray-emphasis"},at={key:0,class:"text-sm bg-nc-bg-gray-light rounded-lg px-2 py-2"},st={class:"text-sm text-nc-content-gray"},ot={key:0,class:"font-bold"},lt={key:1,class:"font-bold"},nt={class:"flex gap-2 items-center justify-end"},it=ye({__name:"LockView",props:{modelValue:{type:Boolean},view:{},changeType:{}},emits:["update:modelValue"],setup(ne,{emit:ie}){const h=ne,p=we(h,"modelValue",ie,{defaultValue:!1}),T=ge(he,w(!1)),{$api:ce,$e:de}=be(),{isUIAllowed:re}=xe(),{user:b}=Ve(),{idUserMap:_}=ee($e()),{activeView:ue}=ee(Le()),a=te(()=>h.view||ue.value),n=te(()=>{var t;return((t=a.value)==null?void 0:t.lock_type)!==l.Locked?l.Locked:h.changeType||l.Collaborative}),pe=t=>{var o;return t&&((o=t==null?void 0:t.focus)==null?void 0:o.call(t))},x=w(),y=w(!1),f=Te({description:""}),me={description:[{max:1e3,message:"Value must be at most 1000 characters long"}]},d=w(!1),V=async()=>{var o;if(!a.value||n.value===l.Locked&&!await x.value.validate())return;const t={lockedViewDescription:n.value===l.Locked?f.description:"",lockedByUserId:n.value===l.Locked?(o=b.value)==null?void 0:o.id:""};d.value=!0;try{await ce.dbView.update(a.value.id,{lock_type:n.value,meta:{...oe(a.value.meta),...t}}),a.value.meta={...oe(a.value.meta),...t},a.value.lock_type=n.value,le.success(`Successfully Switched to ${a.value.lock_type} view`),de(`a:${je[a.value.type]||"view"}:lock`,{lockType:a.value.lock_type,title:a.value.title})}catch(v){le.error(await Ae(v))}finally{p.value=!1,d.value=!1}};return Ie("Enter",()=>{d.value||!p.value||T.value||n.value===l.Locked||V()}),ae(p,t=>{t||(f.description="",y.value=!1)}),ae(()=>f.description,async()=>{if(n.value===l.Locked)try{y.value=!await x.value.validate()}catch{y.value=!0}}),(t,o)=>{var I,B,U,S,C,D,N,z,F,M,R,j,A;const v=Be,$=Ue,_e=Ne,fe=De,ve=Ce,ke=Re;return e(T)?(i(),r("div",Ge,[c("div",Ke,[c("div",Pe,s(t.$t("title.thisFormIsLocked")),1),(B=(I=e(a))==null?void 0:I.meta)!=null&&B.lockedViewDescription?(i(),r("div",Je,s((S=(U=e(a))==null?void 0:U.meta)==null?void 0:S.lockedViewDescription),1)):L("",!0),c("div",Oe,s(t.$t("title.unlockThisVieToMakeChanges")),1),c("div",Qe,[g(s(t.$t("title.unlockViewTitleSubtitle"))+" ",1),((N=e(_)[(D=(C=e(a))==null?void 0:C.meta)==null?void 0:D.lockedByUserId])==null?void 0:N.id)===e(b).id?(i(),r("span",Xe,s(t.$t("general.you")),1)):(i(),r("span",Ye,s(((M=e(_)[(F=(z=e(a))==null?void 0:z.meta)==null?void 0:F.lockedByUserId])==null?void 0:M.display_name)||((A=e(_)[(j=(R=e(a))==null?void 0:R.meta)==null?void 0:j.lockedByUserId])==null?void 0:A.email)),1))])]),e(re)("fieldAdd")?(i(),se($,{key:0,type:"secondary",size:"small",class:"!w-full",loading:e(d),disabled:e(d),onClick:V},{icon:u(()=>[m(v,{icon:"ncUnlock",class:"flex-none"})]),default:u(()=>[g(" "+s(t.$t("labels.unlockView")),1)]),_:1},8,["loading","disabled"])):L("",!0)])):(i(),se(ke,{key:1,visible:e(p),"onUpdate:visible":o[2]||(o[2]=k=>Me(p)?p.value=k:null),"show-separator":!1,header:t.$t("activity.createTable"),size:"small","wrap-class-name":"nc-lock-view-modal-wrapper",onKeydown:o[3]||(o[3]=Fe(k=>p.value=!1,["esc"]))},Se({default:u(()=>[m(ve,{ref_key:"formValidator",ref:x,model:e(f),layout:"vertical",name:"create-new-table-form",class:"flex flex-col gap-5 !mt-1 font-normal",onFinish:V},{default:u(()=>{var k,E,G,K,P,J,O,Q,X,Y,q,H,W;return[e(n)===e(l).Locked?(i(),r("div",Ze,[m(fe,{name:"description",rules:me.description},{default:u(()=>[m(_e,{ref:pe,value:e(f).description,"onUpdate:value":o[0]||(o[0]=Z=>e(f).description=Z),class:"!rounded-lg !text-sm nc-input-shadow !min-h-[120px] max-h-[500px] nc-scrollbar-thin",size:"large","hide-details":"","data-testid":"nc-lock-view-description-input",placeholder:t.$t("placeholder.lockViewDescription")},null,8,["value","placeholder"])]),_:1},8,["rules"])])):(i(),r("div",et,[c("div",tt,s(t.$t("title.unlockViewTitle")),1),(E=(k=e(a))==null?void 0:k.meta)!=null&&E.lockedViewDescription?(i(),r("div",at,s((K=(G=e(a))==null?void 0:G.meta)==null?void 0:K.lockedViewDescription),1)):L("",!0),c("div",st,[g(s(t.$t("title.unlockViewTitleSubtitle"))+" ",1),((O=e(_)[(J=(P=e(a))==null?void 0:P.meta)==null?void 0:J.lockedByUserId])==null?void 0:O.id)===e(b).id?(i(),r("span",ot,s(t.$t("general.you")),1)):(i(),r("span",lt,s(((Y=e(_)[(X=(Q=e(a))==null?void 0:Q.meta)==null?void 0:X.lockedByUserId])==null?void 0:Y.display_name)||((W=e(_)[(H=(q=e(a))==null?void 0:q.meta)==null?void 0:H.lockedByUserId])==null?void 0:W.email)),1))])])),c("div",nt,[m($,{type:"secondary",size:"small",disabled:e(d),"data-testid":"nc-cancel-btn",onClick:o[1]||(o[1]=Z=>p.value=!1)},{default:u(()=>[g(s(t.$t("general.cancel")),1)]),_:1},8,["disabled"]),m($,{type:"primary","html-type":"submit",size:"small",loading:e(d),disabled:e(d)||e(y),"data-testid":"nc-lock-or-unlock-btn"},{icon:u(()=>[m(v,{icon:e(n)===e(l).Locked?"ncLock":"ncUnlock",class:"flex-none"},null,8,["icon"])]),default:u(()=>[c("div",{class:ze(["flex",{"-ml-1":!e(d)}])},s(e(n)===e(l).Locked?t.$t("labels.lockView"):t.$t("labels.unlockView")),3)]),_:1},8,["loading","disabled"])])]}),_:1},8,["model"])]),_:2},[e(n)===e(l).Locked?{name:"header",fn:u(()=>[c("div",qe,[c("div",He,s(t.$t("title.lockThisView")),1),c("div",We,s(t.$t("title.lockThisViewSubtle")),1)])]),key:"0"}:void 0]),1032,["visible","header"]))}}}),rt=Object.assign(Ee(it,[["__scopeId","data-v-b94fd963"]]),{__name:"DlgLockView"});export{rt as default};
