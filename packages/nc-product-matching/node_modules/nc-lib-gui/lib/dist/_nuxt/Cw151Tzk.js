const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./Czw3tY1c.js","./DRA9KN5F.js","./entry.CNP42Mi6.css"])))=>i.map(i=>d[i]);
import{e as oe,G as D,fL as se,gc as re,r as m,bc as ne,a8 as le,am as ce,u as ie,J as ue,n as p,kH as de,aG as R,fJ as pe,eI as me,g as fe,fN as he,bv as ve,c as I,o as u,I as _,L as a,w as f,b as d,M as _e,N as ye,a as c,ag as V,K as y,aH as be,Q as ge,o1 as we,t as b,O as xe,ar as Se,ap as ke,aX as De,$ as Q,a_ as Re,_ as Ie}from"./DRA9KN5F.js";import{_ as Ve}from"./I4_ApCDr.js";import{u as qe,b as Ce}from"./CQa0sIfA.js";import{a as Ee}from"./BmscXXs6.js";import"./D7poRkS0.js";import"./DkDj6Z7Z.js";import"./gAYHr7Gr.js";const Oe=De(()=>Re(()=>import("./Czw3tY1c.js"),__vite__mapDeps([0,1,2]),import.meta.url).then(g=>g.default||g)),Be={class:"flex flex-row h-8 relative"},Te={class:"h-5 flex items-center gap-1 px-1 rounded-md text-nc-content-brand bg-nc-bg-brand select-none"},$e={key:0,class:"w-16 text-bodyDefaultSm font-medium truncate"},Le={class:"flex items-center justify-center px-1"},Qe={key:0,class:"border-t-1 border-nc-border-gray-medium py-1 px-3 flex gap-3"},Ge={class:"text-nc-content-gray text-bodySmBold"},Ne={class:"text-nc-content-gray-muted text-bodySm"},We=oe({__name:"SearchData",setup(g){const G=D(se),w=D(re),q=D(ne,m()),{meta:N,eventBus:W,isGrid:j,isGallery:A,totalRowsWithSearchQuery:C,totalRowsWithoutSearchQuery:z,gridEditEnabled:F}=qe(),{lastOpenedViewId:E}=le(ce()),{isGroupBy:H}=Ee(),M=ie().currentRoute,{search:o,loadFieldQuery:K}=Ce(),{isMobileMode:n}=ue(),r=m(!1),i=m(!!n.value),h=m(),O=m(),x=p(()=>!o.value.query&&!i.value),B=p(()=>{var e;return!((e=o.value.query)!=null&&e.trim())||o.value.isValidFieldQuery}),P=p(()=>{var e;return!r.value&&((e=o.value.query)==null?void 0:e.trim())&&!n.value&&(j.value&&!H.value||A.value)}),S=p(()=>{var e,t;return((t=(e=N.value)==null?void 0:e.columns)==null?void 0:t.filter(s=>de(s)))??[]});R(()=>{var e;return(e=q.value)==null?void 0:e.id},(e,t)=>{var s;if(e!==t){let l=!1;e!==E.value&&(E.value=e,l=!0),K((s=q.value)==null?void 0:s.id,l)}},{immediate:!0});function k(){G.trigger({shouldShowLoading:!1,offset:0}),w==null||w.trigger()}const T=p(()=>{var t,s;if(o.value.field)return(t=S.value)==null?void 0:t.find(l=>l.id===o.value.field);const e=(s=S.value)==null?void 0:s.find(l=>l.pv);return o.value.field=e==null?void 0:e.id,e}),$=p(()=>{var e;return(e=T.value)==null?void 0:e.title});pe(()=>o.value.query,()=>{k()},{debounce:500,maxWait:600});const J=e=>{var t;o.value.field=e.id,r.value=!1,(t=o.value.query)!=null&&t.length&&k(),Q(()=>{var s;(s=h.value)==null||s.focus()})},L=()=>{i.value=!0,setTimeout(()=>{Q(()=>{var e,t;x.value||((e=h.value)==null||e.focus(),(t=h.value)==null||t.select())})},300)},U=()=>{r.value||F.value||(o.value.query="",n.value||(i.value=!1))};return me(O,e=>{const t=e.target;o.value.query||t.closest(".nc-dropdown-toolbar-search, .nc-dropdown-toolbar-search-field-option")||n.value||(i.value=!1)}),fe(()=>{(o.value.query||n.value)&&!i.value&&(i.value=!0)}),R(()=>{var e,t;return(t=(e=M.value)==null?void 0:e.query)==null?void 0:t.where},()=>{W.emit(he.DATA_RELOAD)}),ve("keydown",e=>{(e.ctrlKey||e.metaKey)&&e.key==="f"?(e.preventDefault(),L()):e.key==="Escape"&&U()}),R(x,e=>{e||(r.value=!1)},{immediate:!0}),(e,t)=>{const s=_e,l=ye,X=we,Y=Ve,Z=be,ee=Se,te=ke,ae=Oe;return u(),I("div",{ref_key:"globalSearchWrapperRef",ref:O,class:"nc-global-search-wrapper relative"},[a(x)?(u(),_(l,{key:0,size:"small",type:"text",class:"nc-toolbar-btn !rounded-lg !h-7 !px-1.5","data-testid":"nc-global-search-show-input",onClick:L},{default:f(()=>[d(s,{icon:"search",class:"h-4 w-4 text-nc-content-gray-subtle group-hover:text-nc-content-gray-extreme"})]),_:1})):(u(),_(ae,{key:1,visible:!0},{default:f(()=>[c("div",{class:V({"border-1 rounded-lg border-gray-200 overflow-hidden focus-within:border-primary focus-within:shadow-selected":a(n),"border-primary shadow-selected":a(n)&&a(o).query.length!==0})},[c("div",Be,[d(Z,{visible:a(r),"onUpdate:visible":t[1]||(t[1]=v=>ge(r)?r.value=v:null),trigger:["click"],"overlay-class-name":"nc-dropdown-toolbar-search-field-option"},{overlay:f(()=>[d(Y,{"is-parent-open":a(r),"selected-option-id":a(o).field,"show-selected-option":"",options:a(S),"input-bordered":!1,"search-input-placeholder":e.$t("placeholder.searchFields"),"toolbar-menu":"globalSearch",onSelected:J},null,8,["is-parent-open","selected-option-id","options","search-input-placeholder"])]),default:f(()=>[c("div",{class:"flex items-center gap-2 group px-2 cursor-pointer",onClick:t[0]||(t[0]=v=>r.value=!a(r))},[d(s,{icon:"search",class:"h-3.5 w-3.5 text-nc-content-gray-muted"}),c("div",Te,[d(X,{column:a(T),class:"!w-3.5 !h-3.5 !mx-0"},null,8,["column"]),a(n)?y("",!0):(u(),I("div",$e,b(a($)??""),1)),c("div",Le,[d(s,{icon:"chevronDown",class:V(["!text-current flex-none transform transition-transform duration-25 w-3.5 h-3.5",{"!rotate-180":a(r)}])},null,8,["class"])])])])]),_:1},8,["visible"]),c("form",{class:"p-0",onSubmit:t[3]||(t[3]=xe(()=>{},["prevent"]))},[a(o).query||a(i)?(u(),_(ee,{key:0,ref_key:"globalSearchRef",ref:h,value:a(o).query,"onUpdate:value":t[2]||(t[2]=v=>a(o).query=v),name:"globalSearchQuery",size:"small",class:V(["!text-bodyDefaultSm !w-40 h-full nc-view-search-data !pl-0",{"!pr-7":!a(B)}]),placeholder:`${e.$t("general.searchIn")} ${a($)??""}`,bordered:!1,autocomplete:"off","data-testid":"search-data-input",onPressEnter:k},null,8,["value","class","placeholder"])):y("",!0)],32),a(B)?y("",!0):(u(),_(te,{key:0,title:e.$t("msg.error.invalidSearchQuery"),class:"absolute right-1 top-[50%] transform -translate-y-[50%] flex items-center pr-1",placement:"topRight"},{default:f(()=>[d(s,{icon:"ncInfo",class:"flex-none h-3.5 w-3.5 text-nc-content-red-medium"})]),_:1},8,["title"]))]),a(P)?(u(),I("div",Qe,[c("div",Ge,b(a(C))+" of "+b(a(z)),1),c("div",Ne,b(e.$t("title.matchingResultsInRecords",{count:a(C)})),1)])):y("",!0)],2)]),_:1}))],512)}}}),Ue=Object.assign(Ie(We,[["__scopeId","data-v-8888cedb"]]),{__name:"SmartsheetToolbarSearchData"});export{Ue as default};
