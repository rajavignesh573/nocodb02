import{u as $e,_ as Ne}from"./DzOdU1_u.js";import{r as d,a8 as ve,e as We,a7 as je,J as Be,al as De,as as Ue,bm as Te,T as Le,n as E,aP as Pe,bA as Ve,Y as Q,a9 as Ae,aG as F,a4 as q,a5 as me,ah as Ke,hG as W,ab as Ge,g as Qe,I as $,o as v,w as g,a as m,b as h,c as I,K as H,ag as J,L as t,ad as Fe,an as pe,aq as ue,d as C,t as y,b9 as X,bo as Y,O as qe,a3 as de,bW as He,aH as Je,Q as Z,N as Xe,ap as Ye,ar as Ze,aI as es,bO as ss,cW as ts,P as as,kZ as os,eQ as is,eR as fe,_ as ls}from"./DRA9KN5F.js";import"./ghxJ1J6L.js";import"./0J_Jm9qQ.js";import"./-iDxnmJF.js";import"./BYKJ-MHf.js";import"./lL-0_K96.js";import"./phJnKPvr.js";import"./CkpISeXq.js";import"./C_uh0dMc.js";import"./mXY_vhPu.js";import"./QeWwuUYP.js";import"./Ce4xoeky.js";import"./DP83Cqnl.js";import"./CNwEZGnv.js";import"./DlXIlcns.js";import"./BVqTF1QK.js";import"./C_gbauhL.js";import"./BCBMEREK.js";import"./C2UaKEE0.js";import"./C_VN1MCC.js";import"./gByPF8bR.js";import"./Dv0nYk-Y.js";import"./C6valJX6.js";import"./LhVKWcKT.js";import"./BhKW-HeQ.js";import"./ytmFgNfN.js";import"./HY0lXmUV.js";import"./B8gs0dG7.js";import"./C5HnjaiI.js";import"./CBhmoxRW.js";import"./DkDj6Z7Z.js";import"./C9dUxAef.js";import"./CtCRqrd3.js";import"./boyBAVNN.js";import"./BMufqs0w.js";import"./CN7ac-4_.js";import"./G4Pt-Lbf.js";import"./BSgyuQBI.js";import"./D8vl_16c.js";import"./BMPzbwPk.js";import"./CHRPOXXy.js";import"./D7OHpRdS.js";import"./DvtLu3FC.js";import"./CwPFbl3n.js";import"./YbUkeyWR.js";import"./By5RWL3d.js";const ns=()=>{const j=d([]),B=d([]),i=d([]),{orgId:D}=ve($e());return{orgId:D,workspaces:j,listWorkspaces:async(...w)=>{},fetchOrganizationMembers:async(...w)=>{},fetchOrganizationBases:async(...w)=>{},bases:i,members:B}},rs={class:"flex flex-row text-2xl font-bold items-center gap-x-2"},cs={class:"flex items-center justify-between gap-3 mt-2"},ms={class:"flex w-full gap-4 flex-col"},ps={class:"flex justify-between gap-3 w-full"},us=["disabled","placeholder"],ds={class:"flex items-center"},fs={key:0,class:"ml-2 text-red-500 -mt-2"},vs={key:1,class:"ml-2 text-red-500 -mt-2"},gs={class:""},bs={class:"py-2"},hs={class:"mx-2"},ys={class:"flex flex-col max-h-64 overflow-y-auto nc-scrollbar-md mt-2 px-2"},_s=["onClick"],ws={class:"flex gap-2 capitalize items-center"},ks={class:"flex mt-8 justify-end"},xs={class:"flex gap-2"},Es=We({__name:"InviteDlg",props:{modelValue:{type:Boolean},type:{},baseId:{},emails:{},workspaceId:{},users:{}},emits:["update:modelValue"],setup(j,{emit:B}){const i=j,D=B,ee=je(),{appInfo:ge}=Be(),se=De(),{baseRoles:w,workspaceRoles:U}=Ue(),{createProjectUser:be}=ee,{inviteCollaborator:te}=se,{isPaymentEnabled:he,showUserPlanLimitExceededModal:ye,isPaidPlan:Is,showUserMayChargeAlert:Cs}=Te(),b=Le(i,"modelValue",D),ae=E(()=>i.type==="base"?Pe:Ve),oe=E(()=>i.type==="base"?w==null?void 0:w.value:U==null?void 0:U.value),l=Q({email:"",roles:ae.value.NO_ACCESS}),k=d(),_e=d(),ie=d(),z=d(!1),c=Q({isError:!0,message:""}),_=d(""),n=d([]),T=d([]),L=d([]),M=d(!1),le=ns(),{listWorkspaces:we}=le,{workspaces:ke}=ve(le),S=d(""),ne=E(()=>ke.value.filter(e=>e.title.toLowerCase().includes(S.value.toLowerCase()))),O=Q({}),x=E(()=>ne.value.filter(e=>O[e.id])),P=()=>{var e;(e=ie.value)==null||e.focus(),z.value=!0},{t:V}=Ae();F(b,async e=>{if(e){try{const s=Object.values(ae.value),r=s.findIndex(p=>oe.value&&Object.keys(oe.value).includes(p));r!==-1?(T.value=s.slice(r),L.value=s.slice(0,r)):(T.value=s,L.value=[])}catch(s){q.error(await me(s))}i.emails&&(n.value=i.emails),setTimeout(()=>{P()},100)}else n.value=[],l.email="",_.value=""});const re=e=>{const s=n.value.indexOf(e);s!==-1&&n.value.splice(s,1),n.value.push(e)},ce=(e,s=!1)=>e.length?W(e.trim())?!0:(s||(c.isError=!0,c.message="Invalid Email"),!1):(s||(c.isError=!0,c.message="Email should not be empty"),!1),xe=E(()=>{if(!n.value.length&&!_.value.length||n.value.length&&l.email)return!0}),Ee=E(()=>Ke);F(l,e=>{if(W(e.email)&&!n.value.length){_.value=e.email,c.isError=!1;return}if(_.value="",(e.email.charAt(e.email.length-1)===","||e.email.charAt(e.email.length-1)===" ")&&e.email.trim().length){const p=e.email.split(",")[0].trim()||e.email.split(" ")[0].trim();if(!W(p)){c.isError=!0,c.message="Invalid Email";return}if(n.value.includes(p)){re(p),l.email="";return}n.value.push(p),l.email="",_.value=""}!e.email.length&&c.isError&&(c.isError=!1)});const Ie=()=>{ce(l.email)&&(l.email+=" ",c.isError=!1,c.message="")};Ge("Backspace",()=>{z.value&&l.email.length<1&&n.value.pop()}),F(b,e=>{e&&setTimeout(()=>{P()},100)});const Ce=e=>{var p;c.isError=!1;const s=(p=e.clipboardData)==null?void 0:p.getData("text"),r=(s==null?void 0:s.split(","))||(s==null?void 0:s.split(" "));(r==null?void 0:r.length)===1&&l.email.length&&(r[0]=l.email+=r[0]),r==null||r.forEach(a=>{if(a=os(a)||a,!!ce(a,r.length>1)){if(n.value.includes(a)){re(a);return}n.value.push(a),l.email=""}}),l.email=""},ze=async()=>{var e,s,r,p;try{M.value=!0;const a=_.value||n.value.join(",");a.includes(",")||W(a)||(c.isError=!0,c.message="invalid email");for(const u of a==null?void 0:a.split(","))if((e=i.users)!=null&&e.some(f=>f.email===u.trim())){let f="objects.project";i.type==="workspace"?f="objects.workspace":i.type==="organization"&&(f="general.organization"),k.value=V("msg.userAlreadyExists",{email:u.trim(),scope:V(f).toLowerCase()});return}if(i.type==="base"&&i.baseId)await be(i.baseId,{email:a,roles:l.roles});else if(i.type==="workspace"&&i.workspaceId)await te(a,l.roles,i.workspaceId);else if(i.type==="organization")for(const u of x.value)await te(a,l.roles,u.id);q.success(V("msg.info.inviteSent")),l.email="",n.value=[],b.value=!1}catch(a){const u=await is(a);if(he.value&&u.error===fe.PLAN_LIMIT_EXCEEDED){let f;i.type==="workspace"&&i.workspaceId?f=i.workspaceId:i.type==="organization"&&(f=(p=(r=(s=a==null?void 0:a.config)==null?void 0:s.url)==null?void 0:r.split("/"))==null?void 0:p[4]);const K=u.details;ye({details:K,role:l.roles,callback(G){G==="ok"&&(b.value=!1)},workspaceId:f,isAdminPanel:i.type==="organization"})}else u.error===fe.UNKNOWN_ERROR&&(u.message=await me(a)),q.error(u.message)}finally{_.value="",M.value=!1}},A=d(!1);Qe(async()=>{i.type==="organization"&&await we()});const Me=e=>l.roles=e,Se=e=>{k.value=null,n.value.splice(e,1),n.value.length===0&&(l.email="")};return(e,s)=>{const r=Ne,p=Ye,a=Xe,u=Ze,f=es,K=ss,G=Je,Oe=ts,Re=as;return v(),$(Re,{visible:t(b),"onUpdate:visible":s[7]||(s[7]=R=>Z(b)?b.value=R:null),header:e.$t("activity.createTable"),"show-separator":!1,size:"medium",class:"nc-invite-dlg",onKeydown:s[8]||(s[8]=de(R=>b.value=!1,["esc"]))},{header:g(()=>[m("div",rs,y(e.type==="organization"?e.$t("labels.addMembersToOrganization"):e.type==="base"?e.$t("activity.addMember"):e.$t("activity.inviteToWorkspace")),1)]),default:g(()=>{var R;return[m("div",cs,[m("div",ms,[m("div",ps,[m("div",{ref_key:"divRef",ref:_e,class:J([{"border-primary/100":t(z),"p-1":((R=t(n))==null?void 0:R.length)>0},"flex items-center flex-wrap border-1 gap-1 w-full overflow-x-scroll nc-scrollbar-x-md min-h-10 rounded-lg !min-w-96"]),tabindex:"0",onBlur:s[3]||(s[3]=o=>z.value=!1),onClick:P},[(v(!0),I(pe,null,ue(t(n),(o,N)=>(v(),I("span",{key:o,class:"border-1 text-nc-content-gray bg-nc-bg-gray-light rounded-md flex items-center px-1 whitespace-nowrap"},[C(y(o)+" ",1),(v(),$(X(("iconMap"in e?e.iconMap:t(Y)).close),{class:"ml-0.5 hover:cursor-pointer hover:text-nc-content-gray-subtle mt-0.5 w-4 h-4 text-nc-content-gray-subtle2",onClick:zs=>Se(N)},null,8,["onClick"]))]))),128)),Fe(m("input",{id:"email",ref_key:"focusRef",ref:ie,"onUpdate:modelValue":s[0]||(s[0]=o=>t(l).email=o),disabled:t(M),placeholder:e.$t("activity.enterEmail"),class:"flex-1 min-w-36 outline-none px-2","data-testid":"email-input",onBlur:s[1]||(s[1]=o=>z.value=!1),onKeyup:de(Ie,["enter"]),onPaste:qe(Ce,["prevent"]),onInput:s[2]||(s[2]=o=>k.value=null)},null,40,us),[[He,t(l).email]])],34),m("div",ds,[h(r,{description:!1,"on-role-change":Me,role:t(l).roles,"disabled-roles":t(L),roles:t(T),class:"!min-w-[152px] nc-invite-role-selector",size:"lg"},null,8,["role","disabled-roles","roles"])])]),t(k)?(v(),I("span",fs,y(t(k)),1)):H("",!0),t(c).isError&&t(c).message?(v(),I("span",vs,y(t(c).message),1)):H("",!0),e.type==="organization"?(v(),$(G,{key:2,visible:t(A),"onUpdate:visible":s[5]||(s[5]=o=>Z(A)?A.value=o:null)},{overlay:g(()=>[m("div",bs,[m("div",hs,[h(u,{value:t(S),"onUpdate:value":s[4]||(s[4]=o=>Z(S)?S.value=o:null),class:J([{"!border-brand-500":t(S).length>0},"!rounded-lg !h-8 !ring-0 !placeholder:text-gray-500 !border-gray-200 !px-4"]),"data-testid":"nc-ws-search",placeholder:"Search workspace"},{prefix:g(()=>[(v(),$(X(("iconMap"in e?e.iconMap:t(Y)).search),{class:"h-4 w-4 mr-1 text-gray-500"}))]),_:1},8,["value","class"])]),m("div",ys,[(v(!0),I(pe,null,ue(t(ne),o=>(v(),I("div",{key:o.id,class:"px-2 cursor-pointer hover:bg-gray-100 rounded-lg h-9.5 py-2 w-full flex gap-2",onClick:N=>t(O)[o.id]=!t(O)[o.id]},[m("div",ws,[h(f,{workspace:o,size:"medium"},null,8,["workspace"]),C(" "+y(o.title),1)]),s[9]||(s[9]=m("div",{class:"flex-1"},null,-1)),h(K,{checked:t(O)[o.id],"onUpdate:checked":N=>t(O)[o.id]=N,size:"large"},null,8,["checked","onUpdate:checked"])],8,_s))),128))])])]),default:g(()=>[h(a,{class:"!justify-between","full-width":"",size:"medium",type:"secondary"},{default:g(()=>[m("div",{class:J([{"!text-gray-600":t(x).length>0},"flex text-gray-500 justify-between items-center w-full"])},[h(p,{class:"!max-w-130 truncate","show-on-truncate-only":""},{title:g(()=>[C(y(t(x).length>0?t(x).map(o=>o.title).join(", "):"-select workspaces to invite to-"),1)]),default:g(()=>[m("span",gs,y(t(x).length>0?t(x).map(o=>o.title).join(", "):"-select workspaces to invite to-"),1)]),_:1}),(v(),$(X(("iconMap"in e?e.iconMap:t(Y)).chevronDown)))],2)]),_:1}),s[10]||(s[10]=C(" /> "))]),_:1,__:[10]},8,["visible"])):H("",!0)])]),h(Oe,{visible:t(Ee),type:"warning",message:e.$t("upgrade.newEditorWillBeChanged"),description:e.$t("upgrade.newEditorWillBeChangedSubtitle"),class:"mt-5"},null,8,["visible","message","description"]),m("div",ks,[m("div",xs,[h(a,{type:"secondary",onClick:s[6]||(s[6]=o=>b.value=!1)},{default:g(()=>[C(y(e.$t("labels.cancel")),1)]),_:1}),h(a,{disabled:t(xe)||t(c).isError||t(M)||!!t(k),loading:t(M),size:"medium",type:"primary",class:"nc-invite-btn",onClick:ze},{default:g(()=>[C(y(e.type==="base"?e.$t("activity.inviteToBase"):e.$t("activity.inviteToWorkspace")),1)]),_:1},8,["disabled","loading"])])])]}),_:1},8,["visible","header"])}}}),wt=Object.assign(ls(Es,[["__scopeId","data-v-a786b919"]]),{__name:"DlgInviteDlg"});export{wt as default};
