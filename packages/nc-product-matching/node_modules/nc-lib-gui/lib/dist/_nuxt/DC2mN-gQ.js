const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./DzI8hkox.js","./DRA9KN5F.js","./entry.CNP42Mi6.css","./gAYHr7Gr.js","./PlainCell.CJha1QXQ.css","./BKua7nEo.js","./BUnSBgDC.js","./RecordCard.pwDI-3DF.css","./Bw607vNV.js","./CQa0sIfA.js","./DkDj6Z7Z.js","./B94p8ToD.js","./Cd4chHHL.js","./boyBAVNN.js","./yMSt-9W5.js","./BYKJ-MHf.js","./By5RWL3d.js","./D7poRkS0.js","./C2xdh4Xe.js","./CI3EriLB.js","./C2UaKEE0.js","./Item.GTPiKSkc.css","./C_VN1MCC.js","./index.CMurbi1o.css","./owbQkEXm.js","./DivDataCell.3R8zfazT.css","./DlXIlcns.js","./DP83Cqnl.js","./CVZBrAgI.js","./LhVKWcKT.js","./QeWwuUYP.js","./index._6B72PDH.css","./B89wxTuy.js","./DjPyxH1k.js","./Markdown.CUPXKfeQ.css","./DCa6wpIA.js","./B8gs0dG7.js","./mXY_vhPu.js","./Comments.DTONmK0N.css","./B1qoNiTF.js","./CbX26EBz.js","./TimeSelector.DAR2lbHN.css","./CYKJe2Bk.js","./DkpDpjnr.js","./Dv0nYk-Y.js","./Cell.BBaBjsLL.css","./CHRPOXXy.js","./gByPF8bR.js","./Modal.CB1oWLel.css","./BCBMEREK.js","./DGFEr0h-.js","./DfIS_byq.js","./YbUkeyWR.js","./lL-0_K96.js","./CIOK9Y4w.js","./CNwEZGnv.js","./BVqTF1QK.js","./Ce4xoeky.js","./C3FZdmXk.js","./index.C8L8AhJa.css","./DDmv9w84.js","./DWLi1ZcL.js","./LockView.BWC8JyQk.css","./BALLsGq5.js","./DCm6TF8M.js","./Bj4kMpzI.js","./CbSESqy_.js","./Bxzk9hCO.js","./Bm6QmuXP.js","./CkpISeXq.js","./index.N-A1gxk9.css","./zMMvJhqz.js","./FilterInput.7KjqjE1F.css","./ytmFgNfN.js","./Pagination.Cmvjwryu.css","./DxC2Oool.js","./VirtualCell.6f0pX0MN.css","./CC4cUItJ.js","./EcM5l_HA.js","./BLPDl4Qg.js","./CsX17Y_h.js","./C_gbauhL.js","./BmscXXs6.js","./ColumnMenu.tCfxYPwr.css","./CG-5KGUk.js","./CkvAmLZt.js","./D7OHpRdS.js","./DvtLu3FC.js","./D_txg4HT.js","./SelectOptions.BDAXdwVJ.css","./JqUqXTOd.js","./I4o4wRE2.js","./BMPzbwPk.js","./CwPFbl3n.js","./C5HnjaiI.js","./CBhmoxRW.js","./Bc3_tI4-.js","./CJAyvGKH.js","./D43249YX.js","./U3gU45AW.js","./BBg0y0zb.js","./-iDxnmJF.js","./EditOrAddProvider.C1S70ahv.css","./C1XMFoVa.js","./C-ZUx0lq.js","./YYodiGXA.js","./C316Za7m.js","./CKrOnbU4.js","./index.DA-8lYYb.css"])))=>i.map(i=>d[i]);
import{e as Ce,r as h,fq as je,G as pe,bd as Le,as as Ie,av as Pe,gg as Ve,n as A,o5 as Oe,c as S,o as E,a as H,d as $e,b as J,N as Ae,L as n,w as Q,I as Y,K as B,M as Be,ag as we,cf as N,an as q,aq as fe,O as ye,aX as Z,ba as Ne,a_ as ee,_ as qe}from"./DRA9KN5F.js";import{i as Fe,e as V}from"./gAYHr7Gr.js";import{u as Xe}from"./D7poRkS0.js";import{a as Ue}from"./15xfm8CF.js";const We=Z(()=>ee(()=>import("./DzI8hkox.js"),__vite__mapDeps([0,1,2,3,4]),import.meta.url).then(y=>y.default||y)),Ge=Z(()=>ee(()=>import("./BKua7nEo.js"),__vite__mapDeps([5,1,2,6,7]),import.meta.url).then(y=>y.default||y)),Ke=Z(()=>ee(()=>import("./Bw607vNV.js").then(y=>y.R),__vite__mapDeps([8,1,2,9,10,11,3,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100,101,102,103,104,105,106,107,108]),import.meta.url).then(y=>y.default||y)),He={style:{"z-index":"100"},class:"sticky flex top-0 bg-white border-b-1 border-gray-200 shadow-sm prevent-select"},Je={class:"pointer-events-none h-full inset-y-0 relative"},Qe=["data-testid","data-unique-id","onMouseover","onMousedown"],Ye=Ce({__name:"DateTimeSpanningContainer",props:{records:{}},emits:["expandRecord","newRecord"],setup(y,{expose:_e,emit:ge}){const he=y,F=ge,k=h(null),{width:te}=je(k),L=pe(Le,h()),{isUIAllowed:I}=Ie(),ae=Pe(he,"records"),xe=pe(Ve,h()),{fields:ze}=Xe(),X=A(()=>(ze.value??[]).reduce((e,t)=>(e[t.fk_column_id]={bold:!!t.bold,italic:!!t.italic,underline:!!t.underline},e),{})),{selectedDate:ne,formattedData:T,formattedSideBarData:oe,calendarRange:le,updateRowProperty:re,selectedDateRange:b,viewMetaProperties:Re,displayField:Ee,activeCalendarView:_,updateFormat:C,timezoneDayjs:s}=Ue(),j=A(()=>{var e;return _.value==="week"?(e=Re.value)!=null&&e.hide_weekend?5:7:1}),De=(e,t,o)=>{let p=0;for(;;){let i=!0;for(let u=0;u<o;u++){const d=t+u;if(e[d]||(e[d]={}),e[d][p]){i=!1;break}}if(i)return p;p++}},se=A(()=>_.value==="week"?b.value.start:ne.value),ie=e=>{if(_.value==="day")return e.isSame(ne.value,"day");{const t=j.value===5?s.dayjsTz(b.value.end).subtract(2,"day"):s.dayjsTz(b.value.end);return e&&e.isBetween(s.dayjsTz(b.value.start).startOf("day"),s.dayjsTz(t).endOf("day"),"day","[]")}},ke=A(()=>{var p;if(!((p=ae.value)!=null&&p.length)||!le.value)return[];const e=Array.from({length:7},()=>({})),t=te.value/j.value,o=[];return le.value.forEach(({fk_from_col:i,fk_to_col:u})=>{if(!(!i||!u))for(const d of ae.value){const a=d.rowMeta.id??Oe(),D=s.timezonize(d.row[i.title]),c=s.timezonize(d.row[u.title]),l=Math.max(D.diff(se.value,"day"),0),v=Math.min(c.diff(se.value,"day"),j.value-1)-l+1,z=De(e,l,v);for(let K=0;K<v;K++){const Te=l+K;e[Te][z]=!0}const r=ie(D),w=ie(c);let m="none";r&&w?m="rounded":r?m="leftRounded":w&&(m="rightRounded");const R={top:`${z*28+z*8+8}px`,left:`${l*t}px`,width:`${v*t}px`};o.push({...d,rowMeta:{...d.rowMeta,style:R,position:m,range:{fk_from_col:i,fk_to_col:u},id:a}})}}),o}),O=h(null),U=h(!1),W=h(),P=h(!1),f=h(),$=h(),g=h(null),G=h(),M=h(!1),ue=(e,t)=>{var r,w;if(!k.value||!f.value)return{updatedProperty:[],newRow:null};const{width:o,left:p}=k.value.getBoundingClientRect(),i=e.clientX-p,u=Math.max(0,Math.min(1,i/o)),d=(r=f.value.rowMeta.range)==null?void 0:r.fk_from_col,a=(w=f.value.rowMeta.range)==null?void 0:w.fk_to_col;if(!d)return{updatedProperty:[],newRow:null};const D=Math.floor(u*j.value),c=s.dayjsTz(b.value.start).add(D,"day");if(!c)return{updatedProperty:[],newRow:null};let l;const x={...f.value,row:{...f.value.row,[d.title]:s.dayjsTz(c).format(C.value)}},v=[d.title];if(a){const m=f.value.row[d.title]?s.timezonize(f.value.row[d.title]):null,R=f.value.row[a.title]?s.timezonize(f.value.row[a.title]):null;m&&R?l=s.dayjsTz(c).add(R.diff(m,"day"),"day"):m&&!R||!m&&R?l=s.dayjsTz(c).endOf("day"):l=c.clone(),x.row[a.title]=s.dayjsTz(l).format(C.value),v.push(a.title)}const z=V(x.row,L.value.columns);return t?(T.value=[...T.value,x],oe.value=oe.value.filter(m=>V(m.row,L.value.columns)!==z)):T.value=T.value.map(m=>V(m.row,L.value.columns)===z?x:m),{updateProperty:v,newRow:x}},be=Ne((e,t,o)=>{re(e,t,o)},500),de=e=>{var v,z;if(!I("dataEdit")||!k.value||!g.value)return;const{width:t,left:o}=k.value.getBoundingClientRect(),p=(e.clientX-o-window.scrollX)/t,i=(v=g.value.rowMeta.range)==null?void 0:v.fk_from_col,u=(z=g.value.rowMeta.range)==null?void 0:z.fk_to_col;if(!i||!u)return;const d=s.timezonize(g.value.row[u.title]),a=s.timezonize(g.value.row[i.title]),D=Math.floor(p*j.value);let c=[],l;if($.value==="right"){let r=s.dayjsTz(b.value.start).add(D,"day"),w=a.clone();if(c=[u.title],r.isSameOrBefore(a,"day")&&(r=a.clone().add(1,"hour"),w=a.clone().subtract(1,"hour"),c.push(i.title)),!r.isValid())return;l={...g.value,row:{...g.value.row,[u.title]:r.format(C.value),[i.title]:w.format(C.value)}}}else if($.value==="left"){let r=s.dayjsTz(b.value.start).add(D,"day"),w=d.clone();if(c=[i.title],r.isSameOrAfter(d)&&(r=s.dayjsTz(d).clone(),w=r.clone().add(1,"hour"),c.push(u.title)),!r)return;l={...g.value,row:{...g.value.row,[i.title]:s.dayjsTz(r).format(C.value),[u.title]:s.dayjsTz(w).format(C.value)}}}const x=V(l.row,L.value.columns);T.value=T.value.map(r=>V(r.row,L.value.columns)===x?l:r),be(l,c,!1)},ce=()=>{U.value=!1,$.value=null,g.value=null,document.removeEventListener("mousemove",de),document.removeEventListener("mouseup",ce)},Me=(e,t,o)=>{I("dataEdit")&&(U.value=!0,$.value=e,g.value=o,document.addEventListener("mousemove",de),document.addEventListener("mouseup",ce))},ve=e=>{I("dataEdit")&&(!k.value||!f.value||ue(e,!1))},me=e=>{if(e.preventDefault(),clearTimeout(W.value),!I("dataEdit")||!P.value||!k.value||!f.value)return;const{updateProperty:t,newRow:o}=ue(e);if(!o)return;document.querySelectorAll(".draggable-record").forEach(i=>{i.style.visibility="",i.style.opacity="100%"}),O.value&&(O.value.style.boxShadow="none",O.value=null),f.value=void 0,re(o,t,!1),document.removeEventListener("mousemove",ve),document.removeEventListener("mouseup",me)},Se=(e,t)=>{if(U.value)return;let o=e.target;if(_.value==="day"){F("expandRecord",t);return}P.value=!1,W.value=setTimeout(()=>{if(!I("dataEdit"))return;for(P.value=!0;!o.classList.contains("draggable-record");)o=o.parentElement;document.querySelectorAll(".draggable-record").forEach(u=>{u.getAttribute("data-unique-id").includes(t.rowMeta.id)||(u.style.opacity="30%")}),P.value=!0,O.value=o,f.value=t,document.addEventListener("mousemove",ve),document.addEventListener("mouseup",me)},200);const p=()=>{clearTimeout(W.value),document.removeEventListener("mouseup",p),P.value||F("expandRecord",t)};document.addEventListener("mouseup",p)};return _e({isSpanningRecordExpanded:()=>M.value}),(e,t)=>{const o=Be,p=Ae,i=We,u=Ge,d=Ke;return E(),S("div",He,[H("div",{style:N({maxWidth:`${n(_)==="week"?"64px":"66px"}`,minWidth:`${n(_)==="week"?"64px":"66px"}`}),class:we([{"p-2":n(_)==="day","py-2 pr-1":n(_)==="week"},"text-xs top-0 text-right z-50 !sticky h-full left-0 text-[#6A7184]"])},[t[2]||(t[2]=$e(" All day ")),J(p,{size:"xsmall",class:"mt-2",type:"text",onClick:t[0]||(t[0]=a=>M.value=!n(M))},{default:Q(()=>[n(M)?n(M)?(E(),Y(o,{key:1,class:"w-4 h-4 text-gray-800",icon:"minimize"})):B("",!0):(E(),Y(o,{key:0,class:"w-4 h-4 text-gray-800",icon:"maximize"}))]),_:1})],6),H("div",{ref_key:"container",ref:k,style:N({width:`calc(100% - ${n(_)==="week"?"64":"66"}px)`}),class:we([{"border-gray-100":n(_)==="day","border-gray-200":n(_)==="week","min-h-32 max-h-32 ":n(M),"h-20":!n(M)},"relative border-l-1 transition-all overflow-y-scroll z-30"])},[H("div",Je,[n(j)===7?(E(),S("div",{key:0,class:"absolute !right-0 h-full bg-gray-100 inset-y-0",style:N({width:`${n(te)/7*2}px`})},null,4)):B("",!0),(E(!0),S(q,null,fe(n(ke),(a,D)=>{var c;return E(),S(q,{key:D},[((c=a.rowMeta.style)==null?void 0:c.display)!=="none"?(E(),S("div",{key:0,"data-testid":`nc-calendar-week-record-${a.row[n(Ee).title]}`,"data-unique-id":a.rowMeta.id,style:N({...a.rowMeta.style}),class:"absolute group draggable-record pointer-events-auto nc-calendar-week-record-card",onMouseleave:t[1]||(t[1]=l=>G.value=null),onMouseover:l=>G.value=a.rowMeta.id,onMousedown:ye(l=>Se(l,a),["stop"])},[J(d,{row:a},{default:Q(()=>{var l,x;return[J(u,{hover:n(G)===a.rowMeta.id,dragging:((l=n(g))==null?void 0:l.rowMeta.id)===a.rowMeta.id||((x=n(f))==null?void 0:x.rowMeta.id)===a.rowMeta.id,position:a.rowMeta.position,record:a,resize:n(_)==="week",onDblclick:ye(v=>F("expandRecord",a),["stop"]),onResizeStart:Me},{default:Q(()=>[(E(!0),S(q,null,fe(n(xe),(v,z)=>{var r,w,m;return E(),S(q,{key:z},[("isRowEmpty"in e?e.isRowEmpty:n(Fe))(a,v)?B("",!0):(E(),Y(i,{key:0,modelValue:a.row[v.title],"onUpdate:modelValue":R=>a.row[v.title]=R,class:"text-xs",column:v,bold:!!((r=n(X)[v.id])!=null&&r.bold),italic:!!((w=n(X)[v.id])!=null&&w.italic),underline:!!((m=n(X)[v.id])!=null&&m.underline)},null,8,["modelValue","onUpdate:modelValue","column","bold","italic","underline"]))],64)}),128))]),_:2},1032,["hover","dragging","position","record","resize","onDblclick"])]}),_:2},1032,["row"])],44,Qe)):B("",!0)],64)}),128))])],6)])}}}),ot=Object.assign(qe(Ye,[["__scopeId","data-v-1d06e182"]]),{__name:"SmartsheetCalendarDateTimeSpanningContainer"});export{ot as _};
