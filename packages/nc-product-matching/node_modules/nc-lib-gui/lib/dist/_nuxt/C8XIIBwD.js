const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./xLIsHrMo.js","./DRA9KN5F.js","./entry.CNP42Mi6.css","./D7poRkS0.js","./DkDj6Z7Z.js","./FieldListAutoCompleteDropdown.DdXE7zlY.css"])))=>i.map(i=>d[i]);
import{e as ne,ak as ye,G as L,r as g,bd as se,n as h,aj as ae,aC as le,jg as ge,aD as re,fP as Q,c as w,o as r,b as f,L as t,bc as he,b5 as ke,gd as we,f as Be,J as Oe,aG as Ce,fN as q,ac as Ge,I as d,w as u,ap as xe,ag as E,ad as K,N as Te,a as y,K as M,b9 as U,bo as F,t as D,d as ee,O as I,aX as Se,bB as Me,an as De,aq as Ie,eJ as Le,aH as Ve,Q as oe,M as Ne,a4 as te,a_ as $e,_ as Ee}from"./DRA9KN5F.js";import{_ as Ue}from"./I4_ApCDr.js";import{u as ie}from"./D7poRkS0.js";import{a as ue}from"./BmscXXs6.js";import{_ as Fe}from"./GU4raMbz.js";import{g as Re,a as je}from"./CKrOnbU4.js";import{D as ze}from"./D7OHpRdS.js";import{u as Ae}from"./CQa0sIfA.js";import{u as Pe}from"./Bfaa-xBo.js";import"./DkDj6Z7Z.js";import"./gAYHr7Gr.js";import"./DWLi1ZcL.js";import"./C2xdh4Xe.js";import"./boyBAVNN.js";import"./C316Za7m.js";import"./DvtLu3FC.js";const Ye={class:"nc-group-by-create-modal"},He=ne({__name:"CreateGroupBy",props:{isParentOpen:{type:Boolean},columns:{}},emits:["created"],setup(B,{emit:V}){const R=B,i=V,{isParentOpen:N,columns:O}=ye(R),C=L(se,g()),{showSystemFields:G,metaColumnById:x}=ie(),{groupBy:T}=ue(),j=h(()=>{var s,_;return((_=O.value||((s=C.value)==null?void 0:s.columns))==null?void 0:_.filter(l=>{var v;return l.uidt===ae.Links?!0:le((v=x==null?void 0:x.value)==null?void 0:v[l.id])?l!=null&&l.colOptions||ge(l,C.value)?!1:G.value:!(re(l)&&![Q.BELONGS_TO,Q.ONE_TO_ONE].includes(l.colOptions.type))}).filter(l=>!T.value.find(v=>{var S;return((S=v.column)==null?void 0:S.id)===l.id})))??[]}),z=s=>{i("created",s)};return(s,_)=>{const l=Ue;return r(),w("div",Ye,[f(l,{"is-parent-open":t(N),"search-input-placeholder":s.$t("msg.selectFieldToGroup"),options:t(j),"toolbar-menu":"groupBy",onSelected:z},null,8,["is-parent-open","search-input-placeholder","options"])])}}}),Je=Object.assign(He,{__name:"SmartsheetToolbarCreateGroupBy"}),qe=Se(()=>$e(()=>import("./xLIsHrMo.js"),__vite__mapDeps([0,1,2,3,4,5]),import.meta.url).then(B=>B.default||B)),Ke={class:"flex items-center gap-1 min-h-5"},Qe={class:"flex items-center gap-2"},We={key:0,class:"text-capitalize !text-[13px] font-medium"},Xe={key:0,class:"bg-brand-50 text-brand-500 nc-toolbar-btn-chip"},Ze={key:1,class:"flex flex-col bg-white overflow-auto nc-group-by-list menu-filter-dropdown w-100 p-4","data-testid":"nc-group-by-menu"},eo={class:"w-full flex items-center justify-between gap-2"},oo={class:"truncate flex-1"},to={class:"flex gap-1 items-center"},no=ne({__name:"GroupByMenu",setup(B){const V=L(se,g()),R=L(he,g()),i=L(ke,g(!1)),N=L(we,h(()=>!1)),{gridViewCols:O,updateGridViewColumn:C,metaColumnById:G,showSystemFields:x}=ie(),{fieldsToGroupBy:T,groupByLimit:j}=ue(),{$e:z}=Be(),s=g([]),_=h(()=>{const o=[];return Object.values(O.value).forEach(e=>{e.group_by&&o.push({fk_column_id:e.fk_column_id,sort:e.group_by_sort||"asc",order:e.group_by_order||1})}),o.sort((e,n)=>e.order-n.order),o}),l=h(()=>_.value.map(o=>o.fk_column_id).filter(o=>o)),{eventBus:v}=Ae(),{isMobileMode:S}=Oe(),b=g(!1),W=h(()=>{var o;return((o=V.value)==null?void 0:o.columns)||[]}),de=h(()=>W.value.reduce((o,e)=>(o[e.id]=e,o),{})),ce=h(()=>{var o;return(o=W.value)==null?void 0:o.filter(e=>{var n;return e.uidt===ae.Links?!0:le((n=G==null?void 0:G.value)==null?void 0:n[e.id])?x.value:!(re(e)&&e.colOptions.type!==Q.BELONGS_TO)}).filter(e=>!_.value.find(n=>n.fk_column_id===e.id))}),pe=o=>je(o,de.value),m=g(!1);Pe(m);const k=async()=>{var o;if((o=R.value)!=null&&o.id)try{for(const e of s.value){if(!e.fk_column_id)continue;const n=O.value[e.fk_column_id];n&&(!n.group_by||n.group_by_order!==e.order||n.group_by_sort!==e.sort)&&await C(e.fk_column_id,{group_by:!0,group_by_order:e.order,group_by_sort:e.sort})}for(const e of _.value){if(!e.fk_column_id||s.value.find(c=>c.fk_column_id===e.fk_column_id))continue;const n=O.value[e.fk_column_id];n&&n.group_by&&await C(e.fk_column_id,{group_by:!1,group_by_order:void 0,group_by_sort:void 0})}z("a:group-by:update",{groupBy:_.value}),v.emit(q.GROUP_BY_RELOAD)}catch{te.error("There was an error while updating view!")}else te.error("View not found!!!")},A=o=>{s.value.push({fk_column_id:o.id,sort:"asc",order:s.value.length+1}),k(),b.value=!1},_e=async o=>{if(l.value.length===0){m.value=!1;return}const e=s.value.findIndex(n=>n.fk_column_id===o.fk_column_id);s.value.splice(+e,1),await k()};Ce(m,()=>{m.value?s.value=[..._.value]:b.value=!1}),v.on(async(o,e)=>{if(e!=null&&e.id){if(o===q.GROUP_BY_ADD)A(e);else if(o===q.GROUP_BY_REMOVE){if(l.value.length===0)return;s.value=s.value.filter(n=>n.fk_column_id!==e.id),await k()}}});const me=async o=>{const{newIndex:e,oldIndex:n}=o.moved,c=[...s.value],$=c.splice(n,1)[0];c.splice(e,0,$??[]);const P=c.map((Y,H)=>({...Y,order:H+1}));s.value=[...P],await k()},X=o=>T.value.filter(e=>{var n;return(n=s.value)==null?void 0:n.every(c=>c.fk_column_id!==e.id||c.fk_column_id===o.fk_column_id)});return(o,e)=>{const n=Te,c=xe,$=Je,P=qe,Y=Le,H=Me,fe=Ne,Z=Ve,ve=Fe,J=Ge("e");return r(),d(Z,{visible:t(m),"onUpdate:visible":e[7]||(e[7]=a=>oe(m)?m.value=a:null),"offset-y":"",trigger:["click"],class:"!xs:hidden","overlay-class-name":"nc-dropdown-group-by-menu nc-toolbar-dropdown overflow-hidden"},{overlay:u(()=>[y("div",{class:E({"nc-locked-view":t(i)})},[t(s).length?(r(),w("div",Ze,[y("div",{class:"max-h-100",onClick:e[3]||(e[3]=I(()=>{},["stop"]))},[f(t(ze),{"model-value":t(s),"item-key":"fk_column_id","ghost-class":"bg-gray-50",disabled:t(i),onChange:e[2]||(e[2]=a=>me(a))},{item:u(({element:a})=>[(r(),w("div",{key:a.fk_column_id,class:"flex first:mb-0 !mb-1.5 !last:mb-0 items-center"},[f(n,{type:"secondary",size:"small",class:"!border-r-transparent !rounded-r-none",shadow:!1,disabled:t(i)},{default:u(()=>[(r(),d(U(("iconMap"in o?o.iconMap:t(F)).drag)))]),_:1},8,["disabled"]),f(P,{modelValue:a.fk_column_id,"onUpdate:modelValue":p=>a.fk_column_id=p,class:"caption nc-group-field-select !w-36",columns:X(a),"allow-empty":!0,meta:t(V),disabled:t(i),onChange:k,onClick:e[0]||(e[0]=I(()=>{},["stop"]))},null,8,["modelValue","onUpdate:modelValue","columns","meta","disabled"]),f(H,{ref:"",value:a.sort,"onUpdate:value":p=>a.sort=p,class:"flex flex-grow-1 w-full nc-group-sort-dir-select",label:o.$t("labels.operation"),"dropdown-class-name":"sort-dir-dropdown nc-dropdown-group-sort-dir",disabled:!a.fk_column_id||t(i),onChange:k,onClick:e[1]||(e[1]=I(()=>{},["stop"]))},{default:u(()=>[(r(!0),w(De,null,Ie(("getSortDirectionOptions"in o?o.getSortDirectionOptions:t(Re))(pe(a.fk_column_id),!0),(p,be)=>(r(),d(Y,{key:be,value:p.value},{default:u(()=>[y("div",eo,[y("div",oo,D(p.text),1),a.sort===p.value?(r(),d(U(("iconMap"in o?o.iconMap:t(F)).check),{key:0,id:"nc-selected-item-icon",class:"text-primary w-4 h-4"})):M("",!0)])]),_:2},1032,["value"]))),128))]),_:2},1032,["value","onUpdate:value","label","disabled"]),f(c,{placement:"top",title:"Remove",class:"flex-none"},{default:u(()=>[K((r(),d(n,{class:"nc-group-by-item-remove-btn !border-l-transparent !rounded-l-none",size:"small",type:"secondary",shadow:!1,disabled:t(i),onClick:I(p=>_e(a),["stop"])},{default:u(()=>[(r(),d(U(("iconMap"in o?o.iconMap:t(F)).deleteListItem)))]),_:2},1032,["disabled","onClick"])),[[J,["c:group-by:remove"]]])]),_:2},1024)]))]),_:1},8,["model-value","disabled"])]),t(ce).length&&t(T).length>t(s).length&&t(s).length<t(j)?(r(),d(Z,{key:0,visible:t(b),"onUpdate:visible":e[5]||(e[5]=a=>oe(b)?b.value=a:null),trigger:["click"],"overlay-class-name":"nc-toolbar-dropdown",disabled:t(i)},{overlay:u(()=>[f($,{"is-parent-open":t(b),columns:t(T),onCreated:A},null,8,["is-parent-open","columns"])]),default:u(()=>[K((r(),d(n,{type:"text",size:"small",style:{width:"fit-content"},class:E(["nc-add-group-by-btn mt-2",{"!text-brand-500":!t(i)}]),disabled:t(i),onClick:e[4]||(e[4]=I(a=>b.value=!0,["stop"]))},{default:u(()=>[y("div",to,[f(fe,{icon:"plus"}),ee(" "+D(o.$t("activity.addSubGroup")),1)])]),_:1},8,["class","disabled"])),[[J,["c:group-by:add"]]])]),_:1},8,["visible","disabled"])):M("",!0)])):(r(),d($,{key:0,"is-parent-open":t(m),columns:X({}),disabled:t(i),onCreated:A},null,8,["is-parent-open","columns","disabled"])),t(i)?(r(),d(ve,{key:2,class:E({"-mt-2":t(s).length}),onOnOpen:e[6]||(e[6]=a=>m.value=!1)},null,8,["class"])):M("",!0)],2)]),default:u(()=>{var a;return[f(c,{disabled:!t(S)&&!t(N),class:E({"nc-active-btn":(a=t(l))==null?void 0:a.length})},{title:u(()=>[ee(D(o.$t("activity.group")),1)]),default:u(()=>[K((r(),d(n,{class:"nc-group-by-menu-btn nc-toolbar-btn !border-0 !h-7",size:"small",type:"secondary","show-as-disabled":t(i)},{default:u(()=>{var p;return[y("div",Ke,[y("div",Qe,[(r(),d(U(("iconMap"in o?o.iconMap:t(F)).group),{class:"h-4 w-4"})),!t(S)&&!t(N)?(r(),w("span",We,D(o.$t("activity.group")),1)):M("",!0)]),(p=t(l))!=null&&p.length?(r(),w("span",Xe,D(t(l).length),1)):M("",!0)])]}),_:1},8,["show-as-disabled"])),[[J,["c:group-by"]]])]),_:1},8,["disabled","class"])]}),_:1},8,["visible"])}}}),ko=Object.assign(Ee(no,[["__scopeId","data-v-e5077ba4"]]),{__name:"SmartsheetToolbarGroupByMenu"});export{ko as default};
