import{_ as ee,b as ae,a as te}from"./BiJx_glt.js";import{e as oe,a8 as w,U as R,J as ne,V as se,ge as le,a9 as ie,f as ue,aa as re,am as k,r as i,aG as b,ac as ce,c as me,I as V,K as B,L as a,o as p,ad as C,bW as de,a as x,a3 as M,ag as O,Q as S,w as c,b as g,M as ve,d as pe,t as _e,ap as fe,N as we,aH as be,ax as U}from"./DRA9KN5F.js";import"./CHRPOXXy.js";import"./gByPF8bR.js";import"./BCBMEREK.js";import"./DWLi1ZcL.js";import"./DkDj6Z7Z.js";import"./C_-gdvC5.js";import"./EcM5l_HA.js";import"./C2UaKEE0.js";import"./CRQxmmPY.js";import"./CI3EriLB.js";import"./C3FZdmXk.js";import"./CsX17Y_h.js";import"./C_VN1MCC.js";const Ve={class:"flex items-center gap-0.5"},xe=oe({__name:"OpenedViewAction",setup(ge){const{activeTable:_}=w(R()),{isMobileMode:D}=ne(),{isSharedBase:y,base:h}=w(se()),{sharedView:$}=le(),{t:f}=ie(),{$api:A,$e:G}=ue(),{refreshCommandPalette:K}=re(),{activeView:e,views:z}=w(k()),{loadViews:L,removeFromRecentViews:P}=k(),{navigateToTable:j}=R(),l=i(!1),q=i(!1),m=i(!1),r=i(),o=i(""),n=i(),E=async()=>{if(!e.value||!e.value.id)return;G("c:view:description");const t=i(!0);l.value=!1;const{close:s}=U(ae,{modelValue:t,view:e.value,"onUpdate:modelValue":u});function u(){t.value=!1,s(1e3)}},F=()=>{m.value=!0,l.value=!1,o.value=e.value.title,setTimeout(()=>{r.value.focus()})};b(r,()=>{var t;(t=r.value)==null||t.focus()});const T=async()=>{var t;H()?(e.value.title=o.value,m.value=!1,n.value=void 0,await A.dbView.update(e.value.id,{title:o.value})):(t=r.value)==null||t.focus()};function H(){return!o.value||o.value.trim().length<0?(n.value=f("msg.error.viewNameRequired"),!1):o.value.trim().length>255?(n.value=f("msg.error.nameMaxLength256"),!1):z.value.some(t=>t.title===o.value&&t.id!==e.value.id)?(n.value=f("msg.error.viewNameDuplicate"),!1):!0}b(o,()=>{n.value&&(n.value=void 0)}),b(l,()=>{setTimeout(()=>{q.value=!1},250)});const J=()=>{o.value=e.value.title,m.value=!1};function Q(){const t=i(!0);l.value=!1;const{close:s}=U(te,{modelValue:t,view:e.value,"onUpdate:modelValue":u,onDeleted:async()=>{var d;u(),P({viewId:e.value.id,tableId:e.value.fk_model_id,baseId:h.value.id}),K(),((d=e.value)==null?void 0:d.id)===e.value.id&&j({tableId:_.value.id,baseId:h.value.id}),await L({tableId:_.value.id,force:!0})}});function u(){t.value=!1,s(1e3)}}return(t,s)=>{var I,N;const u=ve,d=fe,W=we,X=ee,Y=be,Z=ce("e");return a(m)?(p(),me("div",{key:0,class:O(["h-6 relative",{"max-w-2/5":!a(y)&&!a(D)&&((I=a(e))==null?void 0:I.is_default),"max-w-3/5":!a(y)&&!a(D)&&!((N=a(e))!=null&&N.is_default)}])},[C(x("input",{ref_key:"renameInputDom",ref:r,"onUpdate:modelValue":s[0]||(s[0]=v=>S(o)?o.value=v:null),class:O(["ml-0.25 w-full px-1 py-0.5 rounded-md font-medium text-gray-800",{"outline-brand-500":!a(n),"outline-red-500 pr-6":a(n)}]),onBlur:T,onKeydown:[M(T,["enter"]),M(J,["esc"])]},null,34),[[de,a(o)]]),a(n)?(p(),V(d,{key:0,class:"absolute top-0.25 right-0.5 bg-white rounded-lg"},{title:c(()=>[pe(_e(a(n)),1)]),default:c(()=>[g(u,{icon:"info",class:"cursor-pointer"})]),_:1})):B("",!0)],2)):a($)?B("",!0):(p(),V(Y,{key:1,visible:a(l),"onUpdate:visible":s[2]||(s[2]=v=>S(l)?l.value=v:null),class:"!xs:pointer-events-none nc-actions-menu-btn nc-view-context-btn","overlay-class-name":"nc-dropdown-actions-menu"},{overlay:c(()=>[g(X,{table:a(_),view:a(e),onCloseModal:s[1]||(s[1]=v=>l.value=!1),onRename:F,onDelete:Q,onDescriptionUpdate:E},null,8,["table","view"])]),default:c(()=>[x("div",null,[C((p(),V(W,{class:"nc-view-action-menu-btn nc-toolbar-btn !border-0 !h-7 !px-1.5 !min-w-7",size:"small",type:"secondary"},{default:c(()=>[x("div",Ve,[g(u,{icon:"threeDotVertical",class:"!h-4 !w-4"})])]),_:1})),[[Z,["c:toolbar:view-actions"]]])])]),_:1},8,["visible"]))}}}),Ae=Object.assign(xe,{__name:"SmartsheetToolbarOpenedViewAction"});export{Ae as default};
