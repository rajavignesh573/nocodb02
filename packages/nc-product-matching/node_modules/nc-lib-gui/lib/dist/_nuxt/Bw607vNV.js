const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./CfTpfQ4B.js","./DRA9KN5F.js","./entry.CNP42Mi6.css","./By5RWL3d.js","./VirtualCell.krPvGNjk.css","./CDTi0oRk.js","./Cell.DrFrP4_9.css","./BALLsGq5.js","./DCm6TF8M.js","./Bj4kMpzI.js","./CbSESqy_.js","./Bxzk9hCO.js","./CbX26EBz.js","./TimeSelector.DAR2lbHN.css","./Bm6QmuXP.js","./CkpISeXq.js","./index.N-A1gxk9.css","./zMMvJhqz.js","./FilterInput.7KjqjE1F.css","./CI3EriLB.js","./ytmFgNfN.js","./Pagination.Cmvjwryu.css","./gAYHr7Gr.js","./DkDj6Z7Z.js","./CQa0sIfA.js","./DxC2Oool.js","./Cd4chHHL.js","./boyBAVNN.js","./B94p8ToD.js","./DfIS_byq.js","./BVqTF1QK.js","./DP83Cqnl.js","./CNwEZGnv.js","./DlXIlcns.js","./Ce4xoeky.js","./VirtualCell.6f0pX0MN.css","./B1qoNiTF.js","./CYKJe2Bk.js","./DkpDpjnr.js","./Dv0nYk-Y.js","./Cell.BBaBjsLL.css","./DzI8hkox.js","./PlainCell.CJha1QXQ.css","./CG-5KGUk.js","./BLPDl4Qg.js","./CkvAmLZt.js","./D7OHpRdS.js","./DvtLu3FC.js","./D_txg4HT.js","./SelectOptions.BDAXdwVJ.css","./C3FZdmXk.js","./index.C8L8AhJa.css","./JqUqXTOd.js","./I4o4wRE2.js","./BMPzbwPk.js","./CwPFbl3n.js","./YbUkeyWR.js","./D7poRkS0.js","./C5HnjaiI.js","./CBhmoxRW.js","./DjPyxH1k.js","./Bc3_tI4-.js","./CsX17Y_h.js","./BCBMEREK.js","./CJAyvGKH.js","./C2UaKEE0.js","./Item.GTPiKSkc.css","./C_VN1MCC.js","./index.CMurbi1o.css","./QeWwuUYP.js","./index._6B72PDH.css","./D43249YX.js","./U3gU45AW.js","./BYKJ-MHf.js","./BBg0y0zb.js","./-iDxnmJF.js","./EditOrAddProvider.C1S70ahv.css","./BYqbwTjR.js","./DCKYOzKD.js","./DGFEr0h-.js","./yMSt-9W5.js","./C2xdh4Xe.js","./owbQkEXm.js","./DivDataCell.3R8zfazT.css","./CVZBrAgI.js","./LhVKWcKT.js","./B89wxTuy.js","./Markdown.CUPXKfeQ.css","./DCa6wpIA.js","./B8gs0dG7.js","./mXY_vhPu.js","./Comments.DTONmK0N.css","./CHRPOXXy.js","./gByPF8bR.js","./Modal.CB1oWLel.css","./lL-0_K96.js","./CIOK9Y4w.js","./DDmv9w84.js","./DWLi1ZcL.js","./LockView.BWC8JyQk.css","./CC4cUItJ.js","./EcM5l_HA.js","./C_gbauhL.js","./BmscXXs6.js","./ColumnMenu.tCfxYPwr.css","./C1XMFoVa.js","./C-ZUx0lq.js","./YYodiGXA.js","./C316Za7m.js","./CKrOnbU4.js","./PaginationV2.DE0InVwA.css","./CPGfyxPl.js","./Pagination.B5Gl1nyf.css","./8cIDi64c.js"])))=>i.map(i=>d[i]);
var tp=Object.defineProperty;var np=(t,n,o)=>n in t?tp(t,n,{enumerable:!0,configurable:!0,writable:!0,value:o}):t[n]=o;var vo=(t,n,o)=>np(t,typeof n!="symbol"?n+"":n,o);import{f as ua,a9 as la,G as dn,r as V,bX as zl,a7 as As,a8 as Uo,V as Ca,n as ue,ge as ju,b1 as Ul,bc as ds,W as Mi,dM as jo,gf as rr,as as wl,bm as ql,gg as wr,aC as xa,gh as gs,el as il,eh as op,aG as Gn,gi as lp,gj as wa,u as cs,a4 as Zt,a5 as hl,fV as _o,S as ai,fv as ap,eQ as vf,eR as ip,f3 as Hs,e as xo,fe as rp,ff as sp,am as yr,ah as Wi,gk as kl,g as oi,ac as Yl,c as B,K as ge,L as e,o as h,an as Qt,aq as po,I as J,ap as Aa,w as K,ad as Nt,ag as Gt,b as le,M as Sl,t as ce,d as Je,_ as Ol,af as ya,a as z,aX as ko,gl as Qr,gm as pf,bZ as vl,b_ as pl,gn as hf,aD as ml,a_ as Co,av as Nn,J as tl,N as da,go as mf,bb as wo,gp as gf,fS as Ri,fX as wf,gq as yf,gr as bf,gs as _f,bi as br,al as up,$ as el,b3 as Ys,bV as Uu,ei as Es,eO as Gu,fW as xf,da as dp,Q as yo,db as cp,aH as Hi,b9 as $o,bo as sl,aA as _r,aR as qs,bk as fs,bd as Ti,a3 as ls,O as ro,gt as Qd,ak as xr,fL as Ea,gu as fp,T as Ra,eI as Xs,P as Ms,gv as vp,a1 as ar,by as kf,fn as Cf,bw as pp,gw as hp,bU as Zd,gx as Hu,gy as Rf,gz as mp,dm as Sf,ao as Yu,gA as If,gB as Ff,cb as qu,bM as ka,fN as qo,aF as jn,bz as Xu,aj as ve,gC as Jn,gc as Ku,gD as Wa,gE as ec,gF as Su,a6 as Af,aQ as Ef,a$ as kr,Y as Si,gG as ol,gH as Ju,bv as Tl,gI as Wl,gJ as ji,gK as tc,bx as ra,aY as Va,gL as ki,gM as za,gN as Mf,gO as sr,gP as ur,gQ as Jo,gR as Cl,gS as Ho,gT as Sa,fr as Rl,fY as sa,gU as as,gV as Tf,g6 as Ks,b5 as Yi,g9 as Qu,gW as Js,gX as Bo,gY as $f,gZ as Ts,g_ as ba,g$ as is,h0 as Of,h1 as ks,h2 as gp,i as Ga,h3 as Zu,cf as Xn,bO as Df,eC as Lf,aS as Nf,br as Iu,h4 as Ci,h5 as Ii,h6 as $s,ax as rs,h7 as Gl,h8 as Pf,h9 as Bf,ha as Wf,hb as zf,fm as wp,ab as Zr,aw as nc,hc as yp,s as bp,dp as _p,dt as xp,hd as Qi,he as Qs,hf as kp,hg as Vf,hh as Os,cv as Fu,hi as Cp,cx as Cr,hj as Rp,hk as Sp,hl as Ip,hm as Fp,hn as Fi,cG as Ap,cM as Ep,cO as Mp,cH as Tp,ho as $p,hp as Op,cK as Dp,hq as Lp,hr as Np,hs as Pp,ht as Bp,hu as Wp,hv as zp,hw as Vp,hx as gl,hy as dr,hz as jp,hA as Up,hB as Gp,hC as ts,hD as Zs,hE as Pt,hF as Il,hG as oc,hH as $l,ca as Hp,j as ta,hI as oa,hJ as Hl,hK as ed,hL as Rr,hM as Yp,hN as qp,hO as Qn,hP as Au,hQ as Xp,hR as Kp,hS as Yo,hT as ns,hU as Jp,hV as ga,hW as Qp,hX as Eu,hY as Zp,hZ as eh,fB as Ai,fA as eu,fl as Cs,h_ as lc,h$ as th,i0 as nh,i1 as oh,i2 as Ds,i3 as Ui,i4 as zi,i5 as lh,i6 as ah,aP as su,aO as ih,i7 as ac,i8 as jf,dk as rh,i9 as sh,ia as Uf,fZ as uu,fP as Zi,ib as uh,ic as dh,id as ch,ie as or,g3 as ws,g4 as ic,g5 as rc,ig as sc,ih as fh,ii as vh,ij as ph,ik as hh,il as mh,im as gh,io as wh,ip as yh,iq as bh,ir as _h,is as xh,it as kh,bQ as Ch,iu as Rh,iv as Sh,iw as Ih,ix as rl,iy as Fh,iz as du,iA as uc,iB as dc,iC as cc,iD as fc,aL as ir,iE as Ah,iF as Gf,iG as Eh,iH as Hf,iI as td,iJ as Yf,iK as qf,iL as Xf,iM as Mh,iN as Rs,iO as Th,iP as vc,iQ as $h,iR as Oh,iS as Dh,iT as Kf,iU as Lh,iV as Nh,iW as Ph,iX as cu,iY as Bh,iZ as Wh,fq as zh,i_ as Vh,dn as jh,i$ as pc,j0 as Uh,j1 as Gh,j2 as Hh,j3 as Yh,fg as Mu,j4 as qh,bN as Xh,j5 as Kh,U as Jh,j6 as Qh,eG as Zh,ef as em,fQ as tm,j7 as nm,j8 as om,eH as fu,j9 as lm}from"./DRA9KN5F.js";import{u as Fl,a as am}from"./CQa0sIfA.js";import{u as Jf}from"./DkDj6Z7Z.js";import{u as Qf}from"./B94p8ToD.js";import{u as im,_ as Zf,a as rm}from"./yMSt-9W5.js";import{u as nd}from"./By5RWL3d.js";import{u as Ha}from"./D7poRkS0.js";import{e as Ht,p as ev,r as Bi,g as tv,a as sm,b as um,c as dm,d as hc}from"./gAYHr7Gr.js";import{a as nv,b as od}from"./C2xdh4Xe.js";import{_ as Sr}from"./CI3EriLB.js";import{_ as Ya}from"./C2UaKEE0.js";import{_ as qa}from"./C_VN1MCC.js";import cm from"./owbQkEXm.js";import{S as ov}from"./DlXIlcns.js";import{_ as fm,a as lv}from"./CVZBrAgI.js";import{_ as ld,c as Ml}from"./B1qoNiTF.js";import{i as Ls,g as Ns,a as vm,b as pm,c as hm,d as mm,e as gm,f as wm,h as ym}from"./BYKJ-MHf.js";import{u as av}from"./DCa6wpIA.js";import{u as Ir}from"./B8gs0dG7.js";import bm from"./CHRPOXXy.js";import{r as vu}from"./DGFEr0h-.js";import{u as vs}from"./DfIS_byq.js";import{u as _m,a as ad}from"./Cd4chHHL.js";import{u as id}from"./CbX26EBz.js";import{_ as xm,R as km}from"./YbUkeyWR.js";import{u as iv}from"./mXY_vhPu.js";import{p as rv}from"./lL-0_K96.js";import{u as Ps}from"./CIOK9Y4w.js";import{S as sv}from"./CNwEZGnv.js";import{_ as Cm}from"./C3FZdmXk.js";import{u as Rm}from"./DDmv9w84.js";import Sm from"./DWLi1ZcL.js";import{_ as Im}from"./BALLsGq5.js";import{b as Fm}from"./CC4cUItJ.js";import{_ as Am}from"./CG-5KGUk.js";import{Q as Em}from"./C1XMFoVa.js";import{u as Mm}from"./C-ZUx0lq.js";import{g as mc}from"./zMMvJhqz.js";import{u as Tm}from"./YYodiGXA.js";import{p as Bs,s as $m,A as gc,v as Om,f as Dm,a as Lm}from"./BmscXXs6.js";import{u as Nm}from"./U3gU45AW.js";import{g as Pm}from"./C316Za7m.js";import{a as Bm,u as Wm}from"./CkvAmLZt.js";import{C as zm,_ as Vm}from"./-iDxnmJF.js";import{u as jm}from"./CKrOnbU4.js";const[Um,Gm]=Jf((t,n,o,l)=>{var Kt,nn,wt,Dn,un,Bn;const{$e:a,$state:i,$api:r,$ncSocket:s}=ua(),{t:u}=la(),c=dn(zl,V(!1)),f=V([]),v=V(!1),p=V(!0),g=V(0),y=V(new Set),x=V({}),w=As(),{basesUser:m}=Uo(w),{base:C}=Uo(Ca()),b=ue(()=>t.value.base_id?m.value.get(t.value.base_id)||[]:[]),{sharedView:S}=ju(),k=V(!S.value||((Kt=S.value)==null?void 0:Kt.type)===Ul.GALLERY||((nn=S.value)==null?void 0:nn.type)===Ul.KANBAN||(Dn=(wt=n.value)==null?void 0:wt.rowMeta)!=null&&Dn.new?n.value:{row:{},oldRow:{},rowMeta:{}});(Bn=(un=k.value)==null?void 0:un.rowMeta)!=null&&Bn.fromExpandedForm&&(k.value.rowMeta.fromExpandedForm=!0);const D=Qf(k),F=dn(ds,V()),{addUndo:I,clone:M,defineViewScope:A}=Mi(),j=dn(rr,jo()),{comments:N,resolveComment:Y,loadComments:ae,updateComment:he,deleteComment:ye,saveComment:re,isCommentsLoading:me}=im(t,k),{isUIAllowed:W}=wl(),{handleUpgradePlan:U,isPaymentEnabled:Ae}=ql();nd();const je=ue(()=>!0),Ue=tt=>!0,ot=ue(()=>{var tt,mt,Dt,Rt;if((tt=k==null?void 0:k.value)!=null&&tt.row){const ct=(Dt=(mt=t==null?void 0:t.value)==null?void 0:mt.columns)==null?void 0:Dt.find(nt=>nt.pv);return ct?(Rt=k.value.row)==null?void 0:Rt[ct.title]:void 0}}),{fieldsMap:G,isLocalMode:pe}=Ha(),ne=dn(wr,V(null)),be=ue(()=>l?o.value?(t.value.columns??[]).filter(tt=>{var mt;return!xa(tt)&&!!((mt=tt.meta)!=null&&mt.defaultViewColVisibility)&&(!D.isNew.value||!gs(tt))}).sort((tt,mt)=>{var Dt,Rt;return(((Dt=tt.meta)==null?void 0:Dt.defaultViewColOrder)??1/0)-(((Rt=mt.meta)==null?void 0:Rt.defaultViewColOrder)??1/0)}):(t.value.columns??[]).filter(tt=>{var mt;return(!D.isNew.value||!gs(tt))&&!xa(tt)&&!!((mt=tt.meta)!=null&&mt.defaultViewColVisibility)}):ne.value?D.isNew.value?ne.value.filter(tt=>!gs(tt)):ne.value:[]),ee=ue(()=>{var mt;const tt=(((mt=t.value)==null?void 0:mt.columns)??[]).filter(Dt=>{var Rt,ct;return!xa(Dt)&&!((Rt=be.value)!=null&&Rt.includes(Dt))&&(pe.value&&(Dt!=null&&Dt.id)&&G.value[Dt.id]?(ct=G.value[Dt.id])==null?void 0:ct.initialShow:!0)&&(!D.isNew.value||!gs(Dt))});return l?o.value?tt.sort((Dt,Rt)=>{var ct,nt;return(((ct=Dt.meta)==null?void 0:ct.defaultViewColOrder)??1/0)-(((nt=Rt.meta)==null?void 0:nt.defaultViewColOrder)??1/0)}):tt:tt.sort((Dt,Rt)=>{var ct,nt;return(((ct=G.value[Dt.id])==null?void 0:ct.order)??1/0)-(((nt=G.value[Rt.id])==null?void 0:nt.order)??1/0)})}),H=tt=>`${tt.id}|${tt.created_at}`,Ce=ue(()=>Ht(k.value.row,t.value.columns)),Ie=V(""),Q=V(!1),ie=async(tt,mt=!0)=>{var Rt,ct,nt,rt;if(!W("recordAuditList")||!k.value&&!tt)return;const Dt=tt??Ht(k.value.row,t.value.columns);if(!(!Dt||!t.value.base_id))try{mt&&(v.value=!0);const st=await r.internal.getOperation(C.value.fk_workspace_id??ap,t.value.base_id??C.value.id,{operation:"recordAuditList",fk_model_id:t.value.id,row_id:Dt,cursor:Ie.value});st.list=st.list.filter(Ot=>!(Ot!=null&&Ot.op_type.includes("INSERT")));const lt=(Rt=st.list)==null?void 0:Rt[st.list.length-1];lt&&(Ie.value=H(lt)),Q.value=!((ct=st.pageInfo)!=null&&ct.isLastPage);const xt=((rt=(nt=st.list)==null?void 0:nt.reverse)==null?void 0:rt.call(nt))||[];f.value.unshift(...xt.map(Ot=>{const yt=b.value.find(Qe=>Qe.id===Ot.fk_user_id||Qe.email===Ot.user);return{...Ot,created_display_name:(yt==null?void 0:yt.display_name)??((yt==null?void 0:yt.email)??"").split("@")[0],created_by_email:yt==null?void 0:yt.email,created_by_meta:yt==null?void 0:yt.meta}}))}catch(st){console.error(st);const lt=await vf(st);if(Ae.value&&lt.error===ip.PLAN_LIMIT_EXCEEDED){const xt=lt.details;U({title:u("upgrade.updateToExtendRecordHistory"),content:u("upgrade.updateToExtendRecordHistorySubtitle",{activePlan:xt.plan,plan:xt.higherPlan,period:Me(+(xt.limit??14))}),limitOrFeature:Hs.LIMIT_AUDIT_RETENTION})}else Zt.error(lt.message)}finally{v.value=!1}};function Me(tt){if(tt===1/0)return"3+ years";if(tt<14)return`${tt} day${tt===1?"":"s"}`;if(tt<30){const mt=Math.floor(tt/7);return`${mt} week${mt===1?"":"s"}`}else if(tt<365){const mt=Math.floor(tt/30);return`${mt} month${mt===1?"":"s"}`}else{const mt=Math.floor(tt/365);return mt>3?`${mt}+ years`:`${mt} year${mt===1?"":"s"}`}}const Be=async()=>{Q.value&&await ie()},it=async()=>{Ie.value="",f.value=[],Q.value=!1,await ie()},Ge=tt=>{var mt,Dt;return((Dt=(mt=i.user)==null?void 0:mt.value)==null?void 0:Dt.email)===tt},ze=async()=>{var tt;if(((tt=F.value)==null?void 0:tt.type)===Ul.KANBAN){const{loadKanbanData:mt}=nv();await mt()}},Z=async(tt={},mt=!1,{kanbanClbk:Dt}={})=>{var nt,rt,st,lt;if(!t.value.id)return;let Rt;const ct=((nt=k.value.rowMeta)==null?void 0:nt.new)??!1;if(ct){const{getMeta:xt}=ai(),{missingRequiredColumns:Ot,insertObj:yt}=await ev({meta:t.value,ltarState:tt,getMeta:xt,row:k.value.row,throwError:!0});if(Ot.size)return;if(Rt=await r.dbTableRow.create("noco",t.value.base_id,t.value.id,{...yt,...tt||{}}),Object.assign(k.value,{row:Rt,rowMeta:{...k.value.rowMeta,new:!1},oldRow:{...Rt}}),!mt){const Qe=Ht(Rt,(rt=t.value)==null?void 0:rt.columns),d=Bi(k.value.row,(st=t.value)==null?void 0:st.columns);I({redo:{fn:async _=>{await r.dbTableRow.create("noco",C.value.id,t.value.id,{...d,..._}),await ze(),j==null||j.trigger()},args:[M(yt)]},undo:{fn:async _=>{var T,se,q;const O=await r.dbViewRow.delete("noco",((T=t.value)==null?void 0:T.base_id)??C.value.id,(se=t.value)==null?void 0:se.id,(q=F.value)==null?void 0:q.id,encodeURIComponent(_));if(O.message)throw new Error(O.message);await ze(),j==null||j.trigger()},args:[Qe]},scope:A({view:F.value})})}}else{const xt=[...y.value].reduce((Ot,yt)=>(Ot[yt]=k.value.row[yt],Ot),{});if(Object.keys(xt).length){const Ot=Ht(k.value.row,t.value.columns);if(!Ot)return Zt.info(u("msg.info.updateNotAllowedWithoutPK"));if(await r.dbTableRow.update(wa,t.value.base_id??C.value.id,t.value.id,encodeURIComponent(Ot),xt),!mt){const yt=[...y.value].reduce((Qe,d)=>(Qe[d]=k.value.oldRow[d],Qe),{});I({redo:{fn:async(Qe,d)=>{await r.dbTableRow.update(wa,C.value.id,t.value.id,encodeURIComponent(Qe),d),await ze(),j==null||j.trigger()},args:[Ot,M(xt)]},undo:{fn:async(Qe,d)=>{await r.dbTableRow.update(wa,C.value.id,t.value.id,encodeURIComponent(Qe),d),await ze(),j==null||j.trigger()},args:[Ot,M(yt)]},scope:A({view:F.value})})}p.value&&await Promise.all([ae()])}else{Zt.info(u("msg.info.noColumnsToUpdate"));return}}return((lt=F.value)==null?void 0:lt.type)===Ul.KANBAN&&Dt&&Dt(k.value,ct),y.value=new Set,a("a:row-expand:add"),Rt},Et=()=>{y.value=new Set},_e=async(tt,mt=!1,Dt=!1)=>{var nt,rt,st,lt,xt,Ot,yt,Qe;if((rt=(nt=k==null?void 0:k.value)==null?void 0:nt.rowMeta)!=null&&rt.new||c.value||!((st=t.value)!=null&&st.id))return;const Rt=tt??Ht(k.value.row,t.value.columns);if(!Rt)return;let ct={};try{ct=await r.dbTableRow.read(wa,(((lt=t.value)==null?void 0:lt.base_id)??((xt=C==null?void 0:C.value)==null?void 0:xt.id))||((yt=(Ot=S.value)==null?void 0:Ot.view)==null?void 0:yt.base_id),t.value.id,encodeURIComponent(Rt),{getHiddenColumn:!0})}catch(d){if(((Qe=d.response)==null?void 0:Qe.status)===404){const _=cs();Zt.error(u("msg.noRecordFound")),_.replace({query:{}})}else Zt.error(`${await hl(d)}`)}try{mt&&(ct={...k.value.row,...(t.value.columns??[]).reduce((d,_)=>(_o(_)&&_.title&&_.title in ct&&(d[_.title]=ct[_.title]),d),{})}),Dt&&(ct=Object.keys(ct).reduce((d,_)=>(Object.prototype.hasOwnProperty.call(k.value.row,_)?d[_]=k.value.row[_]:d[_]=ct[_],d),{})),Object.assign(k.value,{row:ct,oldRow:{...ct},rowMeta:{...k.value.rowMeta}})}catch{Zt.error(`${u("msg.error.errorLoadingRecord")}`)}},yn=async tt=>{var mt;try{const Dt=tt??Ht(k.value.row,t.value.columns),Rt=await r.dbTableRow.delete(wa,((mt=t.value)==null?void 0:mt.base_id)??C.value.id,t.value.id,encodeURIComponent(Dt));if(Rt.message)return Zt.info(`Record delete failed: ${`Unable to delete record with ID ${tt} because of the following:
              
${Rt.message.join(`
`)}.

              Clear the data first & try again`})}`),!1}catch(Dt){Zt.error(`${u("msg.error.deleteFailed")}: ${await hl(Dt)}`)}},It=ue(()=>{var mt,Dt,Rt;const tt=[];try{const ct=JSON.parse(JSON.stringify(f.value));for(const nt of ct){if(nt.op_type!=="DATA_UPDATE"){tt.push(nt);continue}const rt=JSON.parse(nt.details);for(const st of Object.keys(rt.data||{})){if(!((mt=rt.column_meta)!=null&&mt[st])){delete rt.data[st],delete rt.old_data[st],delete rt.column_meta[st];continue}if(["CreatedTime","CreatedBy","LastModifiedTime","LastModifiedBy"].includes((Rt=(Dt=rt.column_meta)==null?void 0:Dt[st])==null?void 0:Rt.type)){delete rt.data[st],delete rt.old_data[st],delete rt.column_meta[st];continue}}Object.values(rt.column_meta||{}).length>0&&(nt.details=JSON.stringify(rt),tt.push(nt))}}catch(ct){console.error(ct)}return tt}),$t=ue(()=>{var Dt,Rt,ct,nt,rt,st,lt,xt,Ot;const tt=[],mt=(yt,Qe,d,_)=>{yt.consolidated_ref_display_values_links||(yt.consolidated_ref_display_values_links=[]),yt.consolidated_ref_display_values_unlinks||(yt.consolidated_ref_display_values_unlinks=[]),_==="link"?yt.consolidated_ref_display_values_unlinks.find(O=>O.refRowId===Qe)?yt.consolidated_ref_display_values_unlinks.splice(yt.consolidated_ref_display_values_unlinks.findIndex(O=>O.refRowId===Qe),1):yt.consolidated_ref_display_values_links.find(O=>O.refRowId===Qe)||yt.consolidated_ref_display_values_links.push({refRowId:Qe,value:d}):yt.consolidated_ref_display_values_links.find(O=>O.refRowId===Qe)?yt.consolidated_ref_display_values_links.splice(yt.consolidated_ref_display_values_links.findIndex(O=>O.refRowId===Qe),1):yt.consolidated_ref_display_values_unlinks.find(O=>O.refRowId===Qe)||yt.consolidated_ref_display_values_unlinks.push({refRowId:Qe,value:d})};try{const yt=JSON.parse(JSON.stringify(It.value));for(;yt.length>0;){const Qe=yt.shift();if(Qe.op_type==="DATA_LINK"||Qe.op_type==="DATA_UNLINK"){const d=tt.findLast(O=>O.op_type==="DATA_LINK"||O.op_type==="DATA_UNLINK"),_=JSON.parse(Qe.details);if(!d)mt(_,_.ref_row_id,_.ref_display_value,Qe.op_type==="DATA_LINK"?"link":"unlink"),Qe.details=JSON.stringify(_),tt.push(Qe);else{const O=JSON.parse(d.details);d.user===Qe.user&&il(Qe.created_at).diff(il(d.created_at),"second")<=30&&O.link_field_id===_.link_field_id&&O.ref_table_title===_.ref_table_title?(mt(O,_.ref_row_id,_.ref_display_value,Qe.op_type==="DATA_LINK"?"link":"unlink"),((Dt=O.consolidated_ref_display_values_links)==null?void 0:Dt.length)>0||(Rt=O.consolidated_ref_display_values_unlinks)!=null&&Rt.length?d.details=JSON.stringify(O):tt.pop()):(mt(_,_.ref_row_id,_.ref_display_value,Qe.op_type==="DATA_LINK"?"link":"unlink"),Qe.details=JSON.stringify(_),tt.push(Qe))}}else if(Qe.op_type==="DATA_UPDATE"){const d=tt.findLast(T=>T.op_type==="DATA_UPDATE");if(!d||d.user!==Qe.user||il(Qe.created_at).diff(il(d.created_at),"second")>30){tt.push(Qe);continue}const _=JSON.parse(Qe.details),O=JSON.parse(d.details);for(const T of Object.values(_.column_meta??{}))if(["MultiSelect","SingleSelect"].includes(T.type)&&((ct=O==null?void 0:O.column_meta)!=null&&ct[T==null?void 0:T.title])){O.data[T.title]=_.data[T.title];for(const se of((rt=(nt=_.column_meta[T.title])==null?void 0:nt.options)==null?void 0:rt.choices)??[])(st=O.column_meta[T.title])!=null&&st.options.choices.find(q=>q.id===se.id)||O.column_meta[T.title].options.choices.push(se);d.details=JSON.stringify(O),delete _.old_data[T.title],delete _.data[T.title],delete _.column_meta[T.title],Qe.details=JSON.stringify(_)}else(lt=O==null?void 0:O.column_meta)!=null&&lt[T==null?void 0:T.title]&&O.old_data[T.title]?(O.data[T.title]=_.data[T.title],d.details=JSON.stringify(O),delete _.old_data[T.title],delete _.data[T.title],delete _.column_meta[T.title],Qe.details=JSON.stringify(_)):(xt=_==null?void 0:_.column_meta)!=null&&xt[T==null?void 0:T.title]&&!((Ot=O==null?void 0:O.column_meta)!=null&&Ot[T==null?void 0:T.title])&&(O.column_meta||(O.column_meta={}),O.old_data||(O.old_data={}),O.data||(O.data={}),O.column_meta[T.title]=_.column_meta[T.title],O.old_data[T.title]=_.old_data[T.title],O.data[T.title]=_.data[T.title],d.details=JSON.stringify(O),delete _.old_data[T.title],delete _.data[T.title],delete _.column_meta[T.title],Qe.details=JSON.stringify(_));Object.values(_.column_meta).length>0&&tt.push(Qe)}else tt.push(Qe)}}catch(yt){console.error(yt)}return tt}),et=ue(()=>{const tt=[...$t.value].map(Rt=>({user:Rt.user,displayName:Rt.created_display_name,created_at:Rt.created_at,type:"audit",audit:Rt})),mt=[...N.value].map(Rt=>({...Rt,user:Rt.created_by_email,displayName:Rt.created_display_name,type:"comment"}));return[...tt,...mt].sort((Rt,ct)=>il(Rt.created_at).isBefore(il(ct.created_at))?-1:1)}),cn=op(async()=>{var tt,mt,Dt;if(((tt=t.value)==null?void 0:tt.base_id)!==((mt=C.value)==null?void 0:mt.id))return await w.getBaseRoles((Dt=t.value)==null?void 0:Dt.base_id,{skipUpdatingUser:!0})}),Pn=V(null);return Gn(t,(tt,mt)=>{if(tt!=null&&tt.fk_workspace_id&&(tt!=null&&tt.base_id)&&(tt!=null&&tt.id)){if(mt!=null&&mt.id&&mt.id===tt.id)return;Pn.value&&s.offMessage(Pn.value),Pn.value=`${lp.DATA_EVENT}:${tt.fk_workspace_id}:${tt.base_id}:${tt.id}`,s.subscribe(Pn.value),s.onMessage(Pn.value,Dt=>{var st;const{id:Rt,action:ct,payload:nt}=Dt,rt=Ht(k.value.row,(st=t.value)==null?void 0:st.columns);if(`${Rt}`===rt&&ct==="update")try{if(nt){const lt={...k.value.row,...nt};for(const xt of y.value)Object.prototype.hasOwnProperty.call(k.value.row,xt)&&(lt[xt]=k.value.row[xt],k.value.row[xt],nt[xt]);Object.assign(k.value,{row:lt,oldRow:{...lt}})}else console.warn("No payload provided for update action")}catch(lt){console.error("Failed to update cached row on socket event",lt)}})}},{immediate:!0}),{...D,loadComments:ae,deleteComment:ye,loadAudits:ie,comments:N,audits:f,isAuditLoading:v,clearColumns:Et,auditCommentGroups:et,consolidatedAudits:$t,hasMoreAudits:Q,loadMoreAudits:Be,resetAuditPages:it,resolveComment:Y,isCommentsLoading:me,saveComment:re,isYou:Ge,commentsDrawer:p,row:k,deleteRowById:yn,displayValue:ot,save:Z,changedColumns:y,localOnlyChanges:x,loadRow:_e,primaryKey:Ce,saveRowAndStay:g,updateComment:he,baseRoles:cn,fieldsFromParent:ne,fields:be,hiddenFields:ee,isAllowedAddNewRecord:je,getIsAllowedEditField:Ue,meta:t}},"expanded-form-store");function $i(){const t=Gm();if(t==null)throw new Error("Please call `useExpandedFormStore` on the appropriate parent component");return t}const Hm={key:0,class:"tab-wrapper flex flex-row rounded-lg border-1 border-nc-border-gray-medium bg-nc-bg-default h-7 overflow-hidden"},Ym=["onClick"],qm={key:0,class:"tab-title nc-tab"},Xm=xo({__name:"ViewModeSelector",props:rp({view:{}},{modelValue:{},modelModifiers:{}}),emits:["update:modelValue"],setup(t){const n=t,o=sp(t,"modelValue");wl(),dn(zl,V(!1));const{isSqlView:l}=Fl(),{isNew:a,commentsDrawer:i,baseRoles:r}=$i(),s=yr(),u=ue(()=>Wi),c=ue(()=>[{icon:"menu",value:kl.FIELD,tooltip:"Fields"},{icon:o.value===kl.ATTACHMENT?"ncFileTextSolid":"ncFileText",value:kl.ATTACHMENT,tooltip:"File Preview"},{icon:o.value===kl.DISCUSSION?"ncMessageSquare1Solid":"ncMessageSquare1Outline",value:kl.DISCUSSION,tooltip:"Discussion",hidden:l.value}].filter(f=>!f.hidden));return oi(()=>{var f;if(!u.value&&o.value!==kl.FIELD){if(o.value=kl.FIELD,!((f=n.view)!=null&&f.id))return;s.setCurrentViewExpandedFormMode(n.view.id,kl.FIELD)}}),(f,v)=>{const p=Sl,g=Aa,y=Yl("e");return e(u)?(h(),B("div",Hm,[(h(!0),B(Qt,null,po(e(c),(x,w)=>(h(),J(g,{key:x.value,disabled:!x.tooltip},{title:K(()=>[Je(ce(x.tooltip),1)]),default:K(()=>[Nt((h(),B("div",{class:Gt(["tab",[`nc-tab-${o.value}`,{active:o.value===x.value,"first-tab":w===0,"last-tab":w===e(c).length-1}]]),onClick:m=>o.value=x.value},[le(p,{icon:x.icon,class:"tab-icon"},null,8,["icon"]),x.title?(h(),B("div",qm,ce(f.$t(x.title)),1)):ge("",!0)],10,Ym)),[[y,[`c:project:mode:${x.value}`]]])]),_:2},1032,["disabled"]))),128))])):ge("",!0)}}}),Km=Object.assign(Ol(Xm,[["__scopeId","data-v-fc5d13ab"]]),{__name:"SmartsheetExpandedFormViewModeSelector"}),Jm=ko(()=>Co(()=>import("./CfTpfQ4B.js"),__vite__mapDeps([0,1,2,3,4]),import.meta.url).then(t=>t.default||t)),Qm=ko(()=>Co(()=>import("./CDTi0oRk.js"),__vite__mapDeps([5,1,2,3,6]),import.meta.url).then(t=>t.default||t)),Zm=ko(()=>Co(()=>import("./BALLsGq5.js").then(t=>t.V),__vite__mapDeps([7,1,2,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,3,26,27,28,29,30,31,32,33,34,35]),import.meta.url).then(t=>t.default||t)),eg=ko(()=>Co(()=>import("./B1qoNiTF.js").then(t=>t.C),__vite__mapDeps([36,1,2,12,13,37,38,39,28,23,22,26,27,40]),import.meta.url).then(t=>t.default||t)),tg=["col-id","data-testid"],ng=["onClick"],og=xo({__name:"ColumnList",props:{fields:{},forceVerticalMode:{type:Boolean},isLoading:{type:Boolean},showColCallback:{type:Function},isHiddenCol:{type:Boolean}},setup(t){const n=t,{changedColumns:o,localOnlyChanges:l,isNew:a,loadRow:i,row:r}=$i(),{isSqlView:s}=Fl(),u=dn(zl,V(!1)),{isUIAllowed:c}=wl(),f=ue(()=>!c("dataEdit")||u.value||s.value),v=g=>{var y;return((y=n.showColCallback)==null?void 0:y.call(n,g))||!_o(g)||!a.value||ml(g)},p=g=>{l.value[g]&&(r.value.row[g]=l.value[g],o.value.delete(g),delete l.value[g])};return(g,y)=>{const x=Jm,w=Qm,m=ov,C=Zm,b=eg,S=cm,k=Sr,D=Aa,F=Sl;return h(!0),B(Qt,null,po(g.fields,I=>Nt((h(),B("div",{key:I.title,class:Gt([`nc-expand-col-${I.title}`,"nc-expanded-form-row w-full"]),"col-id":I.id,"data-testid":`nc-expand-col-${I.title}`},[z("div",{class:Gt(["flex items-start nc-expanded-cell min-h-[32px]",{"flex-row <lg:flex-col <lg:w-full":!n.forceVerticalMode,"flex-col w-full":n.forceVerticalMode}])},[z("div",{class:Gt(["flex-none flex items-center rounded-lg overflow-hidden",{"w-45 <lg:w-full <lg:px-0 <lg:mb-2 h-[32px] xs:h-auto sm:mx-2":!n.forceVerticalMode,"w-full px-0 mb-2 h-auto":n.forceVerticalMode}])},[e(_o)(I)?(h(),J(x,{key:0,column:I,class:"nc-expanded-cell-header h-full flex-none","is-hidden-col":g.isHiddenCol,"show-lock-icon":""},null,8,["column","is-hidden-col"])):(h(),J(w,{key:1,column:I,class:"nc-expanded-cell-header flex-none","is-hidden-col":g.isHiddenCol,"show-lock-icon":""},null,8,["column","is-hidden-col"]))],2),g.isLoading?(h(),J(m,{key:0,active:"",class:"h-8 flex-none <lg:!w-full lg:flex-1 !rounded-lg !overflow-hidden",size:"small"})):(h(),J(D,{key:1,"tooltip-style":{zIndex:"1049"},class:Gt(["!<lg:w-full !<lg:flex-none lg:flex-1 flex",{"w-full !flex-none":n.forceVerticalMode,"lg:max-w-[calc(100%_-_188px)]":!n.forceVerticalMode}]),placement:"right",disabled:!("showReadonlyColumnTooltip"in g?g.showReadonlyColumnTooltip:e(Qr))(I),arrow:!1},{title:K(()=>[Je(ce(g.$t("msg.info.fieldReadonly")),1)]),default:K(()=>[I.title?(h(),J(k,{key:0,class:"w-full","tooltip-style":{zIndex:"1049"},entity:e(pl).FIELD,"entity-id":I.id,permission:e(vl).RECORD_FIELD_EDIT,placement:"right","show-pointer-event-none":!1,"hide-on-click":"",disabled:("showReadonlyColumnTooltip"in g?g.showReadonlyColumnTooltip:e(Qr))(I)||!("showEditRestrictedColumnTooltip"in g?g.showEditRestrictedColumnTooltip:e(pf))(I)},{default:K(({isAllowed:M})=>[le(S,{class:Gt(["flex-1 bg-nc-bg-default px-1 min-h-8 flex items-center relative",{"w-full":n.forceVerticalMode,"!select-text nc-system-field !bg-nc-bg-gray-extralight !text-nc-content-inverted-primary-disabled cursor-pointer":("showReadonlyColumnTooltip"in g?g.showReadonlyColumnTooltip:e(Qr))(I),"!select-text nc-readonly-div-data-cell":e(f)||!M}])},{default:K(()=>[e(_o)(I)?(h(),J(C,{key:0,modelValue:e(r).row[I.title],"onUpdate:modelValue":A=>e(r).row[I.title]=A,column:I,"read-only":e(f)||!M,row:e(r),"is-allowed":M},null,8,["modelValue","onUpdate:modelValue","column","read-only","row","is-allowed"])):(h(),J(b,{key:1,modelValue:e(r).row[I.title],"onUpdate:modelValue":[A=>e(r).row[I.title]=A,A=>e(o).add(I.title)],active:!0,column:I,"edit-enabled":!0,"read-only":("ncIsPlaywright"in g?g.ncIsPlaywright:e(hf))()?e(f)||!M:e(f)||!M||("showReadonlyColumnTooltip"in g?g.showReadonlyColumnTooltip:e(Qr))(I),"is-allowed":M},null,8,["modelValue","onUpdate:modelValue","column","read-only","is-allowed"]))]),_:2},1032,["class"])]),_:2},1032,["entity","entity-id","permission","disabled"])):ge("",!0)]),_:2},1032,["class","disabled"])),I.title&&e(l)[I.title]?(h(),B("div",{key:2,class:"flex h-full items-center justify-center cursor-pointer relative",onClick:M=>p(I.title)},[le(F,{class:"absolute right-0 top-0 text-nc-content-gray-muted hover:text-nc-content-gray-subtle my-auto",icon:"reload"})],8,ng)):ge("",!0)],2)],10,tg)),[[ya,v(I)]])),128)}}}),lg=Object.assign(Ol(og,[["__scopeId","data-v-72f73771"]]),{__name:"SmartsheetExpandedFormPresentorsFieldsColumnList"}),ag={ref:"expandedFormScrollWrapper",class:"flex flex-col flex-grow gap-5 h-full max-h-full nc-scrollbar-thin items-center w-full p-4 xs:px-4 xs:pt-4 xs:pb-2 xs:gap-6 children:max-w-[588px] <lg:children:max-w-[450px]"},ig={key:0,class:"flex w-full <lg:px-1 items-center py-6"},rg=xo({__name:"Columns",props:{fields:{},hiddenFields:{},isLoading:{type:Boolean},forceVerticalMode:{type:Boolean}},setup(t){const o=Nn(t,"isLoading"),{loadRow:l,row:a}=$i(),{isMobileMode:i}=tl(),r=V(!1);return(s,u)=>{const c=lg,f=Sl,v=da;return h(),B("div",ag,[le(c,{fields:s.fields,"force-vertical-mode":s.forceVerticalMode,"is-loading":e(o)},null,8,["fields","force-vertical-mode","is-loading"]),s.hiddenFields.length>0?(h(),B("div",ig,[u[1]||(u[1]=z("div",{class:"flex-grow h-px mr-1 bg-nc-bg-gray-light"},null,-1)),le(v,{size:e(i)?"medium":"small",class:"flex-shrink !text-sm overflow-hidden !text-nc-content-gray-muted !font-weight-500",type:"secondary",onClick:u[0]||(u[0]=p=>r.value=!e(r))},{default:K(()=>[Je(ce(e(r)?`Hide ${s.hiddenFields.length} hidden`:`Show ${s.hiddenFields.length} hidden`)+" "+ce(s.hiddenFields.length>1?"fields":"field")+" ",1),le(f,{icon:"chevronDown",class:Gt([e(r)?"transform rotate-180":"","ml-1"])},null,8,["class"])]),_:1},8,["size"]),u[2]||(u[2]=z("div",{class:"flex-grow h-px ml-1 bg-nc-bg-gray-light"},null,-1))])):ge("",!0),s.hiddenFields.length>0&&e(r)?(h(),J(c,{key:1,fields:s.hiddenFields,"is-hidden-col":"","force-vertical-mode":s.forceVerticalMode,"is-loading":e(o),"show-col-callback":p=>("isFormula"in s?s.isFormula:e(mf))(p)},null,8,["fields","force-vertical-mode","is-loading","show-col-callback"])):ge("",!0)],512)}}}),uv=Object.assign(rg,{__name:"SmartsheetExpandedFormPresentorsFieldsColumns"}),sg=xo({__name:"MiniColumnsWrapper",setup(t){const{fields:n,hiddenFields:o}=$i();return(l,a)=>{const i=uv;return h(),J(i,{fields:e(n),"hidden-fields":e(o),"is-loading":!1,"force-vertical-mode":"",class:"mini-columns-wrapper"},null,8,["fields","hidden-fields"])}}}),dv=Object.assign(sg,{__name:"SmartsheetExpandedFormPresentorsFieldsMiniColumnsWrapper"});function Xa(){}Xa.prototype={diff:function(n,o){var l,a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},i=a.callback;typeof a=="function"&&(i=a,a={});var r=this;function s(S){return S=r.postProcess(S,a),i?(setTimeout(function(){i(S)},0),!0):S}n=this.castInput(n,a),o=this.castInput(o,a),n=this.removeEmpty(this.tokenize(n,a)),o=this.removeEmpty(this.tokenize(o,a));var u=o.length,c=n.length,f=1,v=u+c;a.maxEditLength!=null&&(v=Math.min(v,a.maxEditLength));var p=(l=a.timeout)!==null&&l!==void 0?l:1/0,g=Date.now()+p,y=[{oldPos:-1,lastComponent:void 0}],x=this.extractCommon(y[0],o,n,0,a);if(y[0].oldPos+1>=c&&x+1>=u)return s(wc(r,y[0].lastComponent,o,n,r.useLongestToken));var w=-1/0,m=1/0;function C(){for(var S=Math.max(w,-f);S<=Math.min(m,f);S+=2){var k=void 0,D=y[S-1],F=y[S+1];D&&(y[S-1]=void 0);var I=!1;if(F){var M=F.oldPos-S;I=F&&0<=M&&M<u}var A=D&&D.oldPos+1<c;if(!I&&!A){y[S]=void 0;continue}if(!A||I&&D.oldPos<F.oldPos?k=r.addToPath(F,!0,!1,0,a):k=r.addToPath(D,!1,!0,1,a),x=r.extractCommon(k,o,n,S,a),k.oldPos+1>=c&&x+1>=u)return s(wc(r,k.lastComponent,o,n,r.useLongestToken));y[S]=k,k.oldPos+1>=c&&(m=Math.min(m,S-1)),x+1>=u&&(w=Math.max(w,S+1))}f++}if(i)(function S(){setTimeout(function(){if(f>v||Date.now()>g)return i();C()||S()},0)})();else for(;f<=v&&Date.now()<=g;){var b=C();if(b)return b}},addToPath:function(n,o,l,a,i){var r=n.lastComponent;return r&&!i.oneChangePerToken&&r.added===o&&r.removed===l?{oldPos:n.oldPos+a,lastComponent:{count:r.count+1,added:o,removed:l,previousComponent:r.previousComponent}}:{oldPos:n.oldPos+a,lastComponent:{count:1,added:o,removed:l,previousComponent:r}}},extractCommon:function(n,o,l,a,i){for(var r=o.length,s=l.length,u=n.oldPos,c=u-a,f=0;c+1<r&&u+1<s&&this.equals(l[u+1],o[c+1],i);)c++,u++,f++,i.oneChangePerToken&&(n.lastComponent={count:1,previousComponent:n.lastComponent,added:!1,removed:!1});return f&&!i.oneChangePerToken&&(n.lastComponent={count:f,previousComponent:n.lastComponent,added:!1,removed:!1}),n.oldPos=u,c},equals:function(n,o,l){return l.comparator?l.comparator(n,o):n===o||l.ignoreCase&&n.toLowerCase()===o.toLowerCase()},removeEmpty:function(n){for(var o=[],l=0;l<n.length;l++)n[l]&&o.push(n[l]);return o},castInput:function(n){return n},tokenize:function(n){return Array.from(n)},join:function(n){return n.join("")},postProcess:function(n){return n}};function wc(t,n,o,l,a){for(var i=[],r;n;)i.push(n),r=n.previousComponent,delete n.previousComponent,n=r;i.reverse();for(var s=0,u=i.length,c=0,f=0;s<u;s++){var v=i[s];if(v.removed)v.value=t.join(l.slice(f,f+v.count)),f+=v.count;else{if(!v.added&&a){var p=o.slice(c,c+v.count);p=p.map(function(g,y){var x=l[f+y];return x.length>g.length?x:g}),v.value=t.join(p)}else v.value=t.join(o.slice(c,c+v.count));c+=v.count,v.added||(f+=v.count)}}return i}function yc(t,n){var o;for(o=0;o<t.length&&o<n.length;o++)if(t[o]!=n[o])return t.slice(0,o);return t.slice(0,o)}function bc(t,n){var o;if(!t||!n||t[t.length-1]!=n[n.length-1])return"";for(o=0;o<t.length&&o<n.length;o++)if(t[t.length-(o+1)]!=n[n.length-(o+1)])return t.slice(-o);return t.slice(-o)}function Tu(t,n,o){if(t.slice(0,n.length)!=n)throw Error("string ".concat(JSON.stringify(t)," doesn't start with prefix ").concat(JSON.stringify(n),"; this is a bug"));return o+t.slice(n.length)}function $u(t,n,o){if(!n)return t+o;if(t.slice(-n.length)!=n)throw Error("string ".concat(JSON.stringify(t)," doesn't end with suffix ").concat(JSON.stringify(n),"; this is a bug"));return t.slice(0,-n.length)+o}function Hr(t,n){return Tu(t,n,"")}function ys(t,n){return $u(t,n,"")}function _c(t,n){return n.slice(0,ug(t,n))}function ug(t,n){var o=0;t.length>n.length&&(o=t.length-n.length);var l=n.length;t.length<n.length&&(l=t.length);var a=Array(l),i=0;a[0]=0;for(var r=1;r<l;r++){for(n[r]==n[i]?a[r]=a[i]:a[r]=i;i>0&&n[r]!=n[i];)i=a[i];n[r]==n[i]&&i++}i=0;for(var s=o;s<t.length;s++){for(;i>0&&t[s]!=n[i];)i=a[i];t[s]==n[i]&&i++}return i}var Ws="a-zA-Z0-9_\\u{C0}-\\u{FF}\\u{D8}-\\u{F6}\\u{F8}-\\u{2C6}\\u{2C8}-\\u{2D7}\\u{2DE}-\\u{2FF}\\u{1E00}-\\u{1EFF}",dg=new RegExp("[".concat(Ws,"]+|\\s+|[^").concat(Ws,"]"),"ug"),ps=new Xa;ps.equals=function(t,n,o){return o.ignoreCase&&(t=t.toLowerCase(),n=n.toLowerCase()),t.trim()===n.trim()};ps.tokenize=function(t){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},o;if(n.intlSegmenter){if(n.intlSegmenter.resolvedOptions().granularity!="word")throw new Error('The segmenter passed must have a granularity of "word"');o=Array.from(n.intlSegmenter.segment(t),function(i){return i.segment})}else o=t.match(dg)||[];var l=[],a=null;return o.forEach(function(i){/\s/.test(i)?a==null?l.push(i):l.push(l.pop()+i):/\s/.test(a)?l[l.length-1]==a?l.push(l.pop()+i):l.push(a+i):l.push(i),a=i}),l};ps.join=function(t){return t.map(function(n,o){return o==0?n:n.replace(/^\s+/,"")}).join("")};ps.postProcess=function(t,n){if(!t||n.oneChangePerToken)return t;var o=null,l=null,a=null;return t.forEach(function(i){i.added?l=i:i.removed?a=i:((l||a)&&xc(o,a,l,i),o=i,l=null,a=null)}),(l||a)&&xc(o,a,l,null),t};function cg(t,n,o){return ps.diff(t,n,o)}function xc(t,n,o,l){if(n&&o){var a=n.value.match(/^\s*/)[0],i=n.value.match(/\s*$/)[0],r=o.value.match(/^\s*/)[0],s=o.value.match(/\s*$/)[0];if(t){var u=yc(a,r);t.value=$u(t.value,r,u),n.value=Hr(n.value,u),o.value=Hr(o.value,u)}if(l){var c=bc(i,s);l.value=Tu(l.value,s,c),n.value=ys(n.value,c),o.value=ys(o.value,c)}}else if(o)t&&(o.value=o.value.replace(/^\s*/,"")),l&&(l.value=l.value.replace(/^\s*/,""));else if(t&&l){var f=l.value.match(/^\s*/)[0],v=n.value.match(/^\s*/)[0],p=n.value.match(/\s*$/)[0],g=yc(f,v);n.value=Hr(n.value,g);var y=bc(Hr(f,g),p);n.value=ys(n.value,y),l.value=Tu(l.value,f,y),t.value=$u(t.value,f,f.slice(0,f.length-y.length))}else if(l){var x=l.value.match(/^\s*/)[0],w=n.value.match(/\s*$/)[0],m=_c(w,x);n.value=ys(n.value,m)}else if(t){var C=t.value.match(/\s*$/)[0],b=n.value.match(/^\s*/)[0],S=_c(C,b);n.value=Hr(n.value,S)}}var fg=new Xa;fg.tokenize=function(t){var n=new RegExp("(\\r?\\n)|[".concat(Ws,"]+|[^\\S\\n\\r]+|[^").concat(Ws,"]"),"ug");return t.match(n)||[]};var rd=new Xa;rd.tokenize=function(t,n){n.stripTrailingCr&&(t=t.replace(/\r\n/g,`
`));var o=[],l=t.split(/(\n|\r\n)/);l[l.length-1]||l.pop();for(var a=0;a<l.length;a++){var i=l[a];a%2&&!n.newlineIsToken?o[o.length-1]+=i:o.push(i)}return o};rd.equals=function(t,n,o){return o.ignoreWhitespace?((!o.newlineIsToken||!t.includes(`
`))&&(t=t.trim()),(!o.newlineIsToken||!n.includes(`
`))&&(n=n.trim())):o.ignoreNewlineAtEof&&!o.newlineIsToken&&(t.endsWith(`
`)&&(t=t.slice(0,-1)),n.endsWith(`
`)&&(n=n.slice(0,-1))),Xa.prototype.equals.call(this,t,n,o)};var vg=new Xa;vg.tokenize=function(t){return t.split(/(\S.+?[.!?])(?=\s+|$)/)};var pg=new Xa;pg.tokenize=function(t){return t.split(/([{}:;,]|\s+)/)};function Ou(t){"@babel/helpers - typeof";return Ou=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},Ou(t)}var ss=new Xa;ss.useLongestToken=!0;ss.tokenize=rd.tokenize;ss.castInput=function(t,n){var o=n.undefinedReplacement,l=n.stringifyReplacer,a=l===void 0?function(i,r){return typeof r>"u"?o:r}:l;return typeof t=="string"?t:JSON.stringify(Du(t,null,null,a),a,"  ")};ss.equals=function(t,n,o){return Xa.prototype.equals.call(ss,t.replace(/,([\r\n])/g,"$1"),n.replace(/,([\r\n])/g,"$1"),o)};function Du(t,n,o,l,a){n=n||[],o=o||[],l&&(t=l(a,t));var i;for(i=0;i<n.length;i+=1)if(n[i]===t)return o[i];var r;if(Object.prototype.toString.call(t)==="[object Array]"){for(n.push(t),r=new Array(t.length),o.push(r),i=0;i<t.length;i+=1)r[i]=Du(t[i],n,o,l,a);return n.pop(),o.pop(),r}if(t&&t.toJSON&&(t=t.toJSON()),Ou(t)==="object"&&t!==null){n.push(t),r={},o.push(r);var s=[],u;for(u in t)Object.prototype.hasOwnProperty.call(t,u)&&s.push(u);for(s.sort(),i=0;i<s.length;i+=1)u=s[i],r[u]=Du(t[u],n,o,l,u);n.pop(),o.pop()}else r=t;return r}var Lu=new Xa;Lu.tokenize=function(t){return t.slice()};Lu.join=Lu.removeEmpty=function(t){return t};const os=(t,n)=>cg(t,n).map(o=>({text:o.value,op:o.added?"added":o.removed?"removed":"unchanged"})),hg=ko(()=>Co(()=>import("./DRA9KN5F.js").then(t=>t.oR),__vite__mapDeps([1,2]),import.meta.url).then(t=>t.default||t)),mg={class:"flex items-center gap-1 !text-nc-content-gray-subtle2 text-xs font-weight-500 nc-audit-mini-item-header"},gg={class:"flex items-center gap-2 mt-3 flex-wrap"},wg={key:0,class:"border-1 border-nc-border-red rounded-md bg-nc-bg-red-light w-full p-0.5"},yg={class:"flex flex-col items-start gap-0.5"},bg={class:"flex items-center gap-2 w-full"},_g={class:"flex items-center justify-center w-8 aspect-square"},xg={key:1,class:"nc-attachment flex items-center justify-center"},kg={class:"w-0 flex-1 truncate text-small1 font-weight-500 text-nc-content-gray-subtle2"},Cg={class:"text-xs font-weight-500 p-2 text-nc-content-gray-muted"},Rg={key:1,class:"border-1 border-nc-border-green rounded-md bg-nc-bg-green-light w-full p-0.5"},Sg={class:"flex flex-col items-start gap-0.5"},Ig={class:"flex items-center gap-2 w-full"},Fg={class:"flex items-center justify-center w-8 aspect-square"},Ag={key:1,class:"nc-attachment flex items-center justify-center"},Eg={class:"w-0 flex-1 truncate text-small1 font-weight-500 text-nc-content-gray-subtle2"},Mg={class:"text-xs font-weight-500 p-2 text-nc-content-gray-muted"},Tg={key:0,class:"text-small1 text-nc-content-red-dark border-1 border-nc-red-200 rounded-md px-1 bg-nc-bg-red-light line-through break-all"},$g={key:1,class:"text-small1 text-nc-content-green-dark border-1 border-nc-green-200 rounded-md px-1 bg-nc-bg-green-light break-all"},Og={key:2,class:"w-full"},Dg={key:0,class:"max-w-full text-small1 text-nc-content-red-dark border-1 border-nc-red-200 rounded-md px-1 mr-1 bg-nc-bg-red-light line-through decoration-clone"},Lg={key:1,class:"max-w-full text-small1 text-nc-content-green-dark border-1 border-nc-green-200 rounded-md px-1 mr-1 bg-nc-bg-green-light decoration-clone"},Ng={key:2},Pg={key:3,class:"w-full"},Bg={key:4,class:"overflow-x-auto nc-scrollbar-thin whitespace-nowrap"},Wg={key:0,class:"text-small1 text-nc-content-red-dark border-1 border-nc-red-200 rounded-md px-1 bg-nc-bg-red-light line-through decoration-clone inline"},zg={key:1,class:"text-small1 text-nc-content-green-dark border-1 border-nc-green-200 rounded-md px-1 bg-nc-bg-green-light decoration-clone inline"},Vg={key:2,class:"inline text-small1"},jg=xo({__name:"AuditMiniItem",props:{audit:{}},setup(t){const n=t,o=ue(()=>{try{return JSON.parse(n.audit.details||"")}catch{return{}}}),l=ue(()=>o.value.old_data??{}),a=ue(()=>o.value.data??{}),i=ue(()=>o.value.column_meta??{}),r=ue(()=>Object.keys(a.value));wo(gf,V(!0));const{getPossibleAttachmentSrc:s}=Ri();function u(m){var C,b,S,k,D;return{...((b=(C=i.value)==null?void 0:C[m])==null?void 0:b.options)??{},options:(D=(k=(S=i.value)==null?void 0:S[m])==null?void 0:k.options)==null?void 0:D.choices}}function c(m){var k,D;const C=((k=i.value)==null?void 0:k[m])??{},b=u(m),S=b.icon||(C.type==="Rating"?"star":"circle-check");return{...b,...C,icon:C.type==="Rating"?bf[S]:_f[S],duration:b.duration_format?(D=yf.find(F=>F.title===b.duration_format))==null?void 0:D.id:void 0,is12hrFormat:b["12hr_format"],isLocaleString:b.locale_string,isDisplayTimezone:(b==null?void 0:b.isDisplayTimezone)||(b==null?void 0:b.is_display_timezone),useSameTimezoneForAll:(b==null?void 0:b.useSameTimezoneForAll)||(b==null?void 0:b.use_same_timezone_for_all)}}function f(m){var S,k,D,F,I;const C=l.value[m],b=a.value[m];return((k=(S=i.value)==null?void 0:S[m])==null?void 0:k.type)==="Attachment"?C==null?void 0:C.filter(M=>!(b!=null&&b.some(A=>A.title===M.title))):((F=(D=i.value)==null?void 0:D[m])==null?void 0:F.type)==="MultiSelect"?((I=C==null?void 0:C.filter)==null?void 0:I.call(C,M=>{var A;return!((A=b==null?void 0:b.includes)!=null&&A.call(b,M))}))??C:C}function v(m){var S,k,D,F,I;const C=l.value[m],b=a.value[m];return((k=(S=i.value)==null?void 0:S[m])==null?void 0:k.type)==="Attachment"?b==null?void 0:b.filter(M=>!(C!=null&&C.some(A=>A.title===M.title))):((F=(D=i.value)==null?void 0:D[m])==null?void 0:F.type)==="MultiSelect"?((I=b==null?void 0:b.filter)==null?void 0:I.call(b,M=>{var A;return!((A=C==null?void 0:C.includes)!=null&&A.call(C,M))}))??b:b}function p(m){const C=l.value[m],b=a.value[m];return!C&&!b?[]:os(C?JSON.stringify(C,null,2):"",b?JSON.stringify(b,null,2):"")}function g(m){var C,b;return!["Checkbox","SingleSelect","MultiSelect"].includes((b=(C=i.value)==null?void 0:C[m])==null?void 0:b.type)&&!c(m).is_progress}function y(m){var C,b;return["SingleSelect","MultiSelect"].includes((b=(C=i.value)==null?void 0:C[m])==null?void 0:b.type)}function x(m){return![void 0,null,""].includes(m)}function w(m){var C,b;return["URL","PhoneNumber","Email"].includes((b=(C=i.value)==null?void 0:C[m])==null?void 0:b.type)}return(m,C)=>{const b=wf,S=Aa,k=hg,D=Zf,F=ld;return h(!0),B(Qt,null,po(e(r),I=>{var M,A,j,N,Y,ae,he,ye,re,me,W,U,Ae,je,Ue,ot,G,pe,ne,be;return h(),B("div",{key:I,class:"py-2 px-3"},[z("div",mg,[le(b,{"column-meta":{uidt:(M=e(i)[I])==null?void 0:M.type,dt:((A=e(i)[I])==null?void 0:A.type)==="Number"?"bigint":void 0},class:"!m-0"},null,8,["column-meta"]),le(S,{class:"truncate","show-on-truncate-only":""},{title:K(()=>[Je(ce(I),1)]),default:K(()=>[Je(" "+ce(I),1)]),_:2},1024)]),z("div",gg,[((j=e(i)[I])==null?void 0:j.type)==="Attachment"?(h(),B(Qt,{key:0},[((N=f(I))==null?void 0:N.length)>0?(h(),B("div",wg,[z("div",yg,[(h(!0),B(Qt,null,po(f(I),(ee,H)=>(h(),B("div",{key:ee.url||ee.title,class:"border-1 border-nc-border-gray-medium rounded-md bg-nc-bg-default w-full"},[z("div",bg,[z("div",_g,[("isImage"in m?m.isImage:e(Ls))(ee.title,ee.mimetype??ee.type)?(h(),J(k,{key:0,alt:ee.title||`#${H}`,class:"nc-attachment rounded !w-5.5 !h-5.5 object-cover overflow-hidden",srcs:e(s)(ee,"small")},null,8,["alt","srcs"])):(h(),B("div",xg,[le(D,{item:ee,class:"!w-8 !h-8"},null,8,["item"])]))]),z("span",kg,ce(ee.title),1),z("span",Cg,ce(("getReadableFileSize"in m?m.getReadableFileSize:e(Ns))(ee.size)),1)])]))),128))])])):ge("",!0),((Y=v(I))==null?void 0:Y.length)>0?(h(),B("div",Rg,[z("div",Sg,[(h(!0),B(Qt,null,po(v(I),(ee,H)=>(h(),B("div",{key:ee.url||ee.title,class:"border-1 border-nc-border-gray-medium rounded-md bg-nc-bg-default w-full"},[z("div",Ig,[z("div",Fg,[("isImage"in m?m.isImage:e(Ls))(ee.title,ee.mimetype??ee.type)?(h(),J(k,{key:0,alt:ee.title||`#${H}`,class:"nc-attachment rounded !w-5.5 !h-5.5 object-cover overflow-hidden",srcs:e(s)(ee,"small")},null,8,["alt","srcs"])):(h(),B("div",Ag,[le(D,{item:ee,class:"!w-8 !h-8"},null,8,["item"])]))]),z("span",Eg,ce(ee.title),1),z("span",Mg,ce(("getReadableFileSize"in m?m.getReadableFileSize:e(Ns))(ee.size)),1)])]))),128))])])):ge("",!0)],64)):w(I)?(h(),B(Qt,{key:1},[x(e(l)[I])?(h(),B("div",Tg,ce(e(l)[I]),1)):ge("",!0),x(e(a)[I])?(h(),B("div",$g,ce(e(a)[I]),1)):ge("",!0)],64)):((ae=e(i)[I])==null?void 0:ae.type)==="SingleLineText"?(h(),B("div",Og,[(h(!0),B(Qt,null,po(("diffTextBlocks"in m?m.diffTextBlocks:e(os))(e(l)[I]||"",e(a)[I]||""),(ee,H)=>(h(),B(Qt,{key:H},[ee.op==="removed"?(h(),B("span",Dg,ce(ee.text),1)):ee.op==="added"?(h(),B("span",Lg,ce(ee.text),1)):(h(),B("span",Ng,ce(ee.text),1))],64))),128))])):((he=e(i)[I])==null?void 0:he.type)==="LongText"?(h(),B("div",Pg,[(h(!0),B(Qt,null,po(("diffTextBlocks"in m?m.diffTextBlocks:e(os))(((ye=e(i)[I])==null?void 0:ye.type)==="LongText"&&((me=(re=e(i)[I])==null?void 0:re.options)!=null&&me.ai)?((W=e(l)[I])==null?void 0:W.value)||"":e(l)[I]||"",((U=e(i)[I])==null?void 0:U.type)==="LongText"&&((je=(Ae=e(i)[I])==null?void 0:Ae.options)!=null&&je.ai)?((Ue=e(a)[I])==null?void 0:Ue.value)||"":e(a)[I]||""),(ee,H)=>{var Ce,Ie,Q;return h(),B(Qt,{key:H},[ee.op==="removed"?(h(),B("span",{key:0,class:Gt(["max-w-full text-nc-content-red-dark px-1 bg-nc-bg-red-light rounded-md line-through decoration-clone !leading-[18px]",{"whitespace-pre-wrap":((Ce=e(i)[I])==null?void 0:Ce.type)==="LongText"}])},ce(ee.text),3)):ee.op==="added"?(h(),B("span",{key:1,class:Gt(["max-w-full text-nc-content-green-dark px-1 bg-nc-bg-green-light rounded-md decoration-clone !leading-[18px]",{"whitespace-pre-wrap":((Ie=e(i)[I])==null?void 0:Ie.type)==="LongText"}])},ce(ee.text),3)):(h(),B("span",{key:2,class:Gt(["max-w-full !leading-[18px]",{"whitespace-pre-wrap":((Q=e(i)[I])==null?void 0:Q.type)==="LongText"}])},ce(ee.text),3))],64)}),128))])):((ot=e(i)[I])==null?void 0:ot.type)==="JSON"?(h(),B("div",Bg,[(h(!0),B(Qt,null,po(p(I),(ee,H)=>(h(),B(Qt,{key:H},[ee.op==="removed"?(h(),B("pre",Wg,ce(ee.text),1)):ee.op==="added"?(h(),B("pre",zg,ce(ee.text),1)):(h(),B("pre",Vg,ce(ee.text),1))],64))),128))])):(h(),B(Qt,{key:5},[x(f(I))?(h(),B("div",{key:0,class:Gt(["max-w-full nc-audit-mini-item-cell nc-audit-removal !text-nc-content-red-dark border-1 border-nc-red-200 rounded-md bg-nc-bg-red-light line-through",{"px-1 py-0.25":g(I),"!p-0.25":y(I)}])},[le(F,{column:{uidt:(G=e(i)[I])==null?void 0:G.type,dt:((pe=e(i)[I])==null?void 0:pe.type)==="Number"?"bigint":void 0,meta:c(I),colOptions:u(I)},"model-value":f(I),"edit-enabled":!1,"read-only":"",class:Gt([{"min-w-[100px]":c(I).is_progress},"!text-nc-content-red-dark"])},null,8,["column","model-value","class"])],2)):ge("",!0),x(v(I))?(h(),B("div",{key:1,class:Gt(["nc-audit-mini-item-cell nc-audit-addition border-1 border-nc-green-200 rounded-md bg-nc-bg-green-light",{"px-1 py-0.25":g(I),"!p-0.25":y(I)}])},[le(F,{column:{uidt:(ne=e(i)[I])==null?void 0:ne.type,dt:((be=e(i)[I])==null?void 0:be.type)==="Number"?"bigint":void 0,meta:c(I),colOptions:u(I)},"model-value":v(I),"edit-enabled":!1,"read-only":"",class:Gt([{"min-w-[100px]":c(I).is_progress},"!text-nc-content-green-dark"])},null,8,["column","model-value","class"])],2)):ge("",!0)],64))])])}),128)}}}),Ug=Object.assign(Ol(jg,[["__scopeId","data-v-a89901a6"]]),{__name:"SmartsheetExpandedFormSidebarAuditMiniItem"}),Gg={class:"nc-icon",viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"};function Hg(t,n){return h(),B("svg",Gg,n[0]||(n[0]=[z("path",{fill:"currentColor",d:"M13.5 8H12v5l4.28 2.54l.72-1.21l-3.5-2.08zM13 3a9 9 0 0 0-9 9H1l3.96 4.03L9 12H6a7 7 0 0 1 7-7a7 7 0 0 1 7 7a7 7 0 0 1-7 7c-1.93 0-3.68-.79-4.94-2.06l-1.42 1.42A8.9 8.9 0 0 0 13 21a9 9 0 0 0 9-9a9 9 0 0 0-9-9"},null,-1)]))}const Yg=br({name:"mdi-history",render:Hg}),qg={class:"h-full"},Xg={key:0,class:"flex flex-col items-center justify-center w-full h-full"},Kg={key:0,class:"flex flex-col text-center justify-center h-full"},Jg={class:"text-center text-3xl text-nc-content-gray-subtle2"},Qg={key:0,class:"text-center text-nc-content-gray-subtle2"},Zg={class:"font-bold"},ew={key:0,class:"text-center text-nc-content-gray-subtle2 my-2"},tw={class:"font-bold"},nw={key:1,class:"p-3 text-center"},ow={class:"group gap-3 overflow-hidden px-3 py-2 transition hover:bg-nc-bg-gray-light"},lw={class:"flex items-start justify-between"},aw={class:"flex items-start gap-3 flex-1 w-full"},iw={class:"flex h-[28px] items-center gap-2 w-[calc(100%_-_40px)]"},rw={class:"truncate text-nc-content-gray font-medium !text-small !leading-[18px] overflow-hidden"},sw={class:"text-xs text-nc-content-gray-muted"},uw={key:0,class:"pl-9"},dw={key:0,class:"rounded-lg border-1 border-nc-border-gray-medium bg-nc-bg-gray-extralight divide-y py-2 px-3"},cw={key:1,class:"rounded-lg border-1 border-nc-border-gray-medium bg-nc-bg-gray-extralight divide-y py-2 px-3"},fw={key:1,class:"pl-9"},vw={key:2,class:"pl-9"},pw={class:"rounded-lg border-1 border-nc-border-gray-medium bg-nc-bg-gray-extralight divide-y py-2 px-3"},hw={class:"flex items-center gap-2 !text-nc-content-gray-subtle2 text-xs nc-audit-mini-item-header mb-3"},mw={class:"!border-none audit-link-container"},gw={key:0,class:"audit-link-removal"},ww={key:1,class:"audit-link-addition"},yw={key:3,class:"ml-9 rounded-lg border-1 border-nc-border-gray-medium bg-nc-bg-gray-extralight divide-y"},bw=xo({__name:"Audits",setup(t){const{user:n}=tl(),{primaryKey:o,consolidatedAudits:l,isAuditLoading:a,loadMoreAudits:i,resetAuditPages:r,hasMoreAudits:s}=$i(),{getPlanLimit:u}=up(),c=ue(()=>{const m=u(Hs.LIMIT_AUDIT_RETENTION);return m===14?"2 weeks":m===60?"2 months":m===180?"6 months":m===365?"1 year":null}),f=V(null);Gn(o,()=>{r()});function v(){var m;(m=f.value)==null||m.scrollBy({top:5e4,behavior:"smooth"})}const p=m=>{var C,b;return m.user===((C=n.value)==null?void 0:C.email)?"You":(b=m.created_display_name)!=null&&b.trim()?m.created_display_name||"Shared source":m.user?m.user:"Shared source"},g=V(!1);function y(){g.value=!0,i(),el(()=>{var m,C;(C=(m=document.querySelector('.nc-drawer-expanded-form.active > div[tabindex="0"]'))==null?void 0:m.focus)==null||C.call(m)})}Gn(l,()=>{if(g.value){g.value=!0;return}el(()=>{setTimeout(()=>{v()},500)})},{immediate:!0});function x(m){try{return JSON.parse(m)}catch{return{}}}function w(m){var C;return!!(m.version===0||["LINK_RECORD","UNLINK_RECORD"].includes((m==null?void 0:m.op_sub_type)||"")&&((C=m.details)!=null&&C.startsWith("<span")))}return(m,C)=>{const b=Ys,S=Yg,k=da,D=Uu,F=Aa,I=xf,M=Ug,A=Yl("dompurify-html");return h(),B("div",qg,[e(a)&&e(l).length===0?(h(),B("div",Xg,[le(b,{size:"xlarge"})])):(h(),B("div",{key:1,ref_key:"auditsWrapperEl",ref:f,class:"flex flex-col h-full nc-scrollbar-thin pb-1"},[e(l).length===0?(h(),B("div",Kg,[z("div",Jg,[le(S)]),C[3]||(C[3]=z("div",{class:"font-bold text-center my-1 text-nc-content-gray-subtle2"},"See changes to this record",-1)),e(c)?(h(),B("div",Qg,[C[1]||(C[1]=Je(" Your current plan provides ")),z("span",Zg,ce(e(c)),1),C[2]||(C[2]=Je(" of revision history. "))])):ge("",!0)])):(h(),B(Qt,{key:1},[C[7]||(C[7]=z("div",{class:"mt-auto"},null,-1)),e(c)?(h(),B("div",ew,[C[4]||(C[4]=Je(" You have ")),z("span",tw,ce(e(c)),1),C[5]||(C[5]=Je(" of revision history. "))])):ge("",!0),e(s)?(h(),B("div",nw,[le(k,{size:"small",type:"secondary",onClick:C[0]||(C[0]=j=>y())},{default:K(()=>C[6]||(C[6]=[Je(" Load earlier ")])),_:1,__:[6]})])):ge("",!0),(h(!0),B(Qt,null,po(e(l),j=>{var N,Y;return h(),B("div",{key:j.id,class:Gt([`${j.id}`,"nc-audit-item"])},[z("div",ow,[z("div",lw,[z("div",aw,[le(D,{user:{email:(j==null?void 0:j.created_by_email)||(j==null?void 0:j.user),display_name:(j==null?void 0:j.created_display_name)||(j==null?void 0:j.user),meta:j==null?void 0:j.created_by_meta},class:"mt-0.5",size:"medium"},null,8,["user"]),z("div",iw,[z("div",rw,ce(p(j)),1),z("div",sw,[le(F,null,{title:K(()=>[Je(ce(("parseStringDateTime"in m?m.parseStringDateTime:e(Gu))(j.created_at)),1)]),default:K(()=>[Je(" "+ce(("timeAgo"in m?m.timeAgo:e(Es))(j.created_at)),1)]),_:2},1024)])])])]),w(j)?(h(),B("div",uw,[j.details?Nt((h(),B("div",dw,null,512)),[[A,j.details]]):(h(),B("div",cw,ce(j.description),1))])):(j==null?void 0:j.op_type)==="DATA_INSERT"?(h(),B("div",fw,"created the record.")):["DATA_LINK","DATA_UNLINK"].includes(j==null?void 0:j.op_type)?(h(),B("div",vw,[z("div",pw,[z("div",hw,[le(I,{"column-meta":{uidt:"Links",colOptions:{type:x(j.details).type}},class:"!m-0"},null,8,["column-meta"]),Je(" "+ce(x(j.details).link_field_title),1)]),z("div",mw,[((N=x(j.details).consolidated_ref_display_values_unlinks)==null?void 0:N.length)>0?(h(),B("div",gw,[(h(!0),B(Qt,null,po(x(j.details).consolidated_ref_display_values_unlinks,ae=>(h(),B("span",{key:ae.refRowId,class:"audit-link-item"},ce(ae.value),1))),128))])):ge("",!0),((Y=x(j.details).consolidated_ref_display_values_links)==null?void 0:Y.length)>0?(h(),B("div",ww,[(h(!0),B(Qt,null,po(x(j.details).consolidated_ref_display_values_links,ae=>(h(),B("span",{key:ae.refRowId,class:"audit-link-item"},ce(ae.value),1))),128))])):ge("",!0)])])])):(j==null?void 0:j.op_type)==="DATA_UPDATE"?(h(),B("div",yw,[le(M,{audit:j},null,8,["audit"])])):ge("",!0)])],2)}),128))],64))],512))])}}}),_w=Object.assign(Ol(bw,[["__scopeId","data-v-153e91d0"]]),{__name:"SmartsheetExpandedFormSidebarAudits"}),xw={class:"flex flex-col bg-nc-bg-default !h-full w-full rounded-br-2xl overflow-hidden"},kw={class:"flex items-center gap-2"},Cw={class:"<lg:hidden"},Rw={class:"flex items-center gap-2"},Sw={class:"<lg:hidden"},Iw={class:"flex items-center gap-2"},Fw={class:"<lg:hidden"},Aw=xo({__name:"index",props:{showFieldsTab:{type:Boolean}},setup(t){const n=t,{isSqlView:o}=Fl(),l=$i(),a=V(n.showFieldsTab?"fields":"comments");return Gn(a,i=>{i==="audits"&&l.loadAudits()}),(i,r)=>{const s=Sl,u=dv,c=cp,f=fm,v=_w,p=dp,g=Yl("e");return h(),B("div",xw,[le(p,{"active-key":e(a),"onUpdate:activeKey":r[0]||(r[0]=y=>yo(a)?a.value=y:null),class:"h-full"},{default:K(()=>[n.showFieldsTab?(h(),J(c,{key:"fields",class:"w-full h-full"},{tab:K(()=>[Nt((h(),B("div",kw,[le(s,{icon:"fields",class:"w-4 h-4"}),z("span",Cw,ce(i.$t("objects.fields")),1)])),[[g,["c:row-expand:fields"]]])]),default:K(()=>[le(u)]),_:1})):ge("",!0),e(o)?ge("",!0):(h(),J(c,{key:"comments",class:"w-full h-full"},{tab:K(()=>[Nt((h(),B("div",Rw,[le(s,{icon:"messageCircle",class:"w-4 h-4"}),z("span",Sw,ce(i.$t("general.comments")),1)])),[[g,["c:row-expand:comment"]]])]),default:K(()=>[le(f)]),_:1})),e(o)?ge("",!0):(h(),J(c,{key:"audits",class:"w-full"},{tab:K(()=>[Nt((h(),B("div",Iw,[le(s,{icon:"audit",class:"w-4 h-4"}),z("span",Fw,ce(i.$t("labels.revisionHistory")),1)])),[[g,["c:row-expand:audit"]]])]),default:K(()=>[le(v)]),_:1}))]),_:1},8,["active-key"])])}}}),Ew=Object.assign(Ol(Aw,[["__scopeId","data-v-6ba3b2e4"]]),{__name:"SmartsheetExpandedFormSidebar"}),Mw={class:"h-full flex flex-row"},Tw={key:0,class:"p-2"},$w={class:"flex gap-2 items-center","data-testid":"nc-expanded-form-reload"},Ow={class:"flex gap-2 items-center","data-testid":"nc-expanded-form-copy-url"},Dw={"data-testid":"nc-expanded-form-delete"},Lw={key:1},Nw={key:2,class:"p-2"},Pw={class:"xs:px-1"},Bw={key:1,class:"p-2"},Ww={name:"ExpandedFormPresentorsFields"},zw=xo({...Ww,props:{rowId:{},fields:{},hiddenFields:{},isUnsavedDuplicatedRecordExist:{type:Boolean},isUnsavedFormExist:{type:Boolean},isLoading:{type:Boolean},isSaving:{type:Boolean},newRecordSubmitBtnText:{}},emits:["copyRecordUrl","deleteRow","save"],setup(t,{emit:n}){const o=t,l=n,a=Nn(o,"rowId"),i=Nn(o,"fields"),r=Nn(o,"hiddenFields"),s=Nn(o,"isUnsavedDuplicatedRecordExist"),u=Nn(o,"isUnsavedFormExist"),c=Nn(o,"isLoading"),f=Nn(o,"isSaving"),v=Nn(o,"newRecordSubmitBtnText"),{commentsDrawer:p,changedColumns:g,isNew:y,loadRow:x,row:w,meta:m,isAllowedAddNewRecord:C}=$i(),{isSqlView:b}=Fl(),{isUIAllowed:S}=wl(),{isMobileMode:k}=tl(),D=ue(()=>!y.value&&p.value&&S("commentList")&&!b.value),F=ue(()=>S("dataEdit")&&!b.value);return(I,M)=>{const A=uv,j=Sl,N=da,Y=Ya,ae=_r,he=Sr,ye=qa,re=Hi,me=Ew,W=Yl("e");return h(),B("div",Mw,[z("div",{class:Gt(["h-full flex xs:w-full flex-col overflow-hidden",{"w-full":!e(D),"flex-1":e(D)}])},[le(A,{fields:e(i),"hidden-fields":e(r),"is-loading":e(c)},null,8,["fields","hidden-fields","is-loading"]),e(F)?(h(),B("div",{key:0,class:Gt(["w-full flex items-center justify-end px-2 xs:p-0 xs:gap-x-4 xs:justify-between",{"xs(border-t-1 border-nc-border-gray-medium)":!e(y)}])},[!e(y)&&e(k)?(h(),B("div",Tw,[le(re,{placement:"bottomRight",class:"p-2"},{overlay:K(()=>[le(ye,{variant:"small"},{default:K(()=>{var U;return[le(Y,{onClick:M[0]||(M[0]=Ae=>e(x)())},{default:K(()=>[Nt((h(),B("div",$w,[(h(),J($o(("iconMap"in I?I.iconMap:e(sl)).reload),{class:"cursor-pointer"})),Je(" "+ce(I.$t("general.reload")),1)])),[[W,["c:row-expand:reload"]]])]),_:1}),e(a)?(h(),J(Y,{key:0,onClick:M[1]||(M[1]=Ae=>e(y)?()=>{}:l("copyRecordUrl"))},{default:K(()=>[Nt((h(),B("div",Ow,[(h(),J($o(("iconMap"in I?I.iconMap:e(sl)).copy),{class:"cursor-pointer nc-duplicate-row"})),Je(" "+ce(I.$t("labels.copyRecordURL")),1)])),[[W,["c:row-expand:copy-url"]]])]),_:1})):ge("",!0),le(ae),e(S)("dataEdit")&&!e(y)?(h(),J(he,{key:1,entity:e(pl).TABLE,"entity-id":(U=e(m))==null?void 0:U.id,permission:e(vl).TABLE_RECORD_DELETE},{default:K(({isAllowed:Ae})=>[Nt((h(),J(Y,{danger:"",disabled:!Ae,onClick:M[2]||(M[2]=je=>!e(y)&&l("deleteRow"))},{default:K(()=>[z("div",Dw,[le(j,{icon:"delete",class:"cursor-pointer nc-delete-row"}),M[4]||(M[4]=Je(" Delete record "))])]),_:2},1032,["disabled"])),[[W,["c:row-expand:delete"]]])]),_:1},8,["entity","entity-id","permission"])):ge("",!0)]}),_:1})]),default:K(()=>[le(N,{disabled:e(c),class:"nc-expand-form-more-actions",type:"secondary",size:"small"},{default:K(()=>[le(j,{class:Gt([e(c)?"text-nc-content-brand-hover":"text-nc-content-gray-subtle","text-md"]),icon:"threeDotVertical"},null,8,["class"])]),_:1},8,["disabled"])]),_:1})])):(h(),B("div",Lw)),e(k)&&!e(b)?(h(),B("div",Nw,[Nt((h(),J(N,{disabled:!e(C)&&e(y)||e(g).size===0&&!e(u),loading:e(f),class:Gt(["nc-expand-form-save-btn !xs:text-sm !px-2",{"!h-7":!e(k)}]),"data-testid":"nc-expanded-form-save",type:"primary",size:e(k)?"small":"xsmall",onClick:M[3]||(M[3]=U=>l("save"))},{default:K(()=>[z("div",Pw,ce(e(v)??e(y)?"Create Record":"Save Record"),1)]),_:1},8,["disabled","loading","class","size"])),[[W,["c:row-expand:save"]]])])):ge("",!0)],2)):(h(),B("div",Bw))],2),e(D)&&!e(s)?(h(),B("div",{key:0,class:Gt(["nc-comments-drawer border-l-1 relative border-nc-border-gray-medium bg-nc-bg-gray-extralight w-1/3 max-w-[400px] min-w-0 h-full xs:hidden rounded-br-2xl",{active:e(p)&&e(S)("commentList")}])},[le(me)],2)):ge("",!0)])}}}),Vw=Object.assign(zw,{__name:"SmartsheetExpandedFormPresentorsFields"}),jw={};function Uw(t,n){return h(),B("div")}const Gw=Object.assign(Ol(jw,[["render",Uw]]),{__name:"SmartsheetExpandedFormPresentorsAttachments"}),Hw=ko(()=>Co(()=>import("./DRA9KN5F.js").then(t=>t.oR),__vite__mapDeps([1,2]),import.meta.url).then(t=>t.default||t)),Yw={class:"ml-6.5"},qw={class:"text-small1 font-weight-500 inline-flex items-center flex-wrap gap-1 w-full max-w-full"},Xw={class:"rounded-md px-1 !h-[20px] inline-flex items-center gap-1 text-nc-content-gray-emphasis border-1 border-nc-border-gray-medium"},Kw={class:"text-small1 font-weight-500"},Jw={key:0,class:"w-full"},Qw={class:"border-1 border-nc-red-200 rounded-md bg-nc-bg-red-light p-0.5 flex flex-col items-start gap-0.5 w-[284px]"},Zw={class:"flex items-center gap-2 w-full"},ey={class:"flex items-center justify-center w-8 aspect-square"},ty={key:1,class:"nc-attachment flex items-center justify-center"},ny={class:"w-0 flex-1 truncate text-small1 font-weight-500 text-nc-content-gray-subtle2"},oy={class:"text-xs font-weight-500 p-2 text-nc-content-gray-muted"},ly={key:1,class:"w-full"},ay={class:"border-1 border-nc-green-200 rounded-md bg-nc-bg-green-light p-0.5 flex flex-col items-start gap-0.5 w-[284px]"},iy={class:"flex items-center gap-2 w-full"},ry={class:"flex items-center justify-center w-8 aspect-square"},sy={key:1,class:"nc-attachment flex items-center justify-center"},uy={class:"w-0 flex-1 truncate text-small1 font-weight-500 text-nc-content-gray-subtle2"},dy={class:"text-xs font-weight-500 p-2 text-nc-content-gray-muted"},cy={key:0,class:"max-w-full text-nc-content-red-dark border-1 border-nc-red-200 rounded-md px-1 bg-nc-bg-red-light line-through decoration-clone !leading-[18px]"},fy={key:1,class:"max-w-full text-nc-content-green-dark border-1 border-nc-green-200 rounded-md px-1 bg-nc-bg-green-light decoration-clone !leading-[18px]"},vy={key:2,class:"max-w-full !leading-[18px]"},py={key:2,class:"w-full border-1 rounded-md p-1"},hy={class:"w-full flex justify-start"},my={key:0,class:"!text-nc-content-red-dark border-1 border-nc-red-200 rounded-md bg-nc-bg-red-light line-through !mb-0 mt-1 p-1 max-w-full nc-scrollbar-thin"},gy={class:"w-full flex justify-start"},wy={key:0,class:"!text-nc-content-green-dark border-1 border-nc-green-200 rounded-md bg-nc-bg-green-light !mb-0 mt-1 p-1 max-w-full nc-scrollbar-thin"},yy=["data-label"],by=["data-label"],_y=xo({__name:"AuditInfoExpressive",props:{audit:{}},setup(t){const n=t,o=ue(()=>{try{return JSON.parse(n.audit.details||"")}catch{return{}}}),l=ue(()=>o.value.old_data??{}),a=ue(()=>o.value.data??{}),i=ue(()=>o.value.column_meta??{}),r=ue(()=>Object.keys(a.value));wo(gf,V(!0));const{getPossibleAttachmentSrc:s}=Ri();function u(x){var w,m,C,b,S;return{...((m=(w=i.value)==null?void 0:w[x])==null?void 0:m.options)??{},options:(S=(b=(C=i.value)==null?void 0:C[x])==null?void 0:b.options)==null?void 0:S.choices}}function c(x){var b,S;const w=((b=i.value)==null?void 0:b[x])??{},m=u(x),C=m.icon||(w.type==="Rating"?"star":"circle-check");return{...m,...w,icon:w.type==="Rating"?bf[C]:_f[C],duration:m.duration_format?(S=yf.find(k=>k.title===m.duration_format))==null?void 0:S.id:void 0,is12hrFormat:m["12hr_format"],isLocaleString:m.locale_string,isDisplayTimezone:(m==null?void 0:m.isDisplayTimezone)||(m==null?void 0:m.is_display_timezone),useSameTimezoneForAll:(m==null?void 0:m.useSameTimezoneForAll)||(m==null?void 0:m.use_same_timezone_for_all)}}function f(x){var C,b,S,k,D;const w=l.value[x],m=a.value[x];return((b=(C=i.value)==null?void 0:C[x])==null?void 0:b.type)==="Attachment"?w==null?void 0:w.filter(F=>!(m!=null&&m.some(I=>I.title===F.title))):((k=(S=i.value)==null?void 0:S[x])==null?void 0:k.type)==="MultiSelect"?((D=w==null?void 0:w.filter)==null?void 0:D.call(w,F=>{var I;return!((I=m==null?void 0:m.includes)!=null&&I.call(m,F))}))??w:w}function v(x){var C,b,S,k,D;const w=l.value[x],m=a.value[x];return((b=(C=i.value)==null?void 0:C[x])==null?void 0:b.type)==="Attachment"?m==null?void 0:m.filter(F=>!(w!=null&&w.some(I=>I.title===F.title))):((k=(S=i.value)==null?void 0:S[x])==null?void 0:k.type)==="MultiSelect"?((D=m==null?void 0:m.filter)==null?void 0:D.call(m,F=>{var I;return!((I=w==null?void 0:w.includes)!=null&&I.call(w,F))}))??m:m}function p(x){var w,m;return!["Checkbox","SingleSelect","MultiSelect","User"].includes((m=(w=i.value)==null?void 0:w[x])==null?void 0:m.type)&&!c(x).is_progress}function g(x){var w,m;return["SingleSelect","MultiSelect","User"].includes((m=(w=i.value)==null?void 0:w[x])==null?void 0:m.type)}function y(x){return![void 0,null,""].includes(x)}return(x,w)=>{const m=Sl,C=wf,b=Aa,S=Hw,k=Zf,D=ld;return h(!0),B(Qt,null,po(e(r),F=>{var I,M,A,j,N,Y,ae,he,ye,re,me,W,U,Ae,je,Ue,ot,G,pe,ne,be;return h(),B("div",{key:F,class:"relative not-last:mb-4"},[le(m,{icon:"ncNode",class:Gt(["w-[16px] h-[16px] text-nc-content-gray-muted bg-nc-bg-default absolute left-0 transform -translate-x-1/2",[["JSON","Attachment","SingleLineText","LongText"].includes((I=e(i)[F])==null?void 0:I.type)?"top-1":"top-1/2 -translate-y-2/5"]])},null,8,["class"]),z("div",Yw,[z("div",qw,[w[0]||(w[0]=z("span",{class:"text-nc-content-gray-subtle2 text-xs"}," changed ",-1)),z("span",Xw,[le(C,{"column-meta":{uidt:(M=e(i)[F])==null?void 0:M.type,dt:((A=e(i)[F])==null?void 0:A.type)==="Number"?"bigint":void 0},class:"!w-[16px] !h-[16px] !m-0 !text-nc-content-gray-emphasis"},null,8,["column-meta"]),le(b,{class:"truncate","show-on-truncate-only":""},{title:K(()=>[Je(ce(F),1)]),default:K(()=>[z("span",Kw,ce(F),1)]),_:2},1024)]),((j=e(i)[F])==null?void 0:j.type)==="Attachment"?(h(),B(Qt,{key:0},[((N=f(F))==null?void 0:N.length)>0?(h(),B("div",Jw,[z("div",Qw,[(h(!0),B(Qt,null,po(f(F),(ee,H)=>(h(),B("div",{key:ee.url||ee.title,class:"border-1 border-nc-border-gray-medium rounded-md bg-nc-bg-default w-full"},[z("div",Zw,[z("div",ey,[("isImage"in x?x.isImage:e(Ls))(ee.title,ee.mimetype??ee.type)?(h(),J(S,{key:0,alt:ee.title||`#${H}`,class:"nc-attachment rounded !w-5.5 !h-5.5 object-cover overflow-hidden",srcs:e(s)(ee,"small")},null,8,["alt","srcs"])):(h(),B("div",ty,[le(k,{item:ee,class:"!w-8 !h-8"},null,8,["item"])]))]),z("span",ny,ce(ee.title),1),z("span",oy,ce(("getReadableFileSize"in x?x.getReadableFileSize:e(Ns))(ee.size)),1)])]))),128))])])):ge("",!0),((Y=v(F))==null?void 0:Y.length)>0?(h(),B("div",ly,[z("div",ay,[(h(!0),B(Qt,null,po(v(F),(ee,H)=>(h(),B("div",{key:ee.url||ee.title,class:"border-1 border-nc-border-gray-medium rounded-md bg-nc-bg-default w-full"},[z("div",iy,[z("div",ry,[("isImage"in x?x.isImage:e(Ls))(ee.title,ee.mimetype??ee.type)?(h(),J(S,{key:0,alt:ee.title||`#${H}`,class:"nc-attachment rounded !w-5.5 !h-5.5 object-cover overflow-hidden",srcs:e(s)(ee,"small")},null,8,["alt","srcs"])):(h(),B("div",sy,[le(k,{item:ee,class:"!w-8 !h-8"},null,8,["item"])]))]),z("span",uy,ce(ee.title),1),z("span",dy,ce(("getReadableFileSize"in x?x.getReadableFileSize:e(Ns))(ee.size)),1)])]))),128))])])):ge("",!0)],64)):((ae=e(i)[F])==null?void 0:ae.type)==="SingleLineText"?(h(!0),B(Qt,{key:1},po(("diffTextBlocks"in x?x.diffTextBlocks:e(os))(e(l)[F]||"",e(a)[F]||""),(ee,H)=>(h(),B(Qt,{key:H},[ee.op==="removed"?(h(),B("span",cy,ce(ee.text),1)):ee.op==="added"?(h(),B("span",fy,ce(ee.text),1)):(h(),B("span",vy,ce(ee.text),1))],64))),128)):((he=e(i)[F])==null?void 0:he.type)==="LongText"?(h(),B("div",py,[(h(!0),B(Qt,null,po(("diffTextBlocks"in x?x.diffTextBlocks:e(os))(((ye=e(i)[F])==null?void 0:ye.type)==="LongText"&&((me=(re=e(i)[F])==null?void 0:re.options)!=null&&me.ai)?((W=e(l)[F])==null?void 0:W.value)||"":e(l)[F]||"",((U=e(i)[F])==null?void 0:U.type)==="LongText"&&((je=(Ae=e(i)[F])==null?void 0:Ae.options)!=null&&je.ai)?((Ue=e(a)[F])==null?void 0:Ue.value)||"":e(a)[F]||""),(ee,H)=>{var Ce,Ie,Q;return h(),B(Qt,{key:H},[ee.op==="removed"?(h(),B("span",{key:0,class:Gt(["max-w-full text-nc-content-red-dark px-1 bg-nc-bg-red-light rounded-md line-through decoration-clone !leading-[18px]",{"whitespace-pre-wrap":((Ce=e(i)[F])==null?void 0:Ce.type)==="LongText"}])},ce(ee.text),3)):ee.op==="added"?(h(),B("span",{key:1,class:Gt(["max-w-full text-nc-content-green-dark px-1 bg-nc-bg-green-light rounded-md decoration-clone !leading-[18px]",{"whitespace-pre-wrap":((Ie=e(i)[F])==null?void 0:Ie.type)==="LongText"}])},ce(ee.text),3)):(h(),B("span",{key:2,class:Gt(["max-w-full !leading-[18px]",{"whitespace-pre-wrap":((Q=e(i)[F])==null?void 0:Q.type)==="LongText"}])},ce(ee.text),3))],64)}),128))])):((ot=e(i)[F])==null?void 0:ot.type)==="JSON"?(h(),B(Qt,{key:3},[z("div",hy,[y(f(F))?(h(),B("pre",my,ce(f(F)),1)):ge("",!0)]),z("div",gy,[y(v(F))?(h(),B("pre",wy,ce(v(F)),1)):ge("",!0)])],64)):(h(),B(Qt,{key:4},[y(f(F))?(h(),B("div",{key:0,"data-label":f(F),class:Gt(["max-w-full nc-expressive-mini-item-cell nc-audit-removal !text-nc-content-red-dark border-1 border-nc-red-200 rounded-md bg-nc-bg-red-light line-through",{"px-1 py-0":p(F),"!px-0.25 !py-0.25":g(F)}])},[le(D,{column:{uidt:(G=e(i)[F])==null?void 0:G.type,dt:((pe=e(i)[F])==null?void 0:pe.type)==="Number"?"bigint":void 0,meta:c(F),colOptions:u(F)},"model-value":f(F),"edit-enabled":!1,"read-only":!0,class:Gt(["!text-nc-content-red-dark",{"min-w-[100px]":c(F).is_progress}])},null,8,["column","model-value","class"])],10,yy)):ge("",!0),y(v(F))?(h(),B("div",{key:1,"data-label":v(F),class:Gt(["max-w-full nc-expressive-mini-item-cell nc-audit-addition border-1 border-nc-green-200 rounded-md bg-nc-bg-green-light",{"px-1 py-0":p(F),"!px-0.25 !py-0.25":g(F)}])},[le(D,{column:{uidt:(ne=e(i)[F])==null?void 0:ne.type,dt:((be=e(i)[F])==null?void 0:be.type)==="Number"?"bigint":void 0,meta:c(F),colOptions:u(F)},"model-value":v(F),"edit-enabled":!1,"read-only":!0,class:Gt(["!text-nc-content-green-dark",{"min-w-[100px]":c(F).is_progress}])},null,8,["column","model-value","class"])],10,by)):ge("",!0)],64))])])])}),128)}}}),xy=Object.assign(Ol(_y,[["__scopeId","data-v-f2d0a82d"]]),{__name:"SmartsheetExpandedFormPresentorsDiscussionAuditInfoExpressive"}),ky={class:"py-4 ml-15.8 border-l border-nc-border-gray-dark"},Cy={class:"flex items-center h-[32px] gap-2 mb-2"},Ry={class:"w-[28px] h-[28px] bg-nc-bg-default flex items-center justify-center bg-nc-bg-default rounded-full border border-1 !border-nc-border-gray-medium shadow-sm -ml-3.5"},Sy={class:"text-small1 mb-0"},Iy={class:"font-weight-700"},Fy={key:0,class:"font-weight-500 text-nc-content-gray-subtle2"},Ay={key:1,class:"font-weight-500 text-nc-content-gray-subtle2"},Ey={key:2,class:"font-weight-500 text-nc-content-gray-subtle2"},My={class:"text-xs font-weight-500 text-nc-content-gray-muted"},Ty={key:0,class:"relative mb-2"},$y={key:2,class:"relative mb-2"},Oy={class:"text-sm ml-6.5 inline-flex items-center flex-wrap gap-1"},Dy={class:"rounded-md px-1 !h-[20px] inline-flex items-center gap-1 text-nc-content-gray-emphasis border-1 border-nc-border-gray-medium"},Ly={class:"text-small1 font-weight-500"},Ny={key:0,class:"flex gap-1 flex-wrap"},Py={class:"!text-small p-0.5 font-weight-500 border-1 border-nc-red-200 rounded-md bg-nc-bg-red-light inline-flex items-center gap-1"},By={key:1,class:"flex gap-1 flex-wrap"},Wy={class:"!text-small1 p-0.5 font-weight-500 border-1 border-nc-green-200 rounded-md bg-nc-bg-green-light inline-flex items-center gap-1"},zy=xo({__name:"EntryAudit",props:{auditGroup:{}},setup(t){const n=t,{user:o}=tl(),l=ue(()=>{try{return Object.keys(JSON.parse(n.auditGroup.audit.details||"").data).length}catch{return"-"}});function a(r,s){try{return JSON.parse(r.details||"")[s]}catch{return"-"}}const i=ue(()=>{var r,s;return n.auditGroup.user===((r=o.value)==null?void 0:r.email)?"You":(s=n.auditGroup.displayName)!=null&&s.trim()?n.auditGroup.displayName.trim()||"Shared source":n.auditGroup.displayName?n.auditGroup.displayName:"Shared source"});return(r,s)=>{var g,y,x,w,m,C,b,S,k;const u=Sl,c=Uu,f=Aa,v=xy,p=xf;return h(),B("div",ky,[z("div",Cy,[z("div",Ry,[le(u,{icon:"ncPenLine",class:"w-[16px] h-[16px] text-nc-content-gray-muted"})]),le(c,{user:{email:n.auditGroup.user,display_name:n.auditGroup.displayName,meta:(g=n.auditGroup.audit)==null?void 0:g.created_by_meta},class:"w-[24px] aspect-square"},null,8,["user"]),z("p",Sy,[z("span",Iy,ce(e(i)),1),((y=n.auditGroup.audit)==null?void 0:y.op_type)==="DATA_INSERT"?(h(),B("span",Fy," created a record. ")):((x=n.auditGroup.audit)==null?void 0:x.op_type)==="DATA_UPDATE"?(h(),B("span",Ay," updated "+ce(e(l))+" fields ",1)):((w=n.auditGroup.audit)==null?void 0:w.op_type)==="DATA_LINK"?(h(),B("span",Ey," updated 1 field ")):ge("",!0)]),z("div",My,[le(f,null,{title:K(()=>{var D;return[Je(ce(("parseStringDateTime"in r?r.parseStringDateTime:e(Gu))((D=n.auditGroup.audit)==null?void 0:D.created_at)),1)]}),default:K(()=>{var D;return[Je(" "+ce(("timeAgo"in r?r.timeAgo:e(Es))((D=n.auditGroup.audit)==null?void 0:D.created_at)),1)]}),_:1})])]),((m=n.auditGroup.audit)==null?void 0:m.op_type)==="DATA_INSERT"?(h(),B("div",Ty,[le(u,{icon:"ncNode",class:"w-[16px] h-[16px] text-nc-content-gray-muted bg-nc-bg-default absolute top-1/2 left-0 transform -translate-y-1/2 -translate-x-1/2"}),s[0]||(s[0]=z("p",{class:"text-sm font-weight-500 mb-1 ml-6.5"},"Record was created.",-1))])):((C=n.auditGroup.audit)==null?void 0:C.op_type)==="DATA_UPDATE"?(h(),J(v,{key:1,audit:n.auditGroup.audit},null,8,["audit"])):["DATA_LINK","DATA_UNLINK"].includes((b=n.auditGroup.audit)==null?void 0:b.op_type)?(h(),B("div",$y,[le(u,{icon:"ncNode",class:"w-[16px] h-[16px] text-nc-content-gray-muted bg-nc-bg-default absolute top-1/2 left-0 transform -translate-y-1/2 -translate-x-1/2"}),z("div",Oy,[s[1]||(s[1]=z("span",{class:"text-small1 text-nc-content-gray-subtle2 font-weight-500"}," changed ",-1)),z("span",Dy,[le(p,{"column-meta":{uidt:"Links",colOptions:{type:a(n.auditGroup.audit,"type")}},class:"!w-[16px] !h-[16px] !m-0"},null,8,["column-meta"]),z("span",Ly,ce(a(n.auditGroup.audit,"link_field_title")),1)]),((S=a(n.auditGroup.audit,"consolidated_ref_display_values_unlinks"))==null?void 0:S.length)>0?(h(),B("div",Ny,[z("span",Py,[(h(!0),B(Qt,null,po(a(n.auditGroup.audit,"consolidated_ref_display_values_unlinks"),D=>(h(),B("span",{key:D.refRowId,class:"text-nc-content-brand font-weight-500 line-through px-1 bg-nc-bg-brand !rounded-md"},ce(D.value),1))),128))])])):ge("",!0),((k=a(n.auditGroup.audit,"consolidated_ref_display_values_links"))==null?void 0:k.length)>0?(h(),B("div",By,[z("span",Wy,[(h(!0),B(Qt,null,po(a(n.auditGroup.audit,"consolidated_ref_display_values_links"),D=>(h(),B("span",{key:D.refRowId,class:"text-nc-content-brand font-weight-500 px-1 bg-nc-bg-brand !rounded-md"},ce(D.value),1))),128))])])):ge("",!0)])])):ge("",!0)])}}}),Vy=Object.assign(zy,{__name:"SmartsheetExpandedFormPresentorsDiscussionEntryAudit"}),jy={class:"relative my-4 nc-audit-comment-block"},Uy={class:"absolute left-0"},Gy={class:"text-xs text-nc-content-gray-muted"},Hy={key:0,class:"flex items-center gap-2"},Yy={class:"flex gap-2 items-center"},qy={class:"flex gap-2 items-center"},Xy=xo({__name:"EntryComment",props:{comment:{}},setup(t){const n=t,{user:o}=tl(),{copy:l}=qs(),{dashboardUrl:a}=av(),i=fs(),r=dn(Ti,V()),{loadComments:s,resolveComment:u,updateComment:c,deleteComment:f,primaryKey:v}=rm(),{isUIAllowed:p}=wl(),g=ue(()=>p("commentEdit")),y=M=>{var A,j;return M.created_by===((A=o.value)==null?void 0:A.id)?"You":(j=M.created_display_name)!=null&&j.trim()?M.created_display_name||"Shared source":M.created_by_email?M.created_by_email:"Shared source"},x=ue(()=>y(n.comment)==="You"),w=M=>M.updated_at!==M.created_at&&M.updated_at?`[(edited)](a~~~###~~~Edited_${Es(M.updated_at).replace(" ","_")}) `:"",m=V(!1),C=V();function b(M){C.value={...M},m.value=!0}function S(M){m.value&&(M.preventDefault(),M.stopPropagation(),C.value=void 0,s(),m.value=!1,C.value=void 0)}const k=ue({get(){var M;return((M=C.value)==null?void 0:M.comment)||""},set(M){C.value&&(C.value.comment=M)}});async function D(){var A;if(!m.value||!((A=C.value)!=null&&A.comment))return;for(;C.value.comment.endsWith("<br />")||C.value.comment.endsWith(`
`);)C.value.comment.endsWith("<br />")?C.value.comment=C.value.comment.slice(0,-6):C.value.comment=C.value.comment.slice(0,-2);const M={...C.value};m.value=!1,C.value=void 0,await c(M.id,{comment:M.comment}),s()}function F(){m.value=!1,C.value=void 0}async function I(M){var A;await l(encodeURI(`${a==null?void 0:a.value}#/${i.params.typeOrId}/${i.params.baseId}/${(A=r.value)==null?void 0:A.id}?rowId=${v.value}&commentId=${M.id}`))}return(M,A)=>{var Ae;const j=Uu,N=Aa,Y=Sl,ae=da,he=Ya,ye=_r,re=qa,me=Hi,W=lv,U=Yl("e");return h(),B("div",jy,[z("div",Uy,[le(j,{user:{email:n.comment.user,display_name:n.comment.displayName,meta:n.comment.created_by_meta},size:"base",class:"w-[36px] h-[36px] !aspect-square !text-small"},null,8,["user"])]),z("div",{class:Gt(["flex-1 bg-nc-bg-default rounded-lg border-1 group ml-11.5",{"border-nc-brand-200":e(x),"border-nc-border-gray-medium":!e(x)}])},[z("div",{class:Gt(["flex items-center gap-2 bg-nc-bg-gray-extralight px-4 py-1 border-b rounded-t-lg text-nc-content-gray min-h-[37px]",{"!bg-nc-bg-brand border-nc-brand-200":e(x),"border-nc-border-gray-medium":!e(x)}])},[z("span",{class:Gt(["font-medium text-sm",{"text-nc-content-brand-disabled":e(x)}])},ce(y(n.comment)),3),z("span",Gy,[le(N,null,{title:K(()=>[Je(ce(("parseStringDateTime"in M?M.parseStringDateTime:e(Gu))(n.comment.created_at)),1)]),default:K(()=>[Je(" "+ce(("timeAgo"in M?M.timeAgo:e(Es))(n.comment.created_at)),1)]),_:1})]),A[8]||(A[8]=z("div",{class:"flex-1"},null,-1)),e(C)?ge("",!0):(h(),B("div",Hy,[e(o)&&n.comment.created_by_email===e(o).email&&e(g)?(h(),J(N,{key:0,class:"opacity-0 transition !duration-150 pointer-events-none group-hover:opacity-100 group-hover:pointer-events-auto"},{title:K(()=>A[6]||(A[6]=[Je("Click to edit")])),default:K(()=>[le(ae,{class:"!w-7 !h-7 !bg-transparent !hover:bg-nc-bg-gray-medium",size:"xsmall",type:"text",onClick:A[0]||(A[0]=je=>b(n.comment))},{default:K(()=>[le(Y,{class:"text-md",icon:"pencil"})]),_:1})]),_:1})):ge("",!0),e(C)?ge("",!0):(h(),J(me,{key:1,class:"opacity-0 transition !duration-150 pointer-events-none group-hover:opacity-100 group-hover:pointer-events-auto","overlay-class-name":"!min-w-[160px]",placement:"bottomRight"},{overlay:K(()=>[le(re,{variant:"small"},{default:K(()=>[Nt((h(),J(he,{onClick:A[1]||(A[1]=je=>I(n.comment))},{default:K(()=>[z("div",Yy,[(h(),J($o(("iconMap"in M?M.iconMap:e(sl)).copy),{class:"cursor-pointer"})),Je(" "+ce(M.$t("general.copy"))+" URL ",1)])]),_:1})),[[U,["c:comment-expand:comment:copy"]]]),e(o)&&n.comment.created_by_email===e(o).email&&e(g)?(h(),B(Qt,{key:0},[le(ye),Nt((h(),J(he,{danger:"",onClick:A[2]||(A[2]=je=>e(f)(n.comment.id))},{default:K(()=>[z("div",qy,[(h(),J($o(("iconMap"in M?M.iconMap:e(sl)).delete),{class:"cursor-pointer"})),Je(" "+ce(M.$t("general.delete")),1)])]),_:1})),[[U,["c:row-expand:comment:delete"]]])],64)):ge("",!0)]),_:1})]),default:K(()=>[le(ae,{class:"!w-7 !h-7 !bg-transparent !hover:bg-nc-bg-gray-medium",size:"xsmall",type:"text"},{default:K(()=>[le(Y,{class:"text-md",icon:"threeDotVertical"})]),_:1})]),_:1})),!n.comment.resolved_by&&e(g)?(h(),J(N,{key:2,class:"opacity-0 transition !duration-150 pointer-events-none group-hover:opacity-100 group-hover:pointer-events-auto"},{title:K(()=>A[7]||(A[7]=[Je("Click to resolve")])),default:K(()=>[le(ae,{class:"!w-7 !h-7 !bg-transparent !hover:bg-nc-bg-gray-medium",size:"xsmall",type:"text",onClick:A[3]||(A[3]=je=>e(u)(n.comment.id))},{default:K(()=>[le(Y,{class:"text-md",icon:"checkCircle"})]),_:1})]),_:1})):n.comment.resolved_by?(h(),J(N,{key:3},{title:K(()=>[Je(ce(`Resolved by ${n.comment.resolved_display_name}`),1)]),default:K(()=>[le(ae,{class:"!h-7 !w-7 !bg-transparent !hover:bg-nc-bg-gray-medium text-semibold",size:"xsmall",type:"text",onClick:A[4]||(A[4]=je=>e(u)(n.comment.id))},{default:K(()=>[le(Y,{class:"text-md rounded-full bg-nc-fill-green-dark text-white",icon:"checkFill"})]),_:1})]),_:1})):ge("",!0)]))],2),n.comment.id===((Ae=e(C))==null?void 0:Ae.id)&&e(g)?(h(),J(W,{key:0,value:e(k),"onUpdate:value":A[5]||(A[5]=je=>yo(k)?k.value=je:null),autofocus:"","autofocus-to-end":"","hide-options":!1,class:"cursor-text expanded-form-comment-input !py-3 !px-4 !pr-3 !m-0 w-full !border-1 !border-nc-border-gray-medium !rounded-lg !bg-nc-bg-default !text-nc-content-gray !text-small !leading-18px !max-h-[240px]","data-testid":"expanded-form-comment-input","sync-value-change":"",onSave:D,onKeydown:[ls(S,["esc"]),ls(ro(D,["exact","prevent"]),["enter"])],onBlur:F},null,8,["value","onKeydown"])):(h(),J(W,{key:1,value:`${n.comment.comment}  ${w(n.comment)}`,class:"!text-small !leading-18px !text-nc-content-gray px-4 py-3","read-only":"","sync-value-change":""},null,8,["value"]))],2)])}}}),Ky=Object.assign(Ol(Xy,[["__scopeId","data-v-11e23397"]]),{__name:"SmartsheetExpandedFormPresentorsDiscussionEntryComment"}),Jy={class:"h-full flex flex-row nc-discussion-mode-container"},Qy={key:0,class:"w-[680px] max-w-full fflex-grow-0 flex-shrink-0 flex flex-col px-6 2xl:px-0"},Zy={class:"w-full h-15 flex-grow-0 flex-shrink-0 ml-15.8 border-l-1 border-nc-border-gray-dark relative"},e0={class:"w-[680px] max-w-full pb-4"},t0={key:0,class:"w-full border-t border-nc-border-gray-medium px-6 2xl:px-0 sticky bottom-0 pb-4 -mb-4 bg-nc-bg-default z-10"},n0={key:1,class:"w-full px-6 2xl:px-0"},o0={name:"ExpandedFormPresentorsDiscussion"},l0=xo({...o0,props:{isUnsavedDuplicatedRecordExist:{type:Boolean}},setup(t){const o=Nn(t,"isUnsavedDuplicatedRecordExist"),{saveComment:l,commentsDrawer:a,isNew:i,audits:r,comments:s,auditCommentGroups:u,hasMoreAudits:c,loadMoreAudits:f}=$i(),{isUIAllowed:v}=wl(),{isExpandedFormCommentMode:p}=Uo(Ir()),g=ue(()=>!i.value&&a.value&&v("commentList"));oi(()=>{D()});const y=Qd("refAuditsEnd"),x=Qd("refRichComment"),w=V(""),m=V(!1);function C(){var F;l(w.value),w.value="",(F=x==null?void 0:x.value)==null||F.setEditorContent("",!0)}function b(){m.value=!0,f()}const S=ue(()=>r.value.length),k=ue(()=>s.value.length);Gn([w,S,k],()=>{D()});function D(){setTimeout(()=>{var F;if(m.value){m.value=!1;return}(F=y.value)==null||F.scrollIntoView({behavior:"smooth"})},200)}return(F,I)=>{const M=da,A=Vy,j=Ky,N=lv,Y=dv;return h(),B("div",Jy,[z("div",{class:Gt(["relative h-full overflow-y-auto nc-scrollbar-thin flex flex-col items-center justify-start overflow-x-hidden",{"w-full":!e(g),"flex-1":e(g)}])},[I[8]||(I[8]=z("div",{class:"w-[680px] max-w-full flex-grow flex flex-col px-6 2xl:px-0"},[z("div",{class:"w-full h-0 flex-grow ml-15.8 border-l-1 border-nc-border-gray-dark"})],-1)),e(c)?(h(),B("div",Qy,[z("div",Zy,[le(M,{size:"small",type:"secondary",class:"absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2",onClick:I[0]||(I[0]=ae=>b())},{default:K(()=>I[5]||(I[5]=[Je(" Load more ")])),_:1,__:[5]})])])):ge("",!0),z("div",e0,[(h(!0),B(Qt,null,po(e(u),ae=>(h(),B("div",{key:ae.created_at,class:"w-full px-6 2xl:px-0"},[ae.type==="audit"?(h(),J(A,{key:0,"audit-group":ae},null,8,["audit-group"])):(h(),J(j,{key:1,comment:ae},null,8,["comment"]))]))),128)),e(v)("commentEdit")?(h(),B("div",t0,[I[6]||(I[6]=z("div",{class:"font-bold my-3"},"Add a comment",-1)),le(N,{ref_key:"refRichComment",ref:x,value:e(w),"onUpdate:value":[I[1]||(I[1]=ae=>yo(w)?w.value=ae:null),I[3]||(I[3]=ae=>D())],"hide-options":!1,placeholder:"Comment...",class:"expanded-form-comment-input !py-2 !px-2 cursor-text border-1 rounded-lg !text-nc-content-gray !text-small !leading-18px !max-h-[240px] bg-nc-bg-default !w-auto","data-testid":"expanded-form-comment-input",autofocus:e(p),onFocus:I[2]||(I[2]=ae=>p.value=!1),onKeydown:[I[4]||(I[4]=ro(()=>{},["stop"])),ls(ro(C,["exact","prevent"]),["enter"])],onSave:C},null,8,["value","autofocus","onKeydown"])])):(h(),B("div",n0,I[7]||(I[7]=[z("div",{class:"w-full h-4 flex-grow ml-15.8 -mb-4 border-l-1 border-nc-border-gray-dark"},null,-1)]))),z("div",{ref_key:"refAuditsEnd",ref:y},null,512)])],2),e(g)&&!e(o)?(h(),B("div",{key:0,class:Gt(["nc-comments-drawer border-l-1 relative border-nc-border-gray-medium bg-nc-bg-default w-1/3 max-w-[400px] min-w-0 h-full xs:hidden rounded-br-2xl",{active:e(a)&&e(v)("commentList")}])},[le(Y)],2)):ge("",!0)])}}}),a0=Object.assign(Ol(l0,[["__scopeId","data-v-14d4a399"]]),{__name:"SmartsheetExpandedFormPresentorsDiscussion"}),i0=ko(()=>Co(()=>import("./DzI8hkox.js"),__vite__mapDeps([41,1,2,22,42]),import.meta.url).then(t=>t.default||t)),r0={class:"h-[85vh] xs:max-h-full xs:h-full max-h-215 flex flex-col"},s0={key:0,class:"flex-none h-4 flex items-center justify-center"},u0={class:"flex gap-2 min-h-7 flex-shrink-0 w-full items-center nc-expanded-form-header p-4 xs:px-2 xs:py-0 xs:min-h-[48px] border-b-1 border-nc-border-gray-medium"},d0={class:"flex gap-2 min-w-0 min-h-8"},c0={class:"flex gap-2"},f0={key:0,class:"flex items-center"},v0={key:1,class:"flex-1 flex items-center gap-2 xs:flex-row-reverse xs:justify-end min-w-0"},p0={key:0,class:"hidden md:flex items-center rounded-lg bg-nc-bg-gray-light px-2 py-1 gap-2"},h0={class:"nc-expanded-form-table-name whitespace-nowrap"},m0={key:1,class:"flex items-center truncate font-bold text-nc-content-gray text-xl overflow-hidden"},g0={key:2,class:"flex items-center font-bold text-nc-content-gray text-2xl overflow-hidden"},w0={class:"min-w-[120px] md:min-w-[300px]"},y0={class:"ml-auto"},b0={class:"flex gap-2"},_0={class:"xs:px-1"},x0={"data-testid":"nc-expanded-form-copy-url",class:"flex items-center relative h-4 w-4"},k0={class:"flex gap-2 items-center","data-testid":"nc-expanded-form-reload"},C0={"data-testid":"nc-expanded-form-copy-url",class:"flex gap-2 items-center"},R0={class:"flex gap-2 items-center","data-testid":"nc-expanded-form-duplicate"},S0={class:"-ml-0.25"},I0={class:"flex gap-2 items-center","data-testid":"nc-expanded-form-delete"},F0={class:"-ml-0.25"},A0={class:"flex flex-row items-center py-2.25 px-2.5 bg-nc-bg-gray-extralight rounded-lg text-nc-content-inverted-secondary"},E0={class:"text-ellipsis overflow-hidden select-none w-full pl-1.75 break-keep whitespace-nowrap"},M0={class:""},T0={class:"flex flex-row items-center gap-x-2 text-base font-bold"},$0={class:"flex font-medium mt-2"},O0={class:"flex flex-row justify-end gap-x-2 mt-5"},D0={name:"ExpandedForm"},L0=xo({...D0,props:{modelValue:{type:Boolean},state:{},meta:{},loadRow:{type:Boolean},useMetaFields:{type:Boolean},row:{},rowId:{},view:{},showNextPrevIcons:{type:Boolean},firstRow:{type:Boolean},lastRow:{type:Boolean},closeAfterSave:{type:Boolean},newRecordHeader:{},skipReload:{type:Boolean},newRecordSubmitBtnText:{},expandForm:{type:Function},maintainDefaultViewOrder:{type:Boolean}},emits:["update:modelValue","cancel","next","prev","createdRecord","deletedRecord","updateRowCommentCount"],setup(t,{expose:n,emit:o}){var q;const l=t,a=o,i=yr(),{activeView:r}=Uo(i),s=V(0),u=V(),{dashboardUrl:c}=av(),{copy:f}=qs(),{isMobileMode:v}=tl(),{t:p}=la(),{rowId:g,row:y,state:x,meta:w,lastRow:m,firstRow:C,maintainDefaultViewOrder:b}=xr(l),S=fs(),k=cs(),D=V(!1),F=V(!1),I=V(!1),{isUIAllowed:M}=wl(),A=V(),j=dn(rr,jo()),N=dn(Ea,jo()),{addOrEditStackRow:Y}=nv(),{isExpandedFormCommentMode:ae}=Uo(Ir()),{showRecordPlanLimitExceededModal:he}=ql(),{withLoading:ye}=vs();wo(Hu,void 0);const re=dn(fp,V(!1)),me=dn(zl,V(!1));wo(Ti,w),wo(Rf,void 0);const W=V(!0),U=V(!1),Ae=Um(w,y,b,!!l.useMetaFields),{commentsDrawer:je,changedColumns:Ue,deleteRowById:ot,displayValue:G,state:pe,isNew:ne,loadRow:be,primaryKey:ee,row:H,comments:Ce,save:Ie,loadComments:Q,loadAudits:ie,clearColumns:Me,baseRoles:Be,fields:it,hiddenFields:Ge,isAllowedAddNewRecord:ze}=Ae,Z=L=>{a(L),W.value=!0},Et=ue(()=>{var L;return(L=w.value)==null?void 0:L.title}),_e=V(!me.value&&Wi?((q=l.view)==null?void 0:q.expanded_record_mode)??kl.FIELD:kl.FIELD);Gn(_e,async L=>{var we,oe,Ee;const te=(we=l.view)==null?void 0:we.id;if(te){if(L===kl.FIELD||L===kl.DISCUSSION)await i.setCurrentViewExpandedFormMode(te,L);else if(L===kl.ATTACHMENT){const Ne=(oe=it.value)==null?void 0:oe.find(He=>He.uidt==="Attachment");await i.setCurrentViewExpandedFormMode(te,L,((Ee=l.view)==null?void 0:Ee.attachment_mode_column_id)??(Ne==null?void 0:Ne.id))}}});const yn=ue(()=>{var L,te;return((te=(L=w.value)==null?void 0:L.columns)==null?void 0:te.find(we=>{var oe;return we.pv&&((oe=it.value)==null?void 0:oe.includes(we))}))??null});N.on(ye(async L=>{var we;if(L!=null&&L.skipLoadingRowId&&(L==null?void 0:L.skipLoadingRowId)===ee.value)return;(L==null?void 0:L.relatedTableMetaId)&&(L==null?void 0:L.rowId)&&(L==null?void 0:L.relatedTableMetaId)===((we=w.value)==null?void 0:we.id)&&(L==null?void 0:L.rowId)===g.value?await be(g.value):L!=null&&L.relatedTableMetaId&&(L!=null&&L.rowId)?await be(g.value,!0):await be(g.value,!1,!0)}));const It=V(!1),{isSqlView:$t}=am(V({}),w);_m(w),Gn(x,()=>{x.value?pe.value=x.value:pe.value={}},{immediate:!0});const et=Ra(l,"modelValue",a,{defaultValue:!1}),cn=(L=!1)=>{var te,we;L?et.value=!1:M("dataEdit",Be.value)?Ue.value.size>0?wt.value=!0:((we=(te=H.value)==null?void 0:te.rowMeta)!=null&&we.new&&a("cancel"),et.value=!1):et.value=!1},Pn=()=>{if(he())return;It.value=!0,D.value=!0,F.value=!0;const L={...H.value.row};delete L.ncRecordId;const te=Object.assign({},{row:L,oldRow:{},rowMeta:{new:!0}});setTimeout(async()=>{H.value=te,It.value=!1,Zt.success(p("msg.success.rowDuplicatedWithoutSavedYet"))},500)},Kt=async()=>{var L,te;U.value=!0;try{let we;((L=r.value)==null?void 0:L.type)===Ul.KANBAN&&(we=(oe,Ee)=>{Y(oe,Ee)}),ne.value?await Ie(pe.value,void 0,{kanbanClbk:we}):(await Ie(void 0,void 0,{kanbanClbk:we}),await be()),l.skipReload||(await(j==null?void 0:j.trigger()),await(N==null?void 0:N.trigger())),D.value=!1,l.closeAfterSave?et.value=!1:F.value&&(Ht(H.value.row,w.value.columns)!==g.value&&((te=l==null?void 0:l.expandForm)==null||te.call(l,H.value)),setTimeout(()=>{F.value=!1},500)),a("createdRecord",H.value.row)}catch(we){ne.value?Zt.error(`Add row failed: ${await hl(we)}`):Zt.error(`${p("msg.error.rowUpdateFailed")}: ${await hl(we)}`)}U.value=!1},nn=V(!1),wt=V(!1),Dn=V(void 0),un=()=>{var L,te,we,oe;nn.value&&(Z("next"),(te=(L=H.value)==null?void 0:L.rowMeta)!=null&&te.new&&a("cancel"),nn.value=!1),wt.value&&(wt.value=!1,(oe=(we=H.value)==null?void 0:we.rowMeta)!=null&&oe.new&&a("cancel"),et.value=!1),Me()},Bn=async()=>{if(Ue.value.size>0){nn.value=!0,Dn.value="next";return}Z("next")},tt=async()=>{if(Ue.value.size>0){nn.value=!0,Dn.value="prev";return}Z("prev")},mt=async()=>{var te,we,oe;const L=`${c==null?void 0:c.value}#/${S.params.typeOrId}/${S.params.baseId}/${(te=w.value)==null?void 0:te.id}${l.view?`/${l.view.id}`:""}?rowId=${ee.value}${(we=S.query)!=null&&we.path?`&path=${(oe=S.query)==null?void 0:oe.path}`:""}`;await f(encodeURI(L)),I.value=!0,await Cf(5e3),I.value=!1},Dt=async()=>{nn.value&&(D.value=!1,await Kt(),Dn.value?Z(Dn.value):Z("next"),nn.value=!1,Dn.value=void 0),wt.value&&(wt.value=!1,await Kt(),et.value=!1)},Rt=dn(rr,jo()),ct=jo();if(ct.on(()=>{Rt==null||Rt.trigger({shouldShowLoading:!1}),!ne.value&&(be(void 0,!0),ie(g.value,!1))}),wo(rr,ct),re.value&&H.value.rowMeta.new)for(const[L,te]of Object.entries(H.value.row))te&&Ue.value.add(L);wo(mp,et);const nt=async L=>{await Promise.allSettled([Q(L,!1),be(L)]),W.value=!1},rt=V();oi(async()=>{I.value=!1,W.value=!0;const L=!ae.value;let te=!1;l.loadRow&&!l.rowId?(await nt(),te=!0):l.rowId&&l.loadRow&&!te?await nt(l.rowId):H.value=l.row,_e.value===kl.DISCUSSION&&await ie(g.value,!1),W.value=!1,L&&ne.value&&setTimeout(()=>{var we,oe,Ee;(Ee=(oe=(we=rt.value)==null?void 0:we.$el)==null?void 0:oe.querySelector("input,select,textarea"))==null||Ee.focus()},300)});const st=()=>{if(!ze.value){Zt.toast(p("objects.permissions.addNewRecordTooltip"));return}setTimeout(async()=>{H.value={row:{},oldRow:{},rowMeta:{new:!0}},pe.value={},s.value++,et.value=!0},500)};id(et,async L=>{var te,we,oe;if(!(!L.altKey||ne.value||!l.showNextPrevIcons||pp(L)||hp()))if(L.key==="ArrowLeft"){if(L.stopPropagation(),C.value)return;Z("prev")}else if(L.key==="ArrowRight"){if(L.stopPropagation(),m.value)return;Bn()}else if(L.code==="KeyS"){if((te=document.activeElement)==null||te.blur(),L.stopPropagation(),!ze.value&&ne.value){Zt.toast(p("objects.permissions.addNewRecordTooltip"));return}try{ne.value?(await Ie(pe.value),ct==null||ct.trigger(null)):(await Kt(),ct==null||ct.trigger(null))}catch(Ee){ne.value?Zt.error(`Add row failed: ${await hl(Ee)}`):Zt.error(`${p("msg.error.rowUpdateFailed")}: ${await hl(Ee)}`)}}else L.code==="KeyN"&&((oe=(we=document.activeElement)==null?void 0:we.blur)==null||oe.call(we),Ue.value.size>0?Zd.confirm({title:p("msg.saveChanges"),okText:p("general.save"),cancelText:p("labels.discard"),onOk:async()=>{await Kt(),ct==null||ct.trigger(null),st()},onCancel:()=>{st()}}):ne.value?Zd.confirm({title:"Do you want to save the record?",okText:p("general.save"),cancelText:p("labels.discard"),onOk:async()=>{try{await Ie(pe.value),ct==null||ct.trigger(null),st()}catch(Ee){Zt.error(`${p("msg.error.rowUpdateFailed")}: ${await hl(Ee)}`)}},onCancel:()=>{st()}}):st())},{immediate:!0,isGridCell:!1});const lt=V(!1),xt=()=>{lt.value=!0},Ot=async()=>{await ot(ee.value||void 0),a("deletedRecord"),Zt.success(p("msg.rowDeleted")),lt.value=!1,cn(!0),await N.trigger({shouldShowLoading:!1,skipLoadingRowId:ee.value||void 0})};Gn(g,async L=>{await nt(L)});const yt=ue({get:()=>wt.value||nn.value,set:L=>{wt.value=L}}),Qe=L=>{let te=!1;document.querySelectorAll(".ant-select-dropdown").forEach(we=>{te=te||we.checkVisibility()}),!te&&(Ue.value.size===0&&!D.value?(et.value=L,re.value&&a("cancel")):!L&&M("dataEdit",Be.value)?yt.value=!0:et.value=L)},d=V("");Gn([A,W],()=>{if(v.value)return;const L=A.value;L&&!W.value&&(L.scrollTop=L.scrollHeight,setTimeout(()=>{el(()=>{const te=k.currentRoute.value.query,we=te.columnId;we?(k.push({query:{rowId:te.rowId}}),d.value=we,T(we),Xs(document.querySelector(`[col-id="${we}"]`),()=>{d.value=null})):L.scrollTop=0})},125))});const _=ue(()=>v.value?{placement:"bottom"}:{}),O=ue(()=>{var L,te,we,oe;return ne.value&&((te=(L=y.value)==null?void 0:L.rowMeta)==null?void 0:te.ltarState)&&Object.keys((oe=(we=y.value)==null?void 0:we.rowMeta)==null?void 0:oe.ltarState).length>0});Gn(()=>Ce.value.length,L=>{a("updateRowCommentCount",L)});function T(L){const te=document.querySelector(`.${L}`);te&&te.scrollIntoView({behavior:"smooth",block:"center"})}return n({stopLoading:()=>{el(()=>{W.value=!1})}}),(L,te)=>{const we=Sl,oe=da,Ee=Aa,Ne=ov,He=i0,Ze=Km,Ke=Sr,ft=Ya,Ye=_r,qe=qa,ht=Hi,zt=Vw,Le=Gw,Se=a0,Mt=bm,xe=Yl("e");return h(),B(Qt,null,[(h(),J($o(e(v)?e(vp):Ms),ar({"body-style":{padding:0},class:[{active:e(et)},"nc-drawer-expanded-form"],closable:!1,footer:null,visible:e(et),width:e(je)&&e(M)("commentList",e(Be))?"min(80vw,1280px)":"min(70vw,768px)",size:e(v)?"medium":"small"},e(_),{"onUpdate:visible":Qe}),{default:K(()=>{var Pe,gt,X,Fe;return[z("div",r0,[e(v)?(h(),B("div",s0,[z("div",{class:"flex-none h-full flex items-center justify-center cursor-pointer",onClick:cn},te[22]||(te[22]=[z("div",{class:"w-[72px] h-[2px] rounded-full bg-nc-bg-gray-dark"},null,-1)]))])):ge("",!0),z("div",u0,[z("div",d0,[z("div",c0,[l.showNextPrevIcons?(h(),J(Ee,{key:0,class:"flex items-center"},{title:K(()=>[Je(ce(L.$t("labels.prevRow"))+" "+ce(("renderAltOrOptlKey"in L?L.renderAltOrOptlKey:e(vu))())+" + ",1)]),default:K(()=>[le(oe,{disabled:e(C)||e(W),class:"nc-prev-arrow !w-7 !h-7 !text-nc-content-gray-muted !disabled:text-nc-content-brand-hover",type:"text",size:"xsmall",onClick:tt},{default:K(()=>[le(we,{icon:"chevronDown",class:"transform rotate-180"})]),_:1},8,["disabled"])]),_:1})):ge("",!0),l.showNextPrevIcons?(h(),J(Ee,{key:1,class:"flex items-center"},{title:K(()=>[Je(ce(L.$t("labels.nextRow"))+" "+ce(("renderAltOrOptlKey"in L?L.renderAltOrOptlKey:e(vu))())+" + ",1)]),default:K(()=>[le(oe,{disabled:e(m)||e(W),class:"nc-next-arrow !w-7 !h-7 !text-nc-content-gray-muted !disabled:text-nc-content-brand-hover",type:"text",size:"xsmall",onClick:Bn},{default:K(()=>[le(we,{icon:"chevronDown"})]),_:1},8,["disabled"])]),_:1})):ge("",!0)]),e(W)?(h(),B("div",f0,[le(Ne,{active:"",class:"!h-6 !sm:mr-14 !w-52 !rounded-md !overflow-hidden",size:"small"})])):(h(),B("div",v0,[l.showNextPrevIcons?ge("",!0):(h(),B("div",p0,[le(we,{icon:"table",class:"text-nc-content-inverted-secondary flex-none"}),z("span",h0,ce(e(Et)),1)])),(Pe=e(y).rowMeta)!=null&&Pe.new||l.newRecordHeader?(h(),B("div",m0,ce(l.newRecordHeader??L.$t("activity.newRecord")),1)):e(G)&&!((X=(gt=e(y))==null?void 0:gt.rowMeta)!=null&&X.new)?(h(),B("div",g0,[z("span",w0,[le(He,{modelValue:e(G),"onUpdate:modelValue":te[0]||(te[0]=vt=>yo(G)?G.value=vt:null),column:e(yn),"show-tooltip":""},null,8,["modelValue","column"])])])):ge("",!0)]))]),z("div",y0,[le(Ze,{modelValue:e(_e),"onUpdate:modelValue":te[1]||(te[1]=vt=>yo(_e)?_e.value=vt:null),view:L.view,class:"nc-expanded-form-mode-switch"},null,8,["modelValue","view"])]),z("div",b0,[!e(v)&&e(M)("dataEdit",e(Be))&&!e($t)?(h(),J(Ke,{key:0,entity:e(pl).TABLE,"entity-id":(Fe=e(w))==null?void 0:Fe.id,permission:e(vl).TABLE_RECORD_ADD,disabled:!e(ne),arrow:"","default-tooltip":`${("renderAltOrOptlKey"in L?L.renderAltOrOptlKey:e(vu))()} + S`},{default:K(({isAllowed:vt})=>[Nt((h(),J(oe,{disabled:!vt||e(Ue).size===0&&!e(D)&&!e(O),loading:e(U),class:"nc-expand-form-save-btn !xs:text-base !h-7 !px-2","data-testid":"nc-expanded-form-save",type:"primary",size:"xsmall",onClick:Kt},{default:K(()=>[z("div",_0,ce(L.newRecordSubmitBtnText??L.$t("activity.saveRow")),1)]),_:2},1032,["disabled","loading"])),[[xe,["c:row-expand:save"]]])]),_:1},8,["entity","entity-id","permission","disabled","default-tooltip"])):ge("",!0),le(Ee,null,{title:K(()=>[Je(ce(e(I)?L.$t("labels.copiedRecordURL"):L.$t("labels.copyRecordURL")),1)]),default:K(()=>[!e(ne)&&e(g)&&!e(v)?(h(),J(oe,{key:0,disabled:e(W),class:"!<lg:hidden text-nc-content-inverted-secondary !h-7 !w-7",type:"text",size:"xsmall",onClick:te[2]||(te[2]=vt=>mt())},{default:K(()=>[Nt((h(),B("div",x0,[le(kf,{name:"icon-fade",duration:200},{default:K(()=>[e(I)?(h(),J($o(("iconMap"in L?L.iconMap:e(sl)).check),{key:0,class:"cursor-pointer nc-duplicate-row h-4 w-4"})):(h(),J($o(("iconMap"in L?L.iconMap:e(sl)).copy),{key:1,class:"cursor-pointer nc-duplicate-row h-4 w-4"}))]),_:1})])),[[xe,["c:row-expand:copy-url"]]])]),_:1},8,["disabled"])):ge("",!0)]),_:1}),!e(ne)&&e(g)&&!e(v)?(h(),J(ht,{key:1,placement:"bottomRight"},{overlay:K(()=>[le(qe,{variant:"small"},{default:K(()=>{var vt,Re;return[le(ft,{onClick:te[3]||(te[3]=bt=>e(be)())},{default:K(()=>[Nt((h(),B("div",k0,[(h(),J($o(("iconMap"in L?L.iconMap:e(sl)).reload),{class:"cursor-pointer"})),Je(" "+ce(L.$t("general.reload"))+" "+ce(L.$t("objects.record")),1)])),[[xe,["c:row-expand:reload"]]])]),_:1}),!e(ne)&&e(g)?(h(),J(ft,{key:0,type:"secondary",class:"!lg:hidden",disabled:e(W),onClick:te[4]||(te[4]=bt=>mt())},{default:K(()=>[Nt((h(),B("div",C0,[(h(),J($o(("iconMap"in L?L.iconMap:e(sl)).copy),{class:"cursor-pointer"})),Je(" "+ce(L.$t("labels.copyRecordURL")),1)])),[[xe,["c:row-expand:copy-url"]]])]),_:1},8,["disabled"])):ge("",!0),e(M)("dataEdit",e(Be))&&!e($t)?(h(),J(Ke,{key:1,entity:e(pl).TABLE,"entity-id":(vt=e(w))==null?void 0:vt.id,permission:e(vl).TABLE_RECORD_ADD,placement:"right"},{default:K(({isAllowed:bt})=>[le(ft,{disabled:!bt,onClick:te[5]||(te[5]=_t=>e(ne)?()=>{}:Pn())},{default:K(()=>[Nt((h(),B("div",R0,[(h(),J($o(("iconMap"in L?L.iconMap:e(sl)).duplicate),{class:"cursor-pointer nc-duplicate-row"})),z("span",S0,ce(L.$t("labels.duplicateRecord")),1)])),[[xe,["c:row-expand:duplicate"]]])]),_:2},1032,["disabled"])]),_:1},8,["entity","entity-id","permission"])):ge("",!0),e(M)("dataEdit",{roles:e(Be)})&&!e($t)?(h(),J(Ye,{key:2})):ge("",!0),e(M)("dataEdit",e(Be))&&!e($t)?(h(),J(Ke,{key:3,entity:e(pl).TABLE,"entity-id":(Re=e(w))==null?void 0:Re.id,permission:e(vl).TABLE_RECORD_DELETE,placement:"right"},{default:K(({isAllowed:bt})=>[le(ft,{danger:"",disabled:!bt,onClick:te[6]||(te[6]=_t=>!e(ne)&&xt())},{default:K(()=>[Nt((h(),B("div",I0,[le(we,{icon:"delete",class:"cursor-pointer nc-delete-row"}),z("span",F0,ce(L.$t("general.deleteEntity",{entity:L.$t("objects.record").toLowerCase()})),1)])),[[xe,["c:row-expand:delete"]]])]),_:2},1032,["disabled"])]),_:1},8,["entity","entity-id","permission"])):ge("",!0)]}),_:1})]),default:K(()=>[le(oe,{type:"text",size:"xsmall",class:"nc-expand-form-more-actions !w-7 !h-7",disabled:e(W)},{default:K(()=>[le(we,{icon:"threeDotVertical",class:Gt(["text-md",e(W)?"text-nc-content-brand-hover":"text-nc-content-inverted-secondary"])},null,8,["class"])]),_:1},8,["disabled"])]),_:1})):ge("",!0),le(oe,{class:"nc-expand-form-close-btn !w-7 !h-7","data-testid":"nc-expanded-form-close",type:"text",size:"xsmall",onClick:cn},{default:K(()=>[le(we,{class:"text-md text-nc-content-inverted-secondary h-4 w-4",icon:"close"})]),_:1})])]),z("div",{ref_key:"wrapper",ref:u,class:"flex-grow h-[calc(100%_-_4rem)] w-full"},[e(_e)===e(kl).FIELD?(h(),J(zt,{key:0,"row-id":e(g),fields:e(it)??[],"hidden-fields":e(Ge),"is-unsaved-duplicated-record-exist":e(F),"is-unsaved-form-exist":e(D),"is-loading":e(W),"is-saving":e(U),"new-record-submit-btn-text":L.newRecordSubmitBtnText,onCopyRecordUrl:te[7]||(te[7]=vt=>mt()),onDeleteRow:te[8]||(te[8]=vt=>xt()),onSave:te[9]||(te[9]=vt=>Kt()),"onUpdate:modelValue":te[10]||(te[10]=vt=>a("update:modelValue",vt)),onCreatedRecord:te[11]||(te[11]=vt=>a("createdRecord",vt)),onUpdateRowCommentCount:te[12]||(te[12]=vt=>a("updateRowCommentCount",vt))},null,8,["row-id","fields","hidden-fields","is-unsaved-duplicated-record-exist","is-unsaved-form-exist","is-loading","is-saving","new-record-submit-btn-text"])):e(_e)===e(kl).ATTACHMENT?(h(),J(Le,{key:1,"row-id":e(g),view:l.view,fields:e(it)??[],"hidden-fields":e(Ge),"is-unsaved-duplicated-record-exist":e(F),"is-unsaved-form-exist":e(D),"is-loading":e(W),"is-saving":e(U),"new-record-submit-btn-text":L.newRecordSubmitBtnText,onCopyRecordUrl:te[13]||(te[13]=vt=>mt()),onDeleteRow:te[14]||(te[14]=vt=>xt()),onSave:te[15]||(te[15]=vt=>Kt()),"onUpdate:modelValue":te[16]||(te[16]=vt=>a("update:modelValue",vt)),onCreatedRecord:te[17]||(te[17]=vt=>a("createdRecord",vt)),onUpdateRowCommentCount:te[18]||(te[18]=vt=>a("updateRowCommentCount",vt))},null,8,["row-id","view","fields","hidden-fields","is-unsaved-duplicated-record-exist","is-unsaved-form-exist","is-loading","is-saving","new-record-submit-btn-text"])):e(_e)===e(kl).DISCUSSION?(h(),J(Se,{key:2,"is-unsaved-duplicated-record-exist":e(F)},null,8,["is-unsaved-duplicated-record-exist"])):ge("",!0)],512)])]}),_:1},16,["class","visible","width","size"])),le(Mt,{visible:e(lt),"onUpdate:visible":te[20]||(te[20]=Pe=>yo(lt)?lt.value=Pe:null),"entity-name":"Record","on-delete":Ot},{"entity-preview":K(()=>[z("span",null,[z("div",A0,[z("div",E0,[le(He,{modelValue:e(G),"onUpdate:modelValue":te[19]||(te[19]=Pe=>yo(G)?G.value=Pe:null),column:e(yn)},null,8,["modelValue","column"])])])])]),_:1},8,["visible"]),le(Ms,{visible:e(yt),"onUpdate:visible":te[21]||(te[21]=Pe=>yo(yt)?yt.value=Pe:null),size:"small"},{default:K(()=>[z("div",M0,[z("div",T0,ce(L.$t("tooltip.saveChanges")),1),z("div",$0,ce(L.$t("activity.doYouWantToSaveTheChanges")),1),z("div",O0,[le(oe,{type:"secondary",size:"small",onClick:un},{default:K(()=>[Je(ce(L.$t("labels.discard")),1)]),_:1}),le(oe,{key:"submit",type:"primary",size:"small",loading:e(U),onClick:Dt},{default:K(()=>[Je(ce(L.$t("tooltip.saveChanges")),1)]),_:1},8,["loading"])])])]),_:1},8,["visible"])],64)}}}),sd=Object.assign(L0,{__name:"SmartsheetExpandedForm"}),cv=Object.freeze(Object.defineProperty({__proto__:null,default:sd},Symbol.toStringTag,{value:"Module"})),N0={"data-testid":"nc-expand-table-modal",class:"flex flex-col"},P0={class:"mb-2 nc-content-gray"},B0={class:"flex flex-row mt-5 justify-end gap-x-2"},W0={class:"flex gap-2 items-center"},z0={class:"flex gap-2 items-center"},V0=xo({__name:"DeleteAll",props:{modelValue:{type:Boolean},rows:{}},emits:["cancel","update:modelValue","deleteAll"],setup(t,{emit:n}){const o=t,l=n,a=Ra(o,"modelValue",l);Sf("esc",()=>{a.value=!1,l("update:modelValue",!1)});const i=()=>{a.value=!1,l("cancel")};return(r,s)=>{const u=da,c=Ms;return e(a)?(h(),J(c,{key:0,visible:e(a),"onUpdate:visible":s[1]||(s[1]=f=>yo(a)?a.value=f:null),"show-separator":!1,header:r.$t("activity.deleteAllRecords"),size:"small",onKeydown:s[2]||(s[2]=ls(f=>a.value=!1,["esc"]))},{default:K(()=>[s[3]||(s[3]=z("div",{class:"flex justify-between w-full text-base font-semibold mb-2 text-nc-content-gray-emphasis items-center"},ce("Delete all records"),-1)),z("div",N0,[z("div",P0,"Are you sure you want to delete all "+ce(r.rows)+" records present in this view?",1)]),s[4]||(s[4]=z("div",{class:"bg-nc-bg-gray-light py-2 px-4 flex items-center gap-4 w-full rounded-lg"},[z("div",{class:"leading-5 text-nc-content-gray"},"This action cannot be undone.")],-1)),z("div",B0,[z("div",W0,[le(u,{"data-testid":"nn-record-delete-cancel",type:"secondary",size:"small",onClick:i},{default:K(()=>[Je(ce(r.$t("labels.cancel")),1)]),_:1})]),z("div",z0,[le(u,{"data-testid":"nc-record-delete-all",type:"danger",size:"small",onClick:s[0]||(s[0]=f=>l("deleteAll"))},{default:K(()=>[Je(ce(r.$t("general.delete")),1)]),_:1})])])]),_:1,__:[3,4]},8,["visible","header"])):ge("",!0)}}}),fv=Object.assign(V0,{__name:"DlgRecordDeleteAll"}),j0={"data-testid":"nc-expand-upsert-modal",class:"flex flex-col"},U0={class:"mb-2 nc-content-gray"},G0={key:0,class:"font-bold"},H0={class:"font-bold"},Y0={class:"font-bold"},q0={class:"flex flex-row mt-5 justify-end gap-x-2"},X0={class:"flex gap-2 items-center"},K0={class:"flex gap-2 items-center"},J0=xo({__name:"Upsert",props:{newRows:{},modelValue:{type:Boolean},newColumns:{},cellsOverwritten:{},rowsUpdated:{},isAddingEmptyRowPermitted:{type:Boolean,default:!0},meta:{}},emits:["update:expand","cancel","update:modelValue"],setup(t,{emit:n}){const o=t,l=n,a=Ra(o,"modelValue",l),{isAddingEmptyRowPermitted:i}=xr(o),{showRecordPlanLimitExceededModal:r}=ql(),s=V(i.value),u=()=>{s.value&&r({callback(f){f==="ok"&&(a.value=!1)}})||(l("update:expand",s.value),a.value=!1)};Sf("esc",()=>{a.value=!1,l("update:modelValue",!1)});const c=()=>{a.value=!1,l("cancel")};return(f,v)=>{const p=km,g=Sr,y=xm,x=da,w=Ms;return e(a)?(h(),J(w,{key:0,visible:e(a),"onUpdate:visible":v[1]||(v[1]=m=>yo(a)?a.value=m:null),"show-separator":!1,header:f.$t("activity.createTable"),size:"small",onKeydown:v[2]||(v[2]=ls(m=>a.value=!1,["esc"]))},{default:K(()=>[v[6]||(v[6]=z("div",{class:"flex justify-between w-full text-base font-semibold mb-2 text-nc-content-gray-emphasis items-center"},ce("Do you want to expand this table ?"),-1)),z("div",j0,[z("div",U0,[v[3]||(v[3]=Je(" To accommodate your pasted data, we need to ")),f.cellsOverwritten&&f.rowsUpdated?(h(),B("span",G0," overwrite "+ce(f.cellsOverwritten)+" "+ce(f.cellsOverwritten===1?"cell":"cells")+" in "+ce(f.rowsUpdated)+" "+ce(f.rowsUpdated===1?"record":"records"),1)):ge("",!0),f.newRows?(h(),B(Qt,{key:1},[f.cellsOverwritten||f.rowsUpdated?(h(),B(Qt,{key:0},[Je(" and ")],64)):ge("",!0),z("span",H0," insert "+ce(f.newRows)+" additional "+ce(f.newRows===1?"record":"records"),1)],64)):ge("",!0),f.newColumns?(h(),B(Qt,{key:2},[f.cellsOverwritten||f.rowsUpdated||f.newRows?(h(),B(Qt,{key:0},[Je(" and ")],64)):ge("",!0),z("span",Y0," insert "+ce(f.newColumns)+" additional "+ce(f.newColumns===1?"field":"fields"),1)],64)):ge("",!0)]),(f.newRows??0)>0?(h(),J(y,{key:0,value:e(s),"onUpdate:value":v[0]||(v[0]=m=>yo(s)?s.value=m:null)},{default:K(()=>{var m;return[le(g,{entity:e(pl).TABLE,"entity-id":(m=f.meta)==null?void 0:m.id,permission:e(vl).TABLE_RECORD_ADD},{default:K(()=>[le(p,{"data-testid":"nc-table-expand-yes",style:{display:"flex",height:"30px",lineHeight:"30px"},value:!0,disabled:!e(i)},{default:K(()=>v[4]||(v[4]=[z("div",{class:"nc-content-gray"},[z("span",{class:"font-semibold"}," Expand "),Je(" table to accommodate all pasted cells ")],-1)])),_:1,__:[4]},8,["disabled"])]),_:1},8,["entity","entity-id","permission"]),le(p,{"data-testid":"nc-table-expand-no",style:{display:"flex",lineHeight:"30px"},value:!1},{default:K(()=>v[5]||(v[5]=[z("div",{class:"nc-content-gray leading-5"},[z("span",{class:"font-semibold"}," Don't expand "),Je(" the table. Values beyond the table's current size will be skipped. ")],-1)])),_:1,__:[5]})]}),_:1},8,["value"])):ge("",!0)]),z("div",q0,[z("div",X0,[le(x,{"data-testid":"nc-table-expand-cancel",type:"secondary",size:"small",onClick:c},{default:K(()=>[Je(ce(f.$t("labels.cancel")),1)]),_:1})]),z("div",K0,[le(x,{"data-testid":"nc-table-expand",type:"primary",size:"small",onClick:u},{default:K(()=>[Je(ce(f.$t("labels.continue")),1)]),_:1})])])]),_:1,__:[6]},8,["visible","header"])):ge("",!0)}}}),vv=Object.assign(J0,{__name:"DlgRecordUpsert"}),Q0={xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 16 16"},Z0={"clip-path":"url(#clip0_1422_4212)"},eb=["stroke"],tb=["stroke"],nb=["stroke"],ob=["stroke"],lb=["stroke"],ab=["stroke"],ib=["stroke"],rb=["stroke"],sb=xo({__name:"Spinner",props:{stroke:{default:"#4A5268"}},setup(t){return(n,o)=>(h(),B("svg",Q0,[z("g",Z0,[z("path",{class:"loader-line",d:"M8 12V14.6667",stroke:n.stroke,"stroke-width":"1.33333","stroke-linecap":"round","stroke-linejoin":"round"},null,8,eb),z("path",{class:"loader-line",d:"M10.8267 10.8267L12.7133 12.7133",stroke:n.stroke,"stroke-width":"1.33333","stroke-linecap":"round","stroke-linejoin":"round"},null,8,tb),z("path",{class:"loader-line",d:"M12 8H14.6667",stroke:n.stroke,"stroke-width":"1.33333","stroke-linecap":"round","stroke-linejoin":"round"},null,8,nb),z("path",{class:"loader-line",d:"M10.8267 5.17335L12.7133 3.28668",stroke:n.stroke,"stroke-width":"1.33333","stroke-linecap":"round","stroke-linejoin":"round"},null,8,ob),z("path",{class:"loader-line",d:"M8 1.33331V3.99998",stroke:n.stroke,"stroke-width":"1.33333","stroke-linecap":"round","stroke-linejoin":"round"},null,8,lb),z("path",{class:"loader-line",d:"M3.28662 3.28668L5.17329 5.17335",stroke:n.stroke,"stroke-width":"1.33333","stroke-linecap":"round","stroke-linejoin":"round"},null,8,ab),z("path",{class:"loader-line",d:"M1.33325 8H3.99992",stroke:n.stroke,"stroke-width":"1.33333","stroke-linecap":"round","stroke-linejoin":"round"},null,8,ib),z("path",{class:"loader-line",d:"M3.28662 12.7133L5.17329 10.8267",stroke:n.stroke,"stroke-width":"1.33333","stroke-linecap":"round","stroke-linejoin":"round"},null,8,rb)]),o[0]||(o[0]=z("defs",null,[z("clipPath",{id:"clip0_1422_4212"},[z("rect",{width:"16",height:"16",fill:"white"})])],-1))]))}}),ub=Object.assign(sb,{__name:"GeneralSpinner"}),db=xo({__name:"TableDataCell",props:{active:{type:Boolean}},setup(t){const n=t,{active:o}=xr(n),l=V(),a=jo(),i=jo();wo(Hu,a),wo(If,i),wo(Ff,l);const r=s=>{a.trigger(s),i.trigger(s)};return id(o,s=>{i.trigger(s)},{isGridCell:!0,immediate:!0}),(s,u)=>(h(),B("td",{ref_key:"el",ref:l,class:"select-none",onClick:r},[Yu(s.$slots,"default")],512))}}),pv=Object.assign(db,{__name:"SmartsheetTableDataCell"}),cb={class:"nc-icon",viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"};function fb(t,n){return h(),B("svg",cb,n[0]||(n[0]=[z("path",{fill:"currentColor",d:"M20 2H4c-1.1 0-2 .9-2 2v18l4-4h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2m0 14H5.2L4 17.2V4h16z"},null,-1)]))}const ud=br({name:"mdi-message-outline",render:fb}),hv=({fields:t,tableBodyEl:n,gridWrapper:o})=>{const{eventBus:l,isDefaultView:a,meta:i}=Fl(),{addUndo:r,defineViewScope:s}=Mi(),{activeView:u}=Uo(yr()),{gridViewCols:c,updateGridViewColumn:f}=Ha(),{leftSidebarWidth:v}=Uo(iv()),{width:p}=qu(),g=V(!1),y=V(null),x=V(null),w=V(null),m=(F,I)=>{var M,A,j;(M=i.value)!=null&&M.columns&&(i.value.columns=(i.value.columns||[]).map(N=>(N.id!==F||(N.meta={...jn(N.meta||{}),defaultViewColOrder:I}),N)),(j=(A=i.value)==null?void 0:A.columnsById)!=null&&j[F]&&(i.value.columnsById[F].meta={...jn(i.value.columnsById[F].meta),defaultViewColOrder:I}))},C=async(F,I)=>{const M=c.value[F],A=c.value[I];if(!M||!A)return;const j=t.value.findIndex(me=>me.id===I),N=j<t.value.length-1?t.value[j+1]:null,Y=N?c.value[N.id]:null,ae=t.value[t.value.length-1],he=c.value[ae.id];if(Y===null&&he===null)return;const ye=Y?A.order+(Y.order-A.order)/2:he.order+1,re=M.order;M.order=ye,a.value&&M.fk_column_id&&m(M.fk_column_id,ye),r({undo:{fn:async()=>{t.value&&(M.order=re,a.value&&m(M.fk_column_id,re),await f(F,{order:re}),l.emit(qo.FIELD_RELOAD))},args:[]},redo:{fn:async()=>{t.value&&(M.order=ye,a.value&&m(M.fk_column_id,ye),await f(F,{order:ye}),l.emit(qo.FIELD_RELOAD))},args:[]},scope:s({view:u.value})}),await f(F,{order:ye},!0),l.emit(qo.FIELD_RELOAD)},b=async()=>{g.value=!0;try{if(!x.value)return;x.value.style.left="0px",x.value.style.height="0px",await C(y.value.id,w.value)}catch(F){console.error("Failed to reorder column: ",F)}finally{g.value=!1}y.value=null,w.value=null};return{onDrag:F=>{if(F.preventDefault(),!F.dataTransfer||!y.value||!x.value)return;if(F.clientX===0){b();return}const I=x.value.getBoundingClientRect().top,A=document.elementsFromPoint(F.clientX,I).find(Y=>Y.classList.contains("nc-grid-column-header"));A&&(w.value=(A==null?void 0:A.getAttribute("data-col"))??null);const j=F.clientX-v.value;j>=0&&(x.value.style.left=`${j.toString()}px`);const N=parseFloat(getComputedStyle(document.documentElement).fontSize);j<v.value+1*N?setTimeout(()=>{o.value.scrollLeft-=2.5},250):p.value-j-v.value<15*N&&setTimeout(()=>{o.value.scrollLeft+=2.5},250)},onDragStart:(F,I)=>{var Y;if(!I.dataTransfer)return;const M=document.querySelector('[data-testid="drag-icon-placeholder"]');if(!M||!x.value)return;I.dataTransfer.dropEffect="none",I.dataTransfer.effectAllowed="none",I.dataTransfer.setDragImage(M,10,10),I.dataTransfer.clearData(),I.dataTransfer.setData("text/plain",F),y.value=t.value.find(ae=>ae.id===F)??null;const A=parseFloat(getComputedStyle(document.documentElement).fontSize),j=((Y=n.value)==null?void 0:Y.getBoundingClientRect().height)??6.1*A;x.value.style.height=`${j}px`;const N=I.clientX-v.value;N>=0&&x.value&&(x.value.style.left=`${N.toString()}px`)},onDragEnd:async F=>{F.preventDefault(),await ka(()=>!g.value).toBeTruthy(),!(!F.dataTransfer||!y.value||!w.value)&&b()},draggedCol:y,dragColPlaceholderDomRef:x,toBeDroppedColId:w}},vb=({updateRecordOrder:t,gridWrapper:n,virtualMargin:o,rowSlice:l,rowHeight:a,totalRows:i,cachedRows:r})=>{const s=V(!1),u=V(null),c=V(0),f=V(null),v=V(0),p=V(0),g=V(32),y=V(null),x=V(!1),w=V(null),m=V(null),C=(A,j)=>{const N=A.cloneNode(!0);return N.style.position="absolute",N.style.background="white",N.style.width="500px",N.style.overflowX="hidden",N.style.height=`${A.offsetHeight}px`,N.style.pointerEvents="none",N.style.zIndex="1000",N.style.border="1px solid #D5D5D9",N.style.transition="transform",N.style.borderRadius="6px",N.style.boxShadow="0px 12px 16px -4px rgba(0, 0, 0, 0.10), 0px 4px 6px -2px rgba(0, 0, 0, 0.06)",N.style.transformOrigin="center center",N.style.animation="dragStart 0.2s ease-out forwards",N.setAttribute("data-testid",`grid-row-${j}`),document.body.appendChild(N),N},b=A=>{!m.value||!n.value||(m.value.style.top=`${p.value+48+44+32}px`,m.value.style.left=`${A}px`)},S=()=>{m.value&&(m.value.remove(),m.value=null)},k=(A,j=!1)=>{try{if(A!==null?(A.preventDefault(),y.value=A):A=y.value,!n.value||!A)return;const N=n.value.getBoundingClientRect(),Y=N.bottom-N.top;p.value=Math.max(0,Math.min(c.value+A.clientY-v.value,Y-a.value)),b(A.clientX);const ae=A.clientY-N.top+n.value.scrollTop,he=Math.max(0,Math.min(Math.round(ae/a.value),i.value+1)),ye=Math.max(0,l.start-o),re=Math.max(ye,Math.min(he,l.end+o));g.value=Math.max(re*a.value,32)+(a.value===32?0:32),g.value===0&&a.value!==32&&(g.value=g.value-32);const me=he-l.start-(a.value===32?1:0);if(!x.value||!j){const U=Math.ceil(Y/100*10),Ae=A.clientY-N.top,je=Y-Ae;let Ue=0;const ot=n.value.scrollTop>0,G=n.value.scrollTop<n.value.scrollHeight-Y;if(Ae<U&&ot?Ue=-(6-Math.ceil(Math.max(0,Ae)/U*6)):je<U&&G&&(Ue=6-Math.ceil(Math.max(0,je)/U*6)),Ue!==0){const pe=n.value.scrollTop+Ue;pe>=0&&pe<=n.value.scrollHeight-Y?(x.value=!0,n.value.scrollTop=pe,w.value!==null&&cancelAnimationFrame(w.value),w.value=requestAnimationFrame(()=>{k(null,!1)})):x.value=!1}else x.value=!1,w.value!==null&&(cancelAnimationFrame(w.value),w.value=null)}const W=r.value.get(Math.max(l.start+me,0));f.value=W,(W==null?void 0:W.rowMeta.rowIndex)!==u.value.rowMeta.rowIndex&&(W==null?void 0:W.rowMeta.rowIndex)!==u.value.rowMeta.rowIndex+1?g.value=Math.max(re*a.value,32)+(a.value===32?0:32):g.value=-9999}catch(N){console.error("Error in moveHandler:",N),F()}},D=async A=>{var j,N,Y,ae,he,ye,re,me;try{A.preventDefault(),F();const W=((N=(j=u.value)==null?void 0:j.rowMeta)==null?void 0:N.rowIndex)===((ae=(Y=f.value)==null?void 0:Y.rowMeta)==null?void 0:ae.rowIndex)||((ye=(he=f.value)==null?void 0:he.rowMeta)==null?void 0:ye.rowIndex)===((me=(re=u.value)==null?void 0:re.rowMeta)==null?void 0:me.rowIndex)+1;u.value&&u.value.rowMeta.rowIndex!==void 0&&!W&&await t(u.value.rowMeta.rowIndex,f.value?f.value.rowMeta.rowIndex:null),u.value=null,f.value=null}catch(W){console.error("Error in mouseUp:",W),F()}};function F(){try{s.value=!1,x.value=!1,S(),w.value!==null&&(cancelAnimationFrame(w.value),w.value=null),window.removeEventListener("mousemove",k),window.removeEventListener("mouseup",D)}catch(A){console.error("Error in cancel:",A)}}const I=A=>A*a.value,M=(A,j)=>{var N;try{const Y=j.target.closest(`[data-testid="grid-row-${A.rowMeta.rowIndex}"]`);if(!Y)return;u.value=A,c.value=I(A.rowMeta.rowIndex)-(((N=n.value)==null?void 0:N.scrollTop)||0),v.value=j.clientY,p.value=32,g.value=32,f.value=null,m.value=C(Y,A.rowMeta.rowIndex),b(j.clientX),s.value=!0,k(j),window.addEventListener("mousemove",k),window.addEventListener("mouseup",D)}catch(Y){console.error("Error in startDragging:",Y),F()}};return Xu(()=>{F()}),{startDragging:M,draggingRecord:u,cancel:F,isDragging:s,targetTop:g}};function tu(){const{nestedFilters:t,allFilters:n,sorts:o,validFiltersFromUrlParams:l,meta:a}=Fl(),i=!1,r=ue(()=>{var v;return(((v=a.value)==null?void 0:v.columns)||[]).filter(p=>p.uidt===ve.User).map(p=>p.id)}),s=ue(()=>{const v=new Set,p=g=>{var y;if(g&&g.length>0)for(const x of g)x.is_group?(((y=x.children)==null?void 0:y.length)??0)>0&&p(x.children):x.fk_column_id&&v.add(x.fk_column_id)};return p([...n.value,...t.value,...l.value]),v}),u=ue(()=>{const v=new Set;if(!(o!=null&&o.value)||o.value.length===0)return v;for(const p of o.value)p.fk_column_id&&v.add(p.fk_column_id);return v}),c=(v,p=!1)=>{if(p)return s.value.has(v)?"FILTERED":u.value.has(v)?"SORTED":void 0};return{appearanceConfig:{FILTERED:{cellBgColor:Jn.green[50],"cellBgColor.hovered":Jn.green[100],"cellBgColor.selected":Jn.green[100],cellBorderColor:Jn.gray[200],"cellBorderColor.hovered":Jn.gray[200],"cellBorderColor.selected":Jn.gray[200],cellBgClass:"!bg-green-50 column-filtered",toolbarBgClass:"!bg-nc-bg-green-light !hover:bg-nc-bg-green-dark",toolbarChipBgClass:"bg-nc-bg-green-dark group-hover:bg-green-200",toolbarTextClass:"text-green-700",headerBgColor:"#27D6650A",headerBgClass:"relative !bg-[#ffffff88] after:content-[''] after:absolute after:block after:inset-0 !after:bg-[#27D6650A] after:pointer-events-none"},SORTED:{cellBgColor:Jn.orange[50],"cellBgColor.hovered":Jn.orange[100],"cellBgColor.selected":Jn.orange[100],cellBorderColor:Jn.gray[200],"cellBorderColor.hovered":Jn.gray[200],"cellBorderColor.selected":Jn.gray[200],cellBgClass:"!bg-orange-50 column-sorted !border-b-gray-200",toolbarBgClass:"!bg-nc-bg-orange-light !hover:bg-nc-bg-orange-dark",toolbarChipBgClass:"bg-nc-bg-orange-dark group-hover:bg-orange-200",toolbarTextClass:"text-orange-700",headerBgColor:"#FA82310A",headerBgClass:"relative !bg-[#ffffff88] after:content-[''] after:absolute after:block after:inset-0 !after:bg-[#FA82310A] after:pointer-events-none"}},filteredColumnIds:s,sortedColumnIds:u,isColumnSortedOrFiltered:c,userColumnIds:r,isCellColouringEnabled:i}}const dd=()=>{const{t}=la();return{paste:async()=>{try{if(!navigator.clipboard)throw new Error(t("msg.error.pasteFromClipboardError"));const o=await navigator.clipboard.readText(),l=new Event("paste",{bubbles:!1,cancelable:!0});return Object.defineProperty(l,"clipboardData",{value:{getData:()=>o||""}}),document.dispatchEvent(l),!0}catch{return Zt.error(t("msg.error.pasteFromClipboardError")),!1}}}},[pb,hb]=Jf((t,n,o,l)=>{const{$api:a}=ua(),i=dn(wr,V([])),r=dn(zl,V(!1)),{gridViewCols:s,updateGridViewColumn:u}=Ha(),{nestedFilters:c}=Fl(),{isUIAllowed:f}=wl(),{fetchAggregatedData:v}=ju(),p=V({}),g=dn(Ku),y=ue(()=>i.value.map((k,D)=>({field:k,index:D})).filter(k=>k.index!==0).map(k=>{const D=s.value[k.field.id];return D?{value:p.value[k.field.title]??null,field:D,column:k.field,index:k.index,width:`${Number((D.width??"").replace("px",""))}px`||"180px"}:{field:null,index:k.index}})),x=ue(()=>{var S;return!((S=i.value)!=null&&S.length)||!s.value?{field:null,width:"180px"}:{value:p.value[i.value[0].title]??null,column:i.value[0],field:s.value[i.value[0].id],width:`${Number((s.value[i.value[0].id].width??"").replace("px",""))+80}px`||"260px"}}),w=S=>{var k,D;return S.uidt===ve.Formula&&((D=(k=S.colOptions)==null?void 0:k.parsed_tree)!=null&&D.dataType)?ec(S.uidt,S.colOptions.parsed_tree):ec(S.uidt)},m=async S=>{await ka(()=>!!n.value).toBeTruthy({timeout:1e4}).then(async()=>{var k,D;if(!(!((k=t.value)!=null&&k.type)||((D=t.value)==null?void 0:D.type)!==Ul.GRID))try{const F=r.value?await v({where:o==null?void 0:o.value,filtersArr:c.value,...S?{aggregation:S}:{}}):await a.dbDataTableAggregate.dbDataTableAggregate(n.value.id,{viewId:t.value.id,where:o==null?void 0:o.value,...f("filterSync")?{}:{filterArrJson:JSON.stringify(c.value)},...S?{aggregation:S}:{}});Object.assign(p.value,F),l==null||l.trigger()}catch(F){console.log(F),Zt.error(await vf(F))}})},C=async(S,k)=>{var D;await(g==null?void 0:g.trigger({fields:[{title:((D=i.value.find(F=>F.id===S))==null?void 0:D.title)??"",aggregation:k}]})),await u(S,{aggregation:k}),l==null||l.trigger()},b=ue(()=>i.value.filter(S=>{var k,D,F;return!(!(S!=null&&S.id)||!(S!=null&&S.title)||!mf(S)||!s.value[S.id]||!((k=s.value[S.id])!=null&&k.aggregation)||((D=s.value[S.id])==null?void 0:D.aggregation)===Wa.None||!((F=S.colOptions)!=null&&F.formula_raw))}).map(S=>{var k,D;return{id:S.id,aggregation:((k=s.value[S.id])==null?void 0:k.aggregation)??Wa.None,formula_raw:((D=S.colOptions)==null?void 0:D.formula_raw)??""}}));return g==null||g.on(async S=>{var k;if((!S||!((k=S==null?void 0:S.fields)!=null&&k.length))&&await m(),S!=null&&S.fields){const D=S.fields.reduce((F,I)=>{const M=i.value.find(A=>A.title===I.title);if(!(M!=null&&M.id))return F;F[M.id]=I.aggregation??s.value[M.id].aggregation??Wa.None;for(const A of b.value)!F[A.id]&&A.formula_raw.includes(I.title)&&(F[A.id]=A.aggregation);return F},{});await m(Object.entries(D).map(([F,I])=>({field:F,type:I})))}}),{loadViewAggregate:m,isPublic:r,aggregations:p,updateAggregate:C,getAggregations:w,displayFieldComputed:x,visibleFieldsComputed:y}});function nu(){const t=hb();if(t==null)throw new Error("Please call `useProvideViewAggregate` on the appropriate parent component");return t}class zs{constructor(n=null,o=null){vo(this,"_start");vo(this,"_end");vo(this,"_oldStart");vo(this,"_oldEnd");this._start=n,this._end=o??this._start,this._oldStart=n,this._oldEnd=o??this._start}isEmpty(){return this._start==null||this._end==null}isSingleCell(){var n,o,l,a;return!this.isEmpty()&&((n=this._start)==null?void 0:n.col)===((o=this._end)==null?void 0:o.col)&&((l=this._start)==null?void 0:l.row)===((a=this._end)==null?void 0:a.row)}isSingleRow(){var n,o;return!this.isEmpty()&&((n=this._start)==null?void 0:n.row)===((o=this._end)==null?void 0:o.row)}isCellInRange(n){return!this.isEmpty()&&n.row>=this.start.row&&n.row<=this.end.row&&n.col>=this.start.col&&n.col<=this.end.col}isRowInRange(n){return!this.isEmpty()&&n>=this.start.row&&n<=this.end.row}isColInRange(n){return!this.isEmpty()&&n>=this.start.col&&n<=this.end.col}isDifferentColSelection(){return this.isEmpty()||this.isSingleCell()?!1:this.oldStart.col!==this.start.col||this.oldEnd.col!==this.end.col}get start(){var n,o,l,a;return{row:Math.min(((n=this._start)==null?void 0:n.row)??NaN,((o=this._end)==null?void 0:o.row)??NaN),col:Math.min(((l=this._start)==null?void 0:l.col)??NaN,((a=this._end)==null?void 0:a.col)??NaN)}}get oldStart(){var n,o,l,a;return{row:Math.min(((n=this._oldStart)==null?void 0:n.row)??NaN,((o=this._oldEnd)==null?void 0:o.row)??NaN),col:Math.min(((l=this._oldStart)==null?void 0:l.col)??NaN,((a=this._oldEnd)==null?void 0:a.col)??NaN)}}get end(){var n,o,l,a;return{row:Math.max(((n=this._start)==null?void 0:n.row)??NaN,((o=this._end)==null?void 0:o.row)??NaN),col:Math.max(((l=this._start)==null?void 0:l.col)??NaN,((a=this._end)==null?void 0:a.col)??NaN)}}get oldEnd(){var n,o,l,a;return{row:Math.max(((n=this._oldStart)==null?void 0:n.row)??NaN,((o=this._oldEnd)==null?void 0:o.row)??NaN),col:Math.max(((l=this._oldStart)==null?void 0:l.col)??NaN,((a=this._oldEnd)==null?void 0:a.col)??NaN)}}startRange(n){this._start=n,this._end=n,this._oldStart=n,this._oldEnd=n}endRange(n){this._oldEnd=this._end,this._end=n}clear(){this._oldStart=this._start,this._oldEnd=this._end,this._start=null,this._end=null}}const cr=async t=>{if(!t.addOptions||t.addOptions.length===0)return;t.col.colOptions||(t.col.colOptions={options:[]});const n=t.col.colOptions.options.length??0,o=typeof t.addOptions[0]=="string"?t.addOptions.map((l,a)=>({fk_column_id:t.col.id,title:l,order:n+a+1,color:Su.light[(n+a)%Su.light.length]})):t.addOptions;t.col.colOptions.options=[...t.col.colOptions.options,...o],await t.api.dbTableColumn.update(t.col.id,t.col)},pu=0;function mv(t,n,o,l,a,i,r,s,u,c,f,v,p,g,y,x,w,m,C,b,S,k,D,F=!0){const I=V(t),M=100,A=50,{t:j}=la(),{copy:N}=qs(),{getMeta:Y,metas:ae}=ai(),{appInfo:he}=tl(),{isMysql:ye,isPg:re}=Ca(),{base:me}=Uo(Ca()),{api:W}=Af(),{$api:U}=ua(),{addUndo:Ae,clone:je,defineViewScope:Ue}=Mi(),{isDataReadOnly:ot}=wl(),{meta:G}=Ef(),{isAiFeaturesEnabled:pe}=kr(),{isSqlView:ne,isExternalSource:be}=Fl(),{blockExternalSourceRecordVisibility:ee,showUpgradeToAddMoreAttachmentsInCell:H,maxAttachmentsAllowedInCell:Ce}=ql(),{batchUploadFiles:Ie}=Ri(),Q=V(!1),ie=typeof e(o)=="object"&&Array.isArray(e(o)),Me=V(C),Be=V(a),it=V(!1),Ge=V(!1),ze=V(m),Z=Si(new zs),Et=Si(new zs),_e=Si({row:null,col:null}),yn=ue(()=>{var _;return(_=e(n))==null?void 0:_.length}),It=ue(()=>!(_e.row===null||_e.col===null||isNaN(_e.row)||isNaN(_e.col))),$t=ue(()=>ee(be.value)&&e(l)>=ol);function et(_,O){const T={...O};if(Math.abs(O.row-_.row)+1>M){const q=O.row>_.row?1:-1;T.row=_.row+(M-1)*q}return T}function cn(_,O){_e.row===_&&_e.col===O||(Be.value=!1,_e.row=_,_e.col=O)}const Pn=(_,O,T)=>{var q;const se=(O.title&&_.row[O.title])??"";return as.parseValue(se,{col:O,isMysql:ye,isPg:re,meta:I.value,metas:ae.value,rowId:Ho(O)?Ht(_.row,(q=I.value)==null?void 0:q.columns):null})},Kt=(_,O,T)=>{let se="<table>",q="";const L=[];return _.forEach((te,we)=>{let oe="<tr>";const Ee=[];O.forEach((Ne,He)=>{const Ze=Pn(te,Ne);oe+=`<td>${Ze}</td>`,q=`${q}${Ze}${O.length-1!==He?"	":""}`,Ee.push(Ze)}),se+=`${oe}</tr>`,_.length-1!==we&&(q=`${q}
`),L.push(Ee)}),se+="</table>",{html:se,text:q,json:L}},nn=async(_,O)=>{var te;const{html:T,text:se}=Kt(_,O),q=new Blob([T],{type:"text/html"}),L=new Blob([se],{type:"text/plain"});return((te=navigator.clipboard)==null?void 0:te.write([new ClipboardItem({[q.type]:q,[L.type]:L})]))??N(se)};async function wt(_){try{if(Z.start!==null&&Z.end!==null&&!Z.isSingleCell()){let O;if(ie)O=e(o).slice(Z.start.row,Z.end.row+1);else{const se=Math.floor(Z.start.row/A),q=Math.floor(Z.end.row/A),L=new Set;for(let te=se;te<=q;te++)L.add(te);await Promise.all([...L].map(S)),O=await D(Z.start.row,Z.end.row)}const T=e(n).slice(Z.start.col,Z.end.col+1);await nn(O,T),Zt.toast(j(`msg.toast.nCell${O.length*T.length===1?"":"s"}Copied`,{n:O.length*T.length}))}else{const O=(_==null?void 0:_.row)??_e.row,T=(_==null?void 0:_.col)??_e.col;if(O!=null&&T!=null){const se=ie?e(o)[O]:e(o).get(O);if(!se)return;const q=e(n)[T],L=Pn(se,q);await N(sa(L)?L:""),Zt.toast(j("msg.toast.nCellCopied",{n:1}))}}}catch{Zt.error(j("msg.error.copyToClipboardError"))}}const Dn=ue(()=>{const _={};if(Et._start===null||Et._end===null)return _;for(let O=Et.start.row;O<=Et.end.row;O++)for(let T=Et.start.col;T<=Et.end.col;T++)_[`${O}-${T}`]=!0;return _}),un=ue(()=>{const _={};if(_e.row!==null&&_e.col!==null&&(_[`${_e.row}-${_e.col}`]=!0),Z._start===null||Z._end===null)return _;for(let O=Z.start.row;O<=Z.end.row;O++)for(let T=Z.start.col;T<=Z.end.col;T++)_[`${O}-${T}`]=!0;return _});function Bn(_,O,T){if(Ge.value){const q=ie?e(o)[O]:e(o).get(O);if(!q||!Z._start||!Z._end||q.rowMeta.new)return;const L=Math.min(Z._start.row+100,O),te=Q.value?Math.min(Z._start.col+100,T):Z._end.col;Et.endRange({row:L,col:te}),f==null||f(L,T);return}if(!it.value)return;const se=et(Z.start,{row:O,col:T});Z.endRange(se),f==null||f(se.row,se.col),_.preventDefault()}function tt(_,O,T){if(!(((_==null?void 0:_.button)!==pu||(_==null?void 0:_.button)===pu&&_.ctrlKey)&&un.value[`${O}-${T}`])){if(Be.value||(it.value=!0),r.value=!1,_.preventDefault(),_.shiftKey){(_e.col===null||_e.row===null)&&Z.startRange({row:O,col:T}),Z.endRange({row:O,col:T});return}Z.startRange({row:O,col:T}),(_e.row!==O||_e.col!==T)&&(_e.col=null)}}const mt=(_,O,T)=>{(!_.shiftKey||_e.col===null||_e.row===null)&&cn(O,T),f==null||f(O,T)};function Dt(_,O,T=!1){return!_||!O?(T&&Zt.toast("Please select a cell to paste"),!1):_o(O)||xa(O)||O!=null&&O.readonly?(T&&Zt.toast(j("msg.info.pasteNotSupported")),!1):O.ai?(T&&Zt.toast(j("msg.info.autoIncFieldNotEditable")),!1):O.pk&&!_.rowMeta.new?(T&&Zt.toast(j("msg.info.editingPKnotSupported")),!1):!0}const Rt=async({rawMatrix:_,cpCols:O,rowToPaste:T,data:se})=>{var Ze;if(_.length===0)return;const q=T.end-T.start>0?1:-1,L=q===-1?_.reverse():_,te=L[0].map((Ke,ft)=>L.map(Ye=>Ye[ft])),we=[],oe=Math.abs(T.end-T.start)+1;for(const[Ke,ft]of te.entries()){const Ye=O[Ke],qe=as.populateFillHandle({column:Ye,highlightedData:ft,numberOfRows:oe});qe&&we.push(qe)}const Ee=[];let Ne=0;const He={};for(let Ke=T.start+q*_.length;q===1?Ke<=T.end:Ke>=T.end;Ke+=q){const ft=se[Ke];if(ft){for(const[Ye,qe]of O.entries()){const ht=Ml({value:we[Ye][Ne],to:qe.uidt,column:qe,appInfo:e(he),maxAttachmentsAllowedInCell:Ce.value,showUpgradeToAddMoreAttachmentsInCell:H,isInfoShown:He[qe.title],markInfoShown:()=>{He[qe.title]=!0}},ye((Ze=I.value)==null?void 0:Ze.source_id),!0);ft.row[qe.title]=ht}Ee.push(ft)}Ne++}await(y==null?void 0:y(Ee,O.map(Ke=>Ke.title)))},ct=_=>{var O,T;if(Ge.value)try{const se=!!Q.value;Ge.value=!1,Q.value=!1;const q={};if(Et._start===null||Et._end===null)return;if(Z._start!==null&&Z._end!==null){const L={row:Z._start.row,col:Z._start.col};let te;ie?te=e(o).slice(Z.start.row,Z.end.row+1):te=Array.from(e(o)).filter(([ht])=>ht>=Z.start.row&&ht<=Z.end.row).map(([,ht])=>ht);const we=e(n).slice(Z.start.col,Z.end.col+1),oe=Kt(te,we).json,Ee=Et._start.row<=Et._end.row?1:-1,Ne=Math.max(Z.start.row,Z.end.row,Et._start.row,Et._end.row),He=Math.min(Z.start.row,Z.end.row,Et._start.row,Et._end.row);if(!se){const ht=ie?e(o):e(o)instanceof Map?Array.from(e(o),([zt,Le])=>Le):e(o);return Rt({data:ht,rawMatrix:oe,cpCols:we,rowToPaste:{start:Ee===1?He:Ne,end:Ee===1?Ne:He}}).then(()=>{Et._start===null||Et._end===null||(Z.startRange(L),Z.endRange(Et._end),cn(L.row,L.col),Et.clear())})}let Ze=Ee===1?0:oe.length-1;const Ke=[],ft=[],Ye=[],qe=[];for(let ht=Et._start.row;Ee===1?ht<=Et._end.row:ht>=Et._end.row;ht+=Ee){const zt=ie?e(o)[ht]:e(o).get(ht);if(!zt)continue;let Le=0;un.value[`${ht}-${Z.start.col}`]||Ke.push(zt);for(let Se=Et.start.col;Se<=Et.end.col;Se++){const Mt=e(n)[Se];if(!Dt(zt,Mt)){Le++;continue}if(Z._start&&Z._end&&Z._start.col<=Se&&Se<=Z._end.col){we.findIndex(Pe=>Pe.id===Mt.id)===-1&&(qe.includes(Mt.title)||Ye.push(Mt.title)),!Ye.includes(Mt.title)&&!qe.includes(Mt.title)&&Ye.push(Mt.title);let xe;try{xe=Ml({value:oe[Ze][Le],to:Mt.uidt,column:Mt,appInfo:e(he),maxAttachmentsAllowedInCell:Ce.value,showUpgradeToAddMoreAttachmentsInCell:H,isInfoShown:q[Mt.title],markInfoShown:()=>{q[Mt.title]=!0}},ye((O=I.value)==null?void 0:O.source_id),!0)}catch(Pe){if(Pe instanceof ki)throw Pe;xe=null}xe!==void 0&&(se||(zt.row[Mt.title]=xe))}else se&&(qe.push(Mt.title),ft.find(xe=>{var Pe,gt;return Ht(xe.row,(Pe=I.value)==null?void 0:Pe.columns)===Ht(zt.row,(gt=I.value)==null?void 0:gt.columns)})||ft.push(zt));Le++}Ee===1?Ze=Ze<oe.length-1?Ze+1:0:Ze=Ze>=1?Ze-1:oe.length-1}if(se){const ht=te.map(Le=>{var Mt;const Se={Id:Ht(Le.row,(Mt=I.value)==null?void 0:Mt.columns)};for(const xe of Ye)Se[xe]=Le.row[xe];for(const xe of qe)Se[xe]="FILL";return Se}),zt=Ke.map(Le=>{var Se;return Ht(Le.row,(Se=I.value)==null?void 0:Se.columns)});U.ai.dataFill((T=I.value)==null?void 0:T.id,{rows:ht,generateIds:zt,numRows:zt.length}).then(Le=>{if(!(Et._start===null||Et._end===null)){for(const Se of Ke.concat(ft)){const Mt=Le.find(xe=>{var Pe,gt;return Ht(Se.row,(Pe=I.value)==null?void 0:Pe.columns)===Ht(xe,(gt=I.value)==null?void 0:gt.columns)});if(Mt)for(const xe of Ye.concat(qe))Se.row[xe]=Mt[xe]}y==null||y(Ke.concat(ft),Ye.concat(qe)).then(()=>{Et._start===null||Et._end===null||(Z.startRange(L),Z.endRange(Et._end),cn(L.row,L.col),Et.clear())})}});return}y==null||y(Ke,Ye).then(()=>{Et._start===null||Et._end===null||(Z.startRange(L),Z.endRange(Et._end),cn(L.row,L.col),Et.clear())})}else Et.clear();return}catch(se){(!(se instanceof za)||!se.isErrorSuppressed)&&(console.error(se,se.isErrorSuppressed),Zt.error((se==null?void 0:se.message)||"Something went wrong"))}it.value&&(it.value=!1,setTimeout(()=>{Z._start&&(_e.row!==Z._start.row||_e.col!==Z._start.col)&&cn(Z._start.row,Z._start.col)},0))},rt=Ju(async _=>{var T,se,q,L,te,we,oe,Ee,Ne,He,Ze,Ke,ft,Ye,qe,ht,zt,Le,Se,Mt,xe,Pe;const O=Va()?_.metaKey:_.ctrlKey;if(!(_e.row===null||_e.col===null))switch(_.key){case"Tab":Z.clear(),_.shiftKey?_e.col>0?(_e.col--,Be.value=!1):_e.row>0&&(_e.row--,_e.col=e(yn.value)-1,Be.value=!1):_e.col<e(yn.value)-1?(_e.col++,Be.value=!1):_e.row<(ie?e(o).length:e(l))-1&&(_e.row++,_e.col=0,Be.value=!1),f==null||f();break;case"ArrowRight":_.shiftKey?O?(Be.value=!1,Z.endRange({row:((T=Z._end)==null?void 0:T.row)??_e.row,col:e(yn.value)-1}),f==null||f((se=Z._end)==null?void 0:se.row,(q=Z._end)==null?void 0:q.col)):(((L=Z._end)==null?void 0:L.col)??_e.col)<e(yn.value)-1&&(Be.value=!1,Z.endRange({row:((te=Z._end)==null?void 0:te.row)??_e.row,col:(((we=Z._end)==null?void 0:we.col)??_e.col)+1}),f==null||f((oe=Z._end)==null?void 0:oe.row,(Ee=Z._end)==null?void 0:Ee.col)):(Z.clear(),_e.col<e(yn.value)-1&&(_e.col++,Z.startRange({row:_e.row,col:_e.col}),f==null||f(),Be.value=!1));break;case"ArrowLeft":_.shiftKey?O?(Be.value=!1,Z.endRange({row:((Ne=Z._end)==null?void 0:Ne.row)??_e.row,col:0}),f==null||f((He=Z._end)==null?void 0:He.row,(Ze=Z._end)==null?void 0:Ze.col)):(((Ke=Z._end)==null?void 0:Ke.col)??_e.col)>0&&(Be.value=!1,Z.endRange({row:((ft=Z._end)==null?void 0:ft.row)??_e.row,col:(((Ye=Z._end)==null?void 0:Ye.col)??_e.col)-1}),f==null||f((qe=Z._end)==null?void 0:qe.row,(ht=Z._end)==null?void 0:ht.col)):(Z.clear(),_e.col>0&&(_e.col--,Z.startRange({row:_e.row,col:_e.col}),f==null||f(),Be.value=!1));break;case"ArrowUp":if(_.shiftKey){const gt=Z._start??_e;let X;O?X={row:0,col:((zt=Z._end)==null?void 0:zt.col)??_e.col}:X={row:(((Le=Z._end)==null?void 0:Le.row)??_e.row)-1,col:((Se=Z._end)==null?void 0:Se.col)??_e.col};const Fe=et(gt,X);Be.value=!1,Z.endRange(Fe),f==null||f(Fe.row,Fe.col,"instant")}else Z.clear(),_e.row>0&&(_e.row--,Z.startRange({row:_e.row,col:_e.col}),f==null||f(),Be.value=!1);k==null||k();break;case"ArrowDown":if(_.shiftKey){const gt=Z._start??_e;let X;O?X={row:(ie?e(o).length:e(l))-1,col:((Mt=Z._end)==null?void 0:Mt.col)??_e.col}:X={row:(((xe=Z._end)==null?void 0:xe.row)??_e.row)+1,col:((Pe=Z._end)==null?void 0:Pe.col)??_e.col};const Fe=et(gt,X);Be.value=!1,Z.endRange(Fe),f==null||f(Fe.row,Fe.col,"instant")}else Z.clear(),_e.row<(ie?e(o).length:e(l))&&(_e.row++,Z.startRange({row:_e.row,col:_e.col}),f==null||f(),Be.value=!1);k==null||k();break;case"Enter":{if(Z.clear(),$t.value&&_e.row>=ol-1)return;let gt;ie?gt=e(o)[_e.row]:gt=e(o).get(_e.row),c(gt,e(n)[_e.col]);break}case"Delete":case"Backspace":if(ot.value||$t.value&&_e.row>=ol-1)return;Z.isSingleCell()?(Z.clear(),await s(_e)):await u();break}},60),st=async _=>{if(ie?await(p==null?void 0:p(_)):p!=null&&p(_))return!0;if(!(Wl()||ji())&&!(!It.value||_e.row===null||_e.col===null))switch(_.key){case"Tab":case"Enter":case"Delete":case"Backspace":case"ArrowRight":case"ArrowLeft":case"ArrowUp":case"ArrowDown":_.preventDefault(),rt(_);break;default:{const O=ie?e(o)[_e.row]:e(o).get(_e.row);if(!O)return;const T=e(n)[_e.col];if((!e(Be)||!tc(T))&&!ra()&&(Va()?_.metaKey:_.ctrlKey))switch(_.keyCode){case 67:await wt();break}if(e(Be)||_.ctrlKey||_.altKey||_.metaKey)return!0;if($t.value&&_e.row>=ol-1){_.preventDefault();return}if(ne.value)return;if(_.key.length===1){if(!e(i)&&!O.rowMeta.new)return Zt.toast(j("msg.info.updateNotAllowedWithoutPK"));tc(T)&&c(O,T)&&T.title&&(T.uidt===ve.LongText?O.row[T.title]==="<br />"||O.row[T.title]==="<br>"?O.row[T.title]=_.key:jn(T.meta).richMode&&(O.row[T.title]=O.row[T.title]?O.row[T.title]+_.key:_.key):O.row[T.title]="")}}break}},lt=()=>Z.clear(),xt=Z.clear.bind(Z),Ot=async _=>{var T,se,q,L,te,we,oe,Ee,Ne,He,Ze,Ke,ft,Ye,qe,ht,zt,Le,Se,Mt,xe,Pe,gt,X,Fe,vt,Re,bt;if(ot.value||ne.value||ra()||Wl()||ji()||!It.value||e(Be)||_e.row===null||_e.row===void 0||_e.col===null||_e.col===void 0)return;_.preventDefault();let O=((T=_.clipboardData)==null?void 0:T.getData("text/plain"))||"";O!=null&&O.endsWith(`
`)&&(O=O.replace(/\n$/,""));try{if(O!=null&&O.includes(`
`)||O!=null&&O.includes("	")){const _t=rv.parse(O,{delimiter:"	",escapeChar:"\\"});if(_t.errors.length>0)throw new Error(_t.errors[0].message);let Xe=_t.data;Xe=Xe.map(Ve=>Ve.map(Eo=>Eo==="null"?"":Eo));const tn=Math.max(Xe.length,Z.end.row-Z.start.row+1),Yt=Xe[0].length,en=e(n),pt=_e.col,hn=en.length-pt,on=Math.max(0,Yt-hn);let so=0,Cn,gn,xn;if(ie){const{totalRows:Ve,page:Eo=1,pageSize:qn=100}=e(C);F?(so=Ve,Cn=(Eo-1)*qn+_e.row):(so=Math.max(0,(Ve??0)-(Eo-1)*qn),Cn=_e.row),gn=Math.max(0,so-Cn),xn=Math.max(0,tn-gn)}else so=e(l)??0,Cn=_e.row,gn=Math.max(0,so-Cn),xn=Math.max(0,tn-gn);let Vt={continue:!1,expand:(xn>0||on>0)&&!ie};if(Vt.expand&&!ie&&(Vt=await(v==null?void 0:v({newRows:xn,newColumns:on,cellsOverwritten:Math.min(gn,tn)*(Yt-on),rowsUpdated:Math.min(gn,tn)})),!Vt.continue))return;let ln;const an=[];if(Vt.expand){if(ln=en.slice(pt,pt+Yt),on>0){const Ve=(await W.dbTableColumn.hash((se=I.value)==null?void 0:se.id)).hash,Eo=((L=(q=I.value)==null?void 0:q.columns)==null?void 0:L.length)||0;for(let qn=0;qn<on;qn++){const to={uidt:ve.SingleLineText,order:Eo+qn,column_order:{order:Eo+qn,view_id:(te=ze.value)==null?void 0:te.id},view_id:(we=ze.value)==null?void 0:we.id,table_name:(oe=I.value)==null?void 0:oe.table_name},no=Mf({metaColumns:[...((Ee=I.value)==null?void 0:Ee.columns)??[],...an.map(({column:Qo})=>Qo)],formState:to});an.push({op:"add",column:{...to,title:no}})}await W.dbTableColumn.bulk((Ne=I.value)==null?void 0:Ne.id,{hash:Ve,ops:an}),await Y((He=I==null?void 0:I.value)==null?void 0:He.id,!0),ln=[...ln,...an.map(({column:qn})=>qn)]}}else ln=e(n).slice(_e.col,_e.col+Yt);const Fn=e(o),Yn=[],ao=[],eo=[];let Ro=!1;const Mo={};for(let Ve=0;Ve<tn;Ve++){const Eo=Ve%Xe.length;let qn;if(Ve<gn){const to=Cn+Ve;ie?qn=Ve<Fn.length?Fn[to]:{row:{},oldRow:{},rowMeta:{isExistingRow:!0,rowIndex:to}}:qn=Fn.get(to)||{row:{},oldRow:{},rowMeta:{isExistingRow:!0,rowIndex:to}},Yn.push(qn)}else qn={row:{},oldRow:{},rowMeta:{isExistingRow:!1}},ao.push(qn);for(let to=0;to<Xe[Eo].length;to++){const no=ln[to];if(no)if(no&&Dt(qn,no)){eo.push(no.title);let Qo;try{Qo=Ml({value:Xe[Eo][to],to:no.uidt,column:no,appInfo:e(he),oldValue:no.uidt===ve.Attachment?qn.row[no.title]:void 0,maxAttachmentsAllowedInCell:Ce.value,showUpgradeToAddMoreAttachmentsInCell:H,isInfoShown:Mo[no.title],markInfoShown:()=>{Mo[no.title]=!0}},ye((Ze=I.value)==null?void 0:Ze.source_id),!0),sr(no,Qo)}catch(dl){if(dl instanceof ki)throw dl;if(dl instanceof ur)await cr({api:U,col:no,addOptions:dl.missingOptions}),Qo=dl.value.join(",");else if(dl instanceof za)Qo=null;else throw dl}Qo!==void 0&&(qn.row[no.title]=Qo)}else(Jo(no)||Cl(no)||Ho(no))&&!Ro&&(Zt.toast(j("msg.info.groupPasteIsNotSupportedOnLinksColumn")),Ro=!0)}}Vt.expand&&!ie?(await(x==null?void 0:x(ao,Yn,eo,void 0,an.map(({column:Ve})=>Ve))),f==null||f()):await(y==null?void 0:y(Yn,eo))}else if(Z.isSingleCell()){const _t=ie?e(o)[_e.row]:e(o).get(_e.row);if(!_t)return;const Xe=e(n)[_e.col];if(Jo(Xe)&&!((Ke=Xe.meta)!=null&&Ke.custom)){const Yt=Ml({value:O,to:Xe.uidt,column:Xe,appInfo:e(he)},ye((ft=I.value)==null?void 0:ft.source_id));if(Yt===void 0||!Sa(Yt))return;const en=(qe=(Ye=I.value)==null?void 0:Ye.columns)==null?void 0:qe.find(hn=>{var on;return hn.id===((on=Xe.colOptions)==null?void 0:on.fk_child_column_id)});if(!en)return;const pt=await Y(Xe.colOptions.fk_related_model_id);return _t.oldRow[Xe.title]=_t.row[Xe.title],_t.oldRow[en.title]=_t.row[Xe.title]?Ht(_t.row[Xe.title],pt.columns):null,_t.row[Xe.title]=Yt==null?void 0:Yt.value,_t.row[en.title]=Yt!=null&&Yt.value?Ht(Yt.value,pt.columns):null,await(g==null?void 0:g({..._e,updatedColumnTitle:en.title}))}if(Ho(Xe)){const Yt=Ml({value:O,to:Xe.uidt,column:Xe,appInfo:e(he)},ye((ht=I.value)==null?void 0:ht.source_id));if(Yt===void 0||!Sa(Yt))return;const en=Ht(_t.row,(zt=I.value)==null?void 0:zt.columns);if(!en)return;const pt=_t.row[Xe.title];_t.row[Xe.title]=Yt.value;let hn;try{hn=await W.dbDataTableRow.nestedListCopyPasteOrDeleteAll((Le=I.value)==null?void 0:Le.id,Xe.id,[{operation:"copy",rowId:Yt.rowId,columnId:Yt.columnId,fk_related_model_id:Yt.fk_related_model_id},{operation:"paste",rowId:en,columnId:Xe.id,fk_related_model_id:Xe.colOptions.fk_related_model_id||Yt.fk_related_model_id}],{viewId:(Se=ze==null?void 0:ze.value)==null?void 0:Se.id})}catch{_t.row[Xe.title]=pt;return}if(hn&&(hn!=null&&hn.link)&&(hn!=null&&hn.unlink)&&Array.isArray(hn.link)&&Array.isArray(hn.unlink)){if(!hn.link.length&&!hn.unlink.length){_t.row[Xe.title]=pt;return}Ae(ie?{redo:{fn:async(on,so,Cn,gn,xn,Vt)=>{var ln,an,Fn,Yn,ao,eo,Ro,Mo;if(((ln=Me.value)==null?void 0:ln.pageSize)===(gn==null?void 0:gn.pageSize)){((an=Me.value)==null?void 0:an.page)!==(gn==null?void 0:gn.page)&&await(b==null?void 0:b(gn==null?void 0:gn.page));const Ve=Ht(Cn.row,(Fn=I.value)==null?void 0:Fn.columns),Eo=e(o)[on.row],qn=e(n)[on.col];if(Ve===Ht(Eo.row,(Yn=I.value)==null?void 0:Yn.columns)&&qn.id===so.id)await Promise.all([Vt.link.length&&W.dbDataTableRow.nestedLink((ao=I.value)==null?void 0:ao.id,qn.id,encodeURIComponent(Ve),Vt.link,{viewId:(eo=ze==null?void 0:ze.value)==null?void 0:eo.id}),Vt.unlink.length&&W.dbDataTableRow.nestedUnlink((Ro=I.value)==null?void 0:Ro.id,qn.id,encodeURIComponent(Ve),Vt.unlink,{viewId:(Mo=ze==null?void 0:ze.value)==null?void 0:Mo.id})]),Eo.row[qn.title]=xn,await(g==null?void 0:g(on));else throw new Error(j("msg.recordCouldNotBeFound"))}else throw new Error(j("msg.pageSizeChanged"))},args:[je(_e),je(Xe),je(_t),je(Me.value),je(Yt.value),hn]},undo:{fn:async(on,so,Cn,gn,xn,Vt)=>{var ln,an,Fn,Yn,ao,eo;if(((ln=Me.value)==null?void 0:ln.pageSize)===gn.pageSize){((an=Me.value)==null?void 0:an.page)!==gn.page&&await(b==null?void 0:b(gn.page));const Ro=Ht(Cn.row,(Fn=I.value)==null?void 0:Fn.columns),Mo=e(o)[on.row],Ve=e(n)[on.col];if(Ro===Ht(Mo.row,(Yn=I.value)==null?void 0:Yn.columns)&&Ve.id===so.id)await Promise.all([Vt.unlink.length&&W.dbDataTableRow.nestedLink((ao=I.value)==null?void 0:ao.id,Ve.id,encodeURIComponent(Ro),Vt.unlink),Vt.link.length&&W.dbDataTableRow.nestedUnlink((eo=I.value)==null?void 0:eo.id,Ve.id,encodeURIComponent(Ro),Vt.link)]),Mo.row[Ve.title]=xn,await(g==null?void 0:g(on));else throw new Error(j("msg.recordCouldNotBeFound"))}else throw new Error(j("msg.pageSizeChanged"))},args:[je(_e),je(Xe),je(_t),je(Me.value),je(pt),hn]},scope:Ue({view:ze==null?void 0:ze.value})}:{redo:{fn:async(on,so,Cn,gn,xn)=>{var Fn,Yn,ao,eo,Ro,Mo;const Vt=Ht(Cn.row,(Fn=I.value)==null?void 0:Fn.columns),ln=e(o).get(on.row);if(!ln)return;const an=e(n)[on.col];Vt===Ht(ln.row,(Yn=I.value)==null?void 0:Yn.columns)&&an.id===so.id&&(await Promise.all([xn.link.length&&W.dbDataTableRow.nestedLink((ao=I.value)==null?void 0:ao.id,an.id,encodeURIComponent(Vt),xn.link,{viewId:(eo=ze==null?void 0:ze.value)==null?void 0:eo.id}),xn.unlink.length&&W.dbDataTableRow.nestedUnlink((Ro=I.value)==null?void 0:Ro.id,an.id,encodeURIComponent(Vt),xn.unlink,{viewId:(Mo=ze==null?void 0:ze.value)==null?void 0:Mo.id})]),ln.row[an.title]=gn,await(g==null?void 0:g(on)))},args:[je(_e),je(Xe),je(_t),je(Yt.value),hn]},undo:{fn:async(on,so,Cn,gn,xn)=>{var Fn,Yn,ao,eo;const Vt=Ht(Cn.row,(Fn=I.value)==null?void 0:Fn.columns),ln=e(o).get(on.row);if(!ln)return;const an=e(n)[on.col];Vt===Ht(ln.row,(Yn=I.value)==null?void 0:Yn.columns)&&an.id===so.id&&(await Promise.all([xn.unlink.length&&W.dbDataTableRow.nestedLink((ao=I.value)==null?void 0:ao.id,an.id,encodeURIComponent(Vt),xn.unlink),xn.link.length&&W.dbDataTableRow.nestedUnlink((eo=I.value)==null?void 0:eo.id,an.id,encodeURIComponent(Vt),xn.link)]),ln.row[an.title]=gn,await(g==null?void 0:g(on)))},args:[je(_e),je(Xe),je(_t),je(pt),hn]},scope:Ue({view:ze==null?void 0:ze.value})})}return await(g==null?void 0:g(_e))}if(!Dt(_t,Xe,!0))return;let tn;try{tn=Ml({value:O,to:Xe.uidt,column:Xe,appInfo:e(he),files:Xe.uidt===ve.Attachment&&((xe=(Mt=_.clipboardData)==null?void 0:Mt.files)!=null&&xe.length)?(Pe=_.clipboardData)==null?void 0:Pe.files:void 0,oldValue:_t.row[Xe.title],maxAttachmentsAllowedInCell:Ce.value,showUpgradeToAddMoreAttachmentsInCell:H},ye((gt=I.value)==null?void 0:gt.source_id)),sr(Xe,tn)}catch(Yt){if(Yt instanceof ki)throw Yt;if(Yt instanceof ur)await cr({api:U,col:Xe,addOptions:Yt.missingOptions}),tn=Yt.value.join(",");else if(Yt instanceof za)tn=null;else throw Yt}if(Xe.uidt===ve.Attachment&&((Fe=(X=_.clipboardData)==null?void 0:X.files)!=null&&Fe.length)&&(tn!=null&&tn.length)){const Yt=await Qe(tn,Xe.id,_t.row[Xe.title])||[],en=Rl(_t.row[Xe.title])?_t.row[Xe.title]:[];_t.row[Xe.title]=Yt.length||en.length?JSON.stringify(en.concat(Yt)):null}else tn!==void 0&&(_t.row[Xe.title]=tn);await(g==null?void 0:g(_e))}else{const _t=Z.start,Xe=Z.end,tn=Math.min(_t.row,Xe.row),Yt=Math.max(_t.row,Xe.row),en=Math.min(_t.col,Xe.col),pt=Math.max(_t.col,Xe.col),hn=e(n).slice(en,pt+1);let on;ie?on=e(o).slice(tn,Yt+1):on=Array.from(e(o)).filter(([ln])=>ln>=tn&&ln<=Yt).map(([,ln])=>ln);const so=[];let Cn,gn=!1;const xn={},Vt=(vt=_.clipboardData)==null?void 0:vt.files;for(const ln of on)if(!(!ln||ln.rowMeta.new))for(const an of hn){if(!an.title||!Dt(ln,an)){(Jo(an)||Cl(an)||Ho(an))&&!gn&&(Zt.toast(j("msg.info.groupPasteIsNotSupportedOnLinksColumn")),gn=!0);continue}if(Vt!=null&&Vt.length){if(an.uidt!==ve.Attachment)continue;if(Cn===void 0){const Fn=Ml({value:"",to:an.uidt,column:an,appInfo:e(he),files:Vt,oldValue:ln.row[an.title],maxAttachmentsAllowedInCell:Ce.value,showUpgradeToAddMoreAttachmentsInCell:H,isInfoShown:xn[an.title],markInfoShown:()=>{xn[an.title]=!0}},ye((Re=I.value)==null?void 0:Re.source_id),!0);if(Fn!=null&&Fn.length){const Yn=await Qe(Fn,an.id,ln.row[an.title]);Cn=Yn?JSON.stringify(Yn):null}}}else try{Cn=Ml({value:O,to:an.uidt,column:an,appInfo:e(he),oldValue:ln.row[an.title],maxAttachmentsAllowedInCell:Ce.value,showUpgradeToAddMoreAttachmentsInCell:H,isInfoShown:xn[an.title],markInfoShown:()=>{xn[an.title]=!0}},ye((bt=I.value)==null?void 0:bt.source_id),!0),sr(an,Cn)}catch(Fn){if(Fn instanceof ki)throw Fn;if(Fn instanceof ur)await cr({api:U,col:an,addOptions:Fn.missingOptions}),Cn=Fn.value.join(",");else if(Fn instanceof za)Cn=null;else throw Fn}so.push(an.title),Cn!==void 0&&(ln.row[an.title]=Cn)}if(!so.length)return;await(y==null?void 0:y(on,so))}}catch(_t){(!(_t instanceof za)||!_t.isErrorSuppressed)&&(console.error(_t,_t.isErrorSuppressed),Zt.error(await hl(_t)))}};function yt(_){var O,T;(_==null?void 0:_.button)===pu&&(Ge.value=!0,G!=null&&G.value&&pe.value&&(Q.value=!0),Z._start&&Z._end&&(Et.startRange({row:(O=Z._start)==null?void 0:O.row,col:Z._start.col}),Et.endRange({row:(T=Z._end)==null?void 0:T.row,col:Z._end.col})),_.preventDefault())}async function Qe(_,O,T){var q;const se=[];try{const L=await Ie(_,[wa,me.value.id,(q=I.value)==null?void 0:q.id,O].join("/"));for(const te of L)se.push({...te,title:Tf(te==null?void 0:te.title,[...d(T),...se].map(we=>(we==null?void 0:we.title)||(we==null?void 0:we.fileName)),te==null?void 0:te.mimetype)});return se}catch(L){Zt.error(await hl(L)||j("msg.error.internalError"))}}function d(_){const O=jn(_);return O&&Array.isArray(O)?O:[]}return Tl(document,"keydown",st),Tl(document,"mouseup",ct),Tl(document,"paste",Ot),Tl(w,"mousedown",yt),{isCellActive:It,handleMouseDown:tt,handleMouseOver:Bn,clearSelectedRange:xt,copyValue:wt,activeCell:_e,handleCellClick:mt,resetSelectedRange:lt,selectedRange:Z,makeActive:cn,isMouseDown:it,isFillMode:Ge,selectRangeMap:un,fillRangeMap:Dn,metaKey:G}}const mb=ko(()=>Co(()=>import("./CfTpfQ4B.js"),__vite__mapDeps([0,1,2,3,4]),import.meta.url).then(t=>t.default||t)),gb=ko(()=>Co(()=>import("./CDTi0oRk.js"),__vite__mapDeps([5,1,2,3,6]),import.meta.url).then(t=>t.default||t)),wb=ko(()=>Co(()=>import("./CG-5KGUk.js").then(t=>t.E),__vite__mapDeps([43,1,2,44,45,46,47,48,24,23,3,22,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,39,71,32,31,33,30,34,72,73,28,26,27,74,75,76]),import.meta.url).then(t=>t.default||t)),yb=ko(()=>Co(()=>import("./BYqbwTjR.js"),__vite__mapDeps([77,1,2]),import.meta.url).then(t=>t.default||t)),bb=ko(()=>Co(()=>import("./BALLsGq5.js").then(t=>t.V),__vite__mapDeps([7,1,2,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,3,26,27,28,29,30,31,32,33,34,35]),import.meta.url).then(t=>t.default||t)),_b=ko(()=>Co(()=>import("./B1qoNiTF.js").then(t=>t.C),__vite__mapDeps([36,1,2,12,13,37,38,39,28,23,22,26,27,40]),import.meta.url).then(t=>t.default||t)),xb=ko(()=>Co(()=>Promise.resolve().then(()=>fd),void 0,import.meta.url).then(t=>t.default||t)),kb=ko(()=>Co(()=>import("./DCKYOzKD.js"),__vite__mapDeps([78,1,2,65,66,67,68,43,44,45,46,47,48,24,23,3,22,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,69,70,39,71,32,31,33,30,34,72,73,28,26,27,74,75,76,79,80,81,19,82,83,84,85,86,87,88,89,90,91,36,12,13,37,38,40,92,93,94,29,95,96,97,98,99,7,8,9,10,11,14,15,16,17,18,20,21,25,35,100,101,102,103,104,105,106,107,108,109,110]),import.meta.url).then(t=>t.default||t)),Cb={class:"flex flex-col h-full w-full"},Rb={key:0,class:"absolute h-full flex items-center justify-center z-70 w-full inset-0 bg-white/50"},Sb={class:"flex gap-2 items-center"},Ib={key:0},Fb={class:"nc-grid-header transform"},Ab={key:0,"data-testid":"nc-check-all",class:"flex items-center pl-2 pr-1 w-full h-full"},Eb={key:1,class:"w-full h-full text-gray-500 flex pl-2 pr-1","data-testid":"nc-check-all"},Mb=["colspan"],Tb=["onXcstartresizing","onXcresize","onXcresizing"],$b=["draggable","onDragstart"],Ob=["colspan"],Db={class:"absolute top-0 left-0 h-8 border-b-1 border-r-1 border-gray-200 nc-grid-add-edit-column group"},Lb={class:"h-full w-[60px] flex items-center justify-center"},Nb={class:"nc-edit-or-add-provider-wrapper"},Pb={class:"!border-0 relative !xs:hidden",style:{borderWidth:"0px !important"}},Bb={class:"sticky left-0 flex items-center gap-2 transform bg-yellow-500 px-2 py-1 rounded-br-md font-semibold text-xs text-gray-800"},Wb={class:"sticky left-0 flex items-center gap-2 transform bg-yellow-500 px-2 py-1 rounded-br-md font-semibold text-xs text-gray-800"},zb=["data-testid"],Vb=["data-testid"],jb={class:"w-full flex items-center h-full px-1 gap-0.5"},Ub=["data-testid"],Gb=["onClick"],Hb={key:1,class:"cursor-pointer nc-expand flex items-center border-1 border-gray-100 active:ring rounded-md p-0.75 hover:bg-white hover:border-nc-border-gray-medium"},Yb={key:0,class:"opacity-0.4 gap-2 truncate flex items-center overflow-x-hidden text-sm text-nc-content-gray-muted"},qb={key:1,class:"w-full"},Xb=["colspan"],Kb={key:0,class:"opacity-0.4 gap-2 truncate flex items-center overflow-x-hidden text-sm text-nc-content-gray-muted"},Jb={key:1,class:"w-full"},Qb=["colspan"],Zb={class:"nc-grid-add-new-cell-item h-8 border-b-1 border-gray-100 bg-white group-hover:bg-gray-50 absolute left-0 bottom-0 px-2 sticky z-40 w-full flex items-center text-gray-500"},e1=["colspan"],t1={class:"flex gap-2 items-center"},n1={key:0,class:"flex gap-2 items-center"},o1={key:1,class:"flex gap-2 items-center"},l1={class:"flex gap-2 items-center"},a1={class:"flex gap-2 items-center"},i1={class:"flex gap-2 items-center"},r1={class:"flex gap-2 items-center"},s1={class:"flex gap-2 items-center"},u1={class:"flex gap-2 items-center"},d1={class:"flex gap-2 items-center"},c1={class:"flex gap-2 items-center"},f1={class:"flex gap-2 items-center"},v1={class:"flex gap-2 items-center"},p1={class:"flex gap-2 items-center"},h1={class:"flex gap-2 items-center"},m1={key:0,class:"sticky left-0 py-[120px]"},g1={class:"flex flex-col gap-5 p-6 max-w-[520px] text-center mx-auto"},w1={class:"flex flex-col gap-2"},y1={class:"text-base font-700 text-nc-content-gray"},b1={class:"flex items-center justify-center gap-3"},_1={href:"https://nocodb.com/pricing",target:"_blank"},x1={class:"flex shadow-nc-sm rounded-lg"},k1={class:"flex items-center gap-2"},C1={"data-testid":"nc-pagination-add-record",class:"flex items-center gap-2"},R1={class:"flex flex-row items-center justify-start gap-x-3"},S1={class:"flex flex-row items-center justify-start gap-x-3"},Pi=50,kc=100,I1=100,Cc=40,F1=50,Rc=5,er=10,A1=xo({__name:"InfiniteTable",props:{totalRows:{},actualTotalRows:{},data:{},rowHeightEnum:{},loadData:{type:Function},callAddEmptyRow:{type:Function},deleteRow:{type:Function},updateOrSaveRow:{type:Function},deleteSelectedRows:{type:Function},clearInvalidRows:{type:Function},deleteRangeOfRows:{type:Function},updateRecordOrder:{type:Function},bulkUpdateRows:{type:Function},bulkDeleteAll:{type:Function},bulkUpsertRows:{type:Function},expandForm:{type:Function},removeRowIfNew:{type:Function},rowSortRequiredRows:{},applySorting:{type:Function},clearCache:{type:Function},syncCount:{type:Function},selectedRows:{},chunkStates:{},isBulkOperationInProgress:{type:Boolean},selectedAllRecords:{type:Boolean},getRows:{type:Function}},emits:["bulkUpdateDlg","update:selectedAllRecords"],setup(t,{expose:n,emit:o}){const l=t,a=o,i=Ra(l,"selectedAllRecords",a),{withLoading:r}=vs(),{loadData:s,callAddEmptyRow:u,updateOrSaveRow:c,deleteRow:f,expandForm:v,clearCache:p,syncCount:g,bulkUpdateRows:y,bulkUpsertRows:x,deleteRangeOfRows:w,removeRowIfNew:m,clearInvalidRows:C,updateRecordOrder:b,applySorting:S,bulkDeleteAll:k,getRows:D}=l,F=dn(Ti,V()),I=dn(ds,V()),M=dn(wr,V([])),A=dn(Ks,V(!1)),j=dn(Yi,V(!1)),N=dn(zl,V(!1)),Y=fs(),ae=dn(Ea,jo()),he=dn(Qu,jo()),ye=dn(Js,void 0),{isMobileMode:re,isAddNewRecordGridMode:me,setAddNewRecordGridMode:W}=tl(),{isPkAvail:U,isSqlView:Ae,eventBus:je,allFilters:Ue,sorts:ot,isExternalSource:G}=Fl(),{isColumnSortedOrFiltered:pe,appearanceConfig:ne}=tu(),{$e:be,$api:ee}=ua(),{t:H}=la(),{getMeta:Ce}=ai(),{addUndo:Ie,clone:Q,defineViewScope:ie}=Mi(),{isViewColumnsLoading:Me,updateGridViewColumn:Be,gridViewCols:it,metaColumnById:Ge,resizingColOldWith:ze}=Ha(),{isExpandedFormCommentMode:Z}=Uo(Ir()),{paste:Et}=dd(),{addLTARRef:_e,syncLTARRefs:yn,clearLTARCell:It,cleaMMCell:$t}=ad(),{loadViewAggregate:et}=nu(),{isAiFeaturesEnabled:cn,generateRows:Pn,generatingRows:Kt,generatingColumnRows:nn,generatingColumns:wt,aiIntegrations:Dn}=kr(),{showRecordPlanLimitExceededModal:un,blockExternalSourceRecordVisibility:Bn,showAsBluredRecord:tt,isWsOwner:mt,navigateToPricing:Dt}=ql(),Rt=V(),ct=V(),nt=V(),rt=ue(()=>Me.value||!F.value),st=V(!1),lt=ue(()=>hf()),xt={[ve.Attachment]:{minWidth:80,maxWidth:Number.POSITIVE_INFINITY},[ve.Button]:{minWidth:100,maxWidth:320}},Ot=(R,$)=>{if(R.uidt in xt){const{minWidth:de,maxWidth:De}=xt[R.uidt];if(de<$&&$<De)return $;if($<de)return de;if($>De)return De}return $},yt=(R,$)=>{if(!R||!Ii($==null?void 0:$.detail))return;const de=$.detail.split("px")[0];Be(R,{width:`${Ot(Ge.value[R],de)}px`})},Qe=(R,$)=>{if(!R||!Ii($==null?void 0:$.detail))return;const de=$.detail.split("px")[0];it.value[R].width=`${Ot(Ge.value[R],de)}px`,Ln()},d=(R,$)=>{R&&(ze.value=$.detail,st.value=!0)},_=Nn(l,"data"),O=Nn(l,"rowSortRequiredRows"),T=Nn(l,"totalRows"),se=ue(()=>Bn(G.value)&&T.value>=ol),q=ue(()=>se.value?0:256),L=Nn(l,"chunkStates"),te=Nn(l,"isBulkOperationInProgress"),we=ue(()=>re.value?56:Bo[`${l.rowHeightEnum}`]??32),oe=Si({start:0,end:100}),Ee=async(R,$=!1)=>{if(L.value[R])return;const de=R*Pi,De=$?I1:Pi;if(!(de>=T.value)){L.value[R]="loading",$&&(L.value[R+1]="loading");try{(await s({offset:de,limit:De})).forEach(qt=>_.value.set(qt.rowMeta.rowIndex,qt)),L.value[R]="loaded",$&&(L.value[R+1]="loaded")}catch(Wt){console.error(`Error fetching chunk ${R}:`,Wt),L.value[R]=void 0,$&&(L.value[R+1]=void 0)}}},Ne=Si({viewProgress:null,rowProgress:new Map,cellProgress:new Map}),He=ue(()=>{const{start:R,end:$}=oe;return Array.from({length:Math.min($,T.value)-R},(de,De)=>{var wn;const Wt=R+De,qt=_.value.get(Wt);if(!qt)return{row:{},oldRow:{},rowMeta:{rowIndex:Wt,isLoading:!0}};const vn=Ht(qt.row,((wn=F.value)==null?void 0:wn.columns)??[]);return qt.rowMeta.rowProgress=Ne.rowProgress.get(String(vn)),qt})}),Ze=ue(()=>{var R;return!ct.value||oe.start<=1?0:parseInt(`${((R=ct.value)==null?void 0:R.clientHeight)/(we.value||32)}`)*3}),Ke=ue(()=>{const R={length:oe.start>1?Math.min(oe.start-1,Ze.value):0,rowHeight:we.value,totalRowHeight:0};return R.totalRowHeight=R.length*R.rowHeight,R}),ft=ue(()=>{const R={length:oe.end<T.value-1?Math.min(T.value-1-oe.end,Ze.value):0,rowHeight:we.value,totalRowHeight:0};return R.totalRowHeight=R.length*R.rowHeight,R}),Ye=ue(()=>we.value*(oe.start-Ke.value.length));let qe=null;const ht=async(R=!1)=>{const{start:$,end:de}=oe,De=Math.floor($/Pi),Wt=Math.floor((de-1)/Pi),qt=new Set;for(let Mn=De;Mn<=Wt;Mn++)L.value[Mn]||qt.add(Mn);const vn=Wt+1;de%Pi>Pi-Cc&&!L.value[vn]&&qt.add(vn);const wn=De-1;wn>=0&&$%Pi<Cc&&!L.value[wn]&&qt.add(wn),qt.size!==0&&(clearTimeout(qe),qe=setTimeout(async()=>{De===0&&!L.value[0]&&(await Ee(0,!0),qt.delete(0),qt.delete(1)),await Promise.all([...qt].map(Ut=>Ee(Ut)));const fo=Math.max(0,$-kc),at=Math.min(T.value,de+kc);p(fo,at)},R?F1:25))},{isUIAllowed:zt,isDataReadOnly:Le}=wl(),Se=ue(()=>zt("dataEdit")&&!Ae.value),Mt=ue(()=>!A.value&&zt("fieldAdd")&&!Ae.value),{onDrag:xe,onDragStart:Pe,onDragEnd:gt,draggedCol:X,dragColPlaceholderDomRef:Fe,toBeDroppedColId:vt}=hv({fields:M,tableBodyEl:Rt,gridWrapper:ct}),Re=ue(()=>{var R;return(((R=F.value)==null?void 0:R.columns)??[]).some($=>$f($))}),bt=ue(()=>{var R,$;return((R=Ue.value)==null?void 0:R.length)||(($=ot.value)==null?void 0:$.length)||N.value}),_t=ue(()=>{var R;return((R=ot.value)==null?void 0:R.length)||N.value||!U.value}),Xe=V(!1),tn=V(!1),Yt=V(),en=V(!1),pt=V(!1),hn=V(null),on=V(!1),so=V(!1),Cn=V(!1),gn=Nn(l,"selectedRows"),xn=V(!1),Vt=V(null),ln=ue({get:()=>gn.value.length&&Le.value||Vt.value===null&&!gn.value.length&&!i.value?!1:Cn.value,set:R=>{Cn.value=R}}),an=(R,$)=>{Ae.value||(R.preventDefault(),$&&(Vt.value=$))},Fn=V(!1);wo(Pf,Fn);const Yn=V(!1),ao=R=>$s(R)||R.readonly,eo=ue(()=>M.value.map(R=>({isVirtualCol:_o(R),isReadonly:ao(R)})));async function Ro(R,$=!1){var Wt;if(Le.value||!R||!Se.value||!ml(M.value[R.col])&&_o(M.value[R.col])||M.value[R.col].readonly||eo.value[R.col].isReadonly&&!_o(M.value[R.col]))return;const de=_.value.get(R.row);if(!de)return;const De=M.value[R.col];if(_o(De)){let qt;const vn=de.row[De.title],wn=De.fk_model_id===((Wt=De.colOptions)==null?void 0:Wt.fk_related_model_id);Ho(De)&&de&&(qt=await $t(de,De)),Ie({undo:{fn:async(Mn,fo,at,Ut,lo,mn)=>{var ea,pi,zo;const go=Ht(at.row,(ea=F.value)==null?void 0:ea.columns),Tn=_.value.get(Mn.row),Io=M.value[Mn.col];if(Tn&&Io.title&&go===Ht(Tn.row,(pi=F.value)==null?void 0:pi.columns)&&Io.id===fo.id)Jo(Io)||Cl(Io)?(Tn.row[Io.title]=at.row[Io.title],await _e(Tn,Tn.row[Io.title],Io),await yn(Tn,Tn.row)):Ho(Io)&&(await ee.dbDataTableRow.nestedLink((zo=F.value)==null?void 0:zo.id,Io.id,encodeURIComponent(go),Ut),Tn.row[Io.title]=lo??null),ut.col=Mn.col,ut.row=Mn.row,mn&&ae.trigger({shouldShowLoading:!1}),io==null||io();else throw new Error(H("msg.recordCouldNotBeFound"))},args:[Q(R),Q(De),Q(de),qt,vn]},redo:{fn:async(Mn,fo,at,Ut)=>{var Tn,Io;const lo=Ht(at.row,(Tn=F.value)==null?void 0:Tn.columns),mn=_.value.get(Mn.row),go=M.value[Mn.col];if(mn&&lo===Ht(mn.row,(Io=F.value)==null?void 0:Io.columns)&&go.id===fo.id)Jo(go)||Cl(go)?await It(mn,go):Ho(go)&&await $t(mn,go),ut.col=Mn.col,ut.row=Mn.row,Ut&&ae.trigger({shouldShowLoading:!1}),io==null||io();else throw new Error(H("msg.recordCouldNotBeFound"))},args:[Q(R),Q(De),Q(de),wn]},scope:ie({view:I.value})}),(Jo(De)||Cl(De))&&await It(de,De),wn&&ae.trigger({shouldShowLoading:!1});return}if(De.title)switch(De.uidt){case ve.Checkbox:de.row[De.title]=!1;break;case ve.Rating:de.row[De.title]=0;break;default:de.row[De.title]=null;break}$||await(c==null?void 0:c(de,De.title))}function Mo(R,$){if(!(!Se.value||on.value||A.value||xa($)||$.readonly)){if(!U.value&&!R.rowMeta.new){Zt.info(H("msg.info.updateNotAllowedWithoutPK"));return}if($.ai){Zt.info(H("msg.info.autoIncFieldNotEditable"));return}if($.pk&&!R.rowMeta.new){Zt.info(H("msg.info.editingPKnotSupported"));return}if(![ve.SingleSelect,ve.MultiSelect].includes($.uidt))return on.value=!0}}const Ve=ue(()=>{var R;return Se.value&&!Ae.value&&!N.value&&!((R=F.value)!=null&&R.synced)}),Eo=ue(()=>{var R;return(R=M.value)==null?void 0:R.length}),qn=ue(()=>Array.from({length:11}).map(()=>({}))),to=ue(()=>{var R;return(R=He.value)==null?void 0:R.map($=>{var Wt;const de=Ht($.row,((Wt=F.value)==null?void 0:Wt.columns)??[]),De=Ne.cellProgress.get(de);return M.value.map(qt=>({isColumnRequiredAndNull:Ts(qt,$.row),cellProgress:De==null?void 0:De.get(qt.id)}))})});function no(R){xl("instant"),setTimeout(()=>{Xe.value=!0,Yt.value=R},500)}function Qo(R=!1){hn.value=null,Xe.value=!1,Yt.value={},R&&setTimeout(()=>{xl("instant")},200)}async function dl(){const R=await St(T.value+1,!0);R&&(v==null||v(R,void 0,!0))}const ri=()=>{he.trigger()},Ma=()=>{un()||(W(!0),St())};function kn(){un()||(W(!1),ri())}const Ta=V(null),Ka=V(null),Oi=(R,$,de)=>{var at,Ut;const De=$.getBoundingClientRect(),Wt=15,qt=((at=Ta.value)==null?void 0:at.getBoundingClientRect().width)??0,vn=((Ut=Ka.value)==null?void 0:Ut.getBoundingClientRect().width)??0,wn=qt+vn,Mn={right:R.right+qt-De.width-$.scrollLeft,left:R.left+qt-$.scrollLeft-wn,bottom:R.bottom-De.height-$.scrollTop,top:R.top-$.scrollTop},fo={top:0,left:0};return fo.left=Mn.right+(de==null?void 0:de.right)>0?$.scrollLeft+Mn.right+(de==null?void 0:de.right)+Wt:Mn.left-((de==null?void 0:de.left)||0)<0?$.scrollLeft+Mn.left-((de==null?void 0:de.left)||0)-Wt:$.scrollLeft,fo.top=Mn.bottom+(de==null?void 0:de.bottom)>0?$.scrollTop+Mn.bottom+(de==null?void 0:de.bottom)+Wt:Mn.top-(de==null?void 0:de.top)<0?$.scrollTop+Mn.top-(de==null?void 0:de.top)-Wt:$.scrollTop,fo},ll=()=>{C==null||C(),O.value.length&&(S==null||S(O.value))},ca=V(!1),$a=V(!1);async function Ja(){$a.value=!0;const{close:R}=rs(fv,{modelValue:$a,rows:T.value,"onUpdate:modelValue":$,onDeleteAll:async()=>{await(k==null?void 0:k()),$(),i.value=!1}});function $(){ca.value=!1,R(200)}await ka($a).toBe(!1)}async function Xl({newRows:R,newColumns:$,cellsOverwritten:de,rowsUpdated:De}){ca.value=!0;const Wt={continue:!1,expand:!0},{close:qt}=rs(vv,{modelValue:ca,newRows:R,newColumns:$,cellsOverwritten:de,rowsUpdated:De,isAddingEmptyRowPermitted:!0,meta:F.value,"onUpdate:expand":wn,"onUpdate:modelValue":vn});function vn(){ca.value=!1,qt(1e3)}async function wn(Mn){Wt.continue=!0,Wt.expand=Mn,qt(1e3)}return await ka(ca).toBe(!1),Wt}const{selectRangeMap:Oa,fillRangeMap:Qa,activeCell:ut,handleMouseDown:Kl,handleMouseOver:No,handleCellClick:So,clearSelectedRange:Po,copyValue:bo,isCellActive:Dl,resetSelectedRange:Xo,makeActive:Da,selectedRange:rn,isFillMode:yl,metaKey:An}=mv(F,M,_,T,on,U,ln,Ro,Vl,Mo,io,Xl,R=>{var Wt,qt;if(document.querySelector(".nc-dropdown-single-select-cell.active,.nc-dropdown-multi-select-cell.active"))return R.preventDefault(),!0;if(Wl())return;if(ra()||ji())return!0;const de=Va()?R.metaKey:R.ctrlKey,De=R.altKey;if(R.key===" "){if(R.shiftKey)return!0;const vn=Wl();if(!on.value&&Dl.value&&ut.row!==null&&!vn){R.preventDefault();const wn=_.value.get(ut.row);return wn?(se.value&&wn.rowMeta.rowIndex&&wn.rowMeta.rowIndex>=ol||v==null||v(wn),!0):void 0}}else if(R.key==="Escape"){if(on.value)return on.value=!1,!0}else if(R.key==="Enter"){if(R.shiftKey)return!0;if(on.value)return on.value=!1,!0}else if(R.key==="Tab"){if(!R.shiftKey&&ut.row===T.value-1&&ut.col===((Wt=M.value)==null?void 0:Wt.length)-1)return R.preventDefault(),Ve.value&&!se.value&&(Yn.value=!0),!0;if(R.shiftKey&&ut.row===0&&ut.col===0)return R.preventDefault(),!0}if(de){if(!Dl.value||R.shiftKey)return;switch(R.key){case"ArrowUp":return R.preventDefault(),Po(),ut.row=0,ut.col=ut.col??0,rn.startRange({row:ut.row,col:ut.col}),rn.endRange({row:ut.row,col:ut.col}),io==null||io(void 0,void 0,"instant"),on.value=!1,ll(),!0;case"ArrowDown":return R.preventDefault(),Po(),ut.row=T.value-1,ut.col=ut.col??0,rn.startRange({row:ut.row,col:ut.col}),rn.endRange({row:ut.row,col:ut.col}),io==null||io(void 0,void 0,"instant"),on.value=!1,ll(),!0;case"ArrowRight":return R.preventDefault(),Po(),ut.row=ut.row??0,ut.col=((qt=M.value)==null?void 0:qt.length)-1,rn.startRange({row:ut.row,col:ut.col}),rn.endRange({row:ut.row,col:ut.col}),io==null||io(),on.value=!1,!0;case"ArrowLeft":return R.preventDefault(),Po(),ut.row=ut.row??0,ut.col=0,rn.startRange({row:ut.row,col:ut.col}),rn.endRange({row:ut.row,col:ut.col}),io==null||io(),on.value=!1,!0}}if(De)switch(R.keyCode){case 82:{Ve.value&&!se.value&&(be("c:shortcut",{key:"ALT + R"}),St(),ut.row=T.value-1,ut.col=0,Xo(),el(()=>{var vn;(vn=document.querySelector("td.cell.active"))==null||vn.scrollIntoView({behavior:"smooth"})}));break}case 67:{Mt.value&&(be("c:shortcut",{key:"ALT + C"}),xl("instant"),setTimeout(()=>{Xe.value=!0},250));break}}},async R=>{var Wt;const $=_.value.get(R.row),de=R.col!==void 0?M.value[R.col]:null;if(!$||!de)return;if(!R.updatedColumnTitle&&_o(de)){de.fk_model_id===((Wt=de.colOptions)==null?void 0:Wt.fk_related_model_id)&&(ae==null||ae.trigger({shouldShowLoading:!1}));return}const De=_.value.get(R.row);if(De){const qt={...De,rowMeta:{...De.rowMeta,isUpdatedFromCopyNPaste:{...De.rowMeta.isUpdatedFromCopyNPaste||{},[R.updatedColumnTitle||de.title]:!0}}};_.value.set(R.row,qt)}await(c==null?void 0:c($,R.updatedColumnTitle||de.title))},y,x,nt,I,void 0,void 0,Ee,ll,D);function We(R){Po(),Da(R??T.value-1,0),rn.startRange({row:ut.row,col:ut.col}),io==null||io(R)}async function jt(R,$){await(c==null?void 0:c(R,null,null,{metaValue:F.value,viewMetaValue:I.value},$))}async function St(R,$=!1,de){if(un({focusBtn:null})||se.value&&!de&&!R&&!$)return;C==null||C(),O.value.length&&(S==null||S(O.value));const De=u==null?void 0:u(R);return!$&&De&&jt(De,de),el().then(()=>{We(R??T.value-1)}),De}const kt=R=>{try{f==null||f(R),rn.isRowInRange(R)&&Po(),ut.row===R&&(ut.row=null,ut.col=null)}catch($){Zt.error($.message)}},sn=R=>{try{Z.value=!0;const $=_.value.get(R);v&&v($),ut.row=null,ut.col=null,rn.clear()}catch($){Zt.error($.message)}},bn=()=>{w==null||w(rn).then(()=>{Po(),ut.row=null,ut.col=null})},Rn=ue(()=>{var R;if(rn.start.col===rn.end.col){const $=M.value[rn.start.col];return{enabled:ba($)||is($),disabled:!((R=$==null?void 0:$.colOptions)!=null&&R.fk_integration_id)}}return{enabled:!1,disabled:!1}}),Tt=ue(()=>{if(rn.start.col===rn.end.col){const R=M.value[rn.start.col];return{enabled:Of(R),disabled:!1}}return{enabled:!1,disabled:!1}}),{runScript:_n}=Ps(),Zn=async()=>{var de;if(!Tt.value.enabled||!((de=F==null?void 0:F.value)!=null&&de.id)||!F.value.columns)return;const R=M.value[rn.start.col],$=await D(rn.start.row,rn.end.row+1);for(const De of $){const Wt=Ht(De.row,F.value.columns);_n(R.colOptions.fk_script_id,De.row,{pk:Wt,fieldId:R.id})}},Ko=ue(()=>An.value&&cn.value),Un=async()=>{var qt,vn;if(!Rn.value.enabled||!((qt=F==null?void 0:F.value)!=null&&qt.id)||!F.value.columns)return;const R=M.value[rn.start.col];if(!R.id)return;const $=await D(rn.start.row,rn.end.row+1);if(!$||$.length===0)return;let de=[R.id];is(R)&&(de=Ii((vn=R.colOptions)==null?void 0:vn.output_column_ids)&&R.colOptions.output_column_ids.split(",").length>0?R.colOptions.output_column_ids.split(","):[]);const De=$.map(wn=>Ht(wn.row,F.value.columns)).filter(wn=>wn!==null);Kt.value.push(...De),nn.value.push(R.id),wt.value.push(...de);const Wt=await Pn(F.value.id,R.id,De);if(Wt)for(const wn of Wt){const Mn=Array.from(_.value.values()).find(fo=>Ht(fo.row,F.value.columns)===Ht(wn,F.value.columns));Mn&&(Mn.row={...Mn.row,...wn})}Kt.value=Kt.value.filter(wn=>!De.includes(wn)),nn.value=nn.value.filter(wn=>wn!==R.id),wt.value=wt.value.filter(wn=>!(de!=null&&de.includes(wn)))};Xs(Rt,R=>{if(en.value||st.value||ln.value||ut.row===null||ut.col===null||Wl())return;const de=M.value[ut.col];if(on.value&&(_o(de)||de.uidt===ve.JSON)||yl.value)return;const De=document.querySelector(".nc-picker-datetime.active,.nc-dropdown-single-select-cell.active,.nc-dropdown-multi-select-cell.active,.nc-dropdown-user-select-cell.active,.nc-picker-date.active,.nc-picker-year.active,.nc-picker-time.active,.nc-link-dropdown-root");R.target&&De&&(De===R.target||De!=null&&De.contains(R.target))||ra()||(ll(),Po(),ut.row=null,ut.col=null)});const ho=R=>{if(!(ut.row===null||ut.col===null)){switch(on.value=!1,Po(),R){case Gl.NEXT:ut.row<T.value-1||St(),ut.row++;break;case Gl.PREV:ut.row>0&&ut.row--;break}el(()=>{io()})}};async function Vl(){if(!Se.value||Le.value)return;const R=rn.start,$=rn.end,de=Math.min(R.col,$.col),De=Math.max(R.col,$.col),Wt=M.value.slice(de,De+1),qt=await D(R.row,$.row),vn=[];let wn=!1;for(const Mn of qt)for(const fo of Wt)if(!(!Mn||!fo||!fo.title)){if(_o(fo)){(Jo(fo)||Cl(fo)||Ho(fo))&&!wn&&(Zt.info(H("msg.info.groupClearIsNotSupportedOnLinksColumn")),wn=!0);continue}ao(fo)||(Mn.row[fo.title]=null,vn.push(fo.title))}await(y==null?void 0:y(qt,vn))}const Ao=ue(()=>M.value.filter(R=>R.id&&it.value[R.id]&&it.value[R.id].width&&it.value[R.id].show).map(R=>+it.value[R.id].width.replace("px","")||180).reduce((R,$,de)=>(R.push(R[de]+$),R),[0])),bl=V(0),al=V(0);function io(R,$,de="instant"){if(R=R??ut.row,$=$??ut.col,R!==null&&$!==null&&ct.value){const De={top:R*we.value,left:Ao.value[$],right:$===M.value.length-1?Ao.value[Ao.value.length-1]+180:Ao.value[$+1],bottom:(R+1)*we.value},Wt=Oi(De,ct.value,{top:9,bottom:41,right:9});$===0&&(Wt.left=0);const qt={top:Wt.top,left:Wt.left,behavior:de};R===T.value-1&&(qt.top=ct.value.scrollHeight),$===M.value.length-1&&(qt.left=ct.value.scrollWidth),ct.value.scrollTo(qt)}}const Al=V([]),fa=async(R={})=>{var $,de,De,Wt;for(const qt of R.data||_.value.entries())if(!(($=qt.rowMeta)!=null&&$.fromExpandedForm)){if((de=qt.rowMeta)!=null&&de.new){const vn=Q(qt);await(c==null?void 0:c(qt,"",qt.rowMeta.ltarState||{},R))?qt.rowMeta.changed=!1:R.keepNewRecords&&vn.rowMeta.new&&Object.keys(vn.row).length&&Al.value.push(vn);continue}if((De=qt.rowMeta)!=null&&De.changed){qt.rowMeta.changed=!1;for(const vn of((Wt=R.metaValue||F.value)==null?void 0:Wt.columns)??[])_o(vn)||vn.uidt===ve.Attachment||vn.title in qt.row&&qt.row[vn.title]!==qt.oldRow[vn.title]&&await(c==null?void 0:c(qt,vn.title,{},R))}}},La=V(),Zo=()=>{var R;Xe.value=(R=La.value)==null?void 0:R.shouldKeepModalOpen()},oo=V({start:0,end:0}),Ll=V(),si=V(),Jl=V(),ui=V();let di=-1,Xi=-1,ci=-1,fi=-1;const vi=(R,$)=>{if(di===R&&Xi===$)return{renderStart:ci,renderEnd:fi};let de=0,De=0,Wt=Ao.value.length-1;for(;De<=Wt;){const vn=Math.floor((De+Wt)/2);if(Ao.value[vn]<=R&&Ao.value[vn+1]>R){de=vn;break}Ao.value[vn]<R?De=vn+1:Wt=vn-1}let qt=Ao.value.findIndex(vn=>vn>$+R);return qt=qt===-1?Ao.value.length:qt,di=R,Xi=$,ci=de,fi=qt,{renderStart:de,renderEnd:qt}},E=(R,$,de)=>de.start!==R||de.end!==$?(Object.assign(de,{start:R,end:$}),!0):!1,P=()=>{if(!ct.value){Object.assign(oo.value,{start:0,end:0}),setTimeout(P,50);return}if(si.value&&si.value===bl.value&&Math.abs(Ll.value-al.value)<32*(er-2)&&Jl.value===T.value&&ui.value===M.value.length)return;si.value=bl.value,Ll.value=al.value,ui.value=M.value.length;const{renderStart:R,renderEnd:$}=vi(bl.value,ct.value.clientWidth),de=Math.max(0,R-Rc),De=Math.min(M.value.length,$+Rc);E(de,De,oo.value);const Wt=Math.max(0,Math.floor(al.value/we.value)),qt=Math.ceil(ct.value.clientHeight/we.value),vn=Math.min(Wt+qt,T.value),wn=Math.max(0,Wt-er),Mn=Math.min(T.value,Math.max(vn+er,wn+50));(oe.start<10||Math.abs(wn-oe.start)>=er/2||Math.abs(Mn-oe.end)>=er/2||Jl.value!==T.value)&&(oe.start=wn,oe.end=Mn,ht(!0),Jl.value=T.value)},Te=ue(()=>M.value.slice(oo.value.start,oo.value.end).map(($,de)=>({field:$,index:de+oo.value.start})).filter($=>$.index!==0)),At=ue(()=>{const R={length:oo.value.start>0?oo.value.start-1:0,width:0};return R.width=R.length?Ao.value[oo.value.start]-Ao.value[1]:0,R}),Sn=ue(()=>{const R={length:oo.value.end<M.value.length-1?M.value.length-oo.value.end:0,width:0};return R.width=R.length?Ao.value[M.value.length]-Ao.value[oo.value.end]:0,R}),Vn=ue(()=>2+Te.value.length+At.value.length+Sn.value.length),Wo=V(),$n=V();function Ln(){const R=isNaN(rn.end.row)?ut.row:rn.end.row,$=isNaN(rn.end.col)?ut.col:rn.end.col;if(R!==null&&$!==null){if(!ct.value||!ct.value)return;Wo.value=(R+1)*we.value+32,$n.value=80+Ao.value[$+1]+($===0?Math.max(0,ct.value.scrollLeft-ct.value.offsetLeft):0)}}const Oo=ue(()=>rn.isEmpty()&&ut.col&&eo.value[ut.col].isReadonly||!rn.isEmpty()&&Array.from({length:rn.end.col-rn.start.col+1}).every((R,$)=>eo.value[rn.start.col+$].isReadonly)),co=ue(()=>Oo.value&&(!rn.isSingleCell()||!Vt.value||!Ho(M.value[Vt.value.col])&&!Jo(M.value[Vt.value.col]))),mo=ue(()=>Oo.value&&(!rn.isSingleCell()||!Vt.value||!ml(M.value[Vt.value.col]))),Ql=ue(()=>{var R,$;return!Le.value&&!A.value&&!on.value&&(!rn.isEmpty()||ut.row!==null&&ut.col!==null)&&!(($=(R=_.value.get((isNaN(rn.end.row)?ut.row:rn.end.row)??-1))==null?void 0:R.rowMeta)!=null&&$.new)&&ut.col!==null&&M.value[ut.col]&&T.value&&!Oo.value&&!Ae.value&&(!se.value||rn.end.row<ol)});Gn([()=>rn.end.row,()=>rn.end.col,()=>ut.row,()=>ut.col],([R,$,de,De],[Wt,qt,vn,wn])=>{(R!==Wt||$!==qt||de!==vn||De!==wn)&&Ln()});const Nl=R=>{var $;switch(R.type){case"table":Ne.viewProgress={progress:R.data.progress,message:R.data.message};break;case"row":Ne.rowProgress.set(R.data.rowId,{progress:R.data.progress,message:R.data.message});break;case"cell":{Ne.cellProgress.has(R.data.rowId)||Ne.cellProgress.set(R.data.rowId,new Map),Ne.cellProgress.get(R.data.rowId).set(R.data.cellId,{progress:R.data.progress,message:R.data.message,icon:($=R.data)==null?void 0:$.icon});break}}},Pl=R=>{switch(R.type){case"table":Ne.viewProgress=null,Ne.cellProgress=new Map,Ne.rowProgress=new Map;break;case"row":R.data.rowId&&(Ne.rowProgress.delete(R.data.rowId),Ne.rowProgress.set(R.data.rowId,null));break;case"cell":if(R.data.rowId&&R.data.cellId){const $=Ne.cellProgress.get(R.data.rowId);$&&($.delete(R.data.cellId),$.size===0?Ne.cellProgress.delete(R.data.rowId):Ne.cellProgress.set(R.data.rowId,$))}break}};je.on(async(R,$)=>{R===qo.FIELD_ADD&&(hn.value=$,Xe.value=!0),R===qo.CLEAR_NEW_ROW&&(Po(),ut.row=null,ut.col=null,m==null||m($))}),Gn(ut,R=>{var vn,wn,Mn;const $=R.row!==null?(vn=_.value.get(R.row))==null?void 0:vn.row:void 0,de=$&&R.col!==null?M.value[R.col]:void 0,De=$&&de?$[de.title]:void 0,Wt=Ht($,(wn=F.value)==null?void 0:wn.columns),qt=(Mn=I.value)==null?void 0:Mn.id;je.emit(qo.CELL_SELECTED,{rowId:Wt,colId:de==null?void 0:de.id,val:De,viewId:qt})});const nl=r(async R=>{var $;R!=null&&R.fieldAdd&&(($=ct.value)==null||$.scrollTo({top:0,left:0,behavior:"instant"})),await fa({keepNewRecords:!0}),p(Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY),await g(),P(),await Promise.all([et(),ht()]),Al.value.forEach((de,De)=>{de.rowMeta.rowIndex=T.value+De,_.value.set(T.value+De,de)})});let _l=null;const{eventBus:va}=Ps();va.on(async(R,$)=>{R===ks.UPDATE_PROGRESS&&Nl($),R===ks.RESET_PROGRESS&&Pl($),R===ks.RELOAD_VIEW&&await nl()}),gp(ct,{onScroll:R=>{_l&&cancelAnimationFrame(_l),_l=requestAnimationFrame(()=>{var $,de;bl.value=($=R.target)==null?void 0:$.scrollLeft,al.value=(de=R.target)==null?void 0:de.scrollTop,P(),Ln(),_l=null})},throttle:100,behavior:"smooth"}),Tl(document,"mousedown",R=>{var $,de;(R.offsetX>(($=R.target)==null?void 0:$.clientWidth)||R.offsetY>((de=R.target)==null?void 0:de.clientHeight))&&(en.value=!0),R.target.closest(".nc-grid-cell:not(.caption)")&&(so.value=!0)}),Tl(document,"mouseup",()=>{so.value=!1,setTimeout(()=>{en.value=!1},100)}),Tl(document,"keyup",async R=>{var Wt;const $=Wl();R.key==="Alt"&&!$&&(tn.value=!1);const de=document.querySelector(".nc-dropdown-single-select-cell.active,.nc-dropdown-multi-select-cell.active"),De=Va()?R.metaKey:R.ctrlKey;Yn.value&&!$&&!de&&!ra()&&!De&&!R.shiftKey&&!R.altKey&&(R.key==="Tab"&&ut.row===T.value-1&&ut.col===((Wt=M.value)==null?void 0:Wt.length)-1||R.key==="ArrowDown"&&ut.row===T.value-1&&Ve.value&&!se.value)&&(St(),Yn.value=!1)}),Tl(document,"keydown",async R=>{const $=Va()?R.metaKey:R.ctrlKey;if(R.altKey&&!R.shiftKey&&!$)switch(R.keyCode){case 78:{Ve.value&&!se.value&&St();break}}});const Zl=()=>{P(),Ln(),ht()};Ga(async()=>{const R=I.value,$=_.value.values();R&&Ce(R.fk_model_id,!1,!0).then(de=>{const De=de;De&&fa({metaValue:De,viewMetaValue:R,data:$})}),ae==null||ae.off(nl),he==null||he.off(dl),ye==null||ye.off(Zl)}),he==null||he.on(dl),ae==null||ae.on(nl),ye==null||ye.on(Zl),Gn(ln,()=>{ln.value?xn.value=!1:(xn.value=!0,Vt.value=null)}),Gn(I,async(R,$)=>{try{if(R&&R.id!==($==null?void 0:$.id)&&(R.fk_model_id===Y.params.viewId||N.value)){if(await ka(rt).toMatch(de=>!de),pt.value=!0,$!=null&&$.id){const de=await Ce($.fk_model_id,!1,!0);de&&await fa({viewMetaValue:$,metaValue:de,data:_.value.entries()})}try{await g(),P(),oe.end===0&&(oe.end=Math.min(100,T.value)),await Promise.allSettled([et(),ht()])}catch(de){Zu.isCancel(de)||(console.log(de),Zt.error(H("msg.errorLoadingData")))}}}catch(de){console.error(de)}finally{pt.value=!1}},{immediate:!0}),Gn([()=>M.value.length,()=>_.value.size],()=>{P(),Ln(),ht()}),Gn(we,()=>{P()}),wo(Bf,tn),n({scrollToRow:We,openColumnCreate:no});const cl=(R,$)=>{v&&v(R,$),ut.row=null,ut.col=null,rn.clear()},Na=(R,$,de)=>{const De=_.value.get($);if(ut.row!==$&&ll(),re.value)return cl(De,M.value[de]);So(R,$,de)};function xl(R){var $;($=ct.value)==null||$.scrollTo({top:ct.value.scrollTop,left:ct.value.scrollWidth,behavior:R})}const fe=ue(()=>Ao.value[Ao.value.length-1]+80),ke=ue(()=>T.value*we.value),{width:Oe,height:Ft}=qu();Gn([Oe,Ft],()=>{P()},{immediate:!0});const dt=(R,$)=>{var De;const de=_.value.get($==="above"?R.row:R.row+1);if(de){const Wt=Ht(de.row,(De=F.value)==null?void 0:De.columns);St(R.row+($==="above"?0:1),!1,Wt)}else St()},Ct=R=>{ut.row=null,ut.col=null,R.rowMeta.isDragging=!0,_.value.set(R.rowMeta.rowIndex,R)},{startDragging:Xt,isDragging:Jt,draggingRecord:Bt,targetTop:Lt}=vb({updateRecordOrder:b,onDragStart:Ct,gridWrapper:ct,virtualMargin:er,rowHeight:we,totalRows:T,rowSlice:oe,cachedRows:_}),fn=(R,$)=>{N.value||(R.rowMeta.isDragging=!0,_.value.set(R.rowMeta.rowIndex,R),Xt(R,$))},Wn=R=>{var de;if(i.value)return;const $=_.value.get(R);$&&($.rowMeta.selected=!((de=$.rowMeta)!=null&&de.selected),_.value.set(R,$))};Gn(i,R=>{var $;if(!R)for(const[de,De]of _.value.entries())($=De.rowMeta)!=null&&$.selected&&(De.rowMeta.selected=!1,_.value.set(de,De))}),Gn(se,R=>{me.value&&R&&W(!R)},{immediate:!0});const zn=ue(()=>!l.rowHeightEnum||l.rowHeightEnum===1?"align-middle":"align-top"),En=R=>{var de;const $=pe(R);if($){const De=(de=ne[$])==null?void 0:de.cellBgClass;if(De)return{[De]:!0}}return{}},In=R=>{var de;const $=pe(R,!0);if($){const De=(de=ne[$])==null?void 0:de.headerBgClass;if(De)return{[De]:!0}}return{}};return(R,$)=>{var Ar,Er,Mr,Tr,Hn;const de=Ys,De=sv,Wt=Df,qt=mb,vn=gb,wn=wb,Mn=Lf,fo=yb,at=Sl,Ut=Aa,lo=da,mn=Nf,go=ub,Tn=bb,Io=_b,ea=pv,pi=xb,zo=Ya,Pa=_r,Di=ud,Za=qa,Li=Hi,Ki=kb,Ni=Yl("xc-ver-resize"),Go=Yl("e");return h(),B("div",Cb,[$[46]||($[46]=z("div",{"data-testid":"drag-icon-placeholder",class:"absolute w-1 h-1 pointer-events-none opacity-0"},null,-1)),z("div",{ref_key:"dragColPlaceholderDomRef",ref:Fe,class:Gt([{"hidden w-0 !h-0 left-0 !max-h-0 !max-w-0":!e(X)},"absolute flex items-center z-40 top-0 h-full bg-gray-50 pointer-events-none opacity-60"])},[e(X)?(h(),B("div",{key:0,style:Xn({"min-width":((Ar=e(it)[e(X).id])==null?void 0:Ar.width)||"200px","max-width":((Er=e(it)[e(X).id])==null?void 0:Er.width)||"200px",width:((Mr=e(it)[e(X).id])==null?void 0:Mr.width)||"200px"}),class:"border-r-1 border-l-1 border-gray-200 h-full"},null,4)):ge("",!0)],2),e(te)||e(Ne).viewProgress?(h(),B("div",Rb,[z("div",Sb,ce((Tr=e(Ne).viewProgress)==null?void 0:Tr.progress)+" "+ce((Hn=e(Ne).viewProgress)==null?void 0:Hn.message),1),le(de,{size:"regular"})])):ge("",!0),z("div",{ref_key:"gridWrapper",ref:ct,class:"nc-grid-wrapper min-h-0 flex-1 relative !overflow-auto"},[le(Li,{visible:e(ln),"onUpdate:visible":$[32]||($[32]=Kn=>yo(ln)?ln.value=Kn:null),trigger:e(Ae)?[]:["contextmenu"],"overlay-class-name":"nc-dropdown-grid-context-menu"},{overlay:K(()=>[le(Za,{class:"!rounded !py-0",variant:"small",onClick:$[31]||($[31]=Kn=>ln.value=!1)},{default:K(()=>{var Kn;return[e(i)?ge("",!0):(h(),B(Qt,{key:0},[("isEeUI"in R?R.isEeUI:e(Wi))&&!e(xn)&&!e(Vt)&&!e(Le)&&e(gn).length?(h(),J(zo,{key:0,onClick:$[21]||($[21]=Bl=>a("bulkUpdateDlg"))},{default:K(()=>[Nt((h(),B("div",t1,[(h(),J($o(("iconMap"in R?R.iconMap:e(sl)).ncEdit))),Je(" "+ce(R.$t("title.updateSelectedRows")),1)])),[[Go,["a:row:update-bulk"]]])]),_:1})):ge("",!0),!e(xn)&&!e(Vt)&&!e(Le)&&e(gn).length?(h(),J(zo,{key:1,class:"nc-base-menu-item","data-testid":"nc-delete-row",danger:"",onClick:$[22]||($[22]=Bl=>R.deleteSelectedRows([]))},{default:K(()=>[e(gn).length===1?Nt((h(),B("div",n1,[le(at,{icon:"delete"}),Je(" "+ce(R.$t("activity.deleteSelectedRow")),1)])),[[Go,["a:row:delete"]]]):Nt((h(),B("div",o1,[le(at,{icon:"delete"}),Je(" "+ce(R.$t("activity.deleteSelectedRow")),1)])),[[Go,["a:row:delete-bulk"]]])]),_:1})):ge("",!0)],64)),e(i)?(h(),J(zo,{key:1,class:"nc-base-menu-item",danger:"","data-testid":"nc-delete-all-row",onClick:$[23]||($[23]=Bl=>Ja([]))},{default:K(()=>[Nt((h(),B("div",l1,[le(at,{icon:"delete"}),Je(" "+ce(R.$t("activity.deleteAllRecords")),1)])),[[Go,["a:row:delete-all"]]])]),_:1})):ge("",!0),e(Re)&&e(Se)&&!e(Le)&&e(U)?(h(),B(Qt,{key:2},[e(Vt)?(h(),J(zo,{key:0,class:"nc-base-menu-item","data-testid":"context-menu-item-add-above",onClick:$[24]||($[24]=Bl=>dt(e(Vt),"above"))},{default:K(()=>[Nt((h(),B("div",a1,[le(at,{icon:"ncChevronUp"}),Je(" "+ce(R.$t("general.insertAbove")),1)])),[[Go,["a:row:insert:above"]]])]),_:1})):ge("",!0),e(Vt)&&!e(bt)?(h(),J(zo,{key:1,class:"nc-base-menu-item","data-testid":"context-menu-item-add-below",onClick:$[25]||($[25]=Bl=>dt(e(Vt),"below"))},{default:K(()=>[Nt((h(),B("div",i1,[le(at,{icon:"ncChevronDown"}),Je(" "+ce(R.$t("general.insertBelow")),1)])),[[Go,["a:row:insert:below"]]])]),_:1})):ge("",!0),e(Vt)?(h(),J(Pa,{key:2})):ge("",!0)],64)):ge("",!0),e(Vt)&&e(Se)&&!e(Le)&&e(Rn).enabled?(h(),J(Ut,{key:3,disabled:!e(Rn).disabled},{title:K(()=>[Je(ce(e(Dn).length?R.$t("tooltip.aiIntegrationReConfigure"):R.$t("tooltip.aiIntegrationAddAndReConfigure")),1)]),default:K(()=>[le(zo,{class:"nc-base-menu-item","data-testid":"context-menu-item-bulk",disabled:e(Rn).disabled,onClick:Un},{default:K(()=>[z("div",r1,[le(at,{icon:"ncAutoAwesome",class:"h-4 w-4"}),Je(" Generate "+ce(e(rn).isSingleCell()?"Cell":"All"),1)])]),_:1},8,["disabled"])]),_:1},8,["disabled"])):ge("",!0),e(Tt).enabled?(h(),J(zo,{key:4,class:"nc-base-menu-item","data-testid":"context-menu-item-bulk-script",disabled:e(Tt).disabled,onClick:Zn},{default:K(()=>[z("div",s1,[le(at,{icon:"ncScript",class:"h-4 w-4"}),Je(" Execute "+ce(e(rn).isSingleCell()?"Cell":"All"),1)])]),_:1},8,["disabled"])):ge("",!0),e(Vt)?(h(),J(zo,{key:5,class:"nc-base-menu-item","data-testid":"context-menu-item-copy",onClick:$[26]||($[26]=Bl=>e(bo)(e(Vt)))},{default:K(()=>[Nt((h(),B("div",u1,[le(at,{icon:"copy"}),Je(" "+ce(R.$t("general.copy"))+" "+ce(R.$t("objects.cell").toLowerCase()),1)])),[[Go,["a:row:copy"]]])]),_:1})):ge("",!0),e(Vt)&&e(Se)&&!e(Le)?(h(),J(zo,{key:6,class:"nc-base-menu-item","data-testid":"context-menu-item-paste",disabled:e(co),onClick:e(Et)},{default:K(()=>[Nt((h(),B("div",d1,[le(at,{icon:"paste"}),Je(" "+ce(R.$t("general.paste"))+" "+ce(R.$t("objects.cell").toLowerCase()),1)])),[[Go,["a:row:paste"]]])]),_:1},8,["disabled","onClick"])):ge("",!0),e(Vt)&&e(Se)&&e(rn).isSingleCell()&&(e(ml)(e(M)[e(Vt).col])||!((Kn=e(to)[0])!=null&&Kn[e(Vt).col].isVirtualCol))&&!e(Le)?(h(),J(zo,{key:7,class:"nc-base-menu-item",disabled:e(mo),"data-testid":"context-menu-item-clear",onClick:$[27]||($[27]=Bl=>Ro(e(Vt)))},{default:K(()=>[Nt((h(),B("div",c1,[le(at,{icon:"close"}),Je(" "+ce(R.$t("general.clear"))+" "+ce(R.$t("objects.cell").toLowerCase()),1)])),[[Go,["a:row:clear"]]])]),_:1},8,["disabled"])):e(Vt)&&e(Se)&&!e(Le)?(h(),J(zo,{key:8,class:"nc-base-menu-item",disabled:e(Oo),"data-testid":"context-menu-item-clear",onClick:$[28]||($[28]=Bl=>Vl())},{default:K(()=>[Nt((h(),B("div",f1,[le(at,{icon:"closeBox",class:"text-gray-500"}),Je(" "+ce(R.$t("general.clear"))+" "+ce(R.$t("objects.cell").toLowerCase()),1)])),[[Go,["a:row:clear-range"]]])]),_:1},8,["disabled"])):ge("",!0),e(Vt)&&e(rn).isSingleCell()&&e(zt)("commentEdit")&&!e(re)?(h(),B(Qt,{key:9},[le(Pa),le(zo,{class:"nc-base-menu-item",onClick:$[29]||($[29]=Bl=>sn(e(Vt).row))},{default:K(()=>[Nt((h(),B("div",v1,[le(Di,{class:"h-4 w-4"}),Je(" "+ce(R.$t("general.add"))+" "+ce(R.$t("general.comment").toLowerCase()),1)])),[[Go,["a:row:comment"]]])]),_:1})],64)):ge("",!0),e(Se)&&!e(Le)?(h(),B(Qt,{key:10},[!e(xn)&&!e(Vt)&&(e(gn).length||e(i))?ge("",!0):(h(),J(Pa,{key:0})),e(Vt)&&(e(rn).isSingleCell()||e(rn).isSingleRow())?(h(),J(zo,{key:1,class:"nc-base-menu-item",damger:"",onClick:$[30]||($[30]=Bl=>kt(e(Vt).row))},{default:K(()=>[Nt((h(),B("div",p1,[le(at,{icon:"delete"}),Je(" "+ce(R.$t("activity.deleteRow")),1)])),[[Go,["a:row:delete"]]])]),_:1})):e(Vt)&&e(w)?(h(),J(zo,{key:2,class:"nc-base-menu-item",danger:"",onClick:bn},{default:K(()=>[Nt((h(),B("div",h1,[le(at,{icon:"delete"}),Je(" "+ce(R.$t("activity.deleteRows")),1)])),[[Go,["a:row:delete"]]])]),_:1})):ge("",!0)],64)):ge("",!0)]}),_:1})]),default:K(()=>{var Kn,Bl,$r,Or,Dr,Lr,Nr,Pr;return[z("div",null,[z("table",{class:Gt([{mobile:e(re),desktop:!e(re)},"nc-grid backgroundColorDefault !h-auto bg-white sticky top-0 z-5"])},[z("thead",null,[e(rt)?(h(),B("tr",Ib,[(h(!0),B(Qt,null,po(e(qn),($e,Do)=>(h(),B("td",{key:Do,class:Gt(["!bg-gray-50 h-full border-b-1 border-r-1",{"min-w-45":Do!==0,"min-w-16":Do===0}])},[le(De,{active:!0,title:!0,paragraph:!1,class:Gt(["ml-2 -mt-2",{"max-w-32":Do!==0,"max-w-5 !ml-3.5":Do===0}])},null,8,["class"])],2))),128))])):ge("",!0),Nt(z("tr",Fb,[z("th",{ref_key:"numColHeader",ref:Ta,class:"w-[80px] min-w-[80px]","data-testid":"grid-id-column"},[e(A)?(h(),B("div",Eb,"#")):(h(),B("div",Ab,[z("div",{class:Gt(["nc-no-label text-gray-500",{hidden:e(i)}])},"#",2),z("div",{class:Gt([{hidden:!e(i),flex:e(i),"pl-[21px]":e(Re)&&!e(_t),"pl-[2px]":!(e(Re)&&!e(_t))},"nc-check-all w-full items-center"])},[le(Wt,{checked:e(i),"onUpdate:checked":$[0]||($[0]=$e=>yo(i)?i.value=$e:null)},null,8,["checked"]),$[37]||($[37]=z("span",{class:"flex-1"},null,-1))],2)]))],512),(Bl=(Kn=e(M))==null?void 0:Kn[0])!=null&&Bl.id?Nt((h(),B("th",ar({key:0,ref_key:"primaryColHeader",ref:Ka},e(lt)?{"data-col":e(M)[0].id,"data-title":e(M)[0].title}:{},{style:{"min-width":(($r=e(it)[e(M)[0].id])==null?void 0:$r.width)||"180px","max-width":((Or=e(it)[e(M)[0].id])==null?void 0:Or.width)||"180px",width:((Dr=e(it)[e(M)[0].id])==null?void 0:Dr.width)||"180px"},class:["nc-grid-column-header",{"!border-r-blue-400 !border-r-3":e(vt)===e(M)[0].id,"no-resize":e(j),...In((Nr=(Lr=e(M))==null?void 0:Lr[0])==null?void 0:Nr.id)}],onXcstartresizing:$[4]||($[4]=$e=>d(e(M)[0].id,$e)),onXcresize:$[5]||($[5]=$e=>yt(e(M)[0].id,$e)),onXcresizing:$[6]||($[6]=$e=>Qe(e(M)[0].id,$e))}),[z("div",{class:"w-full h-full flex items-center text-gray-500 pl-2 pr-1",draggable:"false",onDragstart:$[1]||($[1]=ro($e=>e(Pe)(e(M)[0].id,$e),["stop"])),onDrag:$[2]||($[2]=ro($e=>e(xe)($e),["stop"])),onDragend:$[3]||($[3]=ro($e=>e(gt)($e),["stop"]))},[e(M)[0]&&e(eo)[0].isVirtualCol?(h(),J(qt,{key:0,column:e(M)[0],"hide-menu":e(A)||!!e(re)},null,8,["column","hide-menu"])):(h(),J(vn,{key:1,column:e(M)[0],"hide-menu":e(A)||!!e(re)},null,8,["column","hide-menu"]))],32)],16)),[[Ni]]):ge("",!0),e(At).length?(h(),B("th",{key:1,colspan:e(At).length,style:Xn({minWidth:`${e(At).width}px`,maxWidth:`${e(At).width}px`,width:`${e(At).width}px`}),class:"nc-grid-column-header"},null,12,Mb)):ge("",!0),(h(!0),B(Qt,null,po(e(Te),({field:$e,index:Do})=>{var Br,ei,Wr;return Nt((h(),B("th",ar({key:$e.id},{ref_for:!0},e(lt)?{"data-col":$e.id,"data-title":$e.title}:{},{style:{"min-width":((Br=e(it)[$e.id])==null?void 0:Br.width)||"180px","max-width":((ei=e(it)[$e.id])==null?void 0:ei.width)||"180px",width:((Wr=e(it)[$e.id])==null?void 0:Wr.width)||"180px"},class:["nc-grid-column-header",{"!border-r-blue-400 !border-r-3":e(vt)===$e.id,"no-resize":e(j),...In($e.id)}],onXcstartresizing:jl=>d($e.id,jl),onXcresize:jl=>yt($e.id,jl),onXcresizing:jl=>Qe($e.id,jl)}),[z("div",{class:"w-full h-full flex items-center text-gray-500 pl-2 pr-1",draggable:e(re)||Do===0||e(A)||!e(Se)||e(j)?"false":"true",onDragstart:ro(jl=>e(Pe)($e.id,jl),["stop"]),onDrag:$[7]||($[7]=ro(jl=>e(xe)(jl),["stop"])),onDragend:$[8]||($[8]=ro(jl=>e(gt)(jl),["stop"]))},[e(eo)[Do].isVirtualCol?(h(),J(qt,{key:0,column:$e,"hide-menu":e(A)||!!e(re)},null,8,["column","hide-menu"])):(h(),J(vn,{key:1,column:$e,"hide-menu":e(A)||!!e(re)},null,8,["column","hide-menu"]))],40,$b)],16,Tb)),[[Ni]])}),128)),e(Sn).length?(h(),B("th",{key:2,colspan:e(Sn).length,style:Xn({minWidth:`${e(Sn).width}px`,maxWidth:`${e(Sn).width}px`,width:`${e(Sn).width}px`}),class:"nc-grid-column-header"},null,12,Ob)):ge("",!0),e(Mt)?Nt((h(),B("th",{key:3,class:"cursor-pointer !border-0 relative !xs:hidden",style:{borderWidth:"0px !important"},onClick:$[15]||($[15]=ro($e=>Xe.value=!0,["stop"]))},[z("div",Db,[le(Mn,{visible:e(Xe),"onUpdate:visible":$[14]||($[14]=$e=>yo(Xe)?Xe.value=$e:null),trigger:["click"],"overlay-class-name":"nc-dropdown-add-column",onVisibleChange:Zo},{overlay:K(()=>[z("div",Nb,[e(Xe)?(h(),J(wn,{key:0,ref_key:"editOrAddProviderRef",ref:La,preload:e(Yt),"column-position":e(hn),class:Gt({hidden:e(Fn)}),onSubmit:$[9]||($[9]=$e=>Qo(!0)),onCancel:$[10]||($[10]=$e=>Qo()),onClick:$[11]||($[11]=ro(()=>{},["stop"])),onKeydown:$[12]||($[12]=ro(()=>{},["stop"])),onMounted:$[13]||($[13]=$e=>Yt.value=void 0)},null,8,["preload","column-position","class"])):ge("",!0)])]),default:K(()=>[z("div",Lb,[(h(),J($o(("iconMap"in R?R.iconMap:e(sl)).plus),{class:"text-base nc-column-add text-gray-500 !group-hover:text-black"}))])]),_:1},8,["visible"])])])),[[Go,["c:column:add"]]]):ge("",!0),z("th",Pb,[z("div",{class:Gt(["absolute top-0 w-45",{"left-[60px]":e(Mt),"left-0":!e(Mt)}])},"  ",2)])],512),[[ya,!e(rt)]])])],2),Nt(z("div",{class:"dragging-record",style:Xn({width:`${e(Oe)}px`,top:`${e(Lt)}px`})},null,4),[[ya,e(Jt)]]),z("div",{class:"table-overlay",style:Xn({height:e(te)?"100%":`${e(ke)+e(q)}px`,width:`${e(fe)}px`})},[z("table",{class:Gt(["xc-row-table nc-grid backgroundColorDefault !h-auto bg-white relative",{mobile:e(re),desktop:!e(re),"w-full":((Pr=e(He))==null?void 0:Pr.length)===0}]),onContextmenu:an},[z("tbody",{ref_key:"tableBodyEl",ref:Rt,class:"xc-row-table !bg-red-100",style:Xn({transform:`translateY(${e(Ye)}px)`})},[e(Ke).length?(h(),J(fo,{key:0,"row-count":e(Ke).length,"row-height":e(Ke).rowHeight,"total-row-height":e(Ke).totalRowHeight,"col-count":e(Vn)},null,8,["row-count","row-height","total-row-height","col-count"])):ge("",!0),(h(!0),B(Qt,null,po(e(He),($e,Do)=>{var Br;return h(),J(pi,{key:`${$e.rowMeta.rowIndex}-${(Br=$e.rowMeta)==null?void 0:Br.new}`,row:$e},{default:K(({state:ei})=>{var Wr,jl,yd,bd,_d,xd,kd,Cd,Rd,Sd,Id,Fd,Ad,Ed,Md,Td,$d,Od,Dd,Ld,Nd,Pd,Bd,Wd,zd,Vd,jd,Ud;return[(Wr=$e.rowMeta)!=null&&Wr.isValidationFailed?(h(),B("div",{key:0,style:Xn({top:`${(Do+1+e(Ke).length)*e(we)-6}px`,zIndex:100001}),class:"absolute z-30 left-0 w-full flex"},[z("div",Bb,[$[39]||($[39]=Je(" Row filtered ")),le(Ut,null,{title:K(()=>$[38]||($[38]=[Je(" This record will be hidden as it does not match the filters applied to this view. ")])),default:K(()=>[le(at,{icon:"info",class:"w-4 h-4 text-gray-800"})]),_:1})])],4)):ge("",!0),(jl=$e.rowMeta)!=null&&jl.isRowOrderUpdated?(h(),B("div",{key:1,style:Xn({top:`${(Do+1+e(Ke).length)*e(we)-6}px`,zIndex:1e5}),class:"absolute transform z-30 left-0 w-full flex"},[z("div",Wb,[$[41]||($[41]=Je(" Row moved ")),le(Ut,null,{title:K(()=>$[40]||($[40]=[Je(" This record will move to a new position when you click outside of it. ")])),default:K(()=>[le(at,{icon:"info",class:"w-4 h-4 text-gray-800"})]),_:1})])],4)):ge("",!0),z("tr",{class:Gt(["nc-grid-row transition-all duration-500 opacity-100 !xs:h-14",{"active-row":e(ut).row===$e.rowMeta.rowIndex||((yd=e(rn)._start)==null?void 0:yd.row)===$e.rowMeta.rowIndex,"mouse-down":e(so)||e(yl),"selected-row":$e.rowMeta.selected||e(i),"invalid-row":((bd=$e.rowMeta)==null?void 0:bd.isValidationFailed)||((_d=$e.rowMeta)==null?void 0:_d.isRowOrderUpdated),"is-dragging":((xd=$e.rowMeta)==null?void 0:xd.rowIndex)===((Cd=(kd=e(Bt))==null?void 0:kd.rowMeta)==null?void 0:Cd.rowIndex)}]),style:Xn({height:`${e(we)}px`,filter:e(tt)(e(G),$e.rowMeta.rowIndex+1)&&!$e.rowMeta.new?"blur(4px)":void 0,pointerEvents:e(tt)(e(G),$e.rowMeta.rowIndex+1)&&!$e.rowMeta.new?"none":"auto"}),"data-testid":`grid-row-${$e.rowMeta.rowIndex}`},[z("td",{class:"caption nc-grid-cell w-[80px] min-w-[80px]","data-testid":`cell-Id-${$e.rowMeta.rowIndex}`,onContextmenu:$[16]||($[16]=uo=>Vt.value=null)},[z("div",jb,[z("div",{class:Gt(["nc-row-no min-w-4 h-4 flex items-center justify-between text-gray-500 pl-1.5 w-full",{toggle:!e(A),hidden:((Rd=$e.rowMeta)==null?void 0:Rd.selected)||e(i),"text-[10px]":$e.rowMeta.rowIndex+1>=1e4,"text-xs":$e.rowMeta.rowIndex+1>=1e3,"text-small":$e.rowMeta.rowIndex+1<1e3}])},[z("span",null,ce($e.rowMeta.rowIndex+1),1),$[42]||($[42]=z("div",{class:"inline-block min-w-[4px] h-full rounded-full"},null,-1))],2),e(Re)&&!e(_t)?(h(),B("div",{key:0,class:Gt([{toggle:!e(A),"!block":((Sd=$e.rowMeta)==null?void 0:Sd.selected)||!!e(i)},"nc-drag-handle hidden"])},[le(lo,{size:"xxsmall",type:"text",disabled:!!e(gn).length||!!e(i),onMousedown:uo=>fn($e,uo)},{default:K(()=>[le(at,{class:Gt({"text-nc-content-gray hover:text-nc-content-brand":!e(gn).length&&!e(i),"text-nc-content-gray-muted":!(!e(gn).length&&!e(i))}),icon:"ncDrag"},null,8,["class"])]),_:2},1032,["disabled","onMousedown"])],2)):ge("",!0),e(A)?ge("",!0):(h(),B("div",{key:1,class:Gt([{hidden:!((Id=$e.rowMeta)!=null&&Id.selected)&&!e(i),flex:((Fd=$e.rowMeta)==null?void 0:Fd.selected)||e(i),"pl-1.5":!(e(Re)&&!e(_t))},"nc-row-expand-and-checkbox"])},[le(Wt,{checked:$e.rowMeta.selected||e(i),disabled:!$e.rowMeta.selected&&e(gn).length>=("EXTERNAL_SOURCE_VISIBLE_ROWS"in R?R.EXTERNAL_SOURCE_VISIBLE_ROWS:e(ol))||e(i),class:"!w-4 !h-4",onChange:uo=>Wn($e.rowMeta.rowIndex)},null,8,["checked","disabled","onChange"])],2)),z("div",{"data-testid":`nc-expand-${$e.rowMeta.rowIndex}`,class:"flex-1 flex items-center justify-end"},[(Ad=$e.rowMeta)!=null&&Ad.saving||(Ed=$e.rowMeta)!=null&&Ed.isLoading?(h(),J(mn,{key:0,class:"hidden nc-row-spinner items-center","data-testid":`row-save-spinner-${$e.rowMeta.rowIndex}`},null,8,["data-testid"])):(h(),B(Qt,{key:1},[(Md=$e.rowMeta)!=null&&Md.commentCount&&e(v)?Nt((h(),B("span",{key:0,class:Gt([{"nc-comment":(Td=$e.rowMeta)==null?void 0:Td.commentCount,"text-[10px] font-600 px-0.5":$e.rowMeta.commentCount>99,"text-small font-500 px-0.8":$e.rowMeta.commentCount<=99},"text-center rounded-md rounded-bl-none transition-all border-1 border-brand-200 cursor-pointer font-sembold select-none leading-5 text-brand-500 bg-brand-50 hover:bg-brand-100 !min-h-4.5 !min-w-5 !leading-5 inline-block"]),onClick:uo=>cl($e,ei)},[Je(ce($e.rowMeta.commentCount>99?"99+":$e.rowMeta.commentCount),1)],10,Gb)),[[Go,["c:expanded-form:open"]]]):(h(),B("div",Hb,[e(v)?Nt((h(),J($o(("iconMap"in R?R.iconMap:e(sl)).maximize),{key:0,class:"select-none transform nc-row-expand opacity-90 w-3.5 h-3.5",onClick:uo=>cl($e,ei)},null,8,["onClick"])),[[Go,["c:row-expand:open"]]]):ge("",!0)]))],64))],8,Ub)])],40,Vb),e(M)[0]?(h(),J(ea,ar({key:e(M)[0].id,active:e(ut).row===$e.rowMeta.rowIndex&&e(ut).col===0||(($d=e(rn)._start)==null?void 0:$d.row)===$e.rowMeta.rowIndex&&((Od=e(rn)._start)==null?void 0:Od.col)===0,class:["cell relative nc-grid-cell cursor-pointer",{active:e(Oa)[`${$e.rowMeta.rowIndex}-0`],"active-cell !after:h-[calc(100%-1px)]":e(ut).row===$e.rowMeta.rowIndex&&e(ut).col===0||((Dd=e(rn)._start)==null?void 0:Dd.row)===$e.rowMeta.rowIndex&&((Ld=e(rn)._start)==null?void 0:Ld.col)===0,"nc-required-cell":!((Nd=$e.rowMeta)!=null&&Nd.isLoading)&&((Bd=(Pd=e(to)[Do])==null?void 0:Pd[0])==null?void 0:Bd.isColumnRequiredAndNull)&&!e(N),filling:e(Qa)[`${$e.rowMeta.rowIndex}-0`],readonly:((Wd=e(eo)[0])==null?void 0:Wd.isReadonly)&&e(Se)&&((zd=e(Oa))==null?void 0:zd[`${$e.rowMeta.rowIndex}-0`]),"!border-r-blue-400 !border-r-3":e(vt)===e(M)[0].id,[e(zn)]:!0,...En(e(M)[0].id)}],style:{"min-width":((Vd=e(it)[e(M)[0].id])==null?void 0:Vd.width)||"180px","max-width":((jd=e(it)[e(M)[0].id])==null?void 0:jd.width)||"180px",width:((Ud=e(it)[e(M)[0].id])==null?void 0:Ud.width)||"180px"},"data-testid":`cell-${e(M)[0].title}-${$e.rowMeta.rowIndex}`},{ref_for:!0},e(lt)?{"data-key":`data-key-${$e.rowMeta.rowIndex}-${e(M)[0].id}`,"data-col":e(M)[0].id,"data-title":e(M)[0].title,"data-row-index":$e.rowMeta.rowIndex,"data-col-index":0}:{},{onMousedown:uo=>e(Kl)(uo,$e.rowMeta.rowIndex,0),onMouseover:uo=>e(No)(uo,$e.rowMeta.rowIndex,0),onDblclick:uo=>Mo($e,e(M)[0]),onContextmenu:uo=>an(uo,{row:$e.rowMeta.rowIndex,col:0}),onClick:uo=>Na(uo,$e.rowMeta.rowIndex,0)}),{default:K(()=>{var uo,Vo,zr,Vr,jr,Ur;return[(uo=e(to)[Do][0])!=null&&uo.cellProgress&&!e(pt)?(h(),B("div",Yb,[(zr=(Vo=e(to)[Do][0])==null?void 0:Vo.cellProgress)!=null&&zr.icon?(h(),J(at,{key:0,class:"w-4 h-4",icon:(jr=(Vr=e(to)[Do][0])==null?void 0:Vr.cellProgress)==null?void 0:jr.icon},null,8,["icon"])):ge("",!0),Je(" "+ce((Ur=e(to)[Do][0])==null?void 0:Ur.cellProgress.message)+" ",1),$[43]||($[43]=z("div",{class:"flex-1"},null,-1)),le(go,{class:"w-4 h-4"})])):e(pt)?ge("",!0):(h(),B("div",qb,[e(M)[0]&&e(eo)[0].isVirtualCol&&e(M)[0].title?(h(),J(Tn,{key:0,modelValue:$e.row[e(M)[0].title],"onUpdate:modelValue":pa=>$e.row[e(M)[0].title]=pa,active:e(ut).col===0&&e(ut).row===$e.rowMeta.rowIndex,column:e(M)[0],row:$e,"read-only":!e(Se),onNavigate:ho,onSave:pa=>{var hi;return(hi=e(c))==null?void 0:hi($e,"",ei)}},null,8,["modelValue","onUpdate:modelValue","active","column","row","read-only","onSave"])):e(M)[0]&&e(M)[0].title?(h(),J(Io,{key:1,modelValue:$e.row[e(M)[0].title],"onUpdate:modelValue":pa=>$e.row[e(M)[0].title]=pa,column:e(M)[0],"edit-enabled":!!e(Se)&&!!e(on)&&e(ut).col===0&&e(ut).row===$e.rowMeta.rowIndex,"row-index":$e.rowMeta.rowIndex,active:e(ut).col===0&&e(ut).row===$e.rowMeta.rowIndex,"read-only":!e(Se),"onUpdate:editEnabled":$[17]||($[17]=pa=>on.value=pa),onNavigate:ho,onCancel:$[18]||($[18]=pa=>on.value=!1),onSave:pa=>{var hi;return(hi=e(c))==null?void 0:hi($e,e(M)[0].title,ei)}},null,8,["modelValue","onUpdate:modelValue","column","edit-enabled","row-index","active","read-only","onSave"])):ge("",!0)]))]}),_:2},1040,["active","class","style","data-testid","onMousedown","onMouseover","onDblclick","onContextmenu","onClick"])):ge("",!0),e(At).length?(h(),B("td",{key:1,colspan:e(At).length,style:Xn({minWidth:`${e(At).width}px`,maxWidth:`${e(At).width}px`,width:`${e(At).width}px`}),class:"nc-grid-cell"},null,12,Xb)):ge("",!0),(h(!0),B(Qt,null,po(e(Te),({field:uo,index:Vo})=>{var zr,Vr,jr,Ur,pa,hi,Gd,Hd;return h(),J(ea,ar({key:`cell-${Vo}-${$e.rowMeta.rowIndex}`,active:e(ut).row===$e.rowMeta.rowIndex&&e(ut).col===Vo||((zr=e(rn)._start)==null?void 0:zr.row)===$e.rowMeta.rowIndex&&((Vr=e(rn)._start)==null?void 0:Vr.col)===Vo,class:["cell relative nc-grid-cell cursor-pointer",{active:e(Oa)[`${$e.rowMeta.rowIndex}-${Vo}`],"active-cell":e(ut).row===$e.rowMeta.rowIndex&&e(ut).col===Vo||((jr=e(rn)._start)==null?void 0:jr.row)===$e.rowMeta.rowIndex&&((Ur=e(rn)._start)==null?void 0:Ur.col)===Vo,"nc-required-cell":!((pa=$e.rowMeta)!=null&&pa.isLoading)&&e(to)[Do][Vo].isColumnRequiredAndNull&&!e(N),filling:e(Qa)[`${$e.rowMeta.rowIndex}-${Vo}`],readonly:e(eo)[Vo].isReadonly&&e(Se)&&e(Oa)[`${$e.rowMeta.rowIndex}-${Vo}`],"!border-r-blue-400 !border-r-3":e(vt)===uo.id,[e(zn)]:!0,...En(uo.id)}],style:{"min-width":((hi=e(it)[uo.id])==null?void 0:hi.width)||"180px","max-width":((Gd=e(it)[uo.id])==null?void 0:Gd.width)||"180px",width:((Hd=e(it)[uo.id])==null?void 0:Hd.width)||"180px"},"data-testid":`cell-${uo.title}-${$e.rowMeta.rowIndex}`},{ref_for:!0},e(lt)?{"data-key":`data-key-${$e.rowMeta.rowIndex}-${uo.id}`,"data-col":uo.id,"data-title":uo.title,"data-row-index":$e.rowMeta.rowIndex,"data-col-index":0}:{},{onMousedown:ha=>e(Kl)(ha,$e.rowMeta.rowIndex,Vo),onMouseover:ha=>e(No)(ha,$e.rowMeta.rowIndex,Vo),onClick:ha=>Na(ha,$e.rowMeta.rowIndex,Vo),onDblclick:ha=>Mo($e,uo),onContextmenu:ha=>an(ha,{row:$e.rowMeta.rowIndex,col:Vo})}),{default:K(()=>{var ha,Yd,qd,Xd,Kd,Jd;return[(ha=e(to)[Do][Vo])!=null&&ha.cellProgress&&!e(pt)?(h(),B("div",Kb,[(qd=(Yd=e(to)[Do][Vo])==null?void 0:Yd.cellProgress)!=null&&qd.icon?(h(),J(at,{key:0,class:"w-4 h-4",icon:(Kd=(Xd=e(to)[Do][Vo])==null?void 0:Xd.cellProgress)==null?void 0:Kd.icon},null,8,["icon"])):ge("",!0),Je(" "+ce((Jd=e(to)[Do][Vo])==null?void 0:Jd.cellProgress.message)+" ",1),$[44]||($[44]=z("div",{class:"flex-1"},null,-1)),le(go,{class:"w-4 h-4"})])):e(pt)?ge("",!0):(h(),B("div",Jb,[e(eo)[Vo].isVirtualCol&&uo.title?(h(),J(Tn,{key:0,modelValue:$e.row[uo.title],"onUpdate:modelValue":Ji=>$e.row[uo.title]=Ji,column:uo,row:$e,active:e(ut).col===Vo&&e(ut).row===$e.rowMeta.rowIndex,"read-only":!e(Se),onNavigate:ho,onSave:Ji=>{var Gr;return(Gr=e(c))==null?void 0:Gr($e,"",ei)}},null,8,["modelValue","onUpdate:modelValue","column","row","active","read-only","onSave"])):uo.title?(h(),J(Io,{key:1,modelValue:$e.row[uo.title],"onUpdate:modelValue":Ji=>$e.row[uo.title]=Ji,"edit-enabled":!!e(Se)&&!!e(on)&&e(ut).col===Vo&&e(ut).row===$e.rowMeta.rowIndex,active:e(ut).col===Vo&&e(ut).row===$e.rowMeta.rowIndex,"read-only":!e(Se),column:uo,"row-index":$e.rowMeta.rowIndex,onSave:Ji=>{var Gr;return(Gr=e(c))==null?void 0:Gr($e,uo.title,ei)},onNavigate:ho,onCancel:$[19]||($[19]=Ji=>on.value=!1)},null,8,["modelValue","onUpdate:modelValue","edit-enabled","active","read-only","column","row-index","onSave"])):ge("",!0)]))]}),_:2},1040,["active","class","style","data-testid","onMousedown","onMouseover","onClick","onDblclick","onContextmenu"])}),128)),e(Sn).length?(h(),B("td",{key:2,colspan:e(Sn).length,style:Xn({minWidth:`${e(Sn).width}px`,maxWidth:`${e(Sn).width}px`,width:`${e(Sn).width}px`}),class:"nc-grid-cell"},null,12,Qb)):ge("",!0)],14,zb)]}),_:2},1032,["row"])}),128)),e(ft).length?(h(),J(fo,{key:1,"row-count":e(ft).length,"row-height":e(ft).rowHeight,"total-row-height":e(ft).totalRowHeight,"col-count":e(Vn)},null,8,["row-count","row-height","total-row-height","col-count"])):ge("",!0),e(Ve)&&!e(se)?Nt((h(),B("tr",{key:2,class:Gt(["text-left nc-grid-add-new-cell mb-[80px] transition-all cursor-pointer group relative z-3 xs:hidden",{"!border-r-2 !border-r-gray-100":e(Eo)===1}]),style:{height:"32px"},onClick:$[20]||($[20]=$e=>St())},[z("td",Zb,[e(rt)?ge("",!0):(h(),J($o(("iconMap"in R?R.iconMap:e(sl)).plus),{key:0,class:"text-pint-500 text-base ml-2 mt-0 text-gray-600 group-hover:text-black"}))]),z("td",{colspan:e(Eo),class:"!border-gray-100"},null,8,e1)],2)),[[Go,["c:row:add:grid-bottom"]]]):ge("",!0)],4)],34),Nt(z("div",{ref_key:"fillHandle",ref:nt,class:Gt(["nc-fill-handle",{"z-3":!e(rn).isEmpty()&&e(rn).end.col!==0,"z-4":e(rn).isEmpty()&&e(ut).col!==0,"transition-all !bg-purple-400 !w-[10px] !h-[10px] !mt-[-5px] !ml-[-5px]":e(Ko)}]),style:Xn({top:`${e(Wo)}px`,left:`${e($n)}px`,cursor:"crosshair"})},null,6),[[ya,e(Ql)]])],4)])]}),_:1},8,["visible","trigger"]),e(se)?(h(),B("div",m1,[z("div",g1,[z("div",w1,[z("div",y1,ce(R.$t("upgrade.upgradeToSeeMoreRecordInline")),1),z("div",null,ce(R.$t("upgrade.upgradeToSeeMoreRecordInlineSubtitle",{plan:e(Iu).BUSINESS,limit:100,total:Math.max(l.totalRows,l.actualTotalRows),remaining:Math.max(l.totalRows,l.actualTotalRows)-100})),1)]),z("div",b1,[z("a",_1,[le(lo,{size:"small",type:"secondary"},{default:K(()=>[Je(ce(R.$t("msg.learnMore")),1)]),_:1})]),le(lo,{size:"small",onClick:$[33]||($[33]=Kn=>e(Dt)({limitOrFeature:e(Hs).LIMIT_EXTERNAL_SOURCE_PER_WORKSPACE,ctaPlan:e(Iu).BUSINESS}))},{default:K(()=>[Je(ce(e(mt)?R.$t("general.upgrade"):e(H)("general.requestUpgrade")),1)]),_:1})])])])):ge("",!0)],512),z("div",{class:"absolute bottom-12 z-5 left-2",onClick:$[36]||($[36]=ro(()=>{},["stop"]))},[e(Ve)&&!e(se)?(h(),J(Li,{key:0},{overlay:K(()=>[le(Za,{variant:"small"},{default:K(()=>[Nt((h(),J(zo,{class:"nc-new-record-with-grid group",disabled:e(se),onClick:Ma},{default:K(()=>{var Kn;return[z("div",R1,[(h(),J($o((Kn=("viewIcons"in R?R.viewIcons:e(Ci))[e(Ul).GRID])==null?void 0:Kn.icon),{class:"nc-view-icon text-inherit"})),Je(" "+ce(R.$t("activity.newRecord"))+" - "+ce(R.$t("objects.viewType.grid")),1)]),e(me)?(h(),J(at,{key:0,icon:"check",class:"w-4 h-4 text-primary"})):ge("",!0)]}),_:1},8,["disabled"])),[[Go,["c:row:add:grid"]]]),Nt((h(),J(zo,{class:"nc-new-record-with-form group",onClick:kn},{default:K(()=>{var Kn;return[z("div",S1,[(h(),J($o((Kn=("viewIcons"in R?R.viewIcons:e(Ci))[e(Ul).FORM])==null?void 0:Kn.icon),{class:"nc-view-icon text-inherit"})),Je(" "+ce(R.$t("activity.newRecord"))+" - "+ce(R.$t("objects.viewType.form")),1)]),e(me)?ge("",!0):(h(),J(at,{key:0,icon:"check",class:"w-4 h-4 text-primary"}))]}),_:1})),[[Go,["c:row:add:form"]]])]),_:1})]),default:K(()=>[z("div",x1,[e(re)?Nt((h(),J(lo,{key:0,class:"nc-grid-add-new-row",size:"small",type:"secondary",shadow:!1,onClick:$[34]||($[34]=ro(Kn=>kn(),["stop"]))},{default:K(()=>[z("div",k1,[le(at,{icon:"plus"}),$[45]||($[45]=Je(" New Record "))])]),_:1})),[[Go,[e(me)?"c:row:add:grid":"c:row:add:form"]]]):Nt((h(),J(lo,{key:1,class:"!rounded-r-none !border-r-0 nc-grid-add-new-row",size:"small",type:"secondary",shadow:!1,onClick:$[35]||($[35]=ro(Kn=>e(me)?St():kn(),["stop"]))},{default:K(()=>[z("div",C1,[le(at,{icon:"plus"}),e(me)?(h(),B(Qt,{key:0},[Je(ce(R.$t("activity.newRecord")),1)],64)):(h(),B(Qt,{key:1},[Je(ce(R.$t("activity.newRecord"))+" - "+ce(R.$t("objects.viewType.form")),1)],64))])]),_:1})),[[Go,[e(me)?"c:row:add:grid":"c:row:add:form"]]]),e(re)?ge("",!0):(h(),J(lo,{key:2,size:"small",class:"!rounded-l-none nc-add-record-more-info",type:"secondary",shadow:!1},{default:K(()=>[le(at,{icon:"arrowUp"})]),_:1}))])]),_:1})):ge("",!0)]),le(Ki,{"total-rows":Math.max(l.totalRows,l.actualTotalRows),"scroll-left":e(bl),"disable-pagination":!0},null,8,["total-rows","scroll-left"])])}}}),E1=Object.assign(Ol(A1,[["__scopeId","data-v-2991e924"]]),{__name:"SmartsheetGridInfiniteTable"}),M1={class:"nc-icon",viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"};function T1(t,n){return h(),B("svg",M1,n[0]||(n[0]=[z("path",{fill:"currentColor",d:"M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2m-6 4.1L14.1 6l1.4 1.4L16.9 6L18 7.1l-1.4 1.4L18 9.9L16.9 11l-1.4-1.4l-1.4 1.4L13 9.9l1.4-1.4zm-6.8.6h5v1.5h-5zm5.3 8.3h-2v2H8v-2H6v-1.5h2v-2h1.5v2h2zm6.5 1.2h-5v-1.5h5zm0-2.4h-5v-1.5h5z"},null,-1)]))}const $1=br({name:"mdi-calculator-variant",render:T1}),O1={class:"nc-icon",viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"};function D1(t,n){return h(),B("svg",O1,n[0]||(n[0]=[z("path",{fill:"currentColor",d:"M2 12a9 9 0 0 0 9 9c2.39 0 4.68-.94 6.4-2.6l-1.5-1.5A6.7 6.7 0 0 1 11 19c-6.24 0-9.36-7.54-4.95-11.95S18 5.77 18 12h-3l4 4h.1l3.9-4h-3a9 9 0 0 0-18 0"},null,-1)]))}const L1=br({name:"mdi-reload",render:D1}),N1={class:"nc-icon",viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"};function P1(t,n){return h(),B("svg",N1,n[0]||(n[0]=[z("path",{fill:"currentColor",d:"M8.59 16.58L13.17 12L8.59 7.41L10 6l6 6l-6 6z"},null,-1)]))}const B1=br({name:"mdi-chevron-right",render:P1}),W1={class:"nc-icon",viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"};function z1(t,n){return h(),B("svg",W1,n[0]||(n[0]=[z("path",{fill:"currentColor",d:"M11 2a2 2 0 0 1 2 2v16a2 2 0 0 1-2 2H2V2zm-7 8v4h7v-4zm0 6v4h7v-4zM4 4v4h7V4zm11 7h3V8h2v3h3v2h-3v3h-2v-3h-3z"},null,-1)]))}const V1=br({name:"mdi-table-column-plus-after",render:z1}),j1=()=>{const t=V(!1),n=async(...p)=>{},o=async(...p)=>{},l=async(...p)=>{},a=V(!1),i=V(),r=V(!1),s=V();return{loadMagic:t,predictColumnType:n,optionsMagic:o,predictFunction:l,table:{predictingNextColumn:a,predictedNextColumn:i,predictNextColumn:async(...p)=>{},predictingNextFormulas:r,predictedNextFormulas:s,predictNextFormulas:async(...p)=>{}},createTableMagic:async(...p)=>{},createSchemaMagic:async(...p)=>{}}},U1=ko(()=>Co(()=>import("./CfTpfQ4B.js"),__vite__mapDeps([0,1,2,3,4]),import.meta.url).then(t=>t.default||t)),G1=ko(()=>Co(()=>import("./CDTi0oRk.js"),__vite__mapDeps([5,1,2,3,6]),import.meta.url).then(t=>t.default||t)),H1=ko(()=>Co(()=>import("./CG-5KGUk.js").then(t=>t.E),__vite__mapDeps([43,1,2,44,45,46,47,48,24,23,3,22,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,39,71,32,31,33,30,34,72,73,28,26,27,74,75,76]),import.meta.url).then(t=>t.default||t)),Y1=ko(()=>Co(()=>import("./BYqbwTjR.js"),__vite__mapDeps([77,1,2]),import.meta.url).then(t=>t.default||t)),q1=ko(()=>Co(()=>import("./BALLsGq5.js").then(t=>t.V),__vite__mapDeps([7,1,2,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,3,26,27,28,29,30,31,32,33,34,35]),import.meta.url).then(t=>t.default||t)),X1=ko(()=>Co(()=>import("./B1qoNiTF.js").then(t=>t.C),__vite__mapDeps([36,1,2,12,13,37,38,39,28,23,22,26,27,40]),import.meta.url).then(t=>t.default||t)),K1=ko(()=>Co(()=>Promise.resolve().then(()=>fd),void 0,import.meta.url).then(t=>t.default||t)),J1=ko(()=>Co(()=>import("./CPGfyxPl.js"),__vite__mapDeps([111,20,1,2,21,32,31,33,30,34,112]),import.meta.url).then(t=>t.default||t)),Q1=ko(()=>Co(()=>import("./DCKYOzKD.js"),__vite__mapDeps([78,1,2,65,66,67,68,43,44,45,46,47,48,24,23,3,22,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,69,70,39,71,32,31,33,30,34,72,73,28,26,27,74,75,76,79,80,81,19,82,83,84,85,86,87,88,89,90,91,36,12,13,37,38,40,92,93,94,29,95,96,97,98,99,7,8,9,10,11,14,15,16,17,18,20,21,25,35,100,101,102,103,104,105,106,107,108,109,110]),import.meta.url).then(t=>t.default||t)),Z1={class:"flex items-center justify-center bg-white/80 absolute l-0 t-0 w-full h-full z-10 pb-10 pointer-events-none"},e_={class:"flex flex-col items-center justify-center gap-2"},t_=["innerHTML"],n_={key:0},o_={class:"nc-grid-header"},l_={class:"w-[64px] min-w-[64px]","data-testid":"grid-id-column"},a_={class:"w-full h-full flex pl-2 pr-1 items-center","data-testid":"nc-check-all"},i_={key:1,class:"text-gray-500"},r_=["data-col","data-title"],s_=["colspan"],u_=["data-col","data-title","onXcstartresizing","onXcresize","onXcresizing","onClick"],d_=["draggable","onDragstart"],c_=["colspan"],f_={class:"absolute top-0 left-0 h-8 border-b-1 border-r-1 border-gray-200 nc-grid-add-edit-column group"},v_={class:"h-full w-[60px] flex items-center justify-center"},p_={class:"flex flex-row items-center px-1 py-0.5 gap-1 w-full"},h_={class:"text-xs flex-1"},m_={class:"text-xs"},g_={class:"text-red-500 text-xs"},w_={class:"text-xs"},y_={class:"flex flex-row items-center px-1 py-0.5 gap-1 w-full"},b_={class:"text-xs flex-1"},__={class:"text-xs"},x_={class:"text-red-500 text-xs"},k_={class:"text-xs"},C_={class:"nc-edit-or-add-provider-wrapper"},R_={class:"!border-0 relative !xs:hidden",style:{borderWidth:"0px !important"}},S_=["data-testid"],I_=["data-testid"],F_={class:"w-[64px] pl-2 pr-1 items-center w-full flex gap-0.5"},A_=["data-testid"],E_=["onClick"],M_={key:1,class:"cursor-pointer flex items-center border-1 border-gray-100 active:ring rounded-md p-0.75 hover:bg-white hover:border-nc-border-gray-medium"},T_={key:0,class:"w-full"},$_=["colspan"],O_={key:0,class:"w-full"},D_=["colspan"],L_={class:"nc-grid-add-new-cell-item h-8 border-b-1 border-gray-100 bg-white group-hover:bg-gray-50 absolute left-0 bottom-0 px-2 sticky z-40 w-full flex items-center text-gray-500"},N_=["colspan"],P_={class:"flex gap-2 items-center"},B_={key:0,class:"flex gap-2 items-center"},W_={key:1,class:"flex gap-2 items-center"},z_={class:"flex gap-2 items-center"},V_={class:"flex gap-2 items-center"},j_={class:"flex gap-2 items-center"},U_={class:"flex gap-2 items-center"},G_={class:"flex gap-2 items-center"},H_={class:"flex gap-2 items-center"},Y_={class:"flex gap-2 items-center"},q_={class:"flex gap-2 items-center"},X_={class:"relative"},K_={class:"flex ml-1"},J_={"data-testid":"nc-pagination-add-record",class:"flex items-center px-2 text-gray-600 hover:text-black"},Q_={class:"relative overflow-visible min-h-17 w-10"},Z_={class:"flex flex-row items-center justify-between w-full"},ex={class:"flex flex-row items-center justify-start gap-x-2.5"},tx={class:"flex flex-row text-xs text-gray-400 ml-6.5"},nx={class:"flex flex-row items-center justify-between w-full"},ox={class:"flex flex-row items-center justify-start gap-x-2.5"},lx={class:"flex flex-row text-xs text-gray-400 ml-6.5"},ax={class:"flex shadow-nc-sm rounded-lg"},ix={class:"flex items-center gap-2"},rx={"data-testid":"nc-pagination-add-record",class:"flex items-center gap-2"},sx={class:"flex flex-row items-center justify-start gap-x-3"},ux={class:"flex flex-row items-center justify-start gap-x-3"},dx=!1,bs=10,cx=xo({__name:"Table",props:{data:{},vGroup:{},paginationData:{},loadData:{type:Function},changePage:{type:Function},callAddEmptyRow:{type:Function},deleteRow:{type:Function},updateOrSaveRow:{type:Function},selectedAllRecords:{type:Boolean},deleteRangeOfRows:{type:Function},rowHeightEnum:{},expandForm:{type:Function},deleteSelectedRows:{type:Function},removeRowIfNew:{type:Function},bulkUpdateRows:{type:Function},headerOnly:{type:Boolean},hideHeader:{type:Boolean},hideCheckbox:{type:Boolean},pagination:{},disableSkeleton:{type:Boolean},disableVirtualX:{type:Boolean},disableVirtualY:{type:Boolean}},emits:["update:selectedAllRecords","bulkUpdateDlg","toggleOptimisedQuery"],setup(t,{expose:n,emit:o}){const l=t,a=o,i=Ra(l,"selectedAllRecords",a),r=Nn(l,"paginationData"),s=Nn(l,"data"),u=Nn(l,"pagination"),c=Nn(l,"headerOnly"),f=Nn(l,"hideHeader"),v=Nn(l,"disableSkeleton"),p=Nn(l,"disableVirtualX"),g=Nn(l,"disableVirtualY"),{api:y}=Af(),{vGroup:x,loadData:w,changePage:m,callAddEmptyRow:C,updateOrSaveRow:b,deleteRow:S,expandForm:k,deleteSelectedRows:D,deleteRangeOfRows:F,removeRowIfNew:I,bulkUpdateRows:M}=l,A=dn(Ti,V()),j=dn(ds,V()),N=dn(wr,V([])),Y=dn(Ks,V(!1)),ae=dn(Yi,V(!1)),he=dn(zl,V(!1)),ye=dn(Wf,V(!1)),re=fs(),me=dn(Ea,jo()),W=dn(Qu,jo()),{isMobileMode:U,isAddNewRecordGridMode:Ae,setAddNewRecordGridMode:je}=tl(),Ue=dn(zf,V()),{isPkAvail:ot,isSqlView:G,eventBus:pe}=Fl(),{isColumnSortedOrFiltered:ne,appearanceConfig:be}=tu(),{isViewDataLoading:ee,isPaginationLoading:H}=Uo(yr()),{$e:Ce}=ua(),{t:Ie}=la(),{getMeta:Q}=ai(),{addUndo:ie,clone:Me,defineViewScope:Be}=Mi(),{isViewColumnsLoading:it,updateGridViewColumn:Ge,gridViewCols:ze,metaColumnById:Z,resizingColOldWith:Et}=Ha(),{isExpandedFormCommentMode:_e}=Uo(Ir()),{predictingNextColumn:yn,predictedNextColumn:It,predictingNextFormulas:$t,predictedNextFormulas:et,predictNextColumn:cn,predictNextFormulas:Pn}=j1().table,{paste:Kt}=dd(),{addLTARRef:nn,syncLTARRefs:wt,clearLTARCell:Dn,cleaMMCell:un}=ad(),{loadViewAggregate:Bn}=nu(),{showRecordPlanLimitExceededModal:tt}=ql(),mt=V(null),Dt=V(),Rt=V(),ct=V(),nt=V(),{height:rt}=wp(Rt),st=ue(()=>it.value||!A.value),lt=V(!1),xt=ue(()=>U.value?56:Bo[`${l.rowHeightEnum}`]??32),{isUIAllowed:Ot,isDataReadOnly:yt}=wl(),Qe=ue(()=>Ot("dataEdit")&&!G.value),d=ue(()=>!Y.value&&Ot("fieldAdd")&&!G.value),{onDrag:_,onDragStart:O,onDragEnd:T,draggedCol:se,dragColPlaceholderDomRef:q,toBeDroppedColId:L}=hv({fields:N,tableBodyEl:ct,gridWrapper:Dt}),{onLeft:te,onRight:we,onUp:oe,onDown:Ee}=Rm({paginationDataRef:r,changePage:m,isViewDataLoading:ee}),{generateRows:Ne,generatingRows:He,generatingColumnRows:Ze,generatingColumns:Ke,aiIntegrations:ft}=kr(),Ye=V(!1),qe=V(!1),ht=V(!1),zt=V(!1),Le=V(),Se=V(!1),Mt=V(!1),xe=V(null),Pe=V(!1),gt=V(!1),X=V(!1),Fe=V(null),vt=V(!1),Re=ue({get:()=>{var E,P;return(E=l.data)!=null&&E.some(Te=>Te.rowMeta.selected)&&yt.value||Fe.value===null&&!((P=l.data)!=null&&P.some(Te=>Te.rowMeta.selected))&&!i.value?!1:vt.value},set:E=>{vt.value=E}}),bt=(E,P)=>{G.value||(E.preventDefault(),P&&(Fe.value=P))},_t=V(!1);wo(Pf,_t);const Xe=V(!1);async function tn(E,P=!1){var Sn;if(yt.value||!E||!Qe.value||!ml(N.value[E.col])&&_o(N.value[E.col])||N.value[E.col].readonly||xn.value[E.col].isReadonly&&!_o(N.value[E.col]))return;const Te=s.value[E.row],At=N.value[E.col];if(_o(At)){let Vn;const Wo=Te.row[At.title],$n=At.fk_model_id===((Sn=At.colOptions)==null?void 0:Sn.fk_related_model_id);Ho(At)&&Te&&(Vn=await un(Te,At)),ie({undo:{fn:async(Ln,Oo,co,mo,Ql,Nl,Pl)=>{var nl,_l,va,Zl,cl;if(((nl=r.value)==null?void 0:nl.pageSize)===mo.pageSize){((_l=r.value)==null?void 0:_l.page)!==mo.page&&await(m==null?void 0:m(mo.page));const Na=Ht(co.row,(va=A.value)==null?void 0:va.columns),xl=s.value[Ln.row],fe=N.value[Ln.col];if(fe.title&&Na===Ht(xl.row,(Zl=A.value)==null?void 0:Zl.columns)&&fe.id===Oo.id)Jo(fe)||Cl(fe)?(xl.row[fe.title]=co.row[fe.title],await nn(xl,xl.row[fe.title],fe),await wt(xl,xl.row)):Ho(fe)&&(await y.dbDataTableRow.nestedLink((cl=A.value)==null?void 0:cl.id,fe.id,encodeURIComponent(Na),Ql),xl.row[fe.title]=Nl??null),Ve.col=Ln.col,Ve.row=Ln.row,Pl&&me.trigger({shouldShowLoading:!1}),bo==null||bo();else throw new Error(Ie("msg.recordCouldNotBeFound"))}else throw new Error(Ie("msg.pageSizeChanged"))},args:[Me(E),Me(At),Me(Te),Me(r.value),Vn,Wo,$n]},redo:{fn:async(Ln,Oo,co,mo,Ql)=>{var Nl,Pl,nl,_l;if(((Nl=r.value)==null?void 0:Nl.pageSize)===mo.pageSize){((Pl=r.value)==null?void 0:Pl.page)!==mo.page&&await(m==null?void 0:m(mo.page));const va=Ht(co.row,(nl=A.value)==null?void 0:nl.columns),Zl=s.value[Ln.row],cl=N.value[Ln.col];if(va===Ht(Zl.row,(_l=A.value)==null?void 0:_l.columns)&&cl.id===Oo.id)Jo(cl)||Cl(cl)?await Dn(Zl,cl):Ho(cl)&&await un(Zl,cl),Ve.col=Ln.col,Ve.row=Ln.row,Ql&&me.trigger({shouldShowLoading:!1}),bo==null||bo();else throw new Error(Ie("msg.recordCouldNotBeFound"))}else throw new Error(Ie("msg.pageSizeChanged"))},args:[Me(E),Me(At),Me(Te),Me(r.value),$n]},scope:Be({view:j.value})}),(Jo(At)||Cl(At))&&await Dn(Te,At),$n&&me.trigger({shouldShowLoading:!1});return}if(At.title)switch(At.uidt){case ve.Checkbox:Te.row[At.title]=!1;break;case ve.Rating:Te.row[At.title]=0;break;default:Te.row[At.title]=null;break}P||await(b==null?void 0:b(Te,At.title))}function Yt(E,P){if(!(!Qe.value||Pe.value||dx||Y.value||xa(P)||P.readonly)){if(!ot.value&&!E.rowMeta.new){Zt.info(Ie("msg.info.updateNotAllowedWithoutPK"));return}if(P.ai){Zt.info(Ie("msg.info.autoIncFieldNotEditable"));return}if(P.pk&&!E.rowMeta.new){Zt.info(Ie("msg.info.editingPKnotSupported"));return}if(![ve.SingleSelect,ve.MultiSelect].includes(P.uidt))return Pe.value=!0}}const en=ue(()=>Qe.value&&!G.value&&!he.value),pt=ue(()=>{var E;return(E=N.value)==null?void 0:E.length}),hn=ue(()=>{const E=[];return c.value!==!0?Ue.value||E.push("nc-scrollbar-x-lg !overflow-auto"):E.push("overflow-visible"),ee.value&&E.push("!overflow-hidden"),E.join(" ")}),on=ue(()=>{var P;let E=((P=N.value)==null?void 0:P.length)??40;return E=E||40,Array.from({length:E+1}).map(()=>({}))}),so=ue(()=>Array.from({length:40}).map(()=>({}))),Cn=ue(()=>v.value!==!0&&(ee.value||H.value||st.value)||!A.value),gn=ue(()=>s.value.map(E=>N.value.map(P=>({isColumnRequiredAndNull:Ts(P,E.row)})))),xn=ue(()=>N.value.map(E=>({isVirtualCol:_o(E),isReadonly:$s(E)})));function Vt(E){ci("smooth"),setTimeout(()=>{Ye.value=!0,Le.value=E},500)}const ln=(E=!1)=>{xe.value=null,Ye.value=!1,Le.value={},E&&setTimeout(()=>{ci("smooth")},200)};async function an(E){if(E&&E!==(x==null?void 0:x.key))return;const P=ll(s.value.length,!0);P&&(k==null||k(P,void 0,!0,E))}const Fn=()=>{W.trigger(x==null?void 0:x.key)},Yn=()=>{tt()||(je(!0),ll())},ao=()=>{tt()||(je(!1),Fn())},eo=(E,P,Te)=>{var co,mo;const At=P.getBoundingClientRect(),Sn=15,Vn=((co=P.querySelector("thead th:nth-child(1)"))==null?void 0:co.getBoundingClientRect().width)??0,Wo=((mo=P.querySelector("thead th:nth-child(2)"))==null?void 0:mo.getBoundingClientRect().width)??0,$n=Vn+Wo,Ln={right:E.right+Vn-At.width-P.scrollLeft,left:E.left+Vn-P.scrollLeft-$n,bottom:E.bottom-At.height-P.scrollTop,top:E.top-P.scrollTop},Oo={top:0,left:0};return Oo.left=Ln.right+(Te==null?void 0:Te.right)>0?P.scrollLeft+Ln.right+(Te==null?void 0:Te.right)+Sn:Ln.left-((Te==null?void 0:Te.left)||0)<0?P.scrollLeft+Ln.left-((Te==null?void 0:Te.left)||0)-Sn:P.scrollLeft,Oo.top=Ln.bottom+((Te==null?void 0:Te.bottom)||0)>0?P.scrollTop+Ln.bottom+((Te==null?void 0:Te.bottom)||0)+Sn:Ln.top-(Te==null?void 0:Te.top)<0?P.scrollTop+Ln.top-(Te==null?void 0:Te.top)-Sn:P.scrollTop,Oo},{selectRangeMap:Ro,fillRangeMap:Mo,activeCell:Ve,handleMouseDown:Eo,handleMouseOver:qn,handleCellClick:to,clearSelectedRange:no,copyValue:Qo,isCellActive:dl,resetSelectedRange:ri,makeActive:Ma,selectedRange:kn,isFillMode:Ta}=mv(A,N,s,void 0,Pe,ot,Re,tn,Kl,Yt,bo,void 0,async E=>{var Sn,Vn,Wo,$n,Ln,Oo,co,mo,Ql,Nl,Pl;if(document.querySelector(".nc-dropdown-single-select-cell.active,.nc-dropdown-multi-select-cell.active"))return E.preventDefault(),!0;if(Wl())return;if(ra()||ji())return!0;const Te=Va()?E.metaKey:E.ctrlKey,At=E.altKey;if(E.key===" "&&!E.shiftKey){const nl=Wl();if(!Pe.value&&dl.value&&Ve.row!==null&&!nl){E.preventDefault();const _l=s.value[Ve.row];return _l&&(k==null||k(_l)),!0}}else if(E.key==="Escape"){if(Pe.value)return Pe.value=!1,!0}else if(E.key==="Enter"){if(E.shiftKey)return!0;if(Pe.value)return Pe.value=!1,!0}else if(E.key==="Tab"){if(E.shiftKey&&Ve.row===0&&Ve.col===0&&!((Sn=r.value)!=null&&Sn.isFirstPage))return E.preventDefault(),await Dl((((Vn=r.value)==null?void 0:Vn.pageSize)??25)-1,((Wo=N.value)==null?void 0:Wo.length)-1,-1),!0;if(!E.shiftKey&&Ve.row===s.value.length-1&&Ve.col===(($n=N.value)==null?void 0:$n.length)-1){if(E.preventDefault(),(Ln=r.value)!=null&&Ln.isLastPage&&en.value)return Xe.value=!0,!0;if(!((Oo=r.value)!=null&&Oo.isLastPage))return await Dl(0,0,1),!0}}else if(!Te&&!E.shiftKey&&E.key==="ArrowUp"){if(Ve.row===0&&!((co=r.value)!=null&&co.isFirstPage))return E.preventDefault(),await Dl((((mo=r.value)==null?void 0:mo.pageSize)??25)-1,Ve.col,-1),!0}else if(!Te&&!E.shiftKey&&E.key==="ArrowDown"&&Ve.row===s.value.length-1){if(E.preventDefault(),(Ql=r.value)!=null&&Ql.isLastPage&&en.value)return Xe.value=!0,!0;if(!((Nl=r.value)!=null&&Nl.isLastPage))return await Dl(0,Ve.col,1),!0}if(Te){if(!dl.value||E.shiftKey)return;switch(E.key){case"ArrowUp":return E.preventDefault(),no(),Ve.row=0,Ve.col=Ve.col??0,bo==null||bo(),Pe.value=!1,!0;case"ArrowDown":return E.preventDefault(),no(),Ve.row=s.value.length-1,Ve.col=Ve.col??0,bo==null||bo(),Pe.value=!1,!0;case"ArrowRight":return E.preventDefault(),no(),Ve.row=Ve.row??0,Ve.col=((Pl=N.value)==null?void 0:Pl.length)-1,bo==null||bo(),Pe.value=!1,!0;case"ArrowLeft":return E.preventDefault(),no(),Ve.row=Ve.row??0,Ve.col=0,bo==null||bo(),Pe.value=!1,!0}}if(At)switch(E.keyCode){case 82:{en.value&&(Ce("c:shortcut",{key:"ALT + R"}),ll(),Ve.row=s.value.length-1,Ve.col=0,ri(),el(()=>{var nl;(nl=document.querySelector("td.cell.active"))==null||nl.scrollIntoView({behavior:"smooth"})}));break}case 67:{d.value&&(Ce("c:shortcut",{key:"ALT + C"}),ci(void 0),setTimeout(()=>{Ye.value=!0},250));break}}},async E=>{var At;const P=s.value[E.row],Te=E.col!==void 0?N.value[E.col]:null;if(!(!P||!Te)){if(!E.updatedColumnTitle&&_o(Te)){Te.fk_model_id===((At=Te.colOptions)==null?void 0:At.fk_related_model_id)&&(me==null||me.trigger({shouldShowLoading:!1}));return}s.value[E.row].rowMeta.isUpdatedFromCopyNPaste={...s.value[E.row].rowMeta.isUpdatedFromCopyNPaste,[E.updatedColumnTitle||Te.title]:!0},await(b==null?void 0:b(P,E.updatedColumnTitle||Te.title))}},M,void 0,nt,j,r,m,void 0,void 0,void 0,!1);function Ka(E){no(),Ma(E??s.value.length-1,0),kn.startRange({row:Ve.row,col:Ve.col}),bo==null||bo()}async function Oi(E){await(b==null?void 0:b(E))}function ll(E,P=!1){if(tt({focusBtn:null}))return;const Te=C==null?void 0:C(E);return!P&&Te&&Oi(Te),el().then(()=>{Ka(E??s.value.length-1)}),Te}const ca=E=>{try{S==null||S(E),kn.isRowInRange(E)&&no(),Ve.row===E&&(Ve.row=null,Ve.col=null)}catch(P){Zt.error(P.message)}},$a=E=>{try{_e.value=!0;const P=s.value[E];k&&k(P),Ve.row=null,Ve.col=null,kn.clear()}catch(P){Zt.error(P.message)}},Ja=()=>{F==null||F(kn).then(()=>{no(),Ve.row=null,Ve.col=null})},Xl=ue(()=>{var E;if(kn.start.col===kn.end.col){const P=N.value[kn.start.col];return{enabled:ba(P)||is(P),disabled:!((E=P==null?void 0:P.colOptions)!=null&&E.fk_integration_id)}}return{enabled:!1,disabled:!1}}),Oa=async()=>{var Vn,Wo;if(!Xl.value.enabled||!((Vn=A==null?void 0:A.value)!=null&&Vn.id)||!A.value.columns)return;const E=N.value[kn.start.col];if(!E.id)return;const P=s.value.slice(kn.start.row,kn.end.row+1);if(!P||P.length===0)return;let Te=[E.id];is(E)&&(Te=Ii((Wo=E.colOptions)==null?void 0:Wo.output_column_ids)&&E.colOptions.output_column_ids.split(",").length>0?E.colOptions.output_column_ids.split(","):[]);const At=P.map($n=>Ht($n.row,A.value.columns)).filter($n=>$n!==null);He.value.push(...At),Ze.value.push(E.id),Ke.value.push(...Te);const Sn=await Ne(A.value.id,E.id,At);if(Sn)for(const $n of Sn){const Ln=s.value.find(Oo=>Ht(Oo.row,A.value.columns)===Ht($n,A.value.columns));Ln&&(Ln.row={...Ln.row,...$n})}He.value=He.value.filter($n=>!At.includes($n)),Ze.value=Ze.value.filter($n=>$n!==E.id),Ke.value=Ke.value.filter($n=>!(Te!=null&&Te.includes($n)))},Qa=E=>{if(lt.value){lt.value=!1;return}const P=N.value.findIndex(Te=>Te.id===E);P!==-1&&(Ma(0,P),kn.startRange({row:0,col:P}),kn.endRange({row:s.value.length-1,col:P}))};Xs(ct,E=>{if(Se.value||lt.value||Re.value||Ve.row===null||Ve.col===null||Wl())return;const Te=N.value[Ve.col];if(Pe.value&&(_o(Te)||Te.uidt===ve.JSON)||Ta.value)return;const At=document.querySelector(".nc-picker-datetime.active,.nc-dropdown-single-select-cell.active,.nc-dropdown-multi-select-cell.active,.nc-dropdown-user-select-cell.active,.nc-picker-date.active,.nc-picker-year.active,.nc-picker-time.active,.nc-link-dropdown-root");E.target&&At&&(At===E.target||At!=null&&At.contains(E.target))||ra()||(no(),Ve.row=null,Ve.col=null)});const ut=E=>{if(!(Ve.row===null||Ve.col===null)){switch(Pe.value=!1,no(),E){case Gl.NEXT:Ve.row<s.value.length-1||ll(),Ve.row++;break;case Gl.PREV:Ve.row>0&&Ve.row--;break}el(()=>{bo()})}};async function Kl(){if(!Qe.value||yt.value)return;const E=kn.start,P=kn.end,Te=Math.min(E.row,P.row),At=Math.max(E.row,P.row),Sn=Math.min(E.col,P.col),Vn=Math.max(E.col,P.col),Wo=N.value.slice(Sn,Vn+1),$n=s.value.slice(Te,At+1),Ln=[];let Oo=!1;for(const co of $n)for(const mo of Wo)if(!(!co||!mo||!mo.title)){if(_o(mo)){(Jo(mo)||Cl(mo)||Ho(mo))&&!Oo&&(Zt.info(Ie("msg.info.groupClearIsNotSupportedOnLinksColumn")),Oo=!0);continue}$s(mo)||mo.readonly||(co.row[mo.title]=null,Ln.push(mo.title))}await(M==null?void 0:M($n,Ln))}const No=ue(()=>N.value.filter(E=>E.id&&ze.value[E.id]&&ze.value[E.id].width&&ze.value[E.id].show).map(E=>+ze.value[E.id].width.replace("px","")||180).reduce((E,P,Te)=>(E.push(E[Te]+P),E),[0])),So=ue(()=>Ue.value||Dt.value),Po=V();function bo(E,P,Te="instant"){if(E=E??Ve.row,P=P??Ve.col,E!==null&&P!==null&&So.value){const At={top:E*xt.value,left:No.value[P],right:P===N.value.length-1?No.value[No.value.length-1]+180:No.value[P+1],bottom:(E+1)*xt.value},Sn=eo(At,So.value,{top:9,bottom:(rt.value||40)+9,right:9});if(ye.value&&(Sn.top=So.value.scrollTop),P===0&&(Sn.left=0),E===s.value.length-1){requestAnimationFrame(()=>{So.value.scrollTo({top:ye.value?So.value.scrollTop:So.value.scrollHeight,left:P===N.value.length-1?So.value.scrollWidth:Sn.left,behavior:"instant"})});return}if(P===N.value.length-1){requestAnimationFrame(()=>{So.value.scrollTo({top:Sn.top,left:So.value.scrollWidth,behavior:"instant"})});return}requestAnimationFrame(()=>{So.value.scrollTo({top:Sn.top,left:Sn.left,behavior:"instant"})})}}async function Dl(E,P,Te){var At;no(),Te!==void 0&&((At=r.value)!=null&&At.page)?(await(m==null?void 0:m(r.value.page+Te)),await el(),Ma(E,P)):(Ma(E,P),await el()),bo==null||bo()}const Xo=V([]),Da=async(E={})=>{var P;for(const Te of E.data||s.value)if(!Te.rowMeta.fromExpandedForm){if(Te.rowMeta.new){const At=Me(Te);await(b==null?void 0:b(Te,"",Te.rowMeta.ltarState||{},E))?Te.rowMeta.changed=!1:E.keepNewRecords&&At.rowMeta.new&&Object.keys(At.row).length&&Xo.value.push(At);continue}if(Te.rowMeta.changed){Te.rowMeta.changed=!1;for(const At of((P=E.metaValue||A.value)==null?void 0:P.columns)??[])_o(At)||At.uidt===ve.Attachment||At.title in Te.row&&Te.row[At.title]!==Te.oldRow[At.title]&&await(b==null?void 0:b(Te,At.title,{},E))}}},rn={[ve.Attachment]:{minWidth:80,maxWidth:Number.POSITIVE_INFINITY},[ve.Button]:{minWidth:100,maxWidth:320}},yl=(E,P)=>{if(E.uidt in rn){const{minWidth:Te,maxWidth:At}=rn[E.uidt];if(Te<P&&P<At)return P;if(P<Te)return Te;if(P>At)return At}return P},An=(E,P)=>{if(!E||!Ii(P==null?void 0:P.detail))return;const Te=P.detail.split("px")[0];Ge(E,{width:`${yl(Z.value[E],Te)}px`})},We=(E,P)=>{if(!E||!Ii(P==null?void 0:P.detail))return;const Te=P.detail.split("px")[0];ze.value[E].width=`${yl(Z.value[E],Te)}px`,Zo()},jt=(E,P)=>{E&&(Et.value=P.detail,lt.value=!0)},St=(E,P,Te)=>{Le.value={title:E,uidt:P,...Te},ht.value=!1},kt=V(),sn=()=>{var E;Ye.value=!0,(E=kt.value)!=null&&E.shouldKeepModalOpen()||(Ye.value=!1,ht.value=qe.value)},bn=ue(()=>No.value[No.value.length-1]+64),Rn=ue(()=>s.value.length*xt.value),Tt=V({start:0,end:0}),_n=V({start:0,end:0}),Zn=()=>{if(!So.value||!Dt.value){Tt.value={start:0,end:0},_n.value={start:0,end:0},setTimeout(Zn,100);return}let E=0;if(p.value!==!0){let P=0,Te=No.value.length-1;for(;Te!==P;){const Vn=Math.floor((Te-P)/2+P);if(No.value[Vn]<=So.value.scrollLeft&&No.value[Vn+1]>So.value.scrollLeft){E=Vn;break}if(Vn===P){E=Te;break}else No.value[Vn]<=So.value.scrollLeft?P=Vn:Te=Vn}let At=0,Sn=!1;for(let Vn=E;Vn<No.value.length;Vn++)if(No.value[Vn]>Dt.value.clientWidth+So.value.scrollLeft){At=Vn,Sn=!0;break}Tt.value={start:Math.max(0,E-bs),end:Sn?Math.min(N.value.length,At+bs):N.value.length}}if(g.value!==!0){const P=Math.max(0,Math.floor(So.value.scrollTop/xt.value)-bs),Te=Math.min(s.value.length,P+Math.ceil(Dt.value.clientHeight/xt.value)+bs);_n.value={start:P,end:Te}}},Ko=ue(()=>p.value?N.value.map((P,Te)=>({field:P,index:Te})).filter(P=>P.index!==0):N.value.slice(Tt.value.start,Tt.value.end).map((P,Te)=>({field:P,index:Te+Tt.value.start})).filter(P=>P.index!==0)),Un=ue(()=>{const E={length:0,width:0};return p.value||(E.length=Tt.value.start>0?Tt.value.start-1:0,E.width=E.length?No.value[Tt.value.start]-No.value[1]:0),E}),ho=ue(()=>{const E={length:0,width:0};return p.value||(E.length=Tt.value.end<N.value.length-1?N.value.length-Tt.value.end:0,E.width=E.length?No.value[N.value.length]-No.value[Tt.value.end]:0),E}),Vl=ue(()=>2+Ko.value.length+Un.value.length+ho.value.length),Ao=ue(()=>g.value?s.value.map((E,P)=>({row:E,index:P})):s.value.slice(_n.value.start,_n.value.end).map((E,P)=>({row:E,index:P+_n.value.start}))),bl=ue(()=>{var E;return!Dt.value||_n.value.start<=1?0:parseInt(`${((E=Dt.value)==null?void 0:E.clientHeight)/xt.value}`)}),al=ue(()=>{const E={length:_n.value.start>1?Math.min(_n.value.start-1,bl.value):0,rowHeight:xt.value,totalRowHeight:0};return E.totalRowHeight=E.length*E.rowHeight,E}),io=ue(()=>{var P,Te;const E={length:_n.value.end<(((P=r.value)==null?void 0:P.pageSize)??25)-1?Math.min((((Te=r.value)==null?void 0:Te.pageSize)??25)-1-_n.value.end,bl.value):0,rowHeight:xt.value,totalRowHeight:0};return E.totalRowHeight=E.length*E.rowHeight,E}),Al=ue(()=>xt.value*(_n.value.start-al.value.length)),fa=V(),La=V();function Zo(){el(()=>{const E=isNaN(kn.end.row)?Ve.row:kn.end.row,P=isNaN(kn.end.col)?Ve.col:kn.end.col;if(E!==null&&P!==null){if(!So.value||!Dt.value)return;fa.value=(E+1)*xt.value+(f.value?0:32),La.value=64+No.value[P+1]+(P===0?Math.max(0,So.value.scrollLeft-Dt.value.offsetLeft):0)}})}const oo=ue(()=>kn.isEmpty()&&Ve.col&&xn.value[Ve.col].isReadonly||!kn.isEmpty()&&Array.from({length:kn.end.col-kn.start.col+1}).every((E,P)=>xn.value[kn.start.col+P].isReadonly)),Ll=ue(()=>{var E,P;return!yt.value&&!Y.value&&!Pe.value&&(!kn.isEmpty()||Ve.row!==null&&Ve.col!==null)&&!((P=(E=s.value[(isNaN(kn.end.row)?Ve.row:kn.end.row)??-1])==null?void 0:E.rowMeta)!=null&&P.new)&&Ve.col!==null&&N.value[Ve.col]&&!ee.value&&!H.value&&s.value.length&&!oo.value&&!G.value});Gn([()=>kn.end.row,()=>kn.end.col,()=>Ve.row,()=>Ve.col],([E,P,Te,At],[Sn,Vn,Wo,$n])=>{(E!==Sn||P!==Vn||Te!==Wo||At!==$n)&&(Zn(),Zo())}),oi(()=>{const E=new ResizeObserver(()=>{var P;Zo(),Ve.row!==null&&!((P=s.value)!=null&&P[Ve.row])&&(no(),Ve.row=null,Ve.col=null)});mt.value&&E.observe(mt.value),ka(So).toBeTruthy().then(()=>Zn())}),pe.on(async(E,P)=>{E===qo.FIELD_ADD&&(xe.value=P,Ye.value=!0),E===qo.CLEAR_NEW_ROW&&(no(),Ve.row=null,Ve.col=null,I==null||I(P))}),Gn(Ve,E=>{var Wo,$n,Ln;const P=E.row!==null?(Wo=s.value[E.row])==null?void 0:Wo.row:void 0,Te=P&&E.col!==null?N.value[E.col]:void 0,At=P&&Te?P[Te.title]:void 0,Sn=Ht(P,($n=A.value)==null?void 0:$n.columns),Vn=(Ln=j.value)==null?void 0:Ln.id;pe.emit(qo.CELL_SELECTED,{rowId:Sn,colId:Te==null?void 0:Te.id,val:At,viewId:Vn})});async function si(E){var P,Te,At;if(E!=null&&E.shouldShowLoading&&(ee.value=!0),(P=It.value)!=null&&P.length){const Sn=(At=(Te=A.value)==null?void 0:Te.columns)==null?void 0:At.map(Vn=>Vn.title);It.value=It.value.filter(Vn=>!(Sn!=null&&Sn.includes(Vn.title)))}await Da({keepNewRecords:!0}),await(w==null?void 0:w({...(E==null?void 0:E.offset)!==void 0?{offset:E.offset}:{}},E==null?void 0:E.shouldShowLoading)),Xo.value.length&&(s.value.push(...Xo.value),Xo.value=[]),Zn(),ee.value=!1}let Jl=null;Tl(So,"scroll",E=>{Po.value=E.target.scrollLeft,Jl&&cancelAnimationFrame(Jl),Jl=requestAnimationFrame(()=>{Zn(),Zo()})}),Tl(document,"mousedown",E=>{var P,Te;(E.offsetX>((P=E.target)==null?void 0:P.clientWidth)||E.offsetY>((Te=E.target)==null?void 0:Te.clientHeight))&&(Se.value=!0),E.target.closest(".nc-grid-cell:not(.caption)")&&(gt.value=!0)}),Tl(document,"mouseup",()=>{gt.value=!1,setTimeout(()=>{Se.value=!1},100)}),Tl(document,"keydown",async E=>{const P=Wl();E.key==="Alt"&&!P&&(qe.value=!0)}),Tl(document,"keyup",async E=>{var Sn,Vn;const P=Wl();E.key==="Alt"&&!P&&(qe.value=!1,zt.value=!1);const Te=document.querySelector(".nc-dropdown-single-select-cell.active,.nc-dropdown-multi-select-cell.active"),At=Va()?E.metaKey:E.ctrlKey;Xe.value&&!P&&!Te&&!ra()&&!At&&!E.shiftKey&&!E.altKey&&(E.key==="Tab"&&Ve.row===s.value.length-1&&Ve.col===((Sn=N.value)==null?void 0:Sn.length)-1||E.key==="ArrowDown"&&Ve.row===s.value.length-1&&((Vn=r.value)!=null&&Vn.isLastPage)&&en.value)&&(ll(),await Dl(s.value.length-1,0),Xe.value=!1)}),Tl(document,"keydown",async E=>{const P=Va()?E.metaKey:E.ctrlKey;if(E.altKey&&!E.shiftKey&&!P)switch(E.keyCode){case 78:{en.value&&ll();break}}}),Ga(async()=>{const E=j.value,P=s.value;E&&Q(E.fk_model_id,!1,!0).then(Te=>{const At=Te;At&&Da({metaValue:At,viewMetaValue:E,data:P})}),me==null||me.off(si),W==null||W.off(an)}),me==null||me.on(si),W==null||W.on(an),Gn(Re,()=>{Re.value?X.value=!1:(X.value=!0,Fe.value=null)}),Gn(()=>re.params.viewId,()=>{ee.value=!0}),Gn(j,async(E,P)=>{try{if(E&&E.id!==(P==null?void 0:P.id)&&(E.fk_model_id===re.params.viewId||he.value)){if(Mt.value=!0,P!=null&&P.id){const Te=await Q(P.fk_model_id,!1,!0);Te&&await Da({viewMetaValue:P,metaValue:Te,data:s.value})}ee.value=!0;try{ye.value?await(w==null?void 0:w()):await Promise.allSettled([w==null?void 0:w(),Bn()]),Zn()}catch(Te){Zu.isCancel(Te)||(console.log(Te),Zt.error(Ie("msg.errorLoadingData")))}finally{ee.value=!1}}}catch(Te){console.log(Te)}finally{Mt.value=!1}},{immediate:!0}),Gn([()=>N.value.length,()=>s.value.length],()=>{Zn()}),wo(Bf,zt),n({scrollToRow:Ka,openColumnCreate:Vt});const ui=(E,P)=>{k&&k(E,P),Ve.row=null,Ve.col=null,kn.clear()},di=(E,P,Te)=>{const At=s.value[P];if(U.value)return ui(At,N.value[Te]);to(E,P,Te)},Xi=ue(()=>{var E,P,Te,At;if(H.value)return(E=r.value)!=null&&E.totalRows&&((P=r.value)!=null&&P.pageSize)?`Loading page<br/>${r.value.page} of ${Math.ceil(((Te=r.value)==null?void 0:Te.totalRows)/((At=r.value)==null?void 0:At.pageSize))}`:Ie("general.loading")});function ci(E){var P;So.value&&((P=So.value)==null||P.scrollTo({top:So.value.scrollTop,left:So.value.scrollWidth,behavior:E}))}const fi=E=>{var Te;const P=ne(E);if(P){const At=(Te=be[P])==null?void 0:Te.cellBgClass;if(At)return{[At]:!0}}return{}},vi=E=>{var Te;const P=ne(E,!0);if(P){const At=(Te=be[P])==null?void 0:Te.headerBgClass;if(At)return{[At]:!0}}return{}};return Zr("ArrowLeft",te),Zr("ArrowRight",we),Zr("ArrowUp",oe),Zr("ArrowDown",Ee),(E,P)=>{var Wn,zn,En,In,R,$;const Te=Ys,At=sv,Sn=Df,Vn=U1,Wo=G1,$n=Sl,Ln=V1,Oo=B1,co=Ya,mo=L1,Ql=Cm,Nl=$1,Pl=qa,nl=H1,_l=Lf,va=Y1,Zl=Nf,cl=q1,Na=X1,xl=pv,fe=K1,ke=Aa,Oe=_r,Ft=ud,dt=Hi,Ct=da,Xt=yp,Jt=J1,Bt=Q1,Lt=Yl("xc-ver-resize"),fn=Yl("e");return h(),B("div",{class:Gt(["flex flex-col",`${e(c)!==!0?"h-full w-full":""}`])},[P[51]||(P[51]=z("div",{"data-testid":"drag-icon-placeholder",class:"absolute w-1 h-1 pointer-events-none opacity-0"},null,-1)),z("div",{ref_key:"dragColPlaceholderDomRef",ref:q,class:Gt([{"hidden w-0 !h-0 left-0 !max-h-0 !max-w-0":!e(se)},"absolute flex items-center z-40 top-0 h-full bg-gray-50 pointer-events-none opacity-60"])},[e(se)?(h(),B("div",{key:0,style:Xn({"min-width":((Wn=e(ze)[e(se).id])==null?void 0:Wn.width)||"180px","max-width":((zn=e(ze)[e(se).id])==null?void 0:zn.width)||"180px",width:((En=e(ze)[e(se).id])==null?void 0:En.width)||"180px"}),class:"border-r-1 border-l-1 border-gray-200 h-full"},null,4)):ge("",!0)],2),z("div",{ref_key:"gridWrapper",ref:Dt,class:Gt(["nc-grid-wrapper min-h-0 flex-1 relative",e(hn)])},[Nt(z("div",Z1,[z("div",e_,[le(Te,{size:"xlarge"}),z("span",{class:"text-center",innerHTML:e(Xi)},null,8,t_)])],512),[[ya,e(H)&&!e(c)]]),le(dt,{visible:e(Re),"onUpdate:visible":P[35]||(P[35]=de=>yo(Re)?Re.value=de:null),trigger:e(G)?[]:["contextmenu"],"overlay-class-name":"nc-dropdown-grid-context-menu"},{overlay:K(()=>[le(Pl,{class:"!rounded !py-0",variant:"small",onClick:P[34]||(P[34]=de=>Re.value=!1)},{default:K(()=>{var de;return[("isEeUI"in E?E.isEeUI:e(Wi))&&!e(X)&&!e(Fe)&&E.data.some(De=>De.rowMeta.selected)&&!e(yt)?(h(),J(co,{key:0,onClick:P[28]||(P[28]=De=>a("bulkUpdateDlg"))},{default:K(()=>[Nt((h(),B("div",P_,[(h(),J($o(("iconMap"in E?E.iconMap:e(sl)).ncEdit))),Je(" "+ce(E.$t("title.updateSelectedRows")),1)])),[[fn,["a:row:update-bulk"]]])]),_:1})):ge("",!0),!e(X)&&!e(Fe)&&E.data.some(De=>De.rowMeta.selected)&&!e(yt)?(h(),J(co,{key:1,class:"nc-base-menu-item",danger:"","data-testid":"nc-delete-row",onClick:e(D)},{default:K(()=>[E.data.filter(De=>De.rowMeta.selected).length===1?Nt((h(),B("div",B_,[le($n,{icon:"delete"}),Je(" "+ce(E.$t("activity.deleteSelectedRow")),1)])),[[fn,["a:row:delete"]]]):Nt((h(),B("div",W_,[le($n,{icon:"delete"}),Je(" "+ce(E.$t("activity.deleteSelectedRow")),1)])),[[fn,["a:row:delete-bulk"]]])]),_:1},8,["onClick"])):ge("",!0),e(Fe)&&e(Qe)&&!e(yt)&&e(Xl).enabled?(h(),J(ke,{key:2,disabled:!e(Xl).disabled},{title:K(()=>[Je(ce(e(ft).length?E.$t("tooltip.aiIntegrationReConfigure"):E.$t("tooltip.aiIntegrationAddAndReConfigure")),1)]),default:K(()=>[le(co,{class:"nc-base-menu-item","data-testid":"context-menu-item-bulk",disabled:e(Xl).disabled,onClick:Oa},{default:K(()=>[z("div",z_,[le($n,{icon:"ncAutoAwesome",class:"h-4 w-4"}),Je(" Generate "+ce(e(kn).isSingleCell()?"Cell":"All"),1)])]),_:1},8,["disabled"])]),_:1},8,["disabled"])):ge("",!0),e(Fe)?(h(),J(co,{key:3,class:"nc-base-menu-item","data-testid":"context-menu-item-copy",onClick:P[29]||(P[29]=De=>e(Qo)(e(Fe)))},{default:K(()=>[Nt((h(),B("div",V_,[le($n,{icon:"copy"}),Je(" "+ce(E.$t("general.copy"))+" "+ce(E.$t("objects.cell").toLowerCase()),1)])),[[fn,["a:row:copy"]]])]),_:1})):ge("",!0),e(Fe)&&e(Qe)&&!e(yt)?(h(),J(co,{key:4,class:"nc-base-menu-item","data-testid":"context-menu-item-paste",disabled:e(oo)&&(!e(kn).isSingleCell()||!("isMm"in E?E.isMm:e(Ho))(e(N)[e(Fe).col])&&!("isBt"in E?E.isBt:e(Jo))(e(N)[e(Fe).col])),onClick:e(Kt)},{default:K(()=>[Nt((h(),B("div",j_,[le($n,{icon:"paste"}),Je(" "+ce(E.$t("general.paste"))+" "+ce(E.$t("objects.cell").toLowerCase()),1)])),[[fn,["a:row:paste"]]])]),_:1},8,["disabled","onClick"])):ge("",!0),e(Fe)&&e(Qe)&&e(kn).isSingleCell()&&(e(ml)(e(N)[e(Fe).col])||!((de=e(gn)[0])!=null&&de[e(Fe).col].isVirtualCol))&&!e(yt)?(h(),J(co,{key:5,class:"nc-base-menu-item",disabled:e(oo)&&!e(ml)(e(N)[e(Fe).col]),"data-testid":"context-menu-item-clear",onClick:P[30]||(P[30]=De=>tn(e(Fe)))},{default:K(()=>[Nt((h(),B("div",U_,[le($n,{icon:"close"}),Je(" "+ce(E.$t("general.clear"))+" "+ce(E.$t("objects.cell").toLowerCase()),1)])),[[fn,["a:row:clear"]]])]),_:1},8,["disabled"])):e(Fe)&&e(Qe)&&!e(yt)?(h(),J(co,{key:6,class:"nc-base-menu-item",disabled:e(oo),"data-testid":"context-menu-item-clear",onClick:P[31]||(P[31]=De=>Kl())},{default:K(()=>[Nt((h(),B("div",G_,[le($n,{icon:"closeBox",class:"text-gray-500"}),Je(" "+ce(E.$t("general.clear"))+" "+ce(E.$t("objects.cell").toLowerCase()),1)])),[[fn,["a:row:clear-range"]]])]),_:1},8,["disabled"])):ge("",!0),e(Fe)&&e(kn).isSingleCell()&&e(Ot)("commentEdit")&&!e(U)?(h(),B(Qt,{key:7},[le(Oe),le(co,{class:"nc-base-menu-item",onClick:P[32]||(P[32]=De=>$a(e(Fe).row))},{default:K(()=>[Nt((h(),B("div",H_,[le(Ft,{class:"h-4 w-4"}),Je(" "+ce(E.$t("general.add"))+" "+ce(E.$t("general.comment").toLowerCase()),1)])),[[fn,["a:row:comment"]]])]),_:1})],64)):ge("",!0),e(Qe)&&!e(yt)?(h(),B(Qt,{key:8},[!e(X)&&!e(Fe)&&E.data.some(De=>De.rowMeta.selected)?ge("",!0):(h(),J(Oe,{key:0})),e(Fe)&&(e(kn).isSingleCell()||e(kn).isSingleRow())?(h(),J(co,{key:1,class:"nc-base-menu-item",danger:"",onClick:P[33]||(P[33]=De=>ca(e(Fe).row))},{default:K(()=>[Nt((h(),B("div",Y_,[le($n,{icon:"delete"}),Je(" "+ce(E.$t("activity.deleteRow")),1)])),[[fn,["a:row:delete"]]])]),_:1})):e(Fe)&&e(F)?(h(),J(co,{key:2,class:"nc-base-menu-item",danger:"",onClick:Ja},{default:K(()=>[Nt((h(),B("div",q_,[le($n,{icon:"delete"}),Je(" "+ce(E.$t("activity.deleteRows")),1)])),[[fn,["a:row:delete"]]])]),_:1})):ge("",!0)],64)):ge("",!0)]}),_:1})]),default:K(()=>{var de,De,Wt,qt,vn,wn,Mn,fo;return[z("div",null,[z("table",{class:Gt(["xc-row-table nc-grid backgroundColorDefault !h-auto bg-white sticky top-0 z-5 bg-white",{mobile:e(U),desktop:!e(U)}])},[Nt(z("thead",{ref_key:"tableHeadEl",ref:Rt},[e(st)?(h(),B("tr",n_,[(h(!0),B(Qt,null,po(e(on),(at,Ut)=>(h(),B("td",{key:Ut,class:Gt(["!bg-gray-50 h-full border-b-1 border-r-1",{"min-w-45":Ut!==0,"min-w-16":Ut===0}])},[le(At,{active:!0,title:!0,paragraph:!1,class:Gt(["ml-2 -mt-2",{"max-w-32":Ut!==0,"max-w-5 !ml-3.5":Ut===0}])},null,8,["class"])],2))),128))])):ge("",!0),Nt(z("tr",o_,[z("th",l_,[z("div",a_,[!e(Y)&&!E.hideCheckbox?(h(),B(Qt,{key:0},[z("div",{class:Gt(["nc-no-label text-gray-500",{hidden:e(i)}])},"#",2),z("div",{class:Gt([{hidden:!e(i),flex:e(i)},"nc-check-all w-full items-center"])},[le(Sn,{checked:e(i),"onUpdate:checked":P[0]||(P[0]=at=>yo(i)?i.value=at:null)},null,8,["checked"]),P[43]||(P[43]=z("span",{class:"flex-1"},null,-1))],2)],64)):(h(),B("div",i_,"#"))])]),(De=(de=e(N))==null?void 0:de[0])!=null&&De.id?Nt((h(),B("th",{key:0,"data-col":e(N)[0].id,"data-title":e(N)[0].title,style:Xn({"min-width":((Wt=e(ze)[e(N)[0].id])==null?void 0:Wt.width)||"180px","max-width":((qt=e(ze)[e(N)[0].id])==null?void 0:qt.width)||"180px",width:((vn=e(ze)[e(N)[0].id])==null?void 0:vn.width)||"180px"}),class:Gt(["nc-grid-column-header",{"!border-r-blue-400 !border-r-3":e(L)===e(N)[0].id,"no-resize":e(ae),...vi((Mn=(wn=e(N))==null?void 0:wn[0])==null?void 0:Mn.id)}]),onXcstartresizing:P[4]||(P[4]=at=>jt(e(N)[0].id,at)),onXcresize:P[5]||(P[5]=at=>An(e(N)[0].id,at)),onXcresizing:P[6]||(P[6]=at=>We(e(N)[0].id,at)),onClick:P[7]||(P[7]=at=>Qa(e(N)[0].id))},[z("div",{class:"w-full h-full flex items-center text-gray-500 pl-2 pr-1",draggable:"false",onDragstart:P[1]||(P[1]=ro(at=>e(O)(e(N)[0].id,at),["stop"])),onDrag:P[2]||(P[2]=ro(at=>e(_)(at),["stop"])),onDragend:P[3]||(P[3]=ro(at=>e(T)(at),["stop"]))},[e(N)[0]&&e(xn)[0].isVirtualCol?(h(),J(Vn,{key:0,column:e(N)[0],"hide-menu":e(Y)||!!e(U)},null,8,["column","hide-menu"])):(h(),J(Wo,{key:1,column:e(N)[0],"hide-menu":e(Y)||!!e(U)},null,8,["column","hide-menu"]))],32)],46,r_)),[[Lt]]):ge("",!0),e(Un).length?(h(),B("th",{key:1,colspan:e(Un).length,style:Xn({minWidth:`${e(Un).width}px`,maxWidth:`${e(Un).width}px`,width:`${e(Un).width}px`}),class:"nc-grid-column-header"},null,12,s_)):ge("",!0),(h(!0),B(Qt,null,po(e(Ko),({field:at,index:Ut})=>{var lo,mn,go;return Nt((h(),B("th",{key:at.id,"data-col":at.id,"data-title":at.title,style:Xn({"min-width":((lo=e(ze)[at.id])==null?void 0:lo.width)||"180px","max-width":((mn=e(ze)[at.id])==null?void 0:mn.width)||"180px",width:((go=e(ze)[at.id])==null?void 0:go.width)||"180px"}),class:Gt(["nc-grid-column-header",{"!border-r-blue-400 !border-r-3":e(L)===at.id,"no-resize":e(ae),...vi(at.id)}]),onXcstartresizing:Tn=>jt(at.id,Tn),onXcresize:Tn=>An(at.id,Tn),onXcresizing:Tn=>We(at.id,Tn),onClick:Tn=>Qa(at.id)},[z("div",{class:"w-full h-full flex items-center text-gray-500 pl-2 pr-1",draggable:e(U)||Ut===0||e(Y)||!e(Qe)||e(ae)?"false":"true",onDragstart:ro(Tn=>e(O)(at.id,Tn),["stop"]),onDrag:P[8]||(P[8]=ro(Tn=>e(_)(Tn),["stop"])),onDragend:P[9]||(P[9]=ro(Tn=>e(T)(Tn),["stop"]))},[e(xn)[Ut].isVirtualCol?(h(),J(Vn,{key:0,column:at,"hide-menu":e(Y)||!!e(U)},null,8,["column","hide-menu"])):(h(),J(Wo,{key:1,column:at,"hide-menu":e(Y)||!!e(U)},null,8,["column","hide-menu"]))],40,d_)],46,u_)),[[Lt]])}),128)),e(ho).length?(h(),B("th",{key:2,colspan:e(ho).length,style:Xn({minWidth:`${e(ho).width}px`,maxWidth:`${e(ho).width}px`,width:`${e(ho).width}px`}),class:"nc-grid-column-header"},null,12,c_)):ge("",!0),e(d)?Nt((h(),B("th",{key:3,class:"cursor-pointer !border-0 relative !xs:hidden",style:{borderWidth:"0px !important"},onClick:P[20]||(P[20]=ro(at=>Ye.value=!0,["stop"]))},[z("div",f_,[le(_l,{visible:e(Ye),"onUpdate:visible":P[19]||(P[19]=at=>yo(Ye)?Ye.value=at:null),trigger:["click"],"overlay-class-name":"nc-dropdown-add-column",onVisibleChange:sn},nc({default:K(()=>[z("div",v_,[("isEeUI"in E?E.isEeUI:e(Wi))&&(e(qe)||e(ht))?(h(),J($n,{key:0,icon:"magic",class:"text-sm text-orange-400"})):ge("",!0),(h(),J($o(("iconMap"in E?E.iconMap:e(sl)).plus),{class:"text-base nc-column-add text-gray-500 !group-hover:text-black"}))])]),_:2},[("isEeUI"in E?E.isEeUI:e(Wi))&&e(ht)&&((fo=e(A))!=null&&fo.id)?{name:"overlay",fn:K(()=>[le(Pl,{class:"predict-menu",variant:"small"},{default:K(()=>{var at,Ut;return[(at=e(It))!=null&&at.length?(h(),J(Ql,{key:"predict-column",class:"py-0 px-0 w-full"},{title:K(()=>[z("div",p_,[le(Ln,{class:"flex h-[1rem] text-gray-500"}),z("div",h_,ce(E.$t("activity.predictColumns")),1),le(Oo,{class:"text-gray-500"})])]),expandIcon:K(()=>P[44]||(P[44]=[])),default:K(()=>[(h(!0),B(Qt,null,po(e(It),lo=>(h(),J(co,{key:`predict-${lo.title}-${lo.type}`,class:"w-full flex items-center",onClick:mn=>St(lo.title,lo.type)},{default:K(()=>[z("div",m_,ce(lo.title),1)]),_:2},1032,["onClick"]))),128)),le(co,{class:"flex flex-row items-center",onClick:P[10]||(P[10]=lo=>e(cn)(e(A).id))},{default:K(()=>[z("div",g_,[le(mo),P[45]||(P[45]=Je(" Generate Again "))])]),_:1})]),_:1})):(h(),J(co,{key:1,class:"flex flex-row items-center py-3",onClick:P[11]||(P[11]=lo=>e(cn)(e(A).id))},{default:K(()=>[e(yn)?(h(),J(mo,{key:0,class:"animate-infinite animate-spin"})):(h(),J(Ln,{key:1,class:"flex h-[1rem] text-gray-500"})),z("div",w_,ce(E.$t("activity.predictColumns")),1)]),_:1})),(Ut=e(et))!=null&&Ut.length?(h(),J(Ql,{key:"predict-formula",class:"py-0 px-0 w-full"},{title:K(()=>[z("div",y_,[le(Nl,{class:"flex h-[1rem] text-gray-500"}),z("div",b_,ce(E.$t("activity.predictFormulas")),1),le(Oo,{class:"text-gray-500"})])]),expandIcon:K(()=>P[46]||(P[46]=[])),default:K(()=>[(h(!0),B(Qt,null,po(e(et),lo=>(h(),J(co,{key:`predict-${lo.title}-formula`,class:"flex flex-row items-center",onClick:mn=>St(lo.title,"Formula",{formula_raw:lo.formula})},{default:K(()=>[z("div",__,ce(lo.title),1)]),_:2},1032,["onClick"]))),128)),le(co,{class:"flex flex-row items-center",onClick:P[12]||(P[12]=lo=>e(Pn)(e(A).id))},{default:K(()=>[z("div",x_,[le(mo),P[47]||(P[47]=Je(" Generate Again "))])]),_:1})]),_:1})):(h(),J(co,{key:3,class:"flex flex-row items-center py-3",onClick:P[13]||(P[13]=lo=>e(Pn)(e(A).id))},{default:K(()=>[e($t)?(h(),J(mo,{key:0,class:"animate-infinite animate-spin"})):(h(),J(Nl,{key:1,class:"flex h-[1rem] text-gray-500"})),z("div",k_,ce(E.$t("activity.predictFormulas")),1)]),_:1}))]}),_:1})]),key:"0"}:{name:"overlay",fn:K(()=>[z("div",C_,[e(Ye)?(h(),J(nl,{key:0,ref_key:"editOrAddProviderRef",ref:kt,preload:e(Le),"column-position":e(xe),class:Gt({hidden:e(_t)}),onSubmit:P[14]||(P[14]=at=>ln(!0)),onCancel:P[15]||(P[15]=at=>ln()),onClick:P[16]||(P[16]=ro(()=>{},["stop"])),onKeydown:P[17]||(P[17]=ro(()=>{},["stop"])),onMounted:P[18]||(P[18]=at=>Le.value=void 0)},null,8,["preload","column-position","class"])):ge("",!0)])]),key:"1"}]),1032,["visible"])])])),[[fn,["c:column:add"]]]):ge("",!0),z("th",R_,[z("div",{class:Gt(["absolute top-0 w-45",{"left-[60px]":e(d),"left-0":!e(d)}])},"  ",2)])],512),[[ya,!e(st)]])],512),[[ya,e(f)!==!0]])],2),e(Cn)?ge("",!0):(h(),B("div",{key:0,class:Gt(["table-overlay",{"nc-grid-skeleton-loader":e(Cn)}]),style:Xn({height:`${e(Rn)}px`,width:`${e(bn)}px`})},[z("table",{ref_key:"smartTable",ref:mt,class:Gt(["xc-row-table nc-grid backgroundColorDefault !h-auto bg-white relative",{mobile:e(U),desktop:!e(U),"w-full":e(s).length===0,"pb-12":!e(c)&&!e(ye)}]),style:Xn({transform:`translateY(${e(Al)}px)`}),onContextmenu:bt},[e(c)!==!0?(h(),B("tbody",{key:0,ref_key:"tableBodyEl",ref:ct},[e(Cn)?(h(!0),B(Qt,{key:0},po(e(so),(at,Ut)=>(h(),B("tr",{key:Ut},[(h(!0),B(Qt,null,po(e(on),(lo,mn)=>(h(),B("td",{key:mn,class:Gt(["border-b-1 border-r-1",{"min-w-45":mn!==0,"min-w-16":mn===0}])},null,2))),128))]))),128)):ge("",!0),!e(Cn)&&e(al).length?(h(),J(va,{key:1,"row-count":e(al).length,"row-height":e(al).rowHeight,"total-row-height":e(al).totalRowHeight,"col-count":e(Vl)},null,8,["row-count","row-height","total-row-height","col-count"])):ge("",!0),(h(!0),B(Qt,null,po(e(Ao),({row:at,index:Ut})=>(h(),J(fe,{key:Ut,row:at},{default:K(({state:lo})=>{var mn,go,Tn,Io,ea,pi,zo,Pa,Di,Za,Li,Ki,Ni,Go,Ar,Er,Mr,Tr;return[Nt(z("tr",{class:Gt(["nc-grid-row !xs:h-14",{"active-row":e(Ve).row===Ut||((mn=e(kn)._start)==null?void 0:mn.row)===Ut,"mouse-down":e(gt)||e(Ta),"selected-row":at.rowMeta.selected}]),style:Xn({height:e(xt)?`${e(xt)}px`:`${("rowHeightInPx"in E?E.rowHeightInPx:e(Bo))[1]}px`}),"data-testid":`grid-row-${Ut}`},[z("td",{key:"row-index",class:"caption nc-grid-cell w-[64px] min-w-[64px]","data-testid":`cell-Id-${Ut}`,onContextmenu:P[21]||(P[21]=Hn=>Fe.value=null)},[z("div",F_,[z("div",{class:Gt(["nc-row-no sm:min-w-4 text-gray-500 flex items-center justify-between h-4 w-full",{toggle:!e(Y),hidden:at.rowMeta.selected,"text-[10px]":((((go=e(r))==null?void 0:go.page)??1)-1)*(((Tn=e(r))==null?void 0:Tn.pageSize)??25)+Ut+1>=1e4,"text-xs":((((Io=e(r))==null?void 0:Io.page)??1)-1)*(((ea=e(r))==null?void 0:ea.pageSize)??25)+Ut+1>=1e3,"text-small":((((pi=e(r))==null?void 0:pi.page)??1)-1)*(((zo=e(r))==null?void 0:zo.pageSize)??25)+Ut+1<1e3}])},[z("span",null,ce(((((Pa=e(r))==null?void 0:Pa.page)??1)-1)*(((Di=e(r))==null?void 0:Di.pageSize)??25)+Ut+1),1),P[48]||(P[48]=z("div",{class:"inline-block min-w-[4px] h-full rounded-full"},null,-1))],2),e(Y)?ge("",!0):(h(),B("div",{key:0,class:Gt([{hidden:!at.rowMeta.selected,flex:at.rowMeta.selected},"nc-row-expand-and-checkbox"])},[le(Sn,{checked:at.rowMeta.selected,"onUpdate:checked":Hn=>at.rowMeta.selected=Hn},null,8,["checked","onUpdate:checked"])],2)),P[49]||(P[49]=z("span",{class:"flex-1"},null,-1)),z("div",{class:Gt(["nc-expand flex-1 flex items-center justify-end",{"nc-comment":(Za=at.rowMeta)==null?void 0:Za.commentCount}]),"data-testid":`nc-expand-${Ut}`},[at.rowMeta.saving?(h(),J(Zl,{key:0,class:"!flex items-center","data-testid":`row-save-spinner-${Ut}`},null,8,["data-testid"])):(h(),B(Qt,{key:1},[(Li=at.rowMeta)!=null&&Li.commentCount&&e(k)?Nt((h(),B("span",{key:0,class:Gt(["px-1 rounded-md rounded-bl-none transition-all border-1 border-brand-200 cursor-pointer font-sembold select-none hover:bg-brand-100 !min-h-4.5 !min-w-5 !leading-[18px] inline-block text-brand-500 bg-brand-50",{"text-[10px] font-600 px-0.5":at.rowMeta.commentCount>99,"text-small font-500 px-0.8":at.rowMeta.commentCount<=99}]),onClick:Hn=>ui(at,lo)},[Je(ce(at.rowMeta.commentCount>99?"99+":at.rowMeta.commentCount),1)],10,E_)),[[fn,["c:expanded-form:open"]]]):(h(),B("div",M_,[e(k)?Nt((h(),J($o(("iconMap"in E?E.iconMap:e(sl)).maximize),{key:0,class:"select-none nc-row-expand opacity-90 w-3.5 h-3.5",onClick:Hn=>ui(at,lo)},null,8,["onClick"])),[[fn,["c:row-expand:open"]]]):ge("",!0)]))],64))],10,A_)])],40,I_),e(N)[0]?(h(),J(xl,{key:e(N)[0].id,active:e(Ve).row===Ut&&e(Ve).col===0||((Ki=e(kn)._start)==null?void 0:Ki.row)===Ut&&((Ni=e(kn)._start)==null?void 0:Ni.col)===0,class:Gt(["cell relative nc-grid-cell cursor-pointer",{active:e(Ro)[`${Ut}-0`],"active-cell":e(Ve).row===Ut&&e(Ve).col===0||((Go=e(kn)._start)==null?void 0:Go.row)===Ut&&((Ar=e(kn)._start)==null?void 0:Ar.col)===0,"nc-required-cell":e(gn)[Ut][0].isColumnRequiredAndNull&&!e(he),"align-middle":!E.rowHeightEnum||E.rowHeightEnum===1,"align-top":E.rowHeightEnum&&E.rowHeightEnum!==1,filling:e(Mo)[`${Ut}-0`],readonly:e(xn)[0].isReadonly&&e(Qe)&&e(Ro)[`${Ut}-0`],"!border-r-blue-400 !border-r-3":e(L)===e(N)[0].id,...fi(e(N)[0].id)}]),style:Xn({"min-width":((Er=e(ze)[e(N)[0].id])==null?void 0:Er.width)||"180px","max-width":((Mr=e(ze)[e(N)[0].id])==null?void 0:Mr.width)||"180px",width:((Tr=e(ze)[e(N)[0].id])==null?void 0:Tr.width)||"180px"}),"data-testid":`cell-${e(N)[0].title}-${Ut}`,"data-key":`data-key-${Ut}-${e(N)[0].id}`,"data-col":e(N)[0].id,"data-title":e(N)[0].title,"data-row-index":Ut,"data-col-index":0,onMousedown:Hn=>e(Eo)(Hn,Ut,0),onMouseover:Hn=>e(qn)(Hn,Ut,0),onClick:Hn=>di(Hn,Ut,0),onDblclick:Hn=>Yt(at,e(N)[0]),onContextmenu:Hn=>bt(Hn,{row:Ut,col:0})},{default:K(()=>[e(Mt)?ge("",!0):(h(),B("div",T_,[e(N)[0]&&e(xn)[0].isVirtualCol&&e(N)[0].title?(h(),J(cl,{key:0,modelValue:at.row[e(N)[0].title],"onUpdate:modelValue":Hn=>at.row[e(N)[0].title]=Hn,column:e(N)[0],active:e(Ve).col===0&&e(Ve).row===Ut,row:at,"read-only":!e(Qe),onNavigate:ut,onSave:Hn=>{var Kn;return(Kn=e(b))==null?void 0:Kn(at,"",lo)}},null,8,["modelValue","onUpdate:modelValue","column","active","row","read-only","onSave"])):e(N)[0]&&e(N)[0].title?(h(),J(Na,{key:1,modelValue:at.row[e(N)[0].title],"onUpdate:modelValue":Hn=>at.row[e(N)[0].title]=Hn,column:e(N)[0],"edit-enabled":!!e(Qe)&&!!e(Pe)&&e(Ve).col===0&&e(Ve).row===Ut,"row-index":Ut,active:e(Ve).col===0&&e(Ve).row===Ut,"read-only":!e(Qe),"onUpdate:editEnabled":P[22]||(P[22]=Hn=>Pe.value=Hn),onSave:Hn=>{var Kn;return(Kn=e(b))==null?void 0:Kn(at,e(N)[0].title,lo)},onNavigate:ut,onCancel:P[23]||(P[23]=Hn=>Pe.value=!1)},null,8,["modelValue","onUpdate:modelValue","column","edit-enabled","row-index","active","read-only","onSave"])):ge("",!0)]))]),_:2},1032,["active","class","style","data-testid","data-key","data-col","data-title","data-row-index","onMousedown","onMouseover","onClick","onDblclick","onContextmenu"])):ge("",!0),e(Un).length?(h(),B("td",{key:1,colspan:e(Un).length,style:Xn({minWidth:`${e(Un).width}px`,maxWidth:`${e(Un).width}px`,width:`${e(Un).width}px`}),class:"nc-grid-cell"},null,12,$_)):ge("",!0),(h(!0),B(Qt,null,po(e(Ko),({field:Hn,index:Kn})=>{var Bl,$r,Or,Dr,Lr,Nr,Pr;return h(),J(xl,{key:`cell-${Kn}-${Ut}`,active:e(Ve).row===Ut&&e(Ve).col===Kn||((Bl=e(kn)._start)==null?void 0:Bl.row)===Ut&&(($r=e(kn)._start)==null?void 0:$r.col)===Kn,class:Gt(["cell relative nc-grid-cell cursor-pointer",{active:e(Ro)[`${Ut}-${Kn}`],"active-cell":e(Ve).row===Ut&&e(Ve).col===Kn||((Or=e(kn)._start)==null?void 0:Or.row)===Ut&&((Dr=e(kn)._start)==null?void 0:Dr.col)===Kn,"nc-required-cell":e(gn)[Ut][Kn].isColumnRequiredAndNull&&!e(he),"align-middle":!E.rowHeightEnum||E.rowHeightEnum===1,"align-top":E.rowHeightEnum&&E.rowHeightEnum!==1,filling:e(Mo)[`${Ut}-${Kn}`],readonly:e(xn)[Kn].isReadonly&&e(Qe)&&e(Ro)[`${Ut}-${Kn}`],"!border-r-blue-400 !border-r-3":e(L)===Hn.id,...fi(Hn.id)}]),style:Xn({"min-width":((Lr=e(ze)[Hn.id])==null?void 0:Lr.width)||"180px","max-width":((Nr=e(ze)[Hn.id])==null?void 0:Nr.width)||"180px",width:((Pr=e(ze)[Hn.id])==null?void 0:Pr.width)||"180px"}),"data-testid":`cell-${Hn.title}-${Ut}`,"data-key":`data-key-${Ut}-${Hn.id}`,"data-col":Hn.id,"data-title":Hn.title,"data-row-index":Ut,"data-col-index":Kn,onMousedown:$e=>e(Eo)($e,Ut,Kn),onMouseover:$e=>e(qn)($e,Ut,Kn),onClick:$e=>di($e,Ut,Kn),onDblclick:$e=>Yt(at,Hn),onContextmenu:$e=>bt($e,{row:Ut,col:Kn})},{default:K(()=>[e(Mt)?ge("",!0):(h(),B("div",O_,[e(xn)[Kn].isVirtualCol&&Hn.title?(h(),J(cl,{key:0,modelValue:at.row[Hn.title],"onUpdate:modelValue":$e=>at.row[Hn.title]=$e,column:Hn,active:e(Ve).col===Kn&&e(Ve).row===Ut,row:at,"read-only":!e(Qe),onNavigate:ut,onSave:$e=>{var Do;return(Do=e(b))==null?void 0:Do(at,"",lo)}},null,8,["modelValue","onUpdate:modelValue","column","active","row","read-only","onSave"])):Hn.title?(h(),J(Na,{key:1,modelValue:at.row[Hn.title],"onUpdate:modelValue":$e=>at.row[Hn.title]=$e,column:Hn,"edit-enabled":!!e(Qe)&&!!e(Pe)&&e(Ve).col===Kn&&e(Ve).row===Ut,"row-index":Ut,active:e(Ve).col===Kn&&e(Ve).row===Ut,"read-only":!e(Qe),"onUpdate:editEnabled":P[24]||(P[24]=$e=>Pe.value=$e),onSave:$e=>{var Do;return(Do=e(b))==null?void 0:Do(at,Hn.title,lo)},onNavigate:ut,onCancel:P[25]||(P[25]=$e=>Pe.value=!1)},null,8,["modelValue","onUpdate:modelValue","column","edit-enabled","row-index","active","read-only","onSave"])):ge("",!0)]))]),_:2},1032,["active","class","style","data-testid","data-key","data-col","data-title","data-row-index","data-col-index","onMousedown","onMouseover","onClick","onDblclick","onContextmenu"])}),128)),e(ho).length?(h(),B("td",{key:2,colspan:e(ho).length,style:Xn({minWidth:`${e(ho).width}px`,maxWidth:`${e(ho).width}px`,width:`${e(ho).width}px`}),class:"nc-grid-cell"},null,12,D_)):ge("",!0)],14,S_),[[ya,!e(Cn)]])]}),_:2},1032,["row"]))),128)),!e(Cn)&&e(io).length?(h(),J(va,{key:2,"row-count":e(io).length,"row-height":e(io).rowHeight,"total-row-height":e(io).totalRowHeight,"col-count":e(Vl)},null,8,["row-count","row-height","total-row-height","col-count"])):ge("",!0),e(en)&&!e(ye)?Nt((h(),B("tr",{key:3,class:Gt(["text-left nc-grid-add-new-cell cursor-pointer group relative z-3 xs:hidden",{"!border-r-2 !border-r-gray-100":e(pt)===1}]),onMouseup:P[26]||(P[26]=ro(()=>{},["stop"])),onClick:P[27]||(P[27]=at=>ll())},[z("td",L_,[e(st)?ge("",!0):(h(),J($o(("iconMap"in E?E.iconMap:e(sl)).plus),{key:0,class:"text-pint-500 text-base ml-2 mt-0 text-gray-600 group-hover:text-black"}))]),z("td",{class:"!border-gray-100",colspan:e(pt)},null,8,N_)],34)),[[fn,["c:row:add:grid-bottom"]]]):ge("",!0)],512)):ge("",!0)],38),Nt(z("div",{ref_key:"fillHandle",ref:nt,class:Gt(["nc-fill-handle",!e(kn).isEmpty()&&e(kn).end.col!==0||e(kn).isEmpty()&&e(Ve).col!==0?"z-3":"z-4"]),style:Xn({top:`${e(fa)}px`,left:`${e(La)}px`,cursor:"crosshair"})},null,6),[[ya,e(Ll)]])],6))])]}),_:1},8,["visible","trigger"])],2),z("div",X_,[e(c)!==!0&&e(r)&&e(ye)?(h(),J(Jt,{key:`nc-pagination-${e(U)}`,"pagination-data":e(r),"onUpdate:paginationData":P[38]||(P[38]=de=>yo(r)?r.value=de:null),"show-api-timing":!e(ye),"align-count-on-right":"","align-left":e(ye),"change-page":e(m),"hide-sidebars":((In=e(u))==null?void 0:In.hideSidebars)===!0,"fixed-size":(R=e(u))==null?void 0:R.fixedSize,"extra-style":($=e(u))==null?void 0:$.extraStyle,"show-size-changer":!e(ye),"is-add-new-record-grid-mode":e(Ae)},nc({_:2},[e(en)&&!e(Cn)?{name:"add-record",fn:K(()=>[z("div",K_,[e(U)?Nt((h(),J(Ct,{key:0,class:"nc-grid-add-new-row",type:"secondary",disabled:e(H),onClick:P[36]||(P[36]=ro(de=>ao(),["stop"]))},{default:K(()=>[Je(ce(E.$t("activity.newRecord")),1)]),_:1},8,["disabled"])),[[fn,[e(Ae)?"c:row:add:grid":"c:row:add:form"]]]):Nt((h(),J(Xt,{key:1,class:"nc-grid-add-new-row",placement:"top",disabled:e(H),onClick:P[37]||(P[37]=ro(de=>e(Ae)?ll():ao(),["stop"]))},{overlay:K(()=>{var de,De;return[z("div",Q_,[z("div",{class:Gt(["absolute -top-21 flex flex-col min-h-34.5 w-70 p-1.5 bg-white rounded-lg border-1 border-gray-200 justify-start overflow-hidden",{"-left-32.5":!e(Ae),"-left-21.5":e(Ae)}]),style:{"box-shadow":"0px 4px 6px -2px rgba(0, 0, 0, 0.06), 0px -12px 16px -4px rgba(0, 0, 0, 0.1)"}},[Nt((h(),B("div",{class:"px-4 py-3 flex flex-col select-none gap-y-2 cursor-pointer rounded-md hover:bg-gray-100 text-gray-600 nc-new-record-with-grid group",onClick:Yn},[z("div",Z_,[z("div",ex,[(h(),J($o((de=("viewIcons"in E?E.viewIcons:e(Ci))[e(Ul).GRID])==null?void 0:de.icon),{class:"nc-view-icon text-inherit"})),Je(" "+ce(E.$t("activity.newRecord"))+" - "+ce(E.$t("objects.viewType.grid")),1)]),e(Ae)?(h(),J($n,{key:0,icon:"check",class:"w-4 h-4 text-primary"})):ge("",!0)]),z("div",tx,ce(E.$t("labels.addRowGrid")),1)])),[[fn,["c:row:add:grid"]]]),Nt((h(),B("div",{class:"px-4 py-3 flex flex-col select-none gap-y-2 cursor-pointer rounded-md hover:bg-gray-100 text-gray-600 nc-new-record-with-form group",onClick:ao},[z("div",nx,[z("div",ox,[(h(),J($o((De=("viewIcons"in E?E.viewIcons:e(Ci))[e(Ul).FORM])==null?void 0:De.icon),{class:"nc-view-icon text-inherit"})),Je(" "+ce(E.$t("activity.newRecord"))+" - "+ce(E.$t("objects.viewType.form")),1)]),e(Ae)?ge("",!0):(h(),J($n,{key:0,icon:"check",class:"w-4 h-4 text-primary"}))]),z("div",lx,ce(E.$t("labels.addRowForm")),1)])),[[fn,["c:row:add:form"]]])],2)])]}),icon:K(()=>[(h(),J($o(("iconMap"in E?E.iconMap:e(sl)).arrowUp),{class:"text-gray-600 h-4 w-4"}))]),default:K(()=>[z("div",J_,[z("span",null,[e(Ae)?(h(),B(Qt,{key:0},[Je(ce(E.$t("activity.newRecord")),1)],64)):(h(),B(Qt,{key:1},[Je(ce(E.$t("activity.newRecord"))+" - "+ce(E.$t("objects.viewType.form")),1)],64))])])]),_:1},8,["disabled"])),[[fn,[e(Ae)?"c:row:add:grid:toggle":"c:row:add:form:toggle"]]])])]),key:"0"}:void 0]),1032,["pagination-data","show-api-timing","align-left","change-page","hide-sidebars","fixed-size","extra-style","show-size-changer","is-add-new-record-grid-mode"])):e(r)?(h(),J(Bt,{key:1,"pagination-data":e(r),"onUpdate:paginationData":P[39]||(P[39]=de=>yo(r)?r.value=de:null),"change-page":e(m),"show-size-changer":!e(ye),"scroll-left":e(Po)},null,8,["pagination-data","change-page","show-size-changer","scroll-left"])):ge("",!0)]),e(c)!==!0&&e(r)&&!e(ye)?(h(),B("div",{key:0,class:"absolute bottom-12 left-2",onClick:P[42]||(P[42]=ro(()=>{},["stop"]))},[e(en)&&!e(Cn)?(h(),J(dt,{key:0},{overlay:K(()=>[le(Pl,{variant:"small"},{default:K(()=>[Nt((h(),J(co,{class:"nc-new-record-with-grid group",onClick:Yn},{default:K(()=>{var de;return[z("div",sx,[(h(),J($o((de=("viewIcons"in E?E.viewIcons:e(Ci))[e(Ul).GRID])==null?void 0:de.icon),{class:"nc-view-icon text-inherit"})),Je(" "+ce(E.$t("activity.newRecord"))+" - "+ce(E.$t("objects.viewType.grid")),1)]),e(Ae)?(h(),J($n,{key:0,icon:"check",class:"w-4 h-4 text-primary"})):ge("",!0)]}),_:1})),[[fn,["c:row:add:grid"]]]),Nt((h(),J(co,{class:"nc-new-record-with-form group",onClick:ao},{default:K(()=>{var de;return[z("div",ux,[(h(),J($o((de=("viewIcons"in E?E.viewIcons:e(Ci))[e(Ul).FORM])==null?void 0:de.icon),{class:"nc-view-icon text-inherit"})),Je(" "+ce(E.$t("activity.newRecord"))+" - "+ce(E.$t("objects.viewType.form")),1)]),e(Ae)?ge("",!0):(h(),J($n,{key:0,icon:"check",class:"w-4 h-4 text-primary"}))]}),_:1})),[[fn,["c:row:add:form"]]])]),_:1})]),default:K(()=>[z("div",ax,[e(U)?Nt((h(),J(Ct,{key:0,disabled:e(H),class:"nc-grid-add-new-row",size:"small",type:"secondary",shadow:!1,onClick:P[40]||(P[40]=ro(de=>ao(),["stop"]))},{default:K(()=>[z("div",ix,[le($n,{icon:"plus"}),P[50]||(P[50]=Je(" New Record "))])]),_:1},8,["disabled"])),[[fn,[e(Ae)?"c:row:add:grid":"c:row:add:form"]]]):Nt((h(),J(Ct,{key:1,disabled:e(H),class:"!rounded-r-none !border-r-0 nc-grid-add-new-row",size:"small",type:"secondary",shadow:!1,onClick:P[41]||(P[41]=ro(de=>e(Ae)?ll():ao(),["stop"]))},{default:K(()=>[z("div",rx,[le($n,{icon:"plus"}),e(Ae)?(h(),B(Qt,{key:0},[Je(ce(E.$t("activity.newRecord")),1)],64)):(h(),B(Qt,{key:1},[Je(ce(E.$t("activity.newRecord"))+" - "+ce(E.$t("objects.viewType.form")),1)],64))])]),_:1},8,["disabled"])),[[fn,[e(Ae)?"c:row:add:grid":"c:row:add:form"]]]),e(U)?ge("",!0):(h(),J(Ct,{key:2,size:"small",class:"!rounded-l-none nc-add-record-more-info",type:"secondary",shadow:!1},{default:K(()=>[le($n,{icon:"arrowUp"})]),_:1}))])]),_:1})):ge("",!0)])):ge("",!0)],2)}}}),cd=Object.assign(Ol(cx,[["__scopeId","data-v-a8187b47"]]),{__name:"SmartsheetGridTable"}),fx={class:"flex gap-2 items-center"},vx={key:0,class:"flex gap-2 items-center"},px={key:1,class:"flex gap-2 items-center"},hx={class:"flex gap-2 items-center"},mx={class:"flex gap-2 items-center"},gx={class:"flex gap-2 items-center"},wx={class:"flex gap-2 items-center"},yx={class:"flex gap-2 items-center"},bx={class:"flex gap-2 items-center"},_x={class:"flex gap-2 items-center"},xx={class:"flex gap-2 items-center"},kx={class:"flex gap-2 items-center"},Cx={class:"flex gap-2 items-center"},Rx={class:"flex gap-2 items-center"},Sx={class:"flex gap-2 items-center"},Ix=xo({__name:"Cell",props:{selectedAllRecords:{type:Boolean},contextMenuTarget:{},selection:{},columns:{},activeCell:{},isGroupBy:{type:Boolean},isPrimaryKeyAvailable:{type:Boolean},isSelectionReadOnly:{type:Boolean},isSelectionOnlyAI:{},isSelectionOnlyScript:{},actionManager:{},isInsertBelowDisabled:{type:Boolean},isOrderColumnExists:{type:Boolean},deleteRow:{type:Function},deleteRangeOfRows:{type:Function},deleteSelectedRows:{type:Function},bulkDeleteAll:{type:Function},callAddNewRow:{type:Function},copyValue:{type:Function},bulkUpdateRows:{type:Function},expandForm:{type:Function},clearCell:{type:Function},clearSelectedRangeOfCells:{type:Function},getRows:{type:Function},getDataCache:{type:Function}},emits:["bulkUpdateDlg","update:selectedAllRecords"],setup(t,{emit:n}){const o=t,l=n,{bulkDeleteAll:a,deleteRow:i,deleteSelectedRows:r,deleteRangeOfRows:s,expandForm:u,clearCell:c,clearSelectedRangeOfCells:f,getRows:v,getDataCache:p}=o,g=Ra(o,"contextMenuTarget",l),y=Ra(o,"selectedAllRecords",l),x=Nn(o,"isGroupBy"),w=Nn(o,"selection"),m=Nn(o,"actionManager"),C=Nn(o,"columns"),b=Nn(o,"isSelectionOnlyAI"),S=Nn(o,"isSelectionOnlyScript"),k=Nn(o,"activeCell"),D=Nn(o,"isOrderColumnExists"),{isExpandedFormCommentMode:F}=Uo(Ir()),I=V(!1),{isDataReadOnly:M,isUIAllowed:A}=wl(),{aiIntegrations:j}=kr(),{isMobileMode:N}=tl(),{paste:Y}=dd(),{meta:ae}=Fl(),he=ue(()=>A("dataEdit")),ye=ue(()=>{var ne,be;return((ne=g.value)==null?void 0:ne.row)!==-1?(be=g.value)==null?void 0:be.row:null}),re=ue(()=>{var ne,be;return((ne=g.value)==null?void 0:ne.col)!==-1?(be=g.value)==null?void 0:be.col:null}),me=ue(()=>{var ne,be,ee,H;return x.value?(be=(ne=g.value)==null?void 0:ne.path)!=null&&be.length?(ee=g.value)==null?void 0:ee.path:null:(H=g.value)==null?void 0:H.path}),W=ue(()=>me.value?p(me.value).selectedRows.value:[]),U=ue(()=>{var ne,be;return o.isSelectionReadOnly&&(!w.value.isSingleCell()||!re.value||!me.value||!Ho((ne=C.value[re.value])==null?void 0:ne.columnObj)&&!Jo((be=C.value[re.value])==null?void 0:be.columnObj))}),Ae=ue(()=>{var ne;return o.isSelectionReadOnly&&(!w.value.isSingleCell()||!me.value||!re.value||!ml((ne=C.value[re.value])==null?void 0:ne.columnObj))});async function je(){I.value=!0;const{totalRows:ne}=p([]),{close:be}=rs(fv,{modelValue:I,rows:ne.value,"onUpdate:modelValue":ee,onDeleteAll:async()=>{await(a==null?void 0:a([])),ee(),y.value=!1}});function ee(){I.value=!1,be(200)}await ka(I).toBe(!1)}const Ue=(ne,be)=>{try{i==null||i(ne,!1,be),w.value.isRowInRange(ne)&&w.value.clear(),k.value&&k.value.row===ne&&(k.value.row=-1,k.value.column=-1)}catch(ee){Zt.error(ee.message)}},ot=ne=>{s==null||s(w.value,ne).then(()=>{w.value.clear(),k.value.row=-1,k.value.column=-1,k.value.path=ne})},G=(ne,be)=>{try{F.value=!0;const H=p(be).cachedRows.value.get(ne);if(!H)return;u(H,{},!1,be),k.value.row=-1,k.value.column=-1,k.value.path=be,w.value.clear()}catch(ee){Zt.error(ee.message)}},pe=async ne=>{const be=C.value[w.value.start.col],ee=be==null?void 0:be.columnObj;if(!ee||!ee.id)return;const H=await v(w.value.start.row,w.value.end.row+1,ne);if(!H||H.length===0)return;const Ce=H.map(Ie=>{var Q;return{pk:Ht(Ie.row,(Q=ae.value)==null?void 0:Q.columns),row:Ie}}).filter(Ie=>Ie.pk!==null);await m.value.executeButtonAction(Ce.map(Ie=>Ie.pk),be,{row:Ce.map(Ie=>Ie.row),isAiPromptCol:ba(be==null?void 0:be.columnObj),path:me.value})};return(ne,be)=>{const ee=Sl,H=Ya,Ce=Sr,Ie=_r,Q=Aa,ie=ud,Me=qa,Be=Yl("e");return h(),J(Me,{class:"!rounded !py-0",variant:"small"},{default:K(()=>{var it,Ge,ze,Z,Et,_e,yn,It,$t;return[e(y)?ge("",!0):(h(),B(Qt,{key:0},[("isEeUI"in ne?ne.isEeUI:e(Wi))&&e(re)==null&&e(me)!==null&&!e(M)&&e(W).length?(h(),J(H,{key:"update-selected-rows",onClick:be[0]||(be[0]=et=>l("bulkUpdateDlg",e(me)))},{default:K(()=>[Nt((h(),B("div",fx,[le(ee,{icon:"ncEdit"}),Je(" "+ce(ne.$t("title.updateSelectedRows")),1)])),[[Be,["a:row:update-bulk"]]])]),_:1})):ge("",!0),e(re)==null&&!e(M)&&e(me)!==null&&e(W).length?(h(),J(Ce,{key:1,entity:e(pl).TABLE,"entity-id":(it=e(ae))==null?void 0:it.id,permission:e(vl).TABLE_RECORD_DELETE,placement:"right"},{default:K(({isAllowed:et})=>[le(H,{key:"selete-selected-rows",class:"nc-base-menu-item",danger:"","data-testid":"nc-delete-row",disabled:!et,onClick:be[1]||(be[1]=cn=>e(r)(e(me)))},{default:K(()=>[e(W).length===1?Nt((h(),B("div",vx,[le(ee,{icon:"delete"}),Je(" "+ce(ne.$t("activity.deleteSelectedRow")),1)])),[[Be,["a:row:delete"]]]):Nt((h(),B("div",px,[le(ee,{icon:"delete"}),Je(" "+ce(ne.$t("activity.deleteSelectedRow")),1)])),[[Be,["a:row:delete-bulk"]]])]),_:2},1032,["disabled"])]),_:1},8,["entity","entity-id","permission"])):ge("",!0)],64)),e(y)&&!e(x)?(h(),J(Ce,{key:1,entity:e(pl).TABLE,"entity-id":(Ge=e(ae))==null?void 0:Ge.id,permission:e(vl).TABLE_RECORD_DELETE,placement:"right"},{default:K(({isAllowed:et})=>[le(H,{key:"delete-all-rows",class:"nc-base-menu-item",danger:"","data-testid":"nc-delete-all-row",disabled:!et,onClick:be[2]||(be[2]=cn=>je(e(me)))},{default:K(()=>[Nt((h(),B("div",hx,[le(ee,{icon:"delete"}),Je(" "+ce(ne.$t("activity.deleteAllRecords")),1)])),[[Be,["a:row:delete-all"]]])]),_:2},1032,["disabled"])]),_:1},8,["entity","entity-id","permission"])):ge("",!0),e(D)&&e(he)&&!e(M)&&ne.isPrimaryKeyAvailable&&e(w).isSingleCell()?(h(),B(Qt,{key:2},[e(re)!==null&&e(ye)!==null&&e(me)!==null?(h(),J(Ce,{key:0,entity:e(pl).TABLE,"entity-id":(ze=e(ae))==null?void 0:ze.id,permission:e(vl).TABLE_RECORD_ADD,placement:"right"},{default:K(({isAllowed:et})=>[le(H,{key:"insert-above",class:"nc-base-menu-item","data-testid":"context-menu-item-add-above",disabled:!et,onClick:be[3]||(be[3]=cn=>ne.callAddNewRow(e(g),"above"))},{default:K(()=>[Nt((h(),B("div",mx,[le(ee,{icon:"ncChevronUp"}),Je(" "+ce(ne.$t("general.insertAbove")),1)])),[[Be,["a:row:insert:above"]]])]),_:2},1032,["disabled"])]),_:1},8,["entity","entity-id","permission"])):ge("",!0),e(re)!==null&&e(ye)!==null&&e(me)!==null&&!ne.isInsertBelowDisabled?(h(),J(Ce,{key:1,entity:e(pl).TABLE,"entity-id":(Z=e(ae))==null?void 0:Z.id,permission:e(vl).TABLE_RECORD_ADD,placement:"right"},{default:K(({isAllowed:et})=>[le(H,{key:"insert-below",class:"nc-base-menu-item","data-testid":"context-menu-item-add-below",disabled:!et,onClick:be[4]||(be[4]=cn=>ne.callAddNewRow(e(g),"below"))},{default:K(()=>[Nt((h(),B("div",gx,[le(ee,{icon:"ncChevronDown"}),Je(" "+ce(ne.$t("general.insertBelow")),1)])),[[Be,["a:row:insert:below"]]])]),_:2},1032,["disabled"])]),_:1},8,["entity","entity-id","permission"])):ge("",!0),e(re)!==null&&e(ye)!==null?(h(),J(Ie,{key:2})):ge("",!0)],64)):ge("",!0),e(re)!==null&&e(me)!==null&&e(ye)!==null&&e(he)&&!e(M)&&e(b).enabled?(h(),J(Q,{key:3,disabled:!e(b).disabled},{title:K(()=>[Je(ce(e(j).length?ne.$t("tooltip.aiIntegrationReConfigure"):ne.$t("tooltip.aiIntegrationAddAndReConfigure")),1)]),default:K(()=>[le(H,{key:"generate-ai",class:"nc-base-menu-item","data-testid":"context-menu-item-bulk",disabled:e(b).disabled,onClick:be[5]||(be[5]=et=>pe(e(me)||[]))},{default:K(()=>[z("div",wx,[le(ee,{icon:"ncAutoAwesome",class:"h-4 w-4"}),Je(" Generate "+ce(e(w).isSingleCell()?"Cell":"All"),1)])]),_:1},8,["disabled"])]),_:1},8,["disabled"])):ge("",!0),e(S).enabled?(h(),J(H,{key:"execute-script",class:"nc-base-menu-item","data-testid":"context-menu-item-bulk-script",disabled:e(S).disabled,onClick:be[6]||(be[6]=et=>pe(e(me)||[]))},{default:K(()=>[z("div",yx,[le(ee,{icon:"ncScript",class:"h-4 w-4"}),Je(" Execute "+ce(e(w).isSingleCell()?"Cell":"All"),1)])]),_:1},8,["disabled"])):ge("",!0),e(re)!==null&&e(ye)!==null&&e(me)!==null?(h(),J(H,{key:"cell-copy",class:"nc-base-menu-item","data-testid":"context-menu-item-copy",onClick:be[7]||(be[7]=et=>ne.copyValue(e(g),e(me)))},{default:K(()=>[Nt((h(),B("div",bx,[le(ee,{icon:"copy"}),Je(" "+ce(ne.$t("general.copy"))+" "+ce(ne.$t("objects.cell").toLowerCase()),1)])),[[Be,["a:row:copy"]]])]),_:1})):ge("",!0),e(re)!==null&&e(me)&&e(ye)!==null&&e(he)&&!e(M)?(h(),J(Ce,{key:6,entity:e(pl).FIELD,"entity-id":(_e=(Et=e(C)[e(re)])==null?void 0:Et.columnObj)==null?void 0:_e.id,permission:e(vl).RECORD_FIELD_EDIT,placement:"right"},{default:K(({isAllowed:et})=>[le(H,{key:"cell-paste",class:"nc-base-menu-item","data-testid":"context-menu-item-paste",disabled:e(U)||!et,onClick:e(Y)},{default:K(()=>[Nt((h(),B("div",_x,[le(ee,{icon:"paste"}),Je(" "+ce(ne.$t("general.paste"))+" "+ce(ne.$t("objects.cell").toLowerCase()),1)])),[[Be,["a:row:paste"]]])]),_:2},1032,["disabled","onClick"])]),_:1},8,["entity","entity-id","permission"])):ge("",!0),e(re)!==null&&e(ye)!==null&&e(me)!==null&&e(he)&&!e(M)?(h(),J(Ce,{key:7,entity:e(pl).FIELD,"entity-id":(It=(yn=e(C)[e(re)])==null?void 0:yn.columnObj)==null?void 0:It.id,permission:e(vl).RECORD_FIELD_EDIT,placement:"right"},{default:K(({isAllowed:et})=>{var cn;return[e(w).isSingleCell()&&(e(ml)((cn=e(C)[e(re)])==null?void 0:cn.columnObj)||!e(C)[e(re)].virtual)?(h(),J(H,{key:"cell-clear",class:"nc-base-menu-item",disabled:e(Ae)||!et,"data-testid":"context-menu-item-clear",onClick:be[8]||(be[8]=Pn=>e(c)(e(g)))},{default:K(()=>[Nt((h(),B("div",xx,[le(ee,{icon:"close"}),Je(" "+ce(ne.$t("general.clear"))+" "+ce(ne.$t("objects.cell").toLowerCase()),1)])),[[Be,["a:row:clear"]]])]),_:2},1032,["disabled"])):(h(),J(H,{key:"cells-clear",class:"nc-base-menu-item",disabled:ne.isSelectionReadOnly||!et,"data-testid":"context-menu-item-clear",onClick:be[9]||(be[9]=Pn=>e(f)(e(me)))},{default:K(()=>[Nt((h(),B("div",kx,[le(ee,{icon:"closeBox",class:"text-gray-500"}),Je(" "+ce(ne.$t("general.clear"))+" "+ce(ne.$t("objects.cell").toLowerCase()),1)])),[[Be,["a:row:clear-range"]]])]),_:2},1032,["disabled"]))]}),_:1},8,["entity","entity-id","permission"])):ge("",!0),e(me)!==null&&e(re)!==null&&e(ye)!=null&&e(w).isSingleCell()&&e(A)("commentEdit")&&!e(N)?(h(),B(Qt,{key:8},[le(Ie),le(H,{key:"add-comment",class:"nc-base-menu-item",onClick:be[10]||(be[10]=et=>G(e(ye),e(me)))},{default:K(()=>[Nt((h(),B("div",Cx,[le(ie,{class:"h-4 w-4"}),Je(" "+ce(ne.$t("general.add"))+" "+ce(ne.$t("general.comment").toLowerCase()),1)])),[[Be,["a:row:comment"]]])]),_:1})],64)):ge("",!0),e(he)&&!e(M)?(h(),B(Qt,{key:9},[!e(re)!==null&&(e(W).length||e(y))?ge("",!0):(h(),J(Ie,{key:0})),e(me)!==null&&e(re)!==null&&e(ye)!=null?(h(),J(Ce,{key:1,entity:e(pl).TABLE,"entity-id":($t=e(ae))==null?void 0:$t.id,permission:e(vl).TABLE_RECORD_DELETE,placement:"right"},{default:K(({isAllowed:et})=>[e(w).isSingleCell()||e(w).isSingleRow()?(h(),J(H,{key:"delete-row",class:"nc-base-menu-item",danger:"",disabled:!et,onClick:be[11]||(be[11]=cn=>Ue(e(ye),e(me)))},{default:K(()=>[Nt((h(),B("div",Rx,[le(ee,{icon:"delete"}),Je(" "+ce(ne.$t("activity.deleteRow")),1)])),[[Be,["a:row:delete"]]])]),_:2},1032,["disabled"])):(h(),J(H,{key:"delete-selected-row",class:"nc-base-menu-item",danger:"",disabled:!et,onClick:be[12]||(be[12]=cn=>ot(e(me)))},{default:K(()=>[Nt((h(),B("div",Sx,[le(ee,{icon:"delete"}),Je(" "+ce(ne.$t("activity.deleteRows")),1)])),[[Be,["a:row:delete"]]])]),_:2},1032,["disabled"]))]),_:1},8,["entity","entity-id","permission"])):ge("",!0)],64)):ge("",!0)]}),_:1})}}}),Fx=Object.assign(Ix,{__name:"SmartsheetGridCanvasContextCell"}),Ax=xo({__name:"Row",props:{row:{}},setup(t){const o=Nn(t,"row"),{isNew:l,state:a,loadRow:i,pk:r}=Qf(o),s=dn(Ea),u=jo();u.on(f=>{l.value||s==null||s.trigger({...f,shouldShowLoading:(f==null?void 0:f.shouldShowLoading)??!1})});const{eventBus:c}=Ps();return c.on(async(f,v)=>{f===ks.RELOAD_ROW&&v.rowId==r.value&&await i()}),wo(rr,u),(f,v)=>Yu(f.$slots,"default",{state:e(a)})}}),gv=Object.assign(Ax,{__name:"SmartsheetRow"}),fd=Object.freeze(Object.defineProperty({__proto__:null,default:gv},Symbol.toStringTag,{value:"Module"})),Nu=Math.min,fr=Math.max,Vs=Math.round,ja=t=>({x:t,y:t}),Ex={left:"right",right:"left",bottom:"top",top:"bottom"},Mx={start:"end",end:"start"};function Sc(t,n,o){return fr(t,Nu(n,o))}function ou(t,n){return typeof t=="function"?t(n):t}function Gi(t){return t.split("-")[0]}function lu(t){return t.split("-")[1]}function wv(t){return t==="x"?"y":"x"}function yv(t){return t==="y"?"height":"width"}function Vi(t){return["top","bottom"].includes(Gi(t))?"y":"x"}function bv(t){return wv(Vi(t))}function Tx(t,n,o){o===void 0&&(o=!1);const l=lu(t),a=bv(t),i=yv(a);let r=a==="x"?l===(o?"end":"start")?"right":"left":l==="start"?"bottom":"top";return n.reference[i]>n.floating[i]&&(r=js(r)),[r,js(r)]}function $x(t){const n=js(t);return[Pu(t),n,Pu(n)]}function Pu(t){return t.replace(/start|end/g,n=>Mx[n])}function Ox(t,n,o){const l=["left","right"],a=["right","left"],i=["top","bottom"],r=["bottom","top"];switch(t){case"top":case"bottom":return o?n?a:l:n?l:a;case"left":case"right":return n?i:r;default:return[]}}function Dx(t,n,o,l){const a=lu(t);let i=Ox(Gi(t),o==="start",l);return a&&(i=i.map(r=>r+"-"+a),n&&(i=i.concat(i.map(Pu)))),i}function js(t){return t.replace(/left|right|bottom|top/g,n=>Ex[n])}function Lx(t){return{top:0,right:0,bottom:0,left:0,...t}}function Nx(t){return typeof t!="number"?Lx(t):{top:t,right:t,bottom:t,left:t}}function Us(t){const{x:n,y:o,width:l,height:a}=t;return{width:l,height:a,top:o,left:n,right:n+l,bottom:o+a,x:n,y:o}}function Ic(t,n,o){let{reference:l,floating:a}=t;const i=Vi(n),r=bv(n),s=yv(r),u=Gi(n),c=i==="y",f=l.x+l.width/2-a.width/2,v=l.y+l.height/2-a.height/2,p=l[s]/2-a[s]/2;let g;switch(u){case"top":g={x:f,y:l.y-a.height};break;case"bottom":g={x:f,y:l.y+l.height};break;case"right":g={x:l.x+l.width,y:v};break;case"left":g={x:l.x-a.width,y:v};break;default:g={x:l.x,y:l.y}}switch(lu(n)){case"start":g[r]-=p*(o&&c?-1:1);break;case"end":g[r]+=p*(o&&c?-1:1);break}return g}const Px=async(t,n,o)=>{const{placement:l="bottom",strategy:a="absolute",middleware:i=[],platform:r}=o,s=i.filter(Boolean),u=await(r.isRTL==null?void 0:r.isRTL(n));let c=await r.getElementRects({reference:t,floating:n,strategy:a}),{x:f,y:v}=Ic(c,l,u),p=l,g={},y=0;for(let x=0;x<s.length;x++){const{name:w,fn:m}=s[x],{x:C,y:b,data:S,reset:k}=await m({x:f,y:v,initialPlacement:l,placement:p,strategy:a,middlewareData:g,rects:c,platform:r,elements:{reference:t,floating:n}});f=C??f,v=b??v,g={...g,[w]:{...g[w],...S}},k&&y<=50&&(y++,typeof k=="object"&&(k.placement&&(p=k.placement),k.rects&&(c=k.rects===!0?await r.getElementRects({reference:t,floating:n,strategy:a}):k.rects),{x:f,y:v}=Ic(c,p,u)),x=-1)}return{x:f,y:v,placement:p,strategy:a,middlewareData:g}};async function _v(t,n){var o;n===void 0&&(n={});const{x:l,y:a,platform:i,rects:r,elements:s,strategy:u}=t,{boundary:c="clippingAncestors",rootBoundary:f="viewport",elementContext:v="floating",altBoundary:p=!1,padding:g=0}=ou(n,t),y=Nx(g),w=s[p?v==="floating"?"reference":"floating":v],m=Us(await i.getClippingRect({element:(o=await(i.isElement==null?void 0:i.isElement(w)))==null||o?w:w.contextElement||await(i.getDocumentElement==null?void 0:i.getDocumentElement(s.floating)),boundary:c,rootBoundary:f,strategy:u})),C=v==="floating"?{x:l,y:a,width:r.floating.width,height:r.floating.height}:r.reference,b=await(i.getOffsetParent==null?void 0:i.getOffsetParent(s.floating)),S=await(i.isElement==null?void 0:i.isElement(b))?await(i.getScale==null?void 0:i.getScale(b))||{x:1,y:1}:{x:1,y:1},k=Us(i.convertOffsetParentRelativeRectToViewportRelativeRect?await i.convertOffsetParentRelativeRectToViewportRelativeRect({elements:s,rect:C,offsetParent:b,strategy:u}):C);return{top:(m.top-k.top+y.top)/S.y,bottom:(k.bottom-m.bottom+y.bottom)/S.y,left:(m.left-k.left+y.left)/S.x,right:(k.right-m.right+y.right)/S.x}}const Bx=function(t){return t===void 0&&(t={}),{name:"flip",options:t,async fn(n){var o,l;const{placement:a,middlewareData:i,rects:r,initialPlacement:s,platform:u,elements:c}=n,{mainAxis:f=!0,crossAxis:v=!0,fallbackPlacements:p,fallbackStrategy:g="bestFit",fallbackAxisSideDirection:y="none",flipAlignment:x=!0,...w}=ou(t,n);if((o=i.arrow)!=null&&o.alignmentOffset)return{};const m=Gi(a),C=Vi(s),b=Gi(s)===s,S=await(u.isRTL==null?void 0:u.isRTL(c.floating)),k=p||(b||!x?[js(s)]:$x(s)),D=y!=="none";!p&&D&&k.push(...Dx(s,x,y,S));const F=[s,...k],I=await _v(n,w),M=[];let A=((l=i.flip)==null?void 0:l.overflows)||[];if(f&&M.push(I[m]),v){const he=Tx(a,r,S);M.push(I[he[0]],I[he[1]])}if(A=[...A,{placement:a,overflows:M}],!M.every(he=>he<=0)){var j,N;const he=(((j=i.flip)==null?void 0:j.index)||0)+1,ye=F[he];if(ye){var Y;const me=v==="alignment"?C!==Vi(ye):!1,W=((Y=A[0])==null?void 0:Y.overflows[0])>0;if(!me||W)return{data:{index:he,overflows:A},reset:{placement:ye}}}let re=(N=A.filter(me=>me.overflows[0]<=0).sort((me,W)=>me.overflows[1]-W.overflows[1])[0])==null?void 0:N.placement;if(!re)switch(g){case"bestFit":{var ae;const me=(ae=A.filter(W=>{if(D){const U=Vi(W.placement);return U===C||U==="y"}return!0}).map(W=>[W.placement,W.overflows.filter(U=>U>0).reduce((U,Ae)=>U+Ae,0)]).sort((W,U)=>W[1]-U[1])[0])==null?void 0:ae[0];me&&(re=me);break}case"initialPlacement":re=s;break}if(a!==re)return{reset:{placement:re}}}return{}}}};async function Wx(t,n){const{placement:o,platform:l,elements:a}=t,i=await(l.isRTL==null?void 0:l.isRTL(a.floating)),r=Gi(o),s=lu(o),u=Vi(o)==="y",c=["left","top"].includes(r)?-1:1,f=i&&u?-1:1,v=ou(n,t);let{mainAxis:p,crossAxis:g,alignmentAxis:y}=typeof v=="number"?{mainAxis:v,crossAxis:0,alignmentAxis:null}:{mainAxis:v.mainAxis||0,crossAxis:v.crossAxis||0,alignmentAxis:v.alignmentAxis};return s&&typeof y=="number"&&(g=s==="end"?y*-1:y),u?{x:g*f,y:p*c}:{x:p*c,y:g*f}}const zx=function(t){return t===void 0&&(t=0),{name:"offset",options:t,async fn(n){var o,l;const{x:a,y:i,placement:r,middlewareData:s}=n,u=await Wx(n,t);return r===((o=s.offset)==null?void 0:o.placement)&&(l=s.arrow)!=null&&l.alignmentOffset?{}:{x:a+u.x,y:i+u.y,data:{...u,placement:r}}}}},Vx=function(t){return t===void 0&&(t={}),{name:"shift",options:t,async fn(n){const{x:o,y:l,placement:a}=n,{mainAxis:i=!0,crossAxis:r=!1,limiter:s={fn:w=>{let{x:m,y:C}=w;return{x:m,y:C}}},...u}=ou(t,n),c={x:o,y:l},f=await _v(n,u),v=Vi(Gi(a)),p=wv(v);let g=c[p],y=c[v];if(i){const w=p==="y"?"top":"left",m=p==="y"?"bottom":"right",C=g+f[w],b=g-f[m];g=Sc(C,g,b)}if(r){const w=v==="y"?"top":"left",m=v==="y"?"bottom":"right",C=y+f[w],b=y-f[m];y=Sc(C,y,b)}const x=s.fn({...n,[p]:g,[v]:y});return{...x,data:{x:x.x-o,y:x.y-l,enabled:{[p]:i,[v]:r}}}}}};function au(){return typeof window<"u"}function qi(t){return vd(t)?(t.nodeName||"").toLowerCase():"#document"}function na(t){var n;return(t==null||(n=t.ownerDocument)==null?void 0:n.defaultView)||window}function ii(t){var n;return(n=(vd(t)?t.ownerDocument:t.document)||window.document)==null?void 0:n.documentElement}function vd(t){return au()?t instanceof Node||t instanceof na(t).Node:!1}function Ia(t){return au()?t instanceof Element||t instanceof na(t).Element:!1}function Ua(t){return au()?t instanceof HTMLElement||t instanceof na(t).HTMLElement:!1}function Fc(t){return!au()||typeof ShadowRoot>"u"?!1:t instanceof ShadowRoot||t instanceof na(t).ShadowRoot}function hs(t){const{overflow:n,overflowX:o,overflowY:l,display:a}=Fa(t);return/auto|scroll|overlay|hidden|clip/.test(n+l+o)&&!["inline","contents"].includes(a)}function jx(t){return["table","td","th"].includes(qi(t))}function iu(t){return[":popover-open",":modal"].some(n=>{try{return t.matches(n)}catch{return!1}})}function pd(t){const n=hd(),o=Ia(t)?Fa(t):t;return["transform","translate","scale","rotate","perspective"].some(l=>o[l]?o[l]!=="none":!1)||(o.containerType?o.containerType!=="normal":!1)||!n&&(o.backdropFilter?o.backdropFilter!=="none":!1)||!n&&(o.filter?o.filter!=="none":!1)||["transform","translate","scale","rotate","perspective","filter"].some(l=>(o.willChange||"").includes(l))||["paint","layout","strict","content"].some(l=>(o.contain||"").includes(l))}function Ux(t){let n=Ei(t);for(;Ua(n)&&!mr(n);){if(pd(n))return n;if(iu(n))return null;n=Ei(n)}return null}function hd(){return typeof CSS>"u"||!CSS.supports?!1:CSS.supports("-webkit-backdrop-filter","none")}function mr(t){return["html","body","#document"].includes(qi(t))}function Fa(t){return na(t).getComputedStyle(t)}function ru(t){return Ia(t)?{scrollLeft:t.scrollLeft,scrollTop:t.scrollTop}:{scrollLeft:t.scrollX,scrollTop:t.scrollY}}function Ei(t){if(qi(t)==="html")return t;const n=t.assignedSlot||t.parentNode||Fc(t)&&t.host||ii(t);return Fc(n)?n.host:n}function xv(t){const n=Ei(t);return mr(n)?t.ownerDocument?t.ownerDocument.body:t.body:Ua(n)&&hs(n)?n:xv(n)}function kv(t,n,o){var l;n===void 0&&(n=[]);const a=xv(t),i=a===((l=t.ownerDocument)==null?void 0:l.body),r=na(a);return i?(Bu(r),n.concat(r,r.visualViewport||[],hs(a)?a:[],[])):n.concat(a,kv(a,[]))}function Bu(t){return t.parent&&Object.getPrototypeOf(t.parent)?t.frameElement:null}function Cv(t){const n=Fa(t);let o=parseFloat(n.width)||0,l=parseFloat(n.height)||0;const a=Ua(t),i=a?t.offsetWidth:o,r=a?t.offsetHeight:l,s=Vs(o)!==i||Vs(l)!==r;return s&&(o=i,l=r),{width:o,height:l,$:s}}function Rv(t){return Ia(t)?t:t.contextElement}function vr(t){const n=Rv(t);if(!Ua(n))return ja(1);const o=n.getBoundingClientRect(),{width:l,height:a,$:i}=Cv(n);let r=(i?Vs(o.width):o.width)/l,s=(i?Vs(o.height):o.height)/a;return(!r||!Number.isFinite(r))&&(r=1),(!s||!Number.isFinite(s))&&(s=1),{x:r,y:s}}const Gx=ja(0);function Sv(t){const n=na(t);return!hd()||!n.visualViewport?Gx:{x:n.visualViewport.offsetLeft,y:n.visualViewport.offsetTop}}function Hx(t,n,o){return n===void 0&&(n=!1),!o||n&&o!==na(t)?!1:n}function us(t,n,o,l){n===void 0&&(n=!1),o===void 0&&(o=!1);const a=t.getBoundingClientRect(),i=Rv(t);let r=ja(1);n&&(l?Ia(l)&&(r=vr(l)):r=vr(t));const s=Hx(i,o,l)?Sv(i):ja(0);let u=(a.left+s.x)/r.x,c=(a.top+s.y)/r.y,f=a.width/r.x,v=a.height/r.y;if(i){const p=na(i),g=l&&Ia(l)?na(l):l;let y=p,x=Bu(y);for(;x&&l&&g!==y;){const w=vr(x),m=x.getBoundingClientRect(),C=Fa(x),b=m.left+(x.clientLeft+parseFloat(C.paddingLeft))*w.x,S=m.top+(x.clientTop+parseFloat(C.paddingTop))*w.y;u*=w.x,c*=w.y,f*=w.x,v*=w.y,u+=b,c+=S,y=na(x),x=Bu(y)}}return Us({width:f,height:v,x:u,y:c})}function md(t,n){const o=ru(t).scrollLeft;return n?n.left+o:us(ii(t)).left+o}function Iv(t,n,o){o===void 0&&(o=!1);const l=t.getBoundingClientRect(),a=l.left+n.scrollLeft-(o?0:md(t,l)),i=l.top+n.scrollTop;return{x:a,y:i}}function Yx(t){let{elements:n,rect:o,offsetParent:l,strategy:a}=t;const i=a==="fixed",r=ii(l),s=n?iu(n.floating):!1;if(l===r||s&&i)return o;let u={scrollLeft:0,scrollTop:0},c=ja(1);const f=ja(0),v=Ua(l);if((v||!v&&!i)&&((qi(l)!=="body"||hs(r))&&(u=ru(l)),Ua(l))){const g=us(l);c=vr(l),f.x=g.x+l.clientLeft,f.y=g.y+l.clientTop}const p=r&&!v&&!i?Iv(r,u,!0):ja(0);return{width:o.width*c.x,height:o.height*c.y,x:o.x*c.x-u.scrollLeft*c.x+f.x+p.x,y:o.y*c.y-u.scrollTop*c.y+f.y+p.y}}function qx(t){return Array.from(t.getClientRects())}function Xx(t){const n=ii(t),o=ru(t),l=t.ownerDocument.body,a=fr(n.scrollWidth,n.clientWidth,l.scrollWidth,l.clientWidth),i=fr(n.scrollHeight,n.clientHeight,l.scrollHeight,l.clientHeight);let r=-o.scrollLeft+md(t);const s=-o.scrollTop;return Fa(l).direction==="rtl"&&(r+=fr(n.clientWidth,l.clientWidth)-a),{width:a,height:i,x:r,y:s}}function Kx(t,n){const o=na(t),l=ii(t),a=o.visualViewport;let i=l.clientWidth,r=l.clientHeight,s=0,u=0;if(a){i=a.width,r=a.height;const c=hd();(!c||c&&n==="fixed")&&(s=a.offsetLeft,u=a.offsetTop)}return{width:i,height:r,x:s,y:u}}function Jx(t,n){const o=us(t,!0,n==="fixed"),l=o.top+t.clientTop,a=o.left+t.clientLeft,i=Ua(t)?vr(t):ja(1),r=t.clientWidth*i.x,s=t.clientHeight*i.y,u=a*i.x,c=l*i.y;return{width:r,height:s,x:u,y:c}}function Ac(t,n,o){let l;if(n==="viewport")l=Kx(t,o);else if(n==="document")l=Xx(ii(t));else if(Ia(n))l=Jx(n,o);else{const a=Sv(t);l={x:n.x-a.x,y:n.y-a.y,width:n.width,height:n.height}}return Us(l)}function Fv(t,n){const o=Ei(t);return o===n||!Ia(o)||mr(o)?!1:Fa(o).position==="fixed"||Fv(o,n)}function Qx(t,n){const o=n.get(t);if(o)return o;let l=kv(t,[]).filter(s=>Ia(s)&&qi(s)!=="body"),a=null;const i=Fa(t).position==="fixed";let r=i?Ei(t):t;for(;Ia(r)&&!mr(r);){const s=Fa(r),u=pd(r);!u&&s.position==="fixed"&&(a=null),(i?!u&&!a:!u&&s.position==="static"&&!!a&&["absolute","fixed"].includes(a.position)||hs(r)&&!u&&Fv(t,r))?l=l.filter(f=>f!==r):a=s,r=Ei(r)}return n.set(t,l),l}function Zx(t){let{element:n,boundary:o,rootBoundary:l,strategy:a}=t;const r=[...o==="clippingAncestors"?iu(n)?[]:Qx(n,this._c):[].concat(o),l],s=r[0],u=r.reduce((c,f)=>{const v=Ac(n,f,a);return c.top=fr(v.top,c.top),c.right=Nu(v.right,c.right),c.bottom=Nu(v.bottom,c.bottom),c.left=fr(v.left,c.left),c},Ac(n,s,a));return{width:u.right-u.left,height:u.bottom-u.top,x:u.left,y:u.top}}function ek(t){const{width:n,height:o}=Cv(t);return{width:n,height:o}}function tk(t,n,o){const l=Ua(n),a=ii(n),i=o==="fixed",r=us(t,!0,i,n);let s={scrollLeft:0,scrollTop:0};const u=ja(0);function c(){u.x=md(a)}if(l||!l&&!i)if((qi(n)!=="body"||hs(a))&&(s=ru(n)),l){const g=us(n,!0,i,n);u.x=g.x+n.clientLeft,u.y=g.y+n.clientTop}else a&&c();i&&!l&&a&&c();const f=a&&!l&&!i?Iv(a,s):ja(0),v=r.left+s.scrollLeft-u.x-f.x,p=r.top+s.scrollTop-u.y-f.y;return{x:v,y:p,width:r.width,height:r.height}}function hu(t){return Fa(t).position==="static"}function Ec(t,n){if(!Ua(t)||Fa(t).position==="fixed")return null;if(n)return n(t);let o=t.offsetParent;return ii(t)===o&&(o=o.ownerDocument.body),o}function Av(t,n){const o=na(t);if(iu(t))return o;if(!Ua(t)){let a=Ei(t);for(;a&&!mr(a);){if(Ia(a)&&!hu(a))return a;a=Ei(a)}return o}let l=Ec(t,n);for(;l&&jx(l)&&hu(l);)l=Ec(l,n);return l&&mr(l)&&hu(l)&&!pd(l)?o:l||Ux(t)||o}const nk=async function(t){const n=this.getOffsetParent||Av,o=this.getDimensions,l=await o(t.floating);return{reference:tk(t.reference,await n(t.floating),t.strategy),floating:{x:0,y:0,width:l.width,height:l.height}}};function ok(t){return Fa(t).direction==="rtl"}const lk={convertOffsetParentRelativeRectToViewportRelativeRect:Yx,getDocumentElement:ii,getClippingRect:Zx,getOffsetParent:Av,getElementRects:nk,getClientRects:qx,getDimensions:ek,getScale:vr,isElement:Ia,isRTL:ok},ak=zx,ik=Vx,rk=Bx,sk=(t,n,o)=>{const l=new Map,a={platform:lk,...o},i={...a.platform,_c:l};return Px(t,n,{...a,platform:i})};function uk(t){return t!=null&&typeof t=="object"&&"$el"in t}function Mc(t){if(uk(t)){const n=t.$el;return vd(n)&&qi(n)==="#comment"?null:n}return t}function Yr(t){return typeof t=="function"?t():e(t)}function Ev(t){return typeof window>"u"?1:(t.ownerDocument.defaultView||window).devicePixelRatio||1}function Tc(t,n){const o=Ev(t);return Math.round(n*o)/o}function dk(t,n,o){o===void 0&&(o={});const l=o.whileElementsMounted,a=ue(()=>{var F;return(F=Yr(o.open))!=null?F:!0}),i=ue(()=>Yr(o.middleware)),r=ue(()=>{var F;return(F=Yr(o.placement))!=null?F:"bottom"}),s=ue(()=>{var F;return(F=Yr(o.strategy))!=null?F:"absolute"}),u=ue(()=>{var F;return(F=Yr(o.transform))!=null?F:!0}),c=ue(()=>Mc(t.value)),f=ue(()=>Mc(n.value)),v=V(0),p=V(0),g=V(s.value),y=V(r.value),x=bp({}),w=V(!1),m=ue(()=>{const F={position:g.value,left:"0",top:"0"};if(!f.value)return F;const I=Tc(f.value,v.value),M=Tc(f.value,p.value);return u.value?{...F,transform:"translate("+I+"px, "+M+"px)",...Ev(f.value)>=1.5&&{willChange:"transform"}}:{position:g.value,left:I+"px",top:M+"px"}});let C;function b(){if(c.value==null||f.value==null)return;const F=a.value;sk(c.value,f.value,{middleware:i.value,placement:r.value,strategy:s.value}).then(I=>{v.value=I.x,p.value=I.y,g.value=I.strategy,y.value=I.placement,x.value=I.middlewareData,w.value=F!==!1})}function S(){typeof C=="function"&&(C(),C=void 0)}function k(){if(S(),l===void 0){b();return}if(c.value!=null&&f.value!=null){C=l(c.value,f.value,b);return}}function D(){a.value||(w.value=!1)}return Gn([i,r,s,a],b,{flush:"sync"}),Gn([c,f],k,{flush:"sync"}),Gn(a,D,{flush:"sync"}),_p()&&xp(S),{x:Qi(v),y:Qi(p),strategy:Qi(g),placement:Qi(y),middlewareData:Qi(x),isPositioned:Qi(w),floatingStyles:m,update:b}}/**
* @vue/server-renderer v3.5.15
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/const ck=Mp(",key,ref,innerHTML,textContent,ref_key,ref_for");function fk(t,n){let o="";for(const l in t){if(ck(l)||Tp(l)||n==="textarea"&&l==="value")continue;const a=t[l];l==="class"?o+=` class="${pk(a)}"`:l==="style"?o+=` style="${hk(a)}"`:l==="className"?o+=` class="${String(a)}"`:o+=vk(l,a,n)}return o}function vk(t,n,o){if(!Op(n))return"";const l=o&&(o.indexOf("-")>0||Dp(o))?t:Lp[t]||t.toLowerCase();return Np(l)?Pp(n)?` ${l}`:"":Bp(l)?n===""?` ${l}`:` ${l}="${Fi(n)}"`:(console.warn(`[@vue/server-renderer] Skipped rendering unsafe attribute name: ${l}`),"")}function pk(t){return Fi(Gt(t))}function hk(t){if(!t)return"";if(Cr(t))return Fi(t);const n=Xn(t);return Fi($p(n))}const{ensureValidVNode:bR}=Qs;function mk(t,n,o,l,a){t("<!--teleport start-->");const i=a.appContext.provides[Vf],r=i.__teleportBuffers||(i.__teleportBuffers={}),s=r[o]||(r[o]=[]),u=s.length;let c;if(l)n(t),c="<!--teleport start anchor--><!--teleport anchor-->";else{const{getBuffer:f,push:v}=Mv();v("<!--teleport start anchor-->"),n(v),v("<!--teleport anchor-->"),c=f()}s.splice(u,0,c),t("<!--teleport end-->")}{const t=Wp(),n=(o,l)=>{let a;return(a=t[o])||(a=t[o]=[]),a.push(l),i=>{a.length>1?a.forEach(r=>r(i)):a[0](i)}};n("__VUE_INSTANCE_SETTERS__",o=>o),n("__VUE_SSR_SETTERS__",o=>o)}function gk(t,n){throw new Error("On-the-fly template compilation is not supported in the ESM build of @vue/server-renderer. All templates must be pre-compiled into render functions.")}const{createComponentInstance:wk,setCurrentRenderingInstance:$c,setupComponent:yk,renderComponentRoot:Oc,normalizeVNode:bk,pushWarningContext:_R,popWarningContext:xR}=Qs;function Mv(){let t=!1;const n=[];return{getBuffer(){return n},push(o){const l=Cr(o);if(t&&l){n[n.length-1]+=o;return}n.push(o),t=l,(Os(o)||Ap(o)&&o.hasAsync)&&(n.hasAsync=!0)}}}function Tv(t,n=null,o){const l=t.component=wk(t,n,null),a=yk(l,!0),i=Os(a);let r=l.sp;return i||r?Promise.resolve(a).then(()=>{if(i&&(r=l.sp),r)return Promise.all(r.map(u=>u.call(l.proxy)))}).catch(Fu).then(()=>Dc(l,o)):Dc(l,o)}function Dc(t,n){const o=t.type,{getBuffer:l,push:a}=Mv();if(Cp(o)){let i=Oc(t);if(!o.props)for(const r in t.attrs)r.startsWith("data-v-")&&((i.props||(i.props={}))[r]="");Gs(a,t.subTree=i,t,n)}else{(!t.render||t.render===Fu)&&!t.ssrRender&&!o.ssrRender&&Cr(o.template)&&(o.ssrRender=gk(o.template));const i=t.ssrRender||o.ssrRender;if(i){let r=t.inheritAttrs!==!1?t.attrs:void 0,s=!1,u=t;for(;;){const f=u.vnode.scopeId;f&&(s||(r={...r},s=!0),r[f]="");const v=u.parent;if(v&&v.subTree&&v.subTree===u.vnode)u=v;else break}if(n){s||(r={...r});const f=n.trim().split(" ");for(let v=0;v<f.length;v++)r[f[v]]=""}const c=$c(t);try{i(t.proxy,a,t,r,t.props,t.setupState,t.data,t.ctx)}finally{$c(c)}}else t.render&&t.render!==Fu?Gs(a,t.subTree=Oc(t),t,n):(o.name||o.__file,a("<!---->"))}return l()}function Gs(t,n,o,l){const{type:a,shapeFlag:i,children:r,dirs:s,props:u}=n;switch(s&&(n.props=xk(n,u,s)),a){case Fp:t(Fi(r));break;case Sp:t(r?`<!--${Ip(r)}-->`:"<!---->");break;case Rp:t(r);break;case Qt:n.slotScopeIds&&(l=(l?l+" ":"")+n.slotScopeIds.join(" ")),t("<!--[-->"),gd(t,r,o,l),t("<!--]-->");break;default:i&1?_k(t,n,o,l):i&6?t(Tv(n,o,l)):i&64?kk(t,n,o,l):i&128&&Gs(t,n.ssContent,o,l)}}function gd(t,n,o,l){for(let a=0;a<n.length;a++)Gs(t,bk(n[a]),o,l)}function _k(t,n,o,l){const a=n.type;let{props:i,children:r,shapeFlag:s,scopeId:u}=n,c=`<${a}`;i&&(c+=fk(i,a)),u&&(c+=` ${u}`);let f=o,v=n;for(;f&&v===f.subTree;)v=f.vnode,v.scopeId&&(c+=` ${v.scopeId}`),f=f.parent;if(l&&(c+=` ${l}`),t(c+">"),!Ep(a)){let p=!1;i&&(i.innerHTML?(p=!0,t(i.innerHTML)):i.textContent?(p=!0,t(Fi(i.textContent))):a==="textarea"&&i.value&&(p=!0,t(Fi(i.value)))),p||(s&8?t(Fi(r)):s&16&&gd(t,r,o,l)),t(`</${a}>`)}}function xk(t,n,o){const l=[];for(let a=0;a<o.length;a++){const i=o[a],{dir:{getSSRProps:r}}=i;if(r){const s=r(i,t);s&&l.push(s)}}return ar(n||{},...l)}function kk(t,n,o,l){const a=n.props&&n.props.to,i=n.props&&n.props.disabled;if(!a)return[];if(!Cr(a))return[];mk(t,r=>{gd(r,n.children,o,l)},a,i||i==="",o)}const{isVNode:Ck}=Qs;function Ss(t,n,o){if(!t.hasAsync)return n+Ov(t);let l=n;for(let a=o;a<t.length;a+=1){const i=t[a];if(Cr(i)){l+=i;continue}if(Os(i))return i.then(s=>(t[a]=s,Ss(t,l,a)));const r=Ss(i,l,0);if(Os(r))return r.then(s=>(t[a]=s,Ss(t,"",a)));l=r}return l}function $v(t){return Ss(t,"",0)}function Ov(t){let n="";for(let o=0;o<t.length;o++){let l=t[o];Cr(l)?n+=l:n+=Ov(l)}return n}async function Dv(t,n={}){if(Ck(t))return Dv(kp({render:()=>t}),n);const o=le(t._component,t._props);o.appContext=t._context,t.provide(Vf,n);const l=await Tv(o),a=await $v(l);if(await Rk(n),n.__watcherHandles)for(const i of n.__watcherHandles)i();return a}async function Rk(t){if(t.__teleportBuffers){t.teleports=t.teleports||{};for(const n in t.__teleportBuffers)t.teleports[n]=await $v(await Promise.all([t.__teleportBuffers[n]]))}}const{isVNode:kR}=Qs;zp();class Sk{constructor(n){vo(this,"svgCache",new Map);vo(this,"spriteCache",new Map);vo(this,"pendingSprites",0);this.onSettled=n}getCacheKey(n,o,l){return`${typeof n=="string"?n:JSON.stringify(n)}-${o}-${l}`}async loadSvg(n){const o=typeof n=="string"?n:JSON.stringify(n),l=this.svgCache.get(o);if(l)return l;const a=typeof n=="string"?sl[n]:n,i=Vp(a),r=await Dv(i);return this.svgCache.set(o,r),r}async renderIcon(n,{icon:o,size:l,color:a,x:i,y:r,alpha:s=1}){var g;const u=window.devicePixelRatio||1,c=this.getCacheKey(o,l,a),f=this.spriteCache.get(c);if(f){s<1&&(n.globalAlpha=s),n.drawImage(f,i,r,l,l),s<1&&(n.globalAlpha=1);return}const v=document.createElement("canvas");v.width=l*u,v.height=l*u;const p=v.getContext("2d");p.imageSmoothingEnabled=!0,p.imageSmoothingQuality="high",p.scale(u,u),this.spriteCache.set(c,v),this.pendingSprites++;try{const y=await this.loadSvg(o),x=new Image,w=new Blob([y.replaceAll("currentColor",a)],{type:"image/svg+xml"}),m=URL.createObjectURL(w);try{await new Promise(C=>{x.onload=()=>{var b;p.drawImage(x,0,0,l,l),(b=this.onSettled)==null||b.call(this),C()},x.src=m})}finally{URL.revokeObjectURL(m)}}finally{this.pendingSprites--,this.pendingSprites===0&&((g=this.onSettled)==null||g.call(this))}}get isLoading(){return this.pendingSprites>0}clearCaches(){this.svgCache.clear(),this.spriteCache.clear()}}class Ik{constructor(n){vo(this,"cache",new Map);vo(this,"qrCache",new Map);vo(this,"loadingImages",new Map);vo(this,"loadingQRs",new Map);vo(this,"failedUrls",new Set);vo(this,"pendingSprites",0);this.onSettled=n}getQRCacheKey(n,o,l,a){return`qr-${n}-${o}-${l}-${a}`}loadOrGetImage(n){n=Array.isArray(n)?n:[n];for(const i of n){const r=this.cache.get(i);if(r)return r}if(n.some(i=>this.loadingImages.has(i)))return;const l=n.find(i=>!this.failedUrls.has(i));if(!l)return;const a=(async()=>{try{const i=await this.loadImage(l);if(i)return i;this.failedUrls.add(l)}catch{this.failedUrls.add(l)}for(const i of n.slice(n.indexOf(l)+1))if(!this.failedUrls.has(i))try{const r=await this.loadImage(i);if(r)return r}catch{this.failedUrls.add(i)}})().finally(()=>{for(const i of n)this.loadingImages.delete(i)});this.loadingImages.set(l,a)}loadOrGetQR(n,o,l={}){const{dark:a="#000000",light:i="#ffffff"}=l,r=this.getQRCacheKey(n,o,a,i),s=this.qrCache.get(r);if(s)return s;if(!this.loadingQRs.has(r)){const u=this.generateQR(n,o,a,i,r);this.loadingQRs.set(r,u),u.finally(()=>{this.loadingQRs.delete(r)})}}async generateQR(n,o,l,a,i){var r;this.pendingSprites++;try{const s=document.createElement("canvas");return await Em.toCanvas(s,n,{margin:1,scale:4,width:o,color:{dark:l,light:a}}),this.qrCache.set(i,s),s}catch{return}finally{this.pendingSprites--,(r=this.onSettled)==null||r.call(this)}}renderQRCode(n,o,l,a,i){n.drawImage(o,l,a,i,i)}async loadImage(n){var l;const o=new Image;this.pendingSprites++;try{return await new Promise((a,i)=>{o.onload=()=>{a()},o.onerror=()=>{i(new Error("Failed to load image"))},o.src=n}),this.cache.set(n,o),o}catch{o.src="";return}finally{this.pendingSprites--,(l=this.onSettled)==null||l.call(this)}}renderImage(n,o,l,a,i,r,s=4,u,c="cover"){const{border:f=!1,borderColor:v="#e5e7eb",borderWidth:p=1}=u;n.save(),f&&(n.beginPath(),n.roundRect(l,a,i,r,s),n.strokeStyle=v,n.lineWidth=p,n.stroke()),s>0&&(n.beginPath(),n.roundRect(l,a,i,r,s),n.clip()),n.beginPath(),n.roundRect(l+(f?p/2:0),a+(f?p/2:0),i-(f?p:0),r-(f?p:0),Math.max(0,s-(f?p/2:0))),n.clip();const g=i-(f?p:0),y=r-(f?p:0);let x=g/o.width,w=y/o.height,m,C=0,b=0;c==="contain"?(m=Math.min(x,w),C=(g-o.width*m)/2,b=(y-o.height*m)/2):c==="cover"?(m=Math.max(x,w),C=(g-o.width*m)/2,b=(y-o.height*m)/2):(x=g/o.width,w=y/o.height,m=1),n.drawImage(o,l+C+(f?p/2:0),a+b+(f?p/2:0),o.width*(c==="fill"?x:m),o.height*(c==="fill"?w:m)),n.restore()}renderPlaceholder(n,o,l,a,i){n.fillStyle="#f3f4f6",n.beginPath(),n.roundRect(o,l,a,a,4),n.fill(),n.fillStyle="#6b7280",n.font="12px Material Icons",n.textBaseline="middle",n.textAlign="center",n.fillText(i,o+a/2,l+a/2)}clearCache(){this.cache.forEach(n=>{n.onload=null,n.onerror=null,n.src=""}),this.cache.clear(),this.loadingImages.clear(),this.qrCache.clear(),this.loadingQRs.clear()}get isLoading(){return this.pendingSprites>0}renderError(n,o,l,a,i,r,s=10){n.font="500 13px Inter",n.textBaseline="middle",n.textAlign="left",n.fillStyle="#e65100",gl(n,{text:o,x:l+s,y:a+r/2,maxWidth:i-s*2,lineHeight:16})}}const Lc={[dr[0]]:"hh:mm A",[dr[1]]:"hh:mm:ss A",[dr[2]]:"hh:mm:ss.SSS A"},Nc={[dr[0]]:{12:85,24:65},[dr[1]]:{12:100,24:80},[dr[2]]:{12:130,24:110}},pn=t=>typeof t=="number"?t:t?parseInt(t.replace("px",""),10):180,Lv=t=>{const n={options:[],optionsMap:{}},o=t.colOptions;return!o||!Rl(o.options)||(n.options=o.options.filter(l=>l.title!=="").map(l=>{var a;return l.order!==null&&(l.title=(a=l.title)==null?void 0:a.replace(/^'/,"").replace(/'$/,"")),l.value=l.title,l}),n.optionsMap=n.options.reduce((l,a)=>(a.title&&(l[a.title.trim()]=a),l),{})),n},Nv=(t,n)=>{const o={options:[],optionsMap:{}};let l=1;return o.options.push(...(n||[]).map(a=>({id:a.id,email:a.email,display_name:a.display_name,deleted:a.deleted,order:l++,meta:a.meta})).sort((a,i)=>a.order-i.order)),o.optionsMap=o.options.reduce((a,i)=>(i.id&&(a[i.id]=i),i.email&&(a[i.email.trim()]=i),a),{}),o},Pv=[ve.Rating,ve.Checkbox,ve.ID,ve.Rollup,ve.CreatedBy,ve.LastModifiedBy,ve.LastModifiedTime,ve.CreatedTime,ve.Formula],ms=[ve.SingleSelect,ve.MultiSelect,ve.User,ve.CreatedBy,ve.LastModifiedBy,ve.Checkbox,ve.Attachment,ve.Rating,ve.QrCode,ve.Barcode,ve.Lookup,ve.LinkToAnotherRecord,ve.Links],fl={SINGLE_CLICK:1,DOUBLE_CLICK:2,RIGHT_CLICK:"right"};function Pc(t){return t.button===2||t.ctrlKey&&t.button===0&&t.detail===1?fl.RIGHT_CLICK:t.button===0?t.detail===1?fl.SINGLE_CLICK:fl.DOUBLE_CLICK:null}const Bc=()=>{const{t}=Gp().global;Zt.toast(t("msg.info.computedFieldEditWarning"))},mu=new jp({max:500,ttl:1e3*60*60}),gu=(t,n)=>{if(!t)return{isValid:!1,format:""};const l=jn(n==null?void 0:n.meta).barcodeFormat||"CODE128",a=`${t}-${l}`,i=mu.get(a);if(i!==void 0)return i;try{const r=document.createElement("canvas");Up(r,t.toString(),{format:l,displayValue:!1,lineColor:"#000000",margin:0});const s={isValid:!0,format:l};return mu.set(a,s),s}catch{const s={isValid:!1,format:l};return mu.set(a,s),s}},Fo=32,Fk=1,Wu=100,lr=60,wd=[ve.SingleSelect,ve.MultiSelect,ve.User,ve.Links],Wc=80,zc=4,To=48,ia=0,li=12,On=36;class Ak{constructor(n,o,l,a,i,r){vo(this,"api");vo(this,"loadAutomation");vo(this,"generateRows");vo(this,"triggerRefreshCanvas");vo(this,"meta");vo(this,"getDataCache");vo(this,"loadingColumns",new Map);vo(this,"afterActionStatus",new Map);vo(this,"rafId",null);this.api=n,this.loadAutomation=o,this.generateRows=l,this.meta=a,this.triggerRefreshCanvas=i,this.getDataCache=r}getKey(n,o){return`${n}-${o}`}async executeAction(n,o,l=[],a){const i=Date.now(),r=Array.isArray(n)?n:[n];r.forEach(u=>{this.loadingColumns.set(this.getKey(u,o),i),this.afterActionStatus.delete(this.getKey(u,o)),l.forEach(c=>{this.loadingColumns.set(this.getKey(u,c),i),this.afterActionStatus.delete(this.getKey(u,o))})}),this.startAnimationLoop();let s=!1;try{const u=await a();return r.forEach(c=>{this.afterActionStatus.set(this.getKey(c,o),{status:"success"}),l.forEach(f=>{this.afterActionStatus.set(this.getKey(c,f),{status:"success"})})}),u}catch(u){s=!0;const c=await hl(u);throw r.forEach(f=>{this.afterActionStatus.set(this.getKey(f,o),{status:"error",tooltip:c??"Something went wrong"}),l.forEach(v=>{this.afterActionStatus.set(this.getKey(f,v),{status:"error",tooltip:c??"Something went wrong"})})}),u}finally{r.forEach(u=>{this.loadingColumns.delete(this.getKey(u,o)),l.forEach(c=>{this.loadingColumns.delete(this.getKey(u,c))})}),Cf(s?3e3:2e3).then(()=>{r.forEach(u=>{this.afterActionStatus.delete(this.getKey(u,o)),l.forEach(c=>{this.afterActionStatus.delete(this.getKey(u,c))})})})}}startAnimationLoop(){if(this.rafId===null&&(this.loadingColumns.size>0||this.afterActionStatus.size>0)){let n=null,o=!1;const l=()=>{(this.loadingColumns.size>0||this.afterActionStatus.size>0)&&n&&(clearTimeout(n),n=null,o=!1),this.loadingColumns.size>0||this.afterActionStatus.size>0?(this.triggerRefreshCanvas(),this.rafId=requestAnimationFrame(l)):o||(o=!0,this.triggerRefreshCanvas(),n=window.setTimeout(()=>{this.rafId&&(cancelAnimationFrame(this.rafId),this.rafId=null),n=null,o=!1},1e3),this.rafId=requestAnimationFrame(()=>{this.triggerRefreshCanvas()}))};this.rafId=requestAnimationFrame(l)}}handleUrl(n,o,l){o=ts(o);try{o=decodeURI(o)===o?encodeURI(o):o}catch{o=encodeURI(o)}o&&Zs(o,"_blank",l)}async executeButtonAction(n,o,l){var s,u,c,f,v,p;const a=o==null?void 0:o.columnObj.colOptions;if(!a)return;l.path||(l.path=[]);const{cachedRows:i}=this.getDataCache(l.path);if((s=o.isInvalidColumn)!=null&&s.isInvalid)return;l!=null&&l.isAiPromptCol&&(a.type="ai");const{runScript:r}=Ps();try{switch(a.type){case"url":{const g=(f=(c=(u=l==null?void 0:l.row)==null?void 0:u[0])==null?void 0:c.row)==null?void 0:f[o.columnObj.title];this.handleUrl(a,((v=g==null?void 0:g.url)==null?void 0:v.toString())??"",l.allowLocalUrl);break}case"webhook":{const g=a.fk_webhook_id;if(!g)throw new Error("No webhook configured");for(const y of n)await this.executeAction(y,o.id,[],async()=>{await this.api.dbTableWebhook.trigger(g,y)});break}case"script":{const g=await this.loadAutomation(a.fk_script_id);for(let y=0;y<n.length;y++)this.executeAction(n[y],o.id,[],async()=>{var x;await r(g,(x=l==null?void 0:l.row)==null?void 0:x[y],{pk:n[y],fieldId:o.columnObj.id})});break}case"ai":{const g=l!=null&&l.isAiPromptCol?[o.id]:((p=a.output_column_ids)==null?void 0:p.split(",").filter(Boolean))||[],y=g.map(x=>{var w;return(w=this.meta.value)==null?void 0:w.columnsById[x]});await this.executeAction(n,o.id,g,async()=>{var w,m,C,b,S,k;const x=await this.generateRows(o.id,n);if(x!=null&&x.length)for(let D=0;D<x.length;D++){const F=i.value.get((C=(m=(w=l==null?void 0:l.row)==null?void 0:w[D])==null?void 0:m.rowMeta)==null?void 0:C.rowIndex);if(F){const I=x[D];for(const M of y)F.row[M.title]=I[M.title];i.value.set((k=(S=(b=l==null?void 0:l.row)==null?void 0:b[D])==null?void 0:S.rowMeta)==null?void 0:k.rowIndex,F)}}});break}}}catch(g){console.error("Error executing button action",g)}}isLoading(n,o){return this.loadingColumns.has(this.getKey(n,o))}getLoadingStartTime(n,o){return this.loadingColumns.get(this.getKey(n,o))??null}getAfterActionStatus(n,o){return this.afterActionStatus.get(this.getKey(n,o))}clear(){this.loadingColumns.clear()}}const Bv={render:(t,n)=>{var y;const{value:o,x:l,y:a,width:i,height:r,selected:s,pv:u,padding:c,textColor:f="#4a5268",setCursor:v}=n,p=(o==null?void 0:o.toString())??"";if(!p)return{x:l,y:a};const g=p&&oc(p);if((y=n.tag)!=null&&y.renderAsTag)return Il(t,{...n,text:p});{const{x,y:w}=gl(t,{x:l+c,y:a,text:p,maxWidth:i-c*2,fontFamily:`${u?600:500} 13px Inter`,fillStyle:g&&s||u?"#3366FF":f,underline:g,height:r}),m=Pt({x:l+c,y:a+c,width:x-l-c,height:w-a},n.mousePosition);return s&&m&&g&&v("pointer"),{x,y:w}}},async handleKeyDown(t){var r;const{e:n,row:o,column:l,makeCellEditable:a}=t;if(l.readonly||(r=l.columnObj)!=null&&r.readonly)return;const i=l.columnObj;return n.key.length===1&&i.title?(o.row[i.title]="",a(o,l),!0):!1},async handleClick({value:t,row:n,column:o,selected:l,isDoubleClick:a,getCellPosition:i,mousePosition:r}){if(!n||!o||!l&&!a)return!1;const{x:s,y:u,width:c,height:f}=i(o,n.rowMeta.rowIndex),v=10,p=(t==null?void 0:t.toString())??"";if(!(p&&oc(p)))return!1;const y=o.pv,x=$l,{x:w,y:m}=gl(x,{x:s+v,y:u+v,text:p,maxWidth:c-v*2,fontFamily:`${y?600:500} 13px Inter`,height:f,render:!1});return Pt({x:s,y:u,width:w-s,height:m-u},r)?(window.open(`mailto:${p}`,"_blank"),!0):!1}},pr={render:(t,n)=>{var v;const{value:o,x:l,y:a,width:i,height:r,pv:s,padding:u,textColor:c="#4a5268"}=n,f=(Array.isArray(o)?o.join(","):o==null?void 0:o.toString())??"";if(!f)return{x:l,y:a};if((v=n.tag)!=null&&v.renderAsTag)return Il(t,{...n,text:f});{const{x:p,y:g}=gl(t,{x:l+u,y:a,text:f,maxWidth:i-u*2,fontFamily:`${s?600:500} 13px Inter`,fillStyle:s?"#3366FF":c,height:r});return{x:p,y:g}}},async handleKeyDown(t){var r;const{e:n,row:o,column:l,makeCellEditable:a}=t;if(l.readonly||(r=l.columnObj)!=null&&r.readonly)return;const i=l.columnObj;return n.key.length===1&&i.title?(o.row[i.title]="",a(o,l),!0):!1}},ul=Hp("tooltip",()=>{const t=V("top"),n=V(""),o=V({x:0,y:0,top:0,left:0,bottom:0,right:0,width:0,height:0}),l=()=>{n.value=""},a=ue(()=>{const s=o.value;return{getBoundingClientRect(){return s}}});function i({text:s,rect:u,placement:c="top"}){var g;if(!s)return;let f=0,v=0;const p=(g=document.querySelector("canvas"))==null?void 0:g.getBoundingClientRect();p&&(f=p.x,v=p.y),u.x+=f,u.y+=v,n.value=s,t.value=c,o.value={x:u.x,y:u.y,left:u.x,top:u.y,right:u.x+(u.targetWidth||u.width),bottom:u.y+u.height,width:u.targetWidth||u.width,height:u.height}}function r({text:s,description:u,rect:c,mousePosition:f,placement:v}){if(!c||!Pt(c,f)||!s)return!1;const p=Ii(s)&&u?ta("div",{class:"flex flex-col gap-1"},[ta("div",{class:"text-captionBold"},s),ta("div",{class:"text-captionSm"},u)]):s;return i({text:p,rect:c,placement:v}),!0}return{targetReference:a,tooltipText:n,placement:t,tryShowTooltip:r,showTooltip:i,hideTooltip:l}}),Wv=({ctx:t,width:n,label:o="Generate",hasIcon:l})=>{t||(t=$l);const a=12,i=24,r=32,s=14,u=6,c=n-8;let f=0;t.font="500 13px Inter";const v=c-a*2-(s+u),p=Hl(t,o,v,!0),g=p.text,y=p.width;return f+=y,f+=s,f+=u,{buttonWidth:Math.min(c,Math.max(r,f+a*2)),buttonHeight:i,contentWidth:f,truncatedLabel:g,iconSize:s,iconSpacing:u,horizontalPadding:a}},Ek=(t,{x:n,y:o,width:l,disabled:a,mousePosition:i,spriteLoader:r,loadingStartTime:s,isLoading:u,setCursor:c})=>{const f=Wv({ctx:t,width:l,hasIcon:!0}),v=n+(l-f.buttonWidth)/2,p=o+4;a=a||u;const g=!a&&i&&i.x>=v&&i.x<=v+f.buttonWidth&&i.y>=p&&i.y<=p+f.buttonHeight;g&&c("pointer");const y={background:a?"#F4F4F5":g?"#E5D4F5":"#F3ECFA",text:a?"#9AA2AF":"#7D26CD",loader:"#7D26CD"};t.beginPath(),t.roundRect(v,p,f.buttonWidth,f.buttonHeight,6),t.fillStyle=y.background,t.fill();let x=v+(f.buttonWidth-f.contentWidth)/2;const w=p+(f.buttonHeight-f.iconSize)/2;return u&&s?(ed(t,x,w,f.iconSize,y.loader,s,1.5),x+=f.iconSize+f.iconSpacing):r&&(r.renderIcon(t,{icon:"ncAutoAwesome",size:f.iconSize,x,y:w,color:y.text}),x+=f.iconSize+f.iconSpacing),t.fillStyle=y.text,t.textBaseline="middle",t.fillText(f.truncatedLabel,x,p+13),{buttonBounds:{x:v,y:p,width:f.buttonWidth,height:f.buttonHeight}}},mi={render:(t,n)=>{const{value:o,x:l,y:a,width:i,height:r,spriteLoader:s,disabled:u,padding:c,mousePosition:f,actionManager:v,pk:p,column:g}=n,y=Pt({x:l,y:a,width:i,height:r},f),x=12;if(!o){const w=u==null?void 0:u.isInvalid,m=i-x*2,C=v.isLoading(p,g.id),b=v.getLoadingStartTime(p,g.id),{buttonBounds:S}=Ek(t,{x:l+(i-m)/2,y:a,width:m,disabled:w,mousePosition:f,spriteLoader:s,isLoading:C,loadingStartTime:b,setCursor:n.setCursor});return{x:S.x+S.width,y:S.y+S.height}}if(o!=null&&o.value){const{x:w,y:m}=gl(t,{x:l+c,y:a,text:o.value,maxWidth:i-c*2,fillStyle:"#4a5268",height:r});return y&&(oa(t,{buttonX:l+i-28,buttonY:a+7,buttonSize:18,borderRadius:3,iconData:{size:13,xOffset:5/2,yOffset:5/2},mousePosition:f,spriteLoader:s,icon:"maximize"}),oa(t,{buttonX:l+i-52,buttonY:a+7,buttonSize:18,borderRadius:3,iconData:{size:13,xOffset:5/2,yOffset:5/2},mousePosition:f,spriteLoader:s,icon:"refresh"})),{x:w,y:m}}return{x:l,y:a}},async handleClick({mousePosition:t,column:n,row:o,value:l,pk:a,actionManager:i,getCellPosition:r,makeCellEditable:s,path:u}){var p,g;if(!o||!(n!=null&&n.id)||!t)return!1;const{x:c,y:f,width:v}=r(n,o.rowMeta.rowIndex)||((p=n==null?void 0:n.isInvalidColumn)==null?void 0:p.isInvalid);if((g=n==null?void 0:n.isInvalidColumn)!=null&&g.isInvalid&&Pt({x:c+v-52,y:f+7,width:18,height:18},t))return!0;if(Pt({x:c+v-28,y:f+7,width:18,height:18},t)||Pt({x:c+v-52,y:f+7,width:18,height:18},t))return s(o,n),!0;if(!l||!(l!=null&&l.value)){const{buttonWidth:y}=Wv({width:v,hasIcon:!0}),x={x:c+(v-y)/2,y:f+4,width:y,height:24};return Pt(x,t)?(await i.executeButtonAction([a],n,{row:[o],isAiPromptCol:!0,path:u}),!0):!1}return!1},async handleHover({row:t,column:n,mousePosition:o,getCellPosition:l,t:a}){var p;const{tryShowTooltip:i,hideTooltip:r}=ul();if(r(),!t||!(n!=null&&n.id)||!o||(p=n==null?void 0:n.isInvalidColumn)!=null&&p.isInvalid)return;const{x:s,y:u,width:c}=l(n,t.rowMeta.rowIndex),f={x:s+c-28,y:u+7,width:18,height:18},v={x:s+c-52,y:u+7,width:18,height:18};i({text:a("title.expand"),rect:f,mousePosition:o}),i({text:"Re-generate",rect:v,mousePosition:o})},async handleKeyDown(t){var c;const{e:n,row:o,column:l,makeCellEditable:a,value:i,pk:r,actionManager:s,path:u}=t;return l.readonly||(c=l.columnObj)!=null&&c.readonly?!1:!(i!=null&&i.value)&&n.key==="Enter"?(s.executeButtonAction([r],l,{row:[o],isAiPromptCol:!0,path:u}),!0):n.key.length===1?(a(o,l),!0):!1}},Mk={render:(t,n)=>{var b,S,k,D,F,I;if(ba(n.column)){mi.render(t,n);return}const o=(S=(b=n.column)==null?void 0:b.meta)==null?void 0:S.richMode,{value:l,x:a,y:i,width:r,height:s,pv:u,padding:c,textColor:f="#4a5268",mousePosition:v,spriteLoader:p,setCursor:g,selected:y,baseUsers:x,user:w}=n,m=(l==null?void 0:l.toString())??"",C=()=>{oa(t,{buttonX:a+r-28,buttonY:i+7,buttonSize:20,borderRadius:6,iconData:{size:12,xOffset:4,yOffset:4},mousePosition:v,spriteLoader:p,icon:"maximize",background:"white",setCursor:g})};if(!m)return!((k=n.tag)!=null&&k.renderAsTag)&&y&&C(),{x:a,y:i};if((D=n.tag)!=null&&D.renderAsTag)return Il(t,{...n,text:m,renderAsMarkdown:o});if(o){t.save(),t.beginPath(),t.rect(a,i,r-c,s),t.clip();const{x:M,y:A}=Yp(t,{x:a+c,y:i,text:m,maxWidth:r-c*2,fontFamily:`${u?600:500} 13px Inter`,fillStyle:u?"#3366FF":f,height:s,mousePosition:v,cellRenderStore:n.cellRenderStore,selected:y,baseUsers:x,user:w});return t.restore(),!((F=n.tag)!=null&&F.renderAsTag)&&y&&C(),{x:M,y:A}}else{const{x:M,y:A}=gl(t,{x:a+c,y:i,text:m,maxWidth:r-c*2,fontFamily:`${u?600:500} 13px Inter`,fillStyle:u?"#3366FF":f,height:s,cellRenderStore:n.cellRenderStore});return!((I=n.tag)!=null&&I.renderAsTag)&&y&&C(),{x:M,y:A}}},handleClick:async t=>{var f,v;const{column:n,getCellPosition:o,row:l,mousePosition:a,makeCellEditable:i,cellRenderStore:r,isDoubleClick:s,selected:u}=t;if(!u&&!s)return!1;if((v=(f=n.columnObj)==null?void 0:f.meta)==null?void 0:v.richMode){const p=(r==null?void 0:r.links)||[];for(const g of p)if(Pt(g,a))return Zs(g.url,"_blank"),!0}if(ba(n==null?void 0:n.columnObj))return mi.handleClick(t);{const{x:p,y:g,width:y,height:x}=o(n,l.rowMeta.rowIndex);return Pt({x:p+y-28,y:g+7,width:18,height:18},a)?(i(l,n),!0):(s&&Pt({x:p,y:g,width:y,height:x},a)&&i(l,n),!1)}},async handleKeyDown(t){var r;const{e:n,row:o,column:l,makeCellEditable:a}=t,i=l==null?void 0:l.columnObj;if(ba(i))return(r=mi.handleKeyDown)==null?void 0:r.call(mi,t);if(Rr(n))return a(o,l),!0;if(!(l.readonly||i!=null&&i.readonly))return n.key.length===1&&i.title?(o.row[i.title]==="<br />"||o.row[i.title]==="<br>"?o.row[i.title]=n.key:jn(i.meta).richMode&&(o.row[i.title]=o.row[i.title]?o.row[i.title]+n.key:n.key),a(o,l),!0):!1},handleHover:async t=>{var v,p,g;const{row:n,column:o,value:l,mousePosition:a,getCellPosition:i,cellRenderStore:r,setCursor:s,selected:u,t:c}=t;if(!u&&!ba(o==null?void 0:o.columnObj))return;if((p=(v=o.columnObj)==null?void 0:v.meta)==null?void 0:p.richMode){const y=(r==null?void 0:r.links)||[];let x=!1;for(const w of y)if(Pt(w,a)){x=!0;break}if(x){s("pointer");return}}if(ba(o==null?void 0:o.columnObj))(g=mi.handleHover)==null||g.call(mi,t);else{const{tryShowTooltip:y,hideTooltip:x}=ul();x();const w=(l==null?void 0:l.toString())??"";if(!n||!(o!=null&&o.id)||!a||!w)return;const{x:m,y:C,width:b}=i(o,n.rowMeta.rowIndex),S={x:m+b-28,y:C+7,width:18,height:18};y({rect:S,mousePosition:a,text:c("tooltip.expandShiftSpace")})}}},zv={render:(t,n)=>{var g;const{value:o,x:l,y:a,width:i,height:r,pv:s,padding:u,textColor:c="#4a5268",column:f}=n,v=qp(o,f);if(!sa(v))return{x:l,y:a};const p=v.toString();if((g=n.tag)!=null&&g.renderAsTag)return Il(t,{...n,text:p});{const{x:y,y:x}=Qn(t,{x:l+i-u,y:a,textAlign:"right",text:p,maxWidth:i-u*2,fontFamily:`${s?600:500} 13px Inter`,fillStyle:s?"#3366FF":c,height:r});return{x:y,y:x}}},async handleKeyDown(t){var r;const{e:n,row:o,column:l,makeCellEditable:a}=t;if(l.readonly||(r=l.columnObj)!=null&&r.readonly)return;const i=l.columnObj;return/^[0-9]$/.test(n.key)&&i.title?(o.row[i.title]="",a(o,l),!0):!1}},Vv={render:(t,n)=>{var y;const{column:o,value:l,x:a,y:i,width:r,height:s,pv:u,padding:c,textColor:f="#4a5268"}=n;let v=null;const p=jn(o==null?void 0:o.meta);l!==null&&!isNaN(Number(l))&&(p.isLocaleString?v=Number(Au(Number(l),p.precision??1)).toLocaleString(void 0,{minimumFractionDigits:p.precision??1,maximumFractionDigits:p.precision??1}):v=Au(Number(l),p.precision??1));const g=(v==null?void 0:v.toString())??"";if(!sa(g))return{x:a,y:i};if((y=n.tag)!=null&&y.renderAsTag)return Il(t,{...n,text:g});{const{x,y:w}=Qn(t,{x:a+r-c,y:i,text:g,textAlign:"right",maxWidth:r-c*2,fontFamily:`${u?600:500} 13px Inter`,fillStyle:u?"#3366FF":f,height:s});return{x,y:w}}},async handleKeyDown(t){var r;const{e:n,row:o,column:l,makeCellEditable:a}=t;if(l.readonly||(r=l.columnObj)!=null&&r.readonly)return;const i=l.columnObj;return/^[0-9]$/.test(n.key)&&i.title?(o.row[i.title]=null,a(o,l),!0):!1}};function Tk(t,n){return Is(t??"",n)?"ncFileTypeImage":vm(t??"",n)?"ncFileTypePdf":pm(t??"",n)?"ncFileTypeVideo":hm(t??"",n)?"ncFileTypeAudio":mm(t??"")?"ncFileTypeWord":gm(t??"")?"ncFileTypeCsv":wm(t??"")?"ncFileTypePresentation":ym(t??"")?"ncFileTypeZip":"ncFileTypeUnknown"}function wu(t){switch(t){case 1:case 2:return"tiny";case 4:case 6:return"small";default:return"tiny"}}function Is(t,n){return(n==null?void 0:n.includes("image/"))||(t==null?void 0:t.match(/\.(jpg|jpeg|png|gif|webp)$/i))}function yu(t,{itemX:n,itemY:o,itemSize:l,spriteLoader:a,ctx:i}){const r=Tk(t.title,t.mimetype||t.type);i.beginPath(),i.roundRect(n,o,l,l,4),i.strokeStyle="#D5D5D9",i.lineWidth=1,i.stroke(),a.renderIcon(i,{icon:r,x:n,y:o,size:l,color:"#6b7280"})}const $k={render:(t,{value:n,x:o,y:l,width:a,height:i,imageLoader:r,mousePosition:s,spriteLoader:u,selected:c,readonly:f,setCursor:v,isUnderLookup:p,textAlign:g})=>{let y=[];const x=ns[i],w=x===1?4:8;try{y=(typeof n=="string"?JSON.parse(n):n)||[]}catch{y=[]}if(f&&!y.length)return;if(c&&y.length===0){const ae=o+(a-96)/2,he=l+w,ye=Pt({x:ae,y:he,width:96,height:24},s);ye&&v("pointer"),Yo(t,ae,he,96,24,8,{backgroundColor:ye?"#f4f4f5":"white",borderColor:"#E7E7E9",borderWidth:2}),u.renderIcon(t,{icon:"upload",x:ae+8,y:he+10/2,size:14,color:"#6a7184"}),t.fillStyle="#374151",t.font="500 11px Inter",t.textBaseline="middle",t.fillText("Add File(s)",ae+28,he+26/2);return}const{getPossibleAttachmentSrc:m}=Ri(),C=10,b=x===1?24:x===2?32:64,S=8,k=Pt({x:o,y:l,width:a,height:i},s),D=Math.floor((a-C*2+S)/(b+S)),F=y.length,I=F%D||D,A=Math.floor((i-w*2+S)/(b+S))*D;let j=o;if(y.slice(0,A).forEach((N,Y)=>{if(!N)return;const ae=Math.floor(Y/D),he=Y%D,re=ae===Math.floor((F-1)/D)?I:D,me=re*b+(re-1)*S,U=(p&&g!=="center"?o+C:o+C+Math.max(0,(a-C*2-me)/2))+he*(b+S),Ae=l+w+ae*(b+S);if(Is(N.title,N.mimetype||N.type)){const je=wu(x),Ue=m(N,je);if(!(Ue!=null&&Ue.length)){yu(N,{itemX:U,itemY:Ae,itemSize:b,spriteLoader:u,ctx:t});return}const ot=r.loadOrGetImage(Ue);ot?(t.strokeStyle="#D5D5D9",t.lineWidth=1,r.renderImage(t,ot,U,Ae,b,b,4,{border:!0,borderColor:"#D5D5D9",borderWidth:1},"contain")):yu(N,{itemX:U,itemY:Ae,itemSize:b,spriteLoader:u,ctx:t})}else yu(N,{itemX:U,itemY:Ae,itemSize:b,spriteLoader:u,ctx:t});j=U+b,!p&&c&&Pt({x:U,y:Ae,width:b,height:b},s)&&v("pointer")}),p)return{x:j,y:l+b};if(!p&&k&&c&&y.length>0){const N=l+6;if(oa(t,{buttonX:o+a-30,buttonY:N,buttonSize:20,borderRadius:6,iconData:{size:12,xOffset:4,yOffset:4},mousePosition:s,spriteLoader:u,icon:"maximize",setCursor:v}),f)return;oa(t,{buttonX:o+11,buttonY:N,buttonSize:20,borderRadius:6,iconData:{size:12,xOffset:4,yOffset:4},mousePosition:s,spriteLoader:u,icon:"ncPaperclip",setCursor:v})}},async handleHover({row:t,column:n,mousePosition:o,getCellPosition:l,value:a,selected:i,imageLoader:r,t:s}){const{tryShowTooltip:u,hideTooltip:c}=ul();if(c(),!t||!(n!=null&&n.id)||!o||!i)return;const{x:f,y:v,width:p,height:g}=l(n,t.rowMeta.rowIndex);let y=[];try{y=(typeof a=="string"?JSON.parse(a):a)||[]}catch{y=[]}if(i&&y.length===0)return;if(y.length){const N=v+5,Y={x:f+p-30,y:N,width:18,height:18},ae={x:f+11,y:N,width:18,height:18};if(u({rect:Y,text:`${s("activity.viewAttachment")} '${s("tooltip.shiftSpace")}'`,mousePosition:o})||u({rect:ae,text:s("activity.addFiles"),mousePosition:o}))return}const x=ns[g]??1,{getPossibleAttachmentSrc:w}=Ri(),m=10,C=x===1?4:8,b=x===1?24:x===2?32:64,S=8,k=Math.floor((p-m*2+S)/(b+S)),F=y.length%k||k,M=Math.floor((g-C*2+S)/(b+S))*k,A=[];y.slice(0,M).forEach((N,Y)=>{var je;if(!N)return;const ae=Math.floor(Y/k),he=Y%k,re=ae===Math.floor((Y+1)/k)?F:k,me=re*b+(re-1)*S,U=f+m+(p-m*2-me)/2+he*(b+S),Ae=v+C+ae*(b+S);if(Is(N.title,N.mimetype||N.type)){const Ue=wu(x),ot=(je=w(N,Ue))==null?void 0:je[0];if(!ot)return;r.loadOrGetImage(ot)&&A.push({x:U,y:Ae,width:b,height:b,title:N.title??ot,size:N.size??0,mimetype:N.mimetype??""})}else N.title&&A.push({x:U,y:Ae,width:b,height:b,title:N.title,size:N.size??0,mimetype:N.mimetype??""})});const j=A.find(N=>Pt(N,o));u({rect:j,text:ta("div",[(j==null?void 0:j.title)??"",ta("div",{class:"flex items-center justify-between mt-2 text-tiny text-gray-200"},[ta("div",Xp(j==null?void 0:j.mimetype)),ta("div",Kp(j==null?void 0:j.size))])]),mousePosition:o})},async handleKeyDown({row:t,column:n,e:o,makeCellEditable:l}){return o.key==="Enter"||Rr(o)?(l(t,n),!0):!1},async handleClick({row:t,column:n,mousePosition:o,getCellPosition:l,value:a,selected:i,imageLoader:r,makeCellEditable:s}){const{hideTooltip:u}=ul();if(u(),!i)return!1;const c=()=>s(t,n),{x:f,y:v,width:p,height:g}=l(n,t.rowMeta.rowIndex);let y=[];try{y=(typeof a=="string"?JSON.parse(a):a)||[]}catch{y=[]}if(i&&y.length===0){const re=f+(p-84)/2,me=v+3;if(Pt({x:re,y:me,width:84,height:24},o))return c(),!0}const x=ns[g]??1,{getPossibleAttachmentSrc:w}=Ri(),m=10,C=x===1?4:8,b=x===1?24:x===2?32:64,S=8,k=Math.floor((p-m*2+S)/(b+S)),F=y.length%k||k,M=Math.floor((g-C*2+S)/(b+S))*k,A=[];if(y.slice(0,M).forEach((he,ye)=>{var G;if(!he)return;const re=Math.floor(ye/k),me=ye%k,U=re===Math.floor((ye+1)/k)?F:k,Ae=U*b+(U-1)*S,Ue=f+m+(p-m*2-Ae)/2+me*(b+S),ot=v+C+re*(b+S);if(Is(he.title,he.mimetype||he.type)){const pe=wu(x),ne=(G=w(he,pe))==null?void 0:G[0];if(!ne)return;r.loadOrGetImage(ne)&&A.push({x:Ue,y:ot,width:b,height:b,title:he.title??ne})}else he.title&&A.push({x:Ue,y:ot,width:b,height:b,title:he.title})}),A.find(he=>Pt(he,o)))return c(),!0;if(!y.length)return!1;const N=v+5,Y={x:f+p-30,y:N,width:18,height:18},ae={x:f+11,y:N,width:18,height:18};return Pt(Y,o)||Pt(ae,o)?(c(),!0):!1}},jv={render:(t,{value:n,x:o,y:l,width:a,height:i,readonly:r,column:s,spriteLoader:u,tag:c={},mousePosition:f,setCursor:v,isUnderLookup:p,selected:g,isRowHovered:y})=>{const x=Pt({x:o,y:l,width:a,height:i},f);i=Bo[1];const{renderAsTag:w,tagPaddingX:m=6,tagHeight:C=20,tagRadius:b=6,tagBgColor:S="#f4f4f0",tagSpacing:k=4,tagBorderColor:D,tagBorderWidth:F}=c,I=tv(n),M={color:"primary",...jn(s.meta),icon:Jp((s==null?void 0:s.meta)??{})};if(!(!y&&!g&&!I&&!w)&&!((y||g)&&!I&&r&&!w))if(w){const A=14+m*2,j=l+i/2-C/2;return ga(t,{x:o+k,y:j,width:A,height:C,radius:b,fillStyle:S,borderColor:D,borderWidth:F}),(I||p)&&u.renderIcon(t,{icon:I?M.icon.checked:M.icon.unchecked,size:14,x:o+A/2-4,y:j+3,color:M.color}),{x:o+A+8,y:l+C}}else{const A=Pt({x:o+a/2-7,y:l+i/2-7,width:14,height:14},f);(A||g&&x)&&!r&&v("pointer"),u.renderIcon(t,{icon:I?M.icon.checked:M.icon.unchecked,size:14,x:o+a/2-7,y:l+i/2-7,color:M.color,alpha:I?1:A?.7:.3})}},async handleKeyDown(t){const{e:n,row:o,column:l,updateOrSaveRow:a,readonly:i}=t,r=l.columnObj;if(!(l.readonly||i||!(l!=null&&l.isCellEditable)))return n.key==="Enter"?(o.row[r.title]=!o.row[r.title],await a(o,r.title,void 0,void 0,void 0,t.path),!0):!1},async handleClick(t){const{row:n,column:o,updateOrSaveRow:l,getCellPosition:a,mousePosition:i,selected:r,readonly:s,formula:u}=t;if(o.readonly||s||u||!(o!=null&&o.isCellEditable))return!1;if(r)return n.row[o.title]=!n.row[o.title],await l(n,o.title,void 0,void 0,void 0,t.path),!0;const c=a(o,n.rowMeta.rowIndex);c.height=Bo[1];const f={x:c.x+c.width/2-7,y:c.y+c.height/2-8,width:14,height:14};return Pt(f,i)?(n.row[o.title]=!n.row[o.title],await l(n,o.title,void 0,void 0,void 0,t.path),!0):!1}},Vc="YYYY-MM-DD",Uv={render:(t,n)=>{var x,w;const{column:o,value:l,x:a,y:i,width:r,height:s,pv:u,padding:c,textColor:f="#4a5268",selected:v,readonly:p}=n,g=((x=jn(o==null?void 0:o.meta))==null?void 0:x.date_format)??Vc;let y="";if(!l&&v&&!p){t.fillStyle="#989FB1",t.font="400 13px Inter";const m=Math.max(i,36),C=Hl(t,g,r-c*2);return t.fillText(C,a+c,m+16),{x:a,y:m}}if(l){const m=il(/^\d+$/.test(l)?+l:l,Vc);if(m.isValid())y=m.format(g);else{const C=Qp(l);C&&(y=C.format(g))}}if(!y)return{x:a,y:i};if((w=n.tag)!=null&&w.renderAsTag)return Il(t,{...n,text:y});{const{x:m,y:C}=Qn(t,{x:a+c,y:i,text:y,maxWidth:r-c*2,fontFamily:`${u?600:500} 13px Inter`,fillStyle:u?"#3366FF":f,height:s});return{x:m,y:C}}},async handleClick(t){var g,y;const{row:n,column:o,makeCellEditable:l,getCellPosition:a,mousePosition:i,value:r,selected:s}=t;if(!s)return!1;const u=a(o,n.rowMeta.rowIndex),c=8,f=$l,v=((y=jn((g=o==null?void 0:o.columnObj)==null?void 0:g.meta))==null?void 0:y.date_format)??"YYYY-MM-DD";let p="";if(r){const x=il(/^\d+$/.test(r)?+r:r,v);x.isValid()&&(p=x.format(v))}else p=v,f.font="400 13px Inter";if(p){f.font=r?"500 13px Inter":"400 13px Inter";const x=f.measureText(p).width,w={x:u.x+c,y:u.y,width:Math.min(x,u.width-c*2),height:33};if(Pt(w,i))return l(n,o),!0}return!1},async handleKeyDown(t){var i;const{e:n,row:o,column:l,makeCellEditable:a}=t;return l.readonly||(i=l.columnObj)!=null&&i.readonly?!1:n.key.length===1?(a(o,l),!0):!1}};il.extend(eh);const Fs={render:(t,{value:n,x:o,y:l,width:a,selected:i,pv:r,column:s,padding:u,readonly:c})=>{var N,Y,ae;t.font=`${r?600:500} 13px Inter`,t.textBaseline="middle",t.textAlign="left";const f=jn(s==null?void 0:s.meta),v=(f==null?void 0:f.date_format)??"YYYY-MM-DD",p=(f==null?void 0:f.time_format)??"HH:mm",g=(N=s==null?void 0:s.extra)==null?void 0:N.timezone,y=(Y=s==null?void 0:s.extra)==null?void 0:Y.isDisplayTimezone,x=f==null?void 0:f.is12hrFormat,w=n&&il(n).isValid(),m=w&&y?t.measureText(g.abbreviation).width+8:0,b=a-u*3-m,S=Math.min(b*.6,110),k=Math.min(((ae=Nc[p])==null?void 0:ae[x?12:24])??80,b-S),D=l+16;if(!n&&i&&!c){t.fillStyle="#989FB1",t.font="400 13px Inter";const he=Hl(t,v,S-u);t.fillText(he,o+u,D);const ye=Hl(t,p,k),re=o+S+u;t.fillText(ye,re,D);return}let F;if(w)if(g){const{timezonize:he}=Zp(g.name);F=he(il(n))}else F=il(n).utc().local();const I=(F==null?void 0:F.format(v))??"",M=Hl(t,I,S-4*2);t.fillStyle=r?"#3366FF":"#4a5268",t.fillText(M,o+u,D);const A=(F==null?void 0:F.format(x?Lc[p]:p))??"",j=Hl(t,A,k);if(t.fillText(j,o+S+u*2,D),m&&m>0){const he="#6A7184",ye=t.fillStyle,re=t.font;t.font=t.font="500 11px Inter",t.fillStyle=he,t.fillText(g.abbreviation,o+b+u*3.5,D),t.font=re,t.fillStyle=ye}},async handleClick(t){var b,S;const{row:n,column:o,makeCellEditable:l,getCellPosition:a,mousePosition:i,value:r,selected:s}=t,u=a(o,n.rowMeta.rowIndex),c=8;if(!s||o.readonly||Eu(o.uidt))return!1;const f=$l;f.font="500 13px Inter";const v=jn((b=o==null?void 0:o.columnObj)==null?void 0:b.meta),p=(v==null?void 0:v.date_format)??"YYYY-MM-DD",g=(v==null?void 0:v.time_format)??"HH:mm",y=v==null?void 0:v.is12hrFormat,x=Math.min(u.width*.6,110),w=((S=Nc[g])==null?void 0:S[y?12:24])??80;let m,C;if(r&&il(r).isValid()){const k=il(r).utc().local();m=k.format(p),C=k.format(y?Lc[g]:g)}else m=p,C=g,f.font="400 13px Inter";if(m){const k={x:u.x+c,y:u.y,width:Math.min(f.measureText(m).width,x-c*2),height:33};if(Pt(k,i))return l(n,o),!0}if(C){const k={x:u.x+x+c,y:u.y,width:Math.min(f.measureText(C).width,w-c*2),height:33};if(Pt(k,i))return l(n,o),!0}return!1},async handleKeyDown(t){const{e:n,row:o,column:l,makeCellEditable:a}=t;if(!(l.readonly||!(l!=null&&l.isCellEditable)||Eu(l.uidt)))return n.key.length===1?(a(o,l),!0):!1}},Ok={render:(t,n)=>{var g;const{selected:o,value:l,x:a,y:i,width:r,height:s,pv:u,padding:c,readonly:f,textColor:v="#4a5268"}=n;let p="";if(l){const y=il(l.toString(),"YYYY");y.isValid()&&(p=y.format("YYYY"))}if(!l&&o&&!f){t.fillStyle="#989FB1",t.font="400 13px Inter";const y=Math.max(i,36),x=Hl(t,"YYYY",r-c*2,!0);return t.fillText(x.text,a+c,y+16),{x:a,y}}if(!p)return{x:a,y:i};if((g=n.tag)!=null&&g.renderAsTag)return Il(t,{...n,text:p});{const{x:y,y:x}=Qn(t,{x:a+c,y:i,text:p,maxWidth:r-c*2,fontFamily:`${u?600:500} 13px Inter`,fillStyle:u?"#3366FF":v,height:s});return{x:y,y:x}}},async handleClick(t){var g;const{row:n,column:o,makeCellEditable:l,getCellPosition:a,mousePosition:i,value:r,selected:s}=t;if(!s||!((g=n==null?void 0:n.rowMeta)!=null&&g.rowIndex))return!1;const u=a(o,n.rowMeta.rowIndex),c=8,f=$l;let v=0;if(r){const y=il(r.toString(),"YYYY");if(y.isValid()){const x=y.format("YYYY");f.font="500 13px Inter",v=f.measureText(x).width}}else f.font="400 13px Inter",v=f.measureText("YYYY").width;const p={x:u.x+c,y:u.y,width:v,height:33};return Pt(p,i)?(l(n,o),!0):!1},async handleKeyDown(t){var i;const{e:n,row:o,column:l,makeCellEditable:a}=t;if(!(l.readonly||(i=l.columnObj)!=null&&i.readonly))return n.key.length===1?(a(o,l),!0):!1}},Gv={render:(t,n)=>{var x,w;const{column:o,selected:l,value:a,x:i,y:r,width:s,height:u,pv:c,padding:f,textColor:v="#4a5268",readonly:p}=n,g=(x=jn(o==null?void 0:o.meta))!=null&&x.is12hrFormat?"hh:mm A":"HH:mm";if(!a&&l&&!p){t.fillStyle="#989FB1",t.font="400 13px Inter";const m=Hl(t,g,s-f*2);return t.fillText(m,i+f,r+16),{x:i,y:r}}if(!a)return{x:i,y:r};const y=sm(a,o);if((w=n.tag)!=null&&w.renderAsTag)return Il(t,{...n,text:y});{const{x:m,y:C}=Qn(t,{x:i+f,y:r,text:y,maxWidth:s-f*2,fontFamily:`${c?600:500} 13px Inter`,fillStyle:c?"#3366FF":v,height:u});return{x:m,y:C}}},async handleClick(t){var g,y,x;const{row:n,column:o,makeCellEditable:l,getCellPosition:a,mousePosition:i,value:r,selected:s}=t;if(!s||!((g=n==null?void 0:n.rowMeta)!=null&&g.rowIndex))return!1;const u=a(o,n.rowMeta.rowIndex),c=8,f=$l,v=(x=jn((y=o==null?void 0:o.columnObj)==null?void 0:y.meta))!=null&&x.is12hrFormat?"hh:mm A":"HH:mm";let p="";if(r){f.font="500 13px Inter";let w=il(r);w.isValid()||(w=il(r,"HH:mm:ss")),w.isValid()||(w=il(`1999-01-01 ${r}`)),w.isValid()&&(p=w.format(v))}else p=v,f.font="400 13px Inter";if(p){const w=f.measureText(p).width,m={x:u.x+c,y:u.y,width:Math.min(w,u.width-c*2),height:33};if(Pt(m,i))return l(n,o),!0}return!1},async handleKeyDown(t){var i;const{e:n,row:o,column:l,makeCellEditable:a}=t;if(!(l.readonly||(i=l.columnObj)!=null&&i.readonly))return n.key.length===1?(a(o,l),!0):!1}},Hv={render:(t,n)=>{var g;const{column:o,value:l,x:a,y:i,width:r,height:s,pv:u,padding:c,textColor:f="#4a5268"}=n;if(!sa(l)||isNaN(l))return{x:a,y:i};const v={currency_locale:"en-US",currency_code:"USD",precision:2,...jn(o==null?void 0:o.meta)||{}};let p="";try{const y=Au(Number(l),v.precision??2);p=new Intl.NumberFormat(v.currency_locale||"en-US",{style:"currency",currency:v.currency_code||"USD",minimumFractionDigits:v.precision??2,maximumFractionDigits:v.precision??2}).format(y)}catch{p=l.toString()}if(Ai(l)||eu(l))return{x:a,y:i};if((g=n.tag)!=null&&g.renderAsTag)return Il(t,{...n,text:p});{const{x:y,y:x}=Qn(t,{x:a+r-c,y:i,textAlign:"right",text:p,maxWidth:r-c*2,fontFamily:`${u?600:500} 13px Inter`,fillStyle:u?"#3366FF":f,height:s});return{x:y,y:x}}},async handleKeyDown(t){var r;const{e:n,row:o,column:l,makeCellEditable:a}=t;if(l.readonly||(r=l.columnObj)!=null&&r.readonly)return!1;const i=l.columnObj;return/^[0-9]$/.test(n.key)&&i.title?(o.row[i.title]="",a(o,l),!0):!1}},Yv={render:(t,{value:n,x:o,y:l,width:a,height:i,pv:r,column:s,padding:u})=>{if(t.font=`${r?600:500} 13px Inter`,t.textBaseline="middle",t.textAlign="left",{is_progress:!1,...jn(s==null?void 0:s.meta)}.is_progress&&n!==null&&n!==void 0){const f=Math.min(100,Math.max(0,n)),v=4,p=l+14,g=(a-u*2)*(f/100);if(Yo(t,o+u,p,a-u*2,v,v/2,{backgroundColor:"#E5E5E5"}),f===0)return;Yo(t,o+u,p,g,v,v/2,{backgroundColor:"#3366FF"});return}t.fillStyle=r?"#3366FF":"#4a5268",Qn(t,{x:o+a-u,y:l,text:n!==null&&typeof n<"u"&&n!==""?`${n}%`:"",textAlign:"right",maxWidth:a-u*2,fontFamily:`${r?600:500} 13px Inter`,fillStyle:r?"#3366FF":"#4a5268",height:i})},async handleKeyDown(t){var r;const{e:n,row:o,column:l,makeCellEditable:a}=t;if(l.readonly||(r=l.columnObj)!=null&&r.readonly)return;const i=l.columnObj;return/^[0-9]$/.test(n.key)&&i.title?(o.row[i.title]="",a(o,l),!0):!1}},qv={render:(t,n)=>{var w;const{value:o,x:l,y:a,column:i,width:r,height:s,selected:u,pv:c,padding:f,textColor:v="#4a5268",spriteLoader:p,setCursor:g}=n,y=ts((o==null?void 0:o.toString())??"");if(!y)return{x:l,y:a};const x=y&&Cs(y);if((w=n.tag)!=null&&w.renderAsTag)return Il(t,{...n,text:y});{const C=jn(i==null?void 0:i.meta).validate,b=r-f*2-(C&&!x?20:0),{x:S,y:k}=gl(t,{x:l+f,y:a,text:y,maxWidth:b,fontFamily:`${c?600:500} 13px Inter`,fillStyle:x&&u||c?"#3366FF":v,underline:x,height:s}),D=Pt({x:l+f,y:a+f,width:S-l-f,height:k-a},n.mousePosition);if(u&&D&&x&&g("pointer"),C&&!x){const F=l+r-16-f;p.renderIcon(t,{icon:"ncInfo",size:16,color:Jn.red[400],x:F,y:a+(k-a)/2})}return{x:S&&S+(C&&!x?20:0),y:k}}},async handleHover({column:t,row:n,getCellPosition:o,value:l,mousePosition:a,selected:i,t:r}){const{x:s,y:u,width:c,height:f}=o(t,n.rowMeta.rowIndex),{tryShowTooltip:v,hideTooltip:p}=ul();if(p(),!i)return;const g=ts((l==null?void 0:l.toString())??"");if(g&&Cs(g)||!(g!=null&&g.length))return;const x=t.pv,w=$l,m=16,C=10,b=s+c-m-C,{y:S}=gl(w,{x:s+C,y:u,text:g,maxWidth:c-C*2,fontFamily:`${x?600:500} 13px Inter`,height:f,render:!1});if(jn(t.columnObj.meta).validate){const D={x:b,y:u+(S-u)/2,width:m,height:m};v({rect:D,text:r("msg.error.invalidURL"),mousePosition:a})}},async handleKeyDown(t){var r;const{e:n,row:o,column:l,makeCellEditable:a}=t;if(l.readonly||(r=l.columnObj)!=null&&r.readonly)return;const i=l.columnObj;return n.key.length===1&&i.title?(o.row[i.title]="",a(o,l),!0):!1},async handleClick({value:t,row:n,column:o,selected:l,isDoubleClick:a,getCellPosition:i,mousePosition:r}){if(!l&&!a)return!1;const{x:s,y:u,width:c,height:f}=i(o,n.rowMeta.rowIndex),v=10,p=ts((t==null?void 0:t.toString())??"");if(!(p&&Cs(p)))return!1;const y=o.pv,x=$l,{x:w,y:m}=gl(x,{x:s+v,y:u+v,text:p,maxWidth:c-v*2,fontFamily:`${y?600:500} 13px Inter`,height:f,render:!1});return Pt({x:s,y:u,width:w-s,height:m-u},r)?(Zs(p,"_blank"),!0):!1}},Dk={render:(t,{value:n,x:o,y:l,width:a,height:i,spriteLoader:r,pv:s,readonly:u,padding:c,mousePosition:f,selected:v,setCursor:p})=>{t.font=`${s?600:500} 13px Inter`,t.textBaseline="middle",t.textAlign="left";const[g,y]=(n||"").split(";"),x=!!(g&&y),w=x?`${g}; ${y}`:"Set location",C=ns[i]===1?4:8;if(!x&&!u&&v){const k=o+(a-100)/2,D=l+C,F=Pt({x:k,y:D,width:100,height:24},f);F&&p("pointer"),Yo(t,k,D,100,24,6,{backgroundColor:F?"#f4f4f5":"white",borderColor:"#E7E7E9",borderWidth:2}),r.renderIcon(t,{icon:"ncMapPin",x:k+8,y:D+8/2,size:14,color:"#6a7184"}),t.fillStyle="#374151",t.font="10px Inter",t.textBaseline="middle",t.fillText("Set location",k+28,D+26/2)}else if(x){const b=a-c*2;gl(t,{x:o+c,height:i,y:l,text:w,maxWidth:b,lineHeight:16,fillStyle:s?"#3366FF":"#4a5268"})}},async handleClick({row:t,column:n,mousePosition:o,getCellPosition:l,value:a,selected:i,makeCellEditable:r}){const{hideTooltip:s}=ul();s();const u=()=>r(t,n),{x:c,y:f,width:v}=l(n,t.rowMeta.rowIndex),[p,g]=(a||"").split(";");if(i&&!!!(p&&g)){const m=c+(v-84)/2,C=f+3;if(Pt({x:m,y:C,width:84,height:24},o))return u(),!0}return!1}},Xv={render:(t,n)=>{var y;const{value:o,x:l,y:a,width:i,height:r,pv:s,padding:u,textColor:c="#4a5268",selected:f,setCursor:v}=n,p=(o==null?void 0:o.toString())??"";if(!p)return{x:l,y:a};const g=p&&lc(p);if((y=n.tag)!=null&&y.renderAsTag)return Il(t,{...n,text:p});{const{x,y:w}=gl(t,{x:l+u,y:a,text:p,maxWidth:i-u*2,fontFamily:`${s?600:500} 13px Inter`,fillStyle:g&&f||s?"#3366FF":c,height:r,underline:g}),m=Pt({x:l+u,y:a+u,width:x-l-u,height:w-a},n.mousePosition);return f&&m&&g&&v("pointer"),{x,y:w}}},async handleKeyDown(t){var r;const{e:n,row:o,column:l,makeCellEditable:a}=t;if(l.readonly||(r=l.columnObj)!=null&&r.readonly)return;const i=l.columnObj;return n.key.length===1&&i.title?(o.row[i.title]="",a(o,l),!0):!1},async handleClick({value:t,row:n,column:o,selected:l,isDoubleClick:a,getCellPosition:i,mousePosition:r}){if(!n||!o||!l&&!a)return!1;const{x:s,y:u,width:c,height:f}=i(o,n.rowMeta.rowIndex),v=10,p=(t==null?void 0:t.toString())??"";if(!(p&&lc(p)))return!1;const y=o.pv,{x,y:w}=gl($l,{x:s+v,y:u+v,text:p,maxWidth:c-v*2,fontFamily:`${y?600:500} 13px Inter`,height:f,render:!1});return Pt({x:s,y:u,width:x-s,height:w-u},r)?(window.open(`tel:${p}`,"_blank"),!0):!1}},Lk={render:(t,n)=>{var g,y;const{column:o,value:l,x:a,y:i,width:r,height:s,pv:u,padding:c,textColor:f="#4a5268"}=n;if(!sa(l))return{x:a,y:i};const v=((g=jn(o==null?void 0:o.meta))==null?void 0:g.duration)||0,p=th(l,v);if((y=n.tag)!=null&&y.renderAsTag)return Il(t,{...n,text:p});{const{x,y:w}=Qn(t,{x:a+r-c,y:i,textAlign:"right",text:p,maxWidth:r-c*2,fontFamily:`${u?600:500} 13px Inter`,fillStyle:u?"#3366FF":f,height:s});return{x,y:w}}},async handleKeyDown(t){var r;const{e:n,row:o,column:l,makeCellEditable:a}=t;if(l.readonly||(r=l.columnObj)!=null&&r.readonly)return;const i=l.columnObj;return/^[0-9]$/.test(n.key)&&i.title?(o.row[i.title]="",a(o,l),!0):!1}},Nk={render:(t,n)=>{var w;const{value:o,x:l,y:a,width:i,height:r,pv:s,padding:u,textColor:c="#4a5268",mousePosition:f,spriteLoader:v,selected:p,setCursor:g}=n,y=()=>{p&&(oa(t,{buttonX:l+i-28,buttonY:a+7,buttonSize:20,borderRadius:6,iconData:{size:12,xOffset:4,yOffset:4},mousePosition:f,spriteLoader:v,icon:"maximize",background:"white",setCursor:g}),Pt({x:l+i-28,y:a+7,width:20,height:20},f)&&g("pointer"))};if(Ai(o)||eu(o))return y(),{x:l,y:a};let x=typeof o=="string"?o:JSON.stringify(o);if(typeof x=="string")try{JSON.parse(x)}catch{x=JSON.stringify(x)}if((w=n.tag)!=null&&w.renderAsTag)return Il(t,{...n,text:x});{const{x:m,y:C}=gl(t,{x:l+u,y:a,text:x,maxWidth:i-u*2,fontFamily:`${s?600:500} 13px Inter`,fillStyle:s?"#3366FF":c,height:r});return y(),{x:m,y:C}}},async handleKeyDown(t){const{e:n,row:o,column:l,makeCellEditable:a}=t;return l.columnObj.title&&(n.key.length===1||Rr(n))?(a(o,l),!0):!1},async handleClick({row:t,column:n,getCellPosition:o,mousePosition:l,makeCellEditable:a,selected:i}){var f;const r=(f=t==null?void 0:t.rowMeta)==null?void 0:f.rowIndex;if(typeof r!="number"||!i)return!1;const{x:s,y:u,width:c}=o(n,r);return Pt({x:s+c-28,y:u+7,height:20,width:20},l)?(a(t,n),!0):!1},async handleHover({row:t,column:n,mousePosition:o,getCellPosition:l,selected:a,t:i}){var p;const{tryShowTooltip:r,hideTooltip:s}=ul();if(s(),!t||!(n!=null&&n.id)||!o||(p=n==null?void 0:n.isInvalidColumn)!=null&&p.isInvalid||!a)return;const{x:u,y:c,width:f}=l(n,t.rowMeta.rowIndex),v={x:u+f-28,y:c+7,width:18,height:18};r({text:i("tooltip.expandShiftSpace"),rect:v,mousePosition:o})}},Pk={render:(t,n)=>{const{value:o,x:l,y:a,width:i,height:r,column:s,tag:u={},spriteLoader:c,cellRenderStore:f}=n,{renderAsTag:v}=u,p=nh(t,{x:l,y:a,width:i,height:r,column:s,value:(o??"").toString(),renderAsTag:v,spriteLoader:c});return p!=null&&p.startX&&Object.assign(f,{x:p.startX,y:p.startY,width:p.width,height:p.height}),p?{x:p.x,y:p.y}:void 0},async handleKeyDown(t){const{e:n,row:o,column:l,makeCellEditable:a,value:i}=t;return n.key==="Enter"?(gu(i,l.columnObj).isValid&&a(o,l),!0):!1},async handleHover({column:t,row:n,getCellPosition:o,value:l,mousePosition:a,t:i}){const{x:r,y:s,width:u}=o(t,n.rowMeta.rowIndex),{tryShowTooltip:c}=ul();if(!gu(l,t.columnObj).isValid){const v={x:r+u-23,y:s+9,width:16,height:16};c({rect:v,text:i("msg.warning.barcode.renderError"),mousePosition:a})}},async handleClick(t){const{row:n,column:o,makeCellEditable:l,value:a,isDoubleClick:i,selected:r,cellRenderStore:s,mousePosition:u}=t,{x:c,y:f,width:v,height:p}=s;let g=!1;return c&&f&&v&&p&&(g=r&&Pt({x:c,y:f,width:v,height:p},u)),i||g?(gu(a,o.columnObj).isValid&&l(n,o),!0):!1}},Bk={render:(t,{value:n,x:o,y:l,width:a,height:i,column:r,imageLoader:s,padding:u,tag:c={},cellRenderStore:f})=>{const{renderAsTag:v}=c;if(u=4,!n||n==="ERR!"){n==="ERR!"&&gl(t,{x:o+u,y:l,text:"ERR!",maxWidth:a-u*2,fontFamily:"500 13px Inter",fillStyle:"#e65100",height:i});return}const p=String(n);if(p.length>2e3){gl(t,{x:o+u,y:l,text:"Too many characters for a QR Code",maxWidth:a-u*2,fontFamily:"500 13px Inter",fillStyle:"#e65100",height:i});return}const y=jn(r==null?void 0:r.meta);let x;ns[i]===1?x=i-4:x=i-20;const w=Math.min(a-u*2,x),m=s.loadOrGetQR(p,w,{dark:y.dark,light:y.light});if(m){const C=v?o+u:o+(a-w)/2,b=l+(i-w)/2;return s.renderQRCode(t,m,C,b,w),v||Object.assign(f,{x:C,y:b,width:w,height:w}),{x:o+u+w,y:b*2}}else return s.renderPlaceholder(t,o+u,l+u,w,"qr_code"),{x:o+u+w,y:l+u+w}},async handleKeyDown(t){const{e:n,row:o,column:l,makeCellEditable:a}=t;return n.key==="Enter"?(a(o,l),!0):!1},async handleClick({row:t,column:n,mousePosition:o,makeCellEditable:l,cellRenderStore:a,selected:i,isDoubleClick:r}){if(!i||r)return!1;const{x:s,y:u,width:c,height:f}=a;return!s||!u||!c||!f?!1:Pt({x:s,y:u,width:c,height:f},o)?(l(t,n),!0):!1}};function jc({width:t,height:n,padding:o=10,x:l,y:a,column:i,value:r,selected:s,isRowHovered:u,readonly:c}){var M;const f=jn(i==null?void 0:i.meta).max??((M=as.getColumnDefaultMeta(ve.Rating))==null?void 0:M.max)??5,v=Math.min(Math.max(0,Number(r)||0),f),p={color:"#fcb401",...jn(i==null?void 0:i.meta),max:(Ai(s)&&Ai(u)||s||u)&&(Ai(c)||!c)?f:v,icon:oh(jn(i==null?void 0:i.meta))},g=14,y=1.5,x=2,w=t-o*2,m=l+o,C=a+o,b=g+y,S=Math.floor(w/b);if(S<1)return;const k=Math.floor((n-o)/(g+x)),D=S*k,F=Math.min(D,p.max),I=[];for(let A=0;A<F;A++){const j=Math.floor(A/S),N=A%S,Y=m+N*b,ae=C+j*(g+x);I.push({iconX:Y,iconY:ae})}return{iconPositions:I,iconSize:g,ratingMeta:p,startX:m,startY:C,rowSpacing:x,iconWidthWithSpacing:b,maxRows:k,iconsPerRow:S,iconsToShow:F,rating:v}}const Uc="#d9d9d9",Kv={render(t,n){const{value:o,x:l,y:a,width:i,height:r,column:s,spriteLoader:u,padding:c,mousePosition:f,readonly:v,tag:p={},setCursor:g,cellRenderStore:y,selected:x,isRowHovered:w}=n,{renderAsTag:m,tagPaddingX:C=6,tagHeight:b=20,tagRadius:S=6,tagBgColor:k="#f4f4f0",tagSpacing:D=4,tagBorderColor:F,tagBorderWidth:I}=p,M=jc({height:r,width:i,x:l,y:a,column:s,padding:c,selected:x,isRowHovered:w,value:o,readonly:v});if(!M)return;const{ratingMeta:A,startX:j,startY:N,iconSize:Y,rowSpacing:ae,iconWidthWithSpacing:he,maxRows:ye,iconsPerRow:re,iconsToShow:me,rating:W}=M;if(!w&&!x&&!W&&!m)return;if((w||x)&&!W&&v&&!m)return;const U=me<A.max;let Ae=-1;if(f&&!v){const{x:Ue,y:ot}=f,G=Ue-j,pe=ot-N,ne=Math.floor(pe/(Y+ae)),be=Math.floor(G/he);ne>=0&&ne<ye&&be>=0&&be<re&&G>=0&&pe>=0&&Ue<l+i&&ot<a+r&&(Ae=ne*re+be,Ae>=me&&(Ae=-1))}const je=he*me+C*2+(U?15:0);if(m){const Ue=a+r/2-b/2;ga(t,{x:l+D,y:Ue,width:je,height:b,radius:S,fillStyle:k,borderColor:F,borderWidth:I})}for(let Ue=0;Ue<me;Ue++){const ot=Math.floor(Ue/re),G=Ue%re,pe=Ue<W;let ne=Ae>=0&&Ue<=Ae;if(y&&y.ratingChanged){const{value:ee,hoverValue:H}=y.ratingChanged;Ae===H-1?ne=Ue+1<=ee:y.ratingChanged=void 0}let be;if(ne?(be=A.color,v||g("pointer")):be=Uc,Ae===-1&&(be=pe?A.color:Uc),ot<ye){const ee=j+G*he,H=N+ot*(Y+ae);u.renderIcon(t,{icon:pe||ne?A.icon.full:A.icon.empty,size:Y,x:ee,y:H,color:be})}}if(U&&ye>0){const Ue=Math.min(Math.floor((me-1)/re),ye-1),ot=(me-1)%re;t.font="500 13px Inter",t.fillStyle="#4a5268",t.textBaseline="middle",t.fillText("...",j+(ot+1)*he,N+Ue*(Y+ae)+Y/2)}if(m)return{x:l+je+D,y:a+b+D}},async handleClick({mousePosition:t,column:n,row:o,getCellPosition:l,updateOrSaveRow:a,value:i,cellRenderStore:r,readonly:s,path:u,formula:c}){if(!o||!n||s||c||!n.isCellEditable)return!1;const{x:f,y:v,width:p,height:g}=l(n,o.rowMeta.rowIndex),y=jc({x:f,y:v,width:p,height:g,column:n.columnObj,padding:10});if(!y)return!1;const{iconSize:x,iconPositions:w}=y,{x:m,y:C}=t,b=w.findIndex(({iconX:S,iconY:k})=>m>=S&&m<=S+x&&C>=k&&C<=k+x);return b===-1?!1:b+1===i?(o.row[n.title]=0,await(a==null?void 0:a(o,n.title,void 0,void 0,void 0,u)),r.ratingChanged={value:0,hoverValue:b+1},!0):(o.row[n.title]=b+1,await(a==null?void 0:a(o,n.title,void 0,void 0,void 0,u)),r.ratingChanged={value:b+1,hoverValue:b+1},!0)},async handleKeyDown(t){const{e:n,row:o,column:l,updateOrSaveRow:a,readonly:i,path:r}=t;if(l.readonly||i||!l.isCellEditable)return;const s=l.columnObj;return/^[0-9]$/.test(n.key)?(o.row[s.title]=Number(n.key),await a(o,s.title,void 0,void 0,void 0,r),!0):!1}},tr=8,qr=4,_s=8,ti=20,ni=14,Gc=15,Wk=t=>{const{getPossibleAttachmentSrc:n}=Ri();if(!t)return{icon:"",iconType:""};const o=jn(t).icon||"",l=jn(t).iconType||"";return{icon:l===zi.IMAGE&&Sa(o)?n(o)||"":o,iconType:l}},zk=(t,n)=>{var l,a,i,r;const o=t.split(" ").filter(s=>s)??[];return o.length>0?o.length>1?(((l=o[0])==null?void 0:l[0])??"")+(((a=o[1])==null?void 0:a[0])??""):t.slice(0,2):((r=(i=n.split("@"))==null?void 0:i[0])==null?void 0:r.slice(0,2))??""},Vk=(t,n,o)=>{const l=t?ac(t):n?ac(n):"#FFFFFF",a="#F4F4F5";if(o.icon)switch(o.iconType){case zi.IMAGE:return"";case zi.EMOJI:case zi.ICON:return a;default:return l||"#FFFFFF"}return l||"#FFFFFF"},bu={render:(t,n)=>{var b,S;const{value:o,x:l,y:a,width:i,height:r,column:s,spriteLoader:u,padding:c,imageLoader:f}=n;let v=l+c,p=a,g=i-c*2;g=g-c*2;const y=jn(s==null?void 0:s.meta),x=(y==null?void 0:y.is_multi)??!1,w=mc(((b=s==null?void 0:s.extra)==null?void 0:b.optionsMap)||{},o);if(!w.length)return;let m=0,C=1;for(const k of w){const D=((S=k.display_name)==null?void 0:S.trim())??"",F=k.email??"",I=D||F,M=k.deleted,{text:A,width:j}=Qn(t,{text:I,maxWidth:g-tr*2-ni-8,render:!1}),N=ni+8+j+tr*2;if(v+N>l+i-c*2){if(p+ti*2+qr>a+r||C>=Ui(r,!0)){Qn(t,{x:v+c+_s,y:p,text:"...",maxWidth:Gc,textAlign:"right",verticalAlign:"middle",fontFamily:"500 13px Inter",fillStyle:M?"#4a5268":"#0b1d05",height:r}),v=v+c+_s+Gc,p=p+ti+qr;break}v=l+c,p+=ti+qr,C+=1}ga(t,{x:v,y:p+6,width:N,height:ti,radius:12,fillStyle:"#e7e7e9"});const Y=Wk(k.meta),ae=Y.icon&&Y.iconType===zi.IMAGE&&!!Y.icon[0],he=zk(D,F),ye=19,re=ye/2,me=M?!0:!ae,W=ae?"transparent":Vk(D,F,Y),U=lh(W)?"white":"black",Ae=Y.icon;me&&Yo(t,v,p+6.5,ye,ye,re,{backgroundColor:M?Jn.gray[300]:W});let je=!0;if(ae){const Ue=f.loadOrGetImage(Ae);Ue&&(f.renderImage(t,Ue,v,p+6,ye,ye,re,{border:!1}),je=!1)}else Y.icon&&Y.iconType===zi.EMOJI?ah(Ae)?(Qn(t,{x:v+3.5,y:p+1,text:Ae}),je=!1):je=!0:Y.icon&&Y.iconType===zi.ICON?(u.renderIcon(t,{color:"black",icon:Ae,size:12,x:v+4,y:p+9.5}),je=!1):M?(u.renderIcon(t,{icon:"ncSlash",size:ni,x:v+2.5,y:p+6+(ti-ni)/2,color:Jn.gray[500]}),je=!1):he&&(Qn(t,{x:v+re,y:p,text:he.toLocaleUpperCase(),fontFamily:"600 10px Inter",textAlign:"center",verticalAlign:"middle",fillStyle:U}),je=!1);if(je&&u.renderIcon(t,{icon:"user",size:ni,x:v+2.5,y:p+6+(ti-ni)/2,color:U}),Qn(t,{x:v+tr+ni+4,y:p,text:A,maxWidth:g-tr*2,textAlign:"left",verticalAlign:"middle",fontFamily:"500 13px Inter",fillStyle:M?Jn.gray[500]:"#0b1d05",height:r}),v=v+N+_s,m++,!x)break}return{x:v,y:p,nextLine:m<w.length}},async handleHover({column:t,getCellPosition:n,row:o,mousePosition:l,value:a,selected:i,baseUsers:r}){var M,A,j,N;const{hideTooltip:s,tryShowTooltip:u}=ul();if(s(),!i)return;const c=Y=>{const ae=(r||[]).find(he=>he.email===Y);return ae?ae.roles??(ae.workspace_roles?ih[ae.workspace_roles]??su.NO_ACCESS:su.NO_ACCESS):su.NO_ACCESS},{x:f,y:v,width:p,height:g}=n(t,o.rowMeta.rowIndex),y=10;let x=f+y,w=v,m=p-y*2;m=m-y*2;const C=jn(t==null?void 0:t.columnObj.meta),b=(C==null?void 0:C.is_multi)??!1,S=mc(((A=(M=t==null?void 0:t.columnObj)==null?void 0:M.extra)==null?void 0:A.optionsMap)||{},a);if(!S.length)return;const k=[],D=$l;let F=1;for(const Y of S){const ae=((j=Y.display_name)==null?void 0:j.trim())||Y.email,{width:he}=Qn(D,{text:ae,maxWidth:m-tr*2-ni-8,render:!1}),ye=ni+8+he+tr*2;if(x+ye>f+p-y*2){if(w+ti*2+qr>v+g||F>=Ui(g,!0))break;x=f+y,w+=ti+qr,F+=1}if(k.push({x,y:w+6,width:ye,height:ti,display_name:(N=Y.display_name)==null?void 0:N.trim(),email:Y.email,deleted:Y.deleted}),x=x+ye+_s,!b)break}if(!k.length)return;const I=k.find(Y=>Pt(Y,l));I&&u({rect:I,text:ta("div",{class:"flex flex-col gap-2"},[ta("div",{class:"flex flex-col"},[ta("div",{class:I.display_name?"text-small":"hidden"},I.display_name),ta("div",{class:` ${I.display_name?"text-tiny text-gray-200":"text-small"}`},I.email)]),I.deleted?ta("div",{class:"text-tiny text-gray-200"},"Removed"):ta("div",{class:"text-tiny text-gray-200"},`Has ${c(I.email)} role in base`)]),mousePosition:l})},async handleClick({row:t,column:n,mousePosition:o,getCellPosition:l,makeCellEditable:a,selected:i}){if(n.readonly||!(n!=null&&n.isCellEditable)||Ds(n.uidt)||!i)return!1;const{x:r,y:s,width:u}=l(n,t.rowMeta.rowIndex),c=10,f=r+c,v=s,p=u-c*2;return Pt({x:f,y:v,width:p,height:20},o)?(a(t,n),!0):!1},async handleKeyDown({e:t,row:n,column:o,makeCellEditable:l}){return o.readonly||!(o!=null&&o.isCellEditable)||Ds(o.uidt)?!1:t.key.length===1?(l(n,o),!0):!1}},gi=8,Hc=22,Yc=4,jk={render:(t,{column:n,value:o,x:l,y:a,width:i,pv:r,padding:s})=>{var p,g,y,x;const u=((p=o==null?void 0:o.toString())==null?void 0:p.trim())??"";if(!u)return;const{text:c,width:f}=Qn(t,{x:l+s+gi,y:a,text:u,maxWidth:i-s*2-gi*2,textAlign:"left",verticalAlign:"middle",fontFamily:`${r?600:500} 13px Inter`,render:!1}),v=((x=(y=(g=n.extra)==null?void 0:g.optionsMap)==null?void 0:y[u])==null?void 0:x.color)??"#e7e7e9";return ga(t,{x:l+s,y:a+Yc,width:f+gi*2,height:Hc,radius:12,fillStyle:v}),Qn(t,{x:l+s+gi,y:a,text:c,maxWidth:i-s*2-gi*2,textAlign:"left",verticalAlign:"middle",fontFamily:`${r?600:500} 13px Inter`,fillStyle:jf(v)}),{x:l+s+f+gi*2,y:a}},async handleHover({getCellPosition:t,column:n,row:o,value:l,mousePosition:a}){var w;const{x:i,y:r,width:s}=t(n,o.rowMeta.rowIndex),{tryShowTooltip:u,hideTooltip:c}=ul();c();const f=10,v=s-f*2-gi*2,p=document.createElement("canvas").getContext("2d");if(!p)return;p.font=`${n.pv?600:500} 13px Inter`;const g=((w=l==null?void 0:l.toString())==null?void 0:w.trim())??"";if(!g)return;const y=Hl(p,g,v,!0);if(g===y.text)return;const x={x:i+f,y:r+Yc,width:y.width+gi*2,height:Hc};u({rect:x,mousePosition:a,text:g})},async handleClick({row:t,column:n,makeCellEditable:o,selected:l}){var a;return n.readonly||(a=n.columnObj)!=null&&a.readonly||!(n!=null&&n.isCellEditable)||!l?!1:(o(t,n),!0)},async handleKeyDown({e:t,row:n,column:o,makeCellEditable:l}){var a;return o.readonly||(a=o.columnObj)!=null&&a.readonly||!(o!=null&&o.isCellEditable)?!1:t.key.length===1||t.key==="Enter"?(l(n,o),!0):!1}},zu={render:(t,n)=>{var F,I,M;const{column:o,x:l,y:a,width:i,height:r,pv:s,padding:u}=n;let c=l+u,f=a,v=i-u*2;const p=8,g=4,y=8,x=22,w=4,m="#666",C=15;v=v-u*2;const b=zu.getSelectedOptions(n);if(!b.length)return;const S=(F=o.extra)==null?void 0:F.optionsMap;let k=0,D=1;for(const A of b){const j=(A==null?void 0:A.trim())??"",{text:N,width:Y}=Qn(t,{text:j,maxWidth:v-p*2,render:!1});if(c+Y+p*2>l+i-u*2){if(f+x*2+g>a+r||k===0||D>=Ui(r,!0)){Qn(t,{x:c+u+y,y:f,text:"...",maxWidth:C,textAlign:"right",verticalAlign:"middle",fontFamily:"500 13px Inter",fillStyle:m,height:r}),c=c+u+y+C,f=f+x+g;break}c=l+u,f+=x+g,D+=1}ga(t,{x:c,y:f+w,width:Y+p*2,height:x,radius:12,fillStyle:((I=S[j])==null?void 0:I.color)??m}),Qn(t,{x:c+p,y:f,text:N,maxWidth:v-p*2,textAlign:"left",verticalAlign:"middle",fontFamily:`${s?600:500} 13px Inter`,fillStyle:jf(((M=S[j])==null?void 0:M.color)??m),height:r}),c=c+Y+p*2+y,k++}return{x:c,y:f,nextLine:k<b.length}},getSelectedOptions:t=>{var a;const{column:n,value:o,isMysql:l}=t;if(!n||!o)return[];if(Rl(o))return o;if(l!=null&&l(n==null?void 0:n.source_id)){const i=(a=n.extra)==null?void 0:a.optionsMap;return o.toString().split(",").sort((r,s)=>{const u=i[r==null?void 0:r.trim()],c=i[s==null?void 0:s.trim()];return u&&c?u.order-c.order:0})}else return o.toString().split(",")},async handleHover({row:t,column:n,mousePosition:o,getCellPosition:l,value:a}){const{tryShowTooltip:i,hideTooltip:r}=ul();if(r(),!t||!(n!=null&&n.id)||!o)return;const{x:s,y:u,width:c,height:f}=l(n,t.rowMeta.rowIndex),v=10;let p=s+v,g=u,y=c-v*2;const x=8,w=4,m=8,C=20,b=6;y=y-v*2;const S=zu.getSelectedOptions({column:n.columnObj,value:a});if(!S.length)return;const k=[];let D=0,F=1;const I=$l;for(const A of S){const j=(A==null?void 0:A.trim())??"",{text:N,width:Y}=Qn(I,{text:j,maxWidth:y-x*2,render:!1});if(p+Y+x*2>s+c-v*2){if(g+C*2+w>u+f||D===0||F>=Ui(f,!0))break;p=s+v,g+=C+w,F+=1}j!==N&&k.push({x:p,y:g+b,width:Y+x*2,height:C,text:j}),p=p+Y+x*2+m,D++}if(!k.length)return;const M=k.find(A=>Pt(A,o));M&&i({rect:M,mousePosition:o,text:M.text})},async handleClick({row:t,column:n,makeCellEditable:o,selected:l}){var a;return(a=n.columnObj)!=null&&a.readonly||!(n!=null&&n.isCellEditable)||!l?!1:(o(t,n),!0)},async handleKeyDown({e:t,row:n,column:o,makeCellEditable:l}){var a;return o.readonly||(a=o.columnObj)!=null&&a.readonly||!(o!=null&&o.isCellEditable)?!1:t.key.length===1||t.key==="Enter"?(l(n,o),!0):!1}},Uk=rh(),Gk={render:(t,n)=>{var p,g,y,x;const{column:o,value:l,metas:a,renderCell:i}=n;if(!sa(l))return;const r=o.colOptions,s=(g=(p=a==null?void 0:a[o.fk_model_id])==null?void 0:p.columns)==null?void 0:g.find(w=>w.id===(r==null?void 0:r.fk_relation_column_id));if(!s)return;const u=a==null?void 0:a[(y=s.colOptions)==null?void 0:y.fk_related_model_id],c=Uk(((u==null?void 0:u.columns)||[]).find(w=>w.id===(r==null?void 0:r.fk_rollup_column_id)));if(!c)return;let f;if(c.uidt===ve.Formula){const w=jn(c.meta);w!=null&&w.display_type&&(f={...n,column:{...c,uidt:w==null?void 0:w.display_type,...w.display_column_meta,meta:{...jn(w.display_column_meta),...jn(o==null?void 0:o.meta)}},readonly:!0,formula:!0})}f||(f={...n,column:c,relatedColObj:void 0,relatedTableMeta:void 0,readonly:!0});const v=sh(((x=f.column)==null?void 0:x.uidt)||ve.SingleLineText);f.column.meta={...jn(c==null?void 0:c.meta),...jn(o==null?void 0:o.meta)},r!=null&&r.rollup_function&&v.includes(r==null?void 0:r.rollup_function)&&(f.column.uidt=ve.Decimal),i(t,f.column,f)}},Hk={render:(t,n)=>{var m,C,b;const{column:o,value:l,x:a,y:i,width:r,height:s,padding:u,t:c,spriteLoader:f,mousePosition:v,readonly:p,setCursor:g,selected:y}=n,x=+l||0;let w="";if(x?x===1?w=`1 ${((m=o==null?void 0:o.meta)==null?void 0:m.singular)||c("general.link")}`:w=`${x} ${((C=o==null?void 0:o.meta)==null?void 0:C.plural)||c("general.links")}`:w=c("msg.noRecordsLinked"),(b=n.tag)!=null&&b.renderAsTag)return Il(t,{...n,text:w});{const{y:S,width:k}=Qn(t,{x:a+u,y:i,text:w,maxWidth:r-u*2-20,fontFamily:"500 13px Inter",fillStyle:"rgb(67, 81, 232)",height:s}),D=Pt({x:a+u,y:i,width:k,height:S-i},v),{x:F,y:I}=Qn(t,{x:a+u,y:i,text:w,maxWidth:r-u*2-20,fontFamily:"500 13px Inter",fillStyle:"rgb(67, 81, 232)",height:s,underline:y&&D});return y&&D&&g("pointer"),y&&!p&&(f.renderIcon(t,{icon:"ncPlus",x:a+r-16-u,y:i+7,size:16,color:"#374151"}),Pt({x:a+r-16-u,y:i+7,width:16,height:16},v)&&g("pointer")),{x:F,y:I}}},async handleClick({row:t,column:n,getCellPosition:o,mousePosition:l,makeCellEditable:a,selected:i,isDoubleClick:r}){if(!i&&!r)return!1;const s=t.rowMeta.rowIndex,{x:u,y:c,width:f,height:v}=o(n,s),p=10,g=16;return Pt({x:u+f-16-p,y:c+7,height:g,width:g},l)||Pt({x:u+p,y:c,height:v,width:f-p*2},l)?(a(t,n),!0):!1},async handleKeyDown({row:t,column:n,e:o,makeCellEditable:l}){return Rr(o)?(l(t,n),!0):!1}},Fr={render:(t,n)=>{var S;const{column:o,value:l,x:a,y:i,width:r,height:s,padding:u,textColor:c="#4a5268",fontFamily:f="500 13px Inter",meta:v,metas:p,sqlUis:g,isMysql:y,isXcdbBase:x,t:w,isUnderLookup:m}=n;if(!v||!p)return;const C=Uf(o,g),b=um(l,{col:o,abstractType:C,meta:v,metas:p,isMysql:y,isXcdbBase:x,t:w,isUnderLookup:m});if((S=n.tag)!=null&&S.renderAsTag)return Il(t,{...n,text:b});if(b){const{x:k,y:D}=Qn(t,{x:a+u,y:i,text:b,maxWidth:r-u*2,fontFamily:f,fillStyle:c,height:s});return{x:k,y:D}}else return{x:a,y:i}}},wi=[ve.QrCode,ve.Barcode,ve.Attachment,ve.LinkToAnotherRecord,ve.Links],yi=15,Yk={render:(t,n)=>{var re,me,W,U,Ae,je,Ue;const{column:o,x:l,y:a,value:i,renderCell:r,metas:s,height:u,width:c,padding:f=10,tableMetaLoader:v,row:p}=n;let g=l,y=a,x=c-yi;if(!s)return;const w=o.colOptions,m=(me=(re=s==null?void 0:s[o.fk_model_id])==null?void 0:re.columns)==null?void 0:me.find(ot=>{var G;return ot.id===((G=o==null?void 0:o.colOptions)==null?void 0:G.fk_relation_column_id)});if(!m)return;const C=s==null?void 0:s[(W=m.colOptions)==null?void 0:W.fk_related_model_id];if(!C){if(v.isLoading((U=m.colOptions)==null?void 0:U.fk_related_model_id))return;v.getTableMeta((Ae=m.colOptions)==null?void 0:Ae.fk_related_model_id);return}const b=((C==null?void 0:C.columns)||[]).find(ot=>ot.id===(w==null?void 0:w.fk_lookup_column_id));if(!b||(b==null?void 0:b.uidt)===ve.Button)return;y=y+(wi.includes(b.uidt)&&b.uidt!==ve.Attachment?Math.floor(u/2-Bo[1]/2):0),[ve.SingleSelect,ve.MultiSelect].includes(b.uidt)?b.extra=Lv(b):[ve.User,ve.CreatedBy,ve.LastModifiedBy].includes(b.uidt)&&(b.extra=Nv(b,n.baseUsers||[]));const k=(()=>{var ot,G;if(b.uidt===ve.Checkbox&&[Zi.BELONGS_TO,Zi.ONE_TO_ONE].includes((ot=m==null?void 0:m.colOptions)==null?void 0:ot.type)){const pe=!!(p&&p[m==null?void 0:m.title]);return!i&&!pe?[]:(Rl(i)?i:[i]).map(tv)}if(!i)return[];if(b.uidt===ve.Attachment){if([Zi.BELONGS_TO,Zi.ONE_TO_ONE].includes((G=m==null?void 0:m.colOptions)==null?void 0:G.type))return Rl(i)?i:[i];if(Rl(i)&&i.every(pe=>eu(pe)?!0:Rl(pe)?!pe.length||Sa(pe[0]):!1))return i.filter(pe=>pe!==null).reduce((pe,ne)=>(pe.push(...ne),pe),[])}return Rl(i)?i.filter(pe=>pe!==null):[i]})();if(!k.length)return;t.save(),t.beginPath(),t.rect(l,a,c-f,u),t.clip();let D;const F=(je=b.colOptions)==null?void 0:je.fk_related_model_id;if(ml(b)&&F&&(D=s==null?void 0:s[F],!D)){if(v.isLoading(F))return;v.getTableMeta(F);return}const I={...n,column:b,relatedColObj:void 0,relatedTableMeta:D,isUnderLookup:!0,readonly:!0,value:k,height:uu(b)?u:Bo[1],padding:10,tag:{renderAsTag:!0,tagBgColor:Jn.base.white,tagHeight:20,tagBorderColor:Jn.gray[200],tagBorderWidth:1},meta:C,textAlign:uu(b)?"center":n.textAlign},M=ot=>ms.includes(b.uidt)||uh(b)?r(t,b,ot):Fr.render(t,ot),A=Ui(u,!0);let j=1,N=!1,Y=1;const ae=()=>{g!==l&&Qn(t,{x:g+f,y,text:"...",maxWidth:yi,textAlign:"right",verticalAlign:"middle",fontFamily:"500 13px Inter",fillStyle:"#666",height:u})},he=()=>{for(const ot of k){const G=M({...I,value:ot,x:g,y,width:x,tag:{...I.tag,renderAsTag:wi.includes(b.uidt)}});if(wi.includes(b.uidt))G!=null&&G.x&&(g=G==null?void 0:G.x);else if(G!=null&&G.x)if((G==null?void 0:G.x)>=l+c-f*2-(Y<k.length?50-yi:0)){if(j+1>A||wi.includes(b.uidt)){N=!0;break}g=l,x=c-yi,y=G!=null&&G.y&&y!==(G==null?void 0:G.y)&&(G==null?void 0:G.y)-y>=24?G==null?void 0:G.y:y+24,j+=1}else x=g+x-((G==null?void 0:G.x)-2*4)-f*2-yi,g=G==null?void 0:G.x;else{if(j+1>A||wi.includes(b.uidt))break;g=l,y+=24,x=c,j+=1}Y+=1}N&&Y<k.length&&ae()},ye=()=>{for(const ot of k){const G=M({...I,value:ot,x:g,y,width:x});if(wi.includes(b.uidt))G!=null&&G.x&&(g=G==null?void 0:G.x);else if(G!=null&&G.x&&!(G!=null&&G.nextLine))if((G==null?void 0:G.x)>=l+c-f*4-(j+1>A&&Y<k.length?50-yi:0)){if(j+1>A||wi.includes(b.uidt)){N=!0,G!=null&&G.x?g=(G==null?void 0:G.x)+f:g=l+c-f-yi;break}g=l,x=c-yi,y=G!=null&&G.y&&y!==(G==null?void 0:G.y)&&(G==null?void 0:G.y)-y>=24?G==null?void 0:G.y:y+24,j+=1}else x=l+c-((G==null?void 0:G.x)-2*4)-f*2,g=G==null?void 0:G.x;else{if(j+1>A||wi.includes(b.uidt)){G!=null&&G.nextLine||(N=!0);break}g=l,y+=24,x=c,j+=1}if(j>A){N=!0;break}Y++}N&&Y<k.length&&ae()};_o(b)&&![ve.Rollup,ve.Formula].includes(b.uidt)?b.uidt!==ve.LinkToAnotherRecord||b.uidt===ve.LinkToAnotherRecord&&[Zi.BELONGS_TO,Zi.ONE_TO_ONE].includes((Ue=b.colOptions)==null?void 0:Ue.type)?he():M({...I,tag:{...I.tag,renderAsTag:!1}}):uu(b)&&Sa(k[0])?r(t,b,{...I,tag:{...I.tag,renderAsTag:!1}}):ye(),t.restore()},async handleKeyDown(t){const{e:n,row:o,column:l,makeCellEditable:a}=t;return n.key==="Enter"||Rr(n)?(a(o,l),!0):!1}},qk={solid:{brand:{base:{background:"#3366FF",text:"#FFFFFF"},hover:{background:"#2952CC",text:"#FFFFFF"},loader:"#3366FF",disabled:{background:"#F4F4F5",text:"#9AA2AF"}},red:{base:{background:"#FF4A3F",text:"#FFFFFF"},hover:{background:"#CB3F36",text:"#FFFFFF"},loader:"#FF4A3F",disabled:{background:"#F4F4F5",text:"#9AA2AF"}},green:{base:{background:"#27D665",text:"#FFFFFF"},hover:{background:"#1FAB51",text:"#FFFFFF"},loader:"#27D665",disabled:{background:"#F4F4F5",text:"#9AA2AF"}},maroon:{base:{background:"#B33771",text:"#FFFFFF"},hover:{background:"#9D255D",text:"#FFFFFF"},loader:"#B33771",disabled:{background:"#F4F4F5",text:"#9AA2AF"}},blue:{base:{background:"#36BFFF",text:"#FFFFFF"},hover:{background:"#2B99CC",text:"#FFFFFF"},loader:"#36BFFF",disabled:{background:"#F4F4F5",text:"#9AA2AF"}},orange:{base:{background:"#FA8231",text:"#FFFFFF"},hover:{background:"#E1752C",text:"#FFFFFF"},loader:"#FA8231",disabled:{background:"#F4F4F5",text:"#9AA2AF"}},pink:{base:{background:"#FC3AC6",text:"#FFFFFF"},hover:{background:"#CA2E9E",text:"#FFFFFF"},loader:"#FC3AC6",disabled:{background:"#F4F4F5",text:"#9AA2AF"}},purple:{base:{background:"#7D26CD",text:"#FFFFFF"},hover:{background:"#641EA4",text:"#FFFFFF"},loader:"#7D26CD",disabled:{background:"#F4F4F5",text:"#9AA2AF"}},yellow:{base:{background:"#fcbe3a",text:"#FFFFFF"},hover:{background:"#ca982e",text:"#FFFFFF"},loader:"#fcbe3a",disabled:{background:"#F4F4F5",text:"#9AA2AF"}},gray:{base:{background:"#6A7184",text:"#FFFFFF"},hover:{background:"#4A5268",text:"#FFFFFF"},loader:"#6A7184",disabled:{background:"#F4F4F5",text:"#9AA2AF"}}},light:{brand:{base:{background:"#EBF0FF",text:"#2952CC"},hover:{background:"#D6E0FF",text:"#2952CC"},disabled:{background:"#F4F4F5",text:"#9AA2AF"},loader:"#2952CC"},red:{base:{background:"#FFF2F1",text:"#E8463C"},hover:{background:"#FFDBD9",text:"#E8463C"},disabled:{background:"#F4F4F5",text:"#9AA2AF"},loader:"#E8463C"},green:{base:{background:"#ECFFF2",text:"#1FAB51"},hover:{background:"#D4F7E0",text:"#1FAB51"},disabled:{background:"#F4F4F5",text:"#9AA2AF"},loader:"#1FAB51"},maroon:{base:{background:"#FFF0F7",text:"#9D255D"},hover:{background:"#FFCFE6",text:"#9D255D"},disabled:{background:"#F4F4F5",text:"#9AA2AF"},loader:"#9D255D"},blue:{base:{background:"#EDF9FF",text:"#2B99CC"},hover:{background:"#D7F2FF",text:"#2B99CC"},disabled:{background:"#F4F4F5",text:"#9AA2AF"},loader:"#2B99CC"},orange:{base:{background:"#FFF5EF",text:"#E1752C"},hover:{background:"#FEE6D6",text:"#E1752C"},disabled:{background:"#F4F4F5",text:"#9AA2AF"},loader:"#E1752C"},pink:{base:{background:"#FFEEFB",text:"#CA2E9E"},hover:{background:"#FED8F4",text:"#CA2E9E"},disabled:{background:"#F4F4F5",text:"#9AA2AF"},loader:"#CA2E9E"},purple:{base:{background:"#F3ECFA",text:"#641EA4"},hover:{background:"#E5D4F5",text:"#641EA4"},disabled:{background:"#F4F4F5",text:"#9AA2AF"},loader:"#641EA4"},yellow:{base:{background:"#fffbf2",text:"#ca982e"},hover:{background:"#fff0d1",text:"#ca982e"},disabled:{background:"#F4F4F5",text:"#9AA2AF"},loader:"#ca982e"},gray:{base:{background:"#F9F9FA",text:"#4A5268"},hover:{background:"#F4F4F5",text:"#4A5268"},disabled:{background:"#F4F4F5",text:"#9AA2AF"},loader:"#4A5268"}},text:{brand:{base:{background:"transparent",text:"#3366FF"},hover:{background:"#F4F4F5",text:"#3366FF"},disabled:{background:"#F4F4F5",text:"#9AA2AF"},loader:"#3366FF"},red:{base:{background:"transparent",text:"#FF4A3F"},hover:{background:"#F4F4F5",text:"#FF4A3F"},disabled:{background:"#F4F4F5",text:"#9AA2AF"},loader:"#FF4A3F"},green:{base:{background:"transparent",text:"#27D665"},hover:{background:"#F4F4F5",text:"#27D665"},disabled:{background:"#F4F4F5",text:"#9AA2AF"},loader:"#27D665"},maroon:{base:{background:"transparent",text:"#B33771"},hover:{background:"#F4F4F5",text:"#B33771"},disabled:{background:"#F4F4F5",text:"#9AA2AF"},loader:"#B33771"},blue:{base:{background:"transparent",text:"#36BFFF"},hover:{background:"#F4F4F5",text:"#36BFFF"},disabled:{background:"#F4F4F5",text:"#9AA2AF"},loader:"#36BFFF"},orange:{base:{background:"transparent",text:"#FA8231"},hover:{background:"#F4F4F5",text:"#FA8231"},disabled:{background:"#F4F4F5",text:"#9AA2AF"},loader:"#FA8231"},pink:{base:{background:"transparent",text:"#FC3AC6"},hover:{background:"#F4F4F5",text:"#FC3AC6"},disabled:{background:"#F4F4F5",text:"#9AA2AF"},loader:"#FC3AC6"},purple:{base:{background:"transparent",text:"#7D26CD"},hover:{background:"#F4F4F5",text:"#7D26CD"},disabled:{background:"#F4F4F5",text:"#9AA2AF"},loader:"#7D26CD"},yellow:{base:{background:"transparent",text:"#fcbe3a"},hover:{background:"#F4F4F5",text:"#fcbe3a"},disabled:{background:"#F4F4F5",text:"#9AA2AF"},loader:"#fcbe3a"},gray:{base:{background:"transparent",text:"#6A7184"},hover:{background:"#F4F4F5",text:"#6A7184"},disabled:{background:"#F4F4F5",text:"#9AA2AF"},loader:"#6A7184"}}},Xk=(t,n,o,l)=>{var s;const a=(s=qk[t])==null?void 0:s[n];return a?{...a[o&&!l?"hover":"base"],loader:a.loader}:o&&!l?{background:"#2952CC",text:"#FFFFFF",loader:"#3366FF"}:{background:"#3366FF",text:"#FFFFFF",loader:"#3366FF"}},nr=12,Xr=24,_u=32,aa=14,bi=6,Kk={render:(t,n)=>{var re;const{x:o,y:l,width:a,column:i,spriteLoader:r,mousePosition:s,actionManager:u,pk:c,disabled:f,value:v,allowLocalUrl:p,cellRenderStore:g,t:y}=n,x=u.isLoading(c,i.id),w=u.getAfterActionStatus(c,i.id);w!=null&&w.tooltip?Object.assign(g,{invalidUrlTooltip:w.tooltip}):Object.assign(g,{invalidUrlTooltip:""});let m=x||(f==null?void 0:f.isInvalid);t.textAlign="left";const C=i.colOptions;if(!C)return;const b={label:C.label||"",icon:C.icon,theme:C.theme||"solid",color:C.color||"brand",type:C.type};if(b.type===dh.Url){let me=ts(((re=v==null?void 0:v.url)==null?void 0:re.toString())??"");try{me=decodeURI(me)===me?encodeURI(me):me}catch{me=encodeURI(me)}m=!(me&&Cs(me,{require_tld:!p})),Object.assign(g,{invalidUrlTooltip:m?y("msg.error.invalidURL"):""})}const S=!!b.icon||x||w,k=!!b.label,D=a-8;let F=0,I=0,M=b.label;if(k){t.font="550 13px Inter";const me=D-nr*2-(S?aa+bi:0),W=Hl(t,b.label,me,!0);M=W.text,I=W.width,F+=I}S&&(F+=aa,k&&(F+=bi));const A=Math.min(D,Math.max(_u,F+nr*2)),j=o+(a-A)/2,N=l+4,Y=!m&&s&&s.x>=j&&s.x<=j+A&&s.y>=N&&s.y<=N+Xr,ae=Xk(b.theme,b.color,Y,!!m);Y&&n.setCursor("pointer"),m&&(t.globalAlpha=b.theme==="solid"?.3:.5),t.beginPath(),t.roundRect(j,N,A,Xr,6),t.fillStyle=ae.background,t.fill();let he=j+(A-F)/2;const ye=N+(Xr-aa)/2;if(m&&ae.text==="#FFFFFF"&&(t.globalAlpha=1),x){const me=u.getLoadingStartTime(c,i.id);me&&(ed(t,he,ye,aa,ae.loader,me,1.5),he+=aa+(k?bi:0))}else w?(r.renderIcon(t,{icon:w.status==="success"?"ncCheck":"ncInfo",size:aa,x:he,y:ye,color:ae.text}),he+=aa+(k?bi:0)):S&&(r.renderIcon(t,{icon:b.icon,size:aa,x:he,y:ye,color:ae.text}),he+=aa+(k?bi:0));k&&(t.fillStyle=ae.text,t.textBaseline="middle",t.fillText(M,he,N+13)),m&&(t.globalAlpha=1)},async handleClick({mousePosition:t,column:n,row:o,pk:l,actionManager:a,getCellPosition:i,path:r,allowLocalUrl:s}){var F,I;const u=a.isLoading(l,n.id);if(!o||!(n!=null&&n.id)||!t||(F=n==null?void 0:n.isInvalidColumn)!=null&&F.isInvalid||u)return!1;const{x:c,y:f,width:v}=i(n,o.rowMeta.rowIndex),p=(I=n==null?void 0:n.columnObj)==null?void 0:I.colOptions;if(!p)return!1;const g={label:(p==null?void 0:p.label)||"",icon:p==null?void 0:p.icon,theme:(p==null?void 0:p.theme)||"solid",color:(p==null?void 0:p.color)||"brand",type:p==null?void 0:p.type},y=!!g.icon,x=!!g.label,w=v-8;let m=0,C=0;if(x){const M=$l;M.font="550 13px Inter";const A=w-nr*2-(y?aa+bi:0);C=Hl(M,g.label,A,!0).width,m+=C}y&&(m+=aa,x&&(m+=bi));const b=Math.min(w,Math.max(_u,m+nr*2)),S=c+(v-b)/2,k=f+4;return t&&t.x>=S&&t.x<=S+b&&t.y>=k&&t.y<=k+Xr?(await a.executeButtonAction([l],n,{row:[o],path:r,allowLocalUrl:s}),!0):!1},async handleHover({column:t,getCellPosition:n,row:o,mousePosition:l,t:a,cellRenderStore:i}){var A,j,N;const{tryShowTooltip:r,hideTooltip:s}=ul();s();const{x:u,y:c,width:f}=n(t,o.rowMeta.rowIndex),v=(A=t==null?void 0:t.isInvalidColumn)==null?void 0:A.isInvalid,p=(j=t==null?void 0:t.isInvalidColumn)==null?void 0:j.ignoreTooltip;if(!i.invalidUrlTooltip&&(!v||p))return;const{aiIntegrations:g}=kr(),y=(N=t.columnObj)==null?void 0:N.colOptions;if(!y)return;const x={label:(y==null?void 0:y.label)||"",icon:y==null?void 0:y.icon,theme:(y==null?void 0:y.theme)||"solid",color:(y==null?void 0:y.color)||"brand",type:y==null?void 0:y.type},w=!!x.icon,m=!!x.label;if(!m)return;let C=0,b=0;const S=f-8;if(m){const Y=$l;Y.font="550 13px Inter";const ae=S-nr*2-(w?aa+bi:0);b=Hl(Y,x.label,ae,!0).width,C+=b}const k=i.invalidUrlTooltip?i.invalidUrlTooltip:g.value.length?a("tooltip.aiIntegrationReConfigure"):a("tooltip.aiIntegrationAddAndReConfigure"),D=Math.min(S,Math.max(_u,C+nr*2)),F=u+(f-D)/2,I=c+4;r({rect:{x:F,y:I,height:Xr,width:D},mousePosition:l,text:k})},async handleKeyDown(t){var s;const{e:n,row:o,column:l,actionManager:a,pk:i,path:r}=t;if(n.key==="Enter"){const u=a.isLoading(i,l.id);return l.readonly||(s=l.columnObj)!=null&&s.readonly||u?!1:(await a.executeButtonAction([i],l,{row:[o],path:r,allowLocalUrl}),!0)}return!1}},Jk={render:(t,n)=>{var b,S,k,D,F,I,M;const{value:o,x:l,y:a,width:i,height:r,spriteLoader:s,mousePosition:u,relatedTableMeta:c,renderCell:f,readonly:v,setCursor:p,selected:g,cellRenderStore:y}=n,x=((k=((b=c==null?void 0:c.columns)==null?void 0:b.find(A=>A.pv))||((S=c==null?void 0:c.columns)==null?void 0:S[0]))==null?void 0:k.title)||"",w=((I=((D=c==null?void 0:c.columns)==null?void 0:D.find(A=>A.pv))||((F=c==null?void 0:c.columns)==null?void 0:F[0]))==null?void 0:I.id)||"",m=(M=c==null?void 0:c.columns)==null?void 0:M.find(A=>A.title===x);if(!m)return;let C;if(sa(o)){const A=i-(Pt({x:l,y:a,width:i,height:r},u)?26:0),j=o&&!Array.isArray(o)&&typeof o=="object"?o[x]??o[w]:o;if(C=(Y=>ms.includes(m.uidt)?f(t,m,Y):Fr.render(t,Y))({...n,value:j,column:m,width:A,relatedColObj:void 0,relatedTableMeta:void 0,readonly:!0,height:Bo[1],padding:10,textColor:Jn.brand[500],tag:{renderAsTag:!0,tagBgColor:Jn.brand[50],tagHeight:24},meta:c,x:l+4,y:a+(Bo[1]===r?0:2)}),!(C!=null&&C.x)||!(C!=null&&C.y))return;Object.assign(C,{width:C.x-l+4,height:C.y-(a+(Bo[1]===r?0:2))}),Object.assign(y,C),!v&&g&&Pt({x:l+4,y:a+(Bo[1]===r?0:2),height:y.height,width:y.width},u)&&p("pointer"),g&&!v&&(s.renderIcon(t,{x:C.x+2,y:a+(Bo[1]===r?8:10),icon:"ncXCircle",size:16,color:"#AFB3C2"}),Pt({x:C.x+2,y:a+(Bo[1]===r?8:10),height:16,width:16},u)&&p("pointer"))}return g&&!v&&(s.renderIcon(t,{x:l+i-26,y:a+7,icon:"ncPlus",size:16,color:"#374151"}),Pt({x:l+i-26,y:a+7,width:16,height:16},u)&&p("pointer")),C},async handleClick({row:t,value:n,column:o,getCellPosition:l,mousePosition:a,makeCellEditable:i,cellRenderStore:r,selected:s,isPublic:u,readonly:c,isDoubleClick:f,openDetachedExpandedForm:v}){var S;if(!s&&!f)return!1;const p=t.rowMeta.rowIndex,{x:g,y,width:x,height:w}=l(o,p),m=16,C=Pt({x:g+x-26,y:y+8,height:m,width:m},a),b=(r==null?void 0:r.x)&&s&&Pt({x:r.x+2,y:y+7,height:m,width:m},a);if(C||b)return i(t,o),!0;if((s||f)&&Sa(n)&&(r!=null&&r.height)&&(r!=null&&r.width)&&Pt({x:g+4,y:y+(Bo[1]===w?0:2),height:r.height,width:r.width},a)){if(u)return!0;const k=Ht(n,((S=o.relatedTableMeta)==null?void 0:S.columns)||[]);return k&&v({isOpen:!0,row:{row:n,rowMeta:{},oldRow:{...n}},meta:o.relatedTableMeta||{},rowId:k,useMetaFields:!0,maintainDefaultViewOrder:!0,loadRow:!u}),!0}return(s||f)&&!c&&Pt({x:g,y,width:x,height:w},a)?(i(t,o),!0):!1}},qc=15,_i=24,Qk={render:(t,n)=>{var he,ye,re,me;const{value:o,x:l,y:a,width:i,height:r,spriteLoader:s,mousePosition:u,relatedTableMeta:c,padding:f,renderCell:v,readonly:p,setCursor:g,cellRenderStore:y,selected:x}=n,w=((re=((he=c==null?void 0:c.columns)==null?void 0:he.find(W=>W.pv))||((ye=c==null?void 0:c.columns)==null?void 0:ye[0]))==null?void 0:re.title)||"",m=(me=c==null?void 0:c.columns)==null?void 0:me.find(W=>W.title===w);if(!m)return;const C=(Rl(o)?o:[]).reduce((W,U)=>{if(!w)return W;const Ae=U[w];return W.push({value:Ae,item:U}),W},[]),b=l+4,S=i-8;let k=b,D=a+(Bo[1]===r?0:2),F=S;const I=[],M={...n,column:m,relatedColObj:void 0,relatedTableMeta:void 0,readonly:!0,height:Bo[1],padding:10,textColor:Jn.brand[500],tag:{renderAsTag:!0,tagBgColor:Jn.brand[50],tagHeight:24},meta:c},A=W=>ms.includes(m.uidt)?v(t,m,W):Fr.render(t,W),j=Ui(r,!0);let N=1,Y=!1;const ae=1;for(const W of C){const U=A({...M,value:W.value,x:k,y:D,width:F});if(U!=null&&U.x)if(I.push({oldX:k+4,oldY:D+4,x:U.x,y:U.y,width:U.x-(k+4),height:U.y?U.y-(D+4):24,value:W.item}),!p&&x&&Pt({x:k,y:D,width:U.x-k,height:U.y?U.y-D:24},u)&&g("pointer"),(U==null?void 0:U.x)>=l+S-f*2-(ae<C.length?50-qc:0)){if(N+1>j){k=U==null?void 0:U.x,Y=!0;break}k=b,F=S,D=U!=null&&U.y&&a!==(U==null?void 0:U.y)&&(U==null?void 0:U.y)-a>=28?U==null?void 0:U.y:D+28,N+=1}else F=k+F-(U==null?void 0:U.x),k=U==null?void 0:U.x;else{if(I.push({oldX:k+4,oldY:D+4,x:k+F,y:D+24,width:F,height:24,value:W.item}),!p&&x&&Pt({x:k,y:D,width:F,height:24},u)&&g("pointer"),N+1>j)break;k=b,D=D+28,F=S,N+=1}if(N>j)break}Object.assign(y,{ltar:I}),Y&&ae<C.length&&Qn(t,{x:k+12,y:a,text:"...",maxWidth:qc,textAlign:"right",verticalAlign:"middle",fontFamily:"500 13px Inter",fillStyle:"#666",height:r}),Pt({x:l,y:a,width:i,height:r},u)&&(p||oa(t,{buttonX:l+i-57,buttonY:a+4,borderRadius:6,buttonSize:_i,spriteLoader:s,mousePosition:u,icon:"ncPlus",iconData:{size:14,xOffset:5,yOffset:5},setCursor:g}),oa(t,{buttonX:l+i-30,buttonY:a+4,borderRadius:6,buttonSize:_i,spriteLoader:s,mousePosition:u,icon:"maximize",setCursor:g}))},async handleClick({row:t,column:n,getCellPosition:o,mousePosition:l,makeCellEditable:a,cellRenderStore:i,selected:r,isPublic:s,isDoubleClick:u,openDetachedExpandedForm:c}){var x;const f=t.rowMeta.rowIndex,{x:v,y:p,width:g,height:y}=o(n,f);if(Pt({x:v+g-57,y:p+4,height:_i,width:_i},l)||Pt({x:v+g-30,y:p+4,height:_i,width:_i},l))return a(t,n),!0;if((r||u)&&Rl(i==null?void 0:i.ltar)){for(const w of i.ltar)if(Sa(w.value)&&w.width&&w.height&&Pt({x:w.oldX,y:w.oldY,height:w.height,width:w.width},l)){if(s)return!0;const m=Ht(w.value,((x=n.relatedTableMeta)==null?void 0:x.columns)||[]);return m&&c({isOpen:!0,row:{row:w.value,rowMeta:{},oldRow:{...w.value}},meta:n.relatedTableMeta||{},rowId:m,useMetaFields:!0,maintainDefaultViewOrder:!0,loadRow:!s}),!0}}return(r||u)&&Pt({x:v,y:p,width:g,height:y},l)?(a(t,n),!0):!1},handleHover:async t=>{const{row:n,column:o,mousePosition:l,getCellPosition:a,t:i}=t,{tryShowTooltip:r,hideTooltip:s}=ul();s();const u=n.rowMeta.rowIndex,{x:c,y:f,width:v}=a(o,u),p={x:c+v-30,y:f+4,width:_i,height:_i};r({rect:p,mousePosition:l,text:i("tooltip.expandShiftSpace")})}},Xc=15,xi=20,Zk={render:(t,n)=>{var he,ye,re,me;const{value:o,x:l,y:a,width:i,height:r,readonly:s,spriteLoader:u,mousePosition:c,relatedTableMeta:f,padding:v,renderCell:p,setCursor:g,cellRenderStore:y,selected:x}=n,w=((re=((he=f==null?void 0:f.columns)==null?void 0:he.find(W=>W.pv))||((ye=f==null?void 0:f.columns)==null?void 0:ye[0]))==null?void 0:re.title)||"",m=(me=f==null?void 0:f.columns)==null?void 0:me.find(W=>W.title===w);if(!m)return;const C=(Rl(o)?o:[]).reduce((W,U)=>{if(!w)return W;const Ae=U[w];return W.push({value:Ae,item:U}),W},[]),b=l+4,S=i-8;let k=b,D=a+(Bo[1]===r?0:2),F=S;const I=[],M={...n,column:m,relatedColObj:void 0,relatedTableMeta:void 0,readonly:!0,height:Bo[1],padding:10,textColor:Jn.brand[500],tag:{renderAsTag:!0,tagBgColor:Jn.brand[50],tagHeight:24},meta:f},A=W=>ms.includes(m.uidt)?p(t,m,W):Fr.render(t,W),j=Ui(r,!0);let N=1,Y=!1,ae=1;for(const W of C){const U=A({...M,value:W.value,x:k,y:D,width:F});if(U!=null&&U.x)if(I.push({oldX:k+4,oldY:D+4,x:U.x,y:U.y,width:U.x-(k+4),height:U.y?U.y-(D+4):24,value:W.item}),!s&&x&&Pt({x:k,y:D,width:U.x-k,height:U.y?U.y-D:24},c)&&g("pointer"),(U==null?void 0:U.x)>=l+S-v*2-(ae<C.length?50-Xc:0)){if(N+1>j){k=U==null?void 0:U.x,Y=!0;break}k=b,F=S,D=U!=null&&U.y&&a!==(U==null?void 0:U.y)&&(U==null?void 0:U.y)-a>=28?U==null?void 0:U.y:D+28,N+=1}else F=k+F-(U==null?void 0:U.x),k=U==null?void 0:U.x;else{if(I.push({oldX:k,oldY:D,x:k+F,y:D+24,width:F,height:24,value:W.item}),!s&&x&&Pt({x:k,y:D,width:F,height:24},c)&&g("pointer"),N+1>j)break;k=b,D=D+28,F=S,N+=1}ae++}Y&&ae<C.length&&Qn(t,{x:k+12,y:a,text:"...",maxWidth:Xc,textAlign:"right",verticalAlign:"middle",fontFamily:"500 13px Inter",fillStyle:"#666",height:r}),Object.assign(y,{ltar:I}),x&&(s||oa(t,{buttonX:l+i-57,buttonY:a+6,borderRadius:6,buttonSize:xi,spriteLoader:u,mousePosition:c,icon:"ncPlus",iconData:{size:14,xOffset:3,yOffset:3},setCursor:g}),oa(t,{buttonX:l+i-30,buttonY:a+6,borderRadius:6,buttonSize:xi,spriteLoader:u,mousePosition:c,icon:"maximize",setCursor:g,iconData:{size:12,xOffset:4,yOffset:4}}))},async handleClick({row:t,column:n,getCellPosition:o,mousePosition:l,makeCellEditable:a,cellRenderStore:i,selected:r,isPublic:s,isDoubleClick:u,openDetachedExpandedForm:c}){var x;if(!r&&!u)return!1;const f=t.rowMeta.rowIndex,{x:v,y:p,width:g,height:y}=o(n,f);if(Pt({x:v+g-57,y:p+7,height:xi,width:xi},l)||Pt({x:v+g-30,y:p+7,height:xi,width:xi},l))return a(t,n),!0;if((r||u)&&Rl(i==null?void 0:i.ltar)){for(const w of i.ltar)if(Sa(w.value)&&w.width&&w.height&&Pt({x:w.oldX,y:w.oldY,height:w.height,width:w.width},l)){if(s)return!0;const m=Ht(w.value,((x=n.relatedTableMeta)==null?void 0:x.columns)||[]);return m&&c({isOpen:!0,row:{row:w.value,rowMeta:{},oldRow:{...w.value}},meta:n.relatedTableMeta||{},rowId:m,useMetaFields:!0,maintainDefaultViewOrder:!0,loadRow:!s}),!0}}return(r||u)&&Pt({x:v,y:p,width:g,height:y},l)?(a(t,n),!0):!1},handleHover:async t=>{const{row:n,column:o,mousePosition:l,getCellPosition:a,selected:i,t:r}=t;if(!i)return;const{tryShowTooltip:s,hideTooltip:u}=ul();u();const c=n.rowMeta.rowIndex,{x:f,y:v,width:p}=a(o,c),g={x:f+p-30,y:v+4,width:xi,height:xi};s({rect:g,mousePosition:l,text:r("tooltip.expandShiftSpace")})}},eC={render:(t,n)=>{var D,F,I,M,A,j,N;const{value:o,x:l,y:a,width:i,height:r,spriteLoader:s,mousePosition:u,row:c,column:f,relatedTableMeta:v,renderCell:p,readonly:g,setCursor:y,selected:x,cellRenderStore:w}=n,m=!!c[f.title],C=((I=((D=v==null?void 0:v.columns)==null?void 0:D.find(Y=>Y.pv))||((F=v==null?void 0:v.columns)==null?void 0:F[0]))==null?void 0:I.title)||"",b=((j=((M=v==null?void 0:v.columns)==null?void 0:M.find(Y=>Y.pv))||((A=v==null?void 0:v.columns)==null?void 0:A[0]))==null?void 0:j.id)||"",S=(N=v==null?void 0:v.columns)==null?void 0:N.find(Y=>Y.title===C);if(!S)return;let k;if(sa(o)){const Y=i-(Pt({x:l,y:a,width:i,height:r},u)?16:0),ae=o&&!Array.isArray(o)&&typeof o=="object"?o[C]??o[b]:o;if(k=(ye=>ms.includes(S.uidt)?p(t,S,ye):Fr.render(t,ye))({...n,value:ae,column:S,width:Y,relatedColObj:void 0,relatedTableMeta:void 0,readonly:!0,height:Bo[1],padding:10,textColor:Jn.brand[500],tag:{renderAsTag:!0,tagBgColor:Jn.brand[50],tagHeight:24},meta:v,x:l+4,y:a+(Bo[1]===r?0:2)}),!(k!=null&&k.x)||!(k!=null&&k.y))return;Object.assign(k,{width:k.x-l+4,height:k.y-(a+(Bo[1]===r?0:2))}),Object.assign(w,k),!g&&x&&Pt({x:l+4,y:a+(Bo[1]===r?0:2),height:w.height,width:w.width},u)&&y("pointer"),x&&!g&&(s.renderIcon(t,{x:k.x+2,y:a+(Bo[1]===r?8:10),icon:"ncXCircle",size:14,color:"#AFB3C2"}),Pt({x:k.x+2,y:a+(Bo[1]===r?8:10),height:14,width:14},u)&&y("pointer"))}return x&&!g&&(s.renderIcon(t,{x:l+i-27,y:a+7,icon:m?"maximize":"ncPlus",size:16,color:"#374151"}),Pt({x:l+i-27,y:a+7,height:16,width:16},u)&&y("pointer")),k},async handleClick({row:t,value:n,column:o,getCellPosition:l,mousePosition:a,makeCellEditable:i,cellRenderStore:r,selected:s,isPublic:u,readonly:c,isDoubleClick:f,openDetachedExpandedForm:v}){var S;if(!s&&!f)return!1;const p=t.rowMeta.rowIndex,{x:g,y,width:x,height:w}=l(o,p),m=16,C=Pt({x:g+x-27,y:y+7,height:m,width:m},a),b=(r==null?void 0:r.x)&&s&&Pt({x:r.x+2,y:y+8,height:m,width:m},a);if(C||b)return i(t,o),!0;if((s||f)&&Sa(n)&&(r!=null&&r.height)&&(r!=null&&r.width)&&Pt({x:g+4,y:y+(Bo[1]===w?0:2),height:r.height,width:r.width},a)){if(u)return!0;const k=Ht(n,((S=o.relatedTableMeta)==null?void 0:S.columns)||[]);return k&&v({isOpen:!0,row:{row:n,rowMeta:{},oldRow:{...n}},meta:o.relatedTableMeta||{},rowId:k,useMetaFields:!0,maintainDefaultViewOrder:!0,loadRow:!u}),!0}return(s||f)&&!c&&Pt({x:g,y,width:x,height:w},a)?(i(t,o),!0):!1}},xu=t=>{if(ch(t))return Qk;if(Ho(t))return Zk;if(Jo(t))return Jk;if(Cl(t))return eC},tC={render:(t,n)=>{const o=xu(n.column);if(o)return o.render(t,n)},handleClick:async t=>{var a,i,r,s;let n=t;const o=(i=(a=n.column)==null?void 0:a.columnObj)==null?void 0:i.colOptions;if(o!=null&&o.fk_related_base_id&&o.fk_related_base_id!==o.base_id){const u=o==null?void 0:o.fk_related_base_id,{isUIAllowed:c}=wl(),f=(r=n.baseRoles)==null?void 0:r[u];if(!f){if(n.baseRoleLoader.isLoading(u))return;n.baseRoleLoader.loadBaseRole(u);return}n={...n,readonly:n.readonly||!c("dataEdit",f)}}const l=xu(n.column.columnObj);if(l)return(s=l==null?void 0:l.handleClick)==null?void 0:s.call(l,n)},handleKeyDown:async t=>{const{row:n,column:o,e:l,makeCellEditable:a}=t;return Rr(l)?(a(n,o),!0):!1},handleHover:async t=>{var o;const n=xu(t.column.columnObj);if(n)return(o=n==null?void 0:n.handleHover)==null?void 0:o.call(n,t)}};function xs(t){const n=jn(t.meta),o={uidt:n==null?void 0:n.display_type,...n==null?void 0:n.display_column_meta};return fh(o)?jv:vh(o)?Hv:ph(o)?Vv:hh(o)?Yv:mh(o)?Kv:gh(o,"")?Uv:wh(o,"")?Fs:yh(o,"")?Gv:bh(o)?Bv:_h(o)?qv:xh(o)?Xv:pr}const nC={render:(t,n)=>{var C,b,S,k,D;const{column:o,x:l,y:a,padding:i,isPg:r,value:s,width:u,pv:c,height:f,textColor:v="#4a5268",mousePosition:p,setCursor:g,spriteLoader:y,selected:x}=n,w=jn(o.meta);if((C=jn(o.colOptions))!=null&&C.error){Qn(t,{text:"ERR!",x:l+i,y:a});return}if(w!=null&&w.display_type){xs(o).render(t,{...n,column:{...o,uidt:(w==null?void 0:w.display_type)||ve.LongText,...w.display_column_meta},readonly:!0,formula:!0});return}const m=r(o.source_id)?ws(ic(s)):ws(s);if(((S=(b=o==null?void 0:o.colOptions)==null?void 0:b.parsed_tree)==null?void 0:S.dataType)===or.NUMERIC){zv.render(t,{...n,value:m,formula:!0});return}if(((D=(k=o==null?void 0:o.colOptions)==null?void 0:k.parsed_tree)==null?void 0:D.dataType)===or.STRING){const F=rc(m),I=u-i*2;typeof F=="string"?(t.font=`${c?600:500} 13px Inter`,t.fillStyle=c?"#3366FF":v,sc(t,{htmlText:F,height:f,maxWidth:I,x:l+i,y:a+3,lineHeight:16}).find(j=>Pt(j,p))&&x&&g("pointer")):pr.render(t,{...n,value:m,formula:!0}),x&&oa(t,{buttonX:l+u-28,buttonY:a+7,buttonSize:20,borderRadius:6,iconData:{size:12,xOffset:4,yOffset:4},mousePosition:p,spriteLoader:y,icon:"maximize",background:"white",setCursor:g})}else pr.render(t,{...n,value:m,formula:!0})},handleClick:async t=>{var C,b,S,k,D,F,I;const{column:n,getCellPosition:o,value:l,openDetachedLongText:a,selected:i,isDoubleClick:r,mousePosition:s}=t;if(!i&&!r)return!1;const u=n.columnObj,c=jn(u.meta),f=((C=jn(u.colOptions))==null?void 0:C.error)??"",{x:v,y:p,width:g,height:y}=o(n,t.row.rowMeta.rowIndex),x=Ca(),{isPg:w}=x;if((c!=null&&c.display_type||!f)&&(b=xs(u))!=null&&b.handleClick)return xs(u).handleClick({...t,column:{...n,columnObj:{...u,uidt:c==null?void 0:c.display_type,...c.display_column_meta}},formula:!0});const m=w(n.columnObj.source_id)?ws(ic(t.value)):ws(t.value);if(((D=(k=(S=n.columnObj)==null?void 0:S.colOptions)==null?void 0:k.parsed_tree)==null?void 0:D.dataType)===or.STRING){const M=rc(m),A=10,j=g-A*2,N=n.pv;if(Pt({x:v+g-28,y:p+7,width:18,height:18},s))return a({column:u,vModel:l}),!0;if(typeof M=="string"){const Y=$l;Y.font=`${N?600:500} 13px Inter`;const he=sc(Y,{htmlText:M,height:y,maxWidth:j,x:v+A,y:p+3,lineHeight:16}).find(ye=>Pt(ye,t.mousePosition));he?Zs(he.url,"_blank"):i&&a({column:u,vModel:l})}if(((F=t.event)==null?void 0:F.detail)===2)return a({column:u,vModel:l}),!0}return((I=t.event)==null?void 0:I.detail)===2?(Bc(),!0):!1},handleKeyDown:async t=>{var i,r;const{column:n,value:o,openDetachedLongText:l}=t,a=n.columnObj;if(t.e.key==="Enter"||t.e.key===" "&&t.e.shiftKey){if(!ra()&&((r=(i=a==null?void 0:a.colOptions)==null?void 0:i.parsed_tree)==null?void 0:r.dataType)===or.STRING){l({column:a,vModel:o});return}return t.e.key===" "&&t.e.shiftKey?void 0:(Bc(),!0)}},async handleHover(t){var x,w,m,C,b;const{mousePosition:n,getCellPosition:o,column:l,row:a,selected:i,t:r}=t,s=l.columnObj,u=jn(s.meta),c=((x=jn(s.colOptions))==null?void 0:x.error)??"",{tryShowTooltip:f,hideTooltip:v}=ul();if(v(),u!=null&&u.display_type)return(m=(w=xs(s))==null?void 0:w.handleHover)==null?void 0:m.call(w,{...t,column:{...l,columnObj:{...s,uidt:(u==null?void 0:u.display_type)||ve.LongText,...u.display_column_meta}}});const{x:p,y:g,width:y}=o(l,a.rowMeta.rowIndex);i&&((b=(C=s==null?void 0:s.colOptions)==null?void 0:C.parsed_tree)==null?void 0:b.dataType)===or.STRING&&f({rect:{x:p+y-28,y:g+7,width:18,height:18},mousePosition:n,text:r("tooltip.expandShiftSpace")}),f({rect:{x:p+10,y:g,height:25,width:45},mousePosition:n,text:c})}},Kc={render:(t,n)=>{var v;const{value:o,x:l,y:a,width:i,height:r,pv:s,padding:u,textColor:c="#4a5268"}=n,f=(o==null?void 0:o.toString())??"";if(!f)return{x:l,y:a};if((v=n.tag)!=null&&v.renderAsTag)return Il(t,{...n,text:f});{const{x:p,y:g}=gl(t,{x:l+u,y:a,text:f,maxWidth:i-u*2,fontFamily:`${s?600:500} 13px Inter`,fillStyle:s?"#3366FF":c,height:r});return{x:p,y:g}}}},Jc={render:(t,n)=>{var g,y;const{column:o,sqlUis:l,x:a,y:i,width:r,height:s,padding:u,textColor:c="#d5d5d9"}=n,f=kh(o,Uf(o,l))||o.uidt===ve.Formula&&((y=(g=o.colOptions)==null?void 0:g.parsed_tree)==null?void 0:y.dataType)===or.NUMERIC,{x:v,y:p}=Qn(t,{x:f?a+r-u:a+u,y:i,textAlign:f?"right":"left",text:"NULL",maxWidth:r-u*2,fontFamily:"500 13px Inter",fillStyle:c,height:s});return{x:v,y:p}}},ku=1e3;function oC(t){const n=dn(zl,V(!1)),{t:o}=la(),{metas:l}=ai(),{user:a}=tl(),i=Si({});wo(Ih,i);const{isColumnSortedOrFiltered:r,appearanceConfig:s}=tu(),{isRowColouringEnabled:u}=od(),c=Ca(),{showNull:f,appInfo:v}=tl(),{isMysql:p,isXcdbBase:g,isPg:y}=c,{sqlUis:x}=Uo(c),{basesUser:w,baseRoles:m}=Uo(As()),{open:C}=Tm(),{open:b}=Mm(),S=ue(()=>{var re,me,W;return(me=(re=t.meta)==null?void 0:re.value)!=null&&me.base_id?w.value.get((W=t.meta)==null?void 0:W.value.base_id)||[]:[]}),k=t.actionManager,D=t.makeCellEditable,F=t.setCursor,I=new Map,M=new Map,A=new Map;A.set(ve.Email,Bv),A.set(ve.SingleLineText,pr),A.set(ve.LongText,Mk),A.set(ve.Number,zv),A.set(ve.Decimal,Vv),A.set(ve.Attachment,$k),A.set(ve.Checkbox,jv),A.set(ve.Date,Uv),A.set(ve.DateTime,Fs),A.set(ve.Year,Ok),A.set(ve.Time,Gv),A.set(ve.Currency,Hv),A.set(ve.Percent,Yv),A.set(ve.URL,qv),A.set(ve.GeoData,Dk),A.set(ve.PhoneNumber,Xv),A.set(ve.Duration,Lk),A.set(ve.CreatedTime,Fs),A.set(ve.LastModifiedTime,Fs),A.set(ve.JSON,Nk),A.set(ve.Barcode,Pk),A.set(ve.QrCode,Bk),A.set(ve.Rating,Kv),A.set(ve.User,bu),A.set(ve.CreatedBy,bu),A.set(ve.LastModifiedBy,bu),A.set(ve.SingleSelect,jk),A.set(ve.MultiSelect,zu),A.set(ve.Rollup,Gk),A.set(ve.Links,Hk),A.set(ve.Lookup,Yk),A.set(ve.Button,Kk),A.set(ve.LinkToAnotherRecord,tC),A.set(ve.Formula,nC),A.set(ve.Geometry,pr),A.set(ve.SpecificDBType,pr),A.set(ve.ForeignKey,Kc),A.set(ve.ID,Kc);const j=re=>(I.has(re)||I.set(re,{}),M.set(re,Date.now()+ku),I.get(re)),N=(re,me,{value:W,row:U,x:Ae,y:je,width:Ue,height:ot,selected:G=!1,pv:pe=!1,readonly:ne=!1,spriteLoader:be,imageLoader:ee,tableMetaLoader:H,padding:Ce=10,relatedColObj:Ie,relatedTableMeta:Q,tag:ie={},fontSize:Me=13,textAlign:Be="center",textColor:it,disabled:Ge,mousePosition:ze,pk:Z,meta:Et=(un=>(un=t.meta)==null?void 0:un.value)(),skipRender:_e=!1,renderAsPlainCell:yn=!1,isUnderLookup:It=!1,path:$t=[],fontFamily:et,isRowHovered:cn=!1,isRowChecked:Pn=!1,isCellInSelectionRange:Kt=!1,isGroupHeader:nn=!1,rowMeta:wt={},isRootCell:Dn=!1})=>{var Rt;if(_e)return;if(!nn){const ct=r(me.id);if(!u.value&&ct!==void 0&&!(wt!=null&&wt.isValidationFailed)){let nt="cellBgColor",rt="cellBorderColor";G||Pn||Kt?(nt="cellBgColor.selected",rt="cellBorderColor.selected"):cn&&(nt="cellBgColor.hovered",rt="cellBorderColor.hovered"),Yo(re,Ae,je,Ue,ot,0,{backgroundColor:s[ct][nt],borderColor:s[ct][rt],borderWidth:.4,borders:{top:wt.rowIndex!==0,right:!0,bottom:!0,left:!0}})}else if(!(wt!=null&&wt.isValidationFailed)&&Dn){const nt=wt!=null&&wt.is_set_as_background&&(G||cn||Pn||Kt)?wt==null?void 0:wt.rowHoverColor:wt==null?void 0:wt.rowBgColor;nt&&Yo(re,Ae,je,Ue,ot,0,{backgroundColor:nt,borderColor:Jn.gray[200],borderWidth:.4,borders:{top:wt.rowIndex!==0,right:!0,bottom:!0,left:!0}})}}const Bn=A.get(me.uidt);if(k!=null&&k.isLoading(Z,me.id)&&!ba(me)&&!Rh(me)){const ct=k==null?void 0:k.getLoadingStartTime(Z,me.id);if(ct){ed(re,Ae+Ue/2,je+8,16,"#3366FF",ct,1.5);return}}const tt=j(`${me.id}-${Z}`);re.textAlign="left";let mt;const Dt=f.value&&Sh(me)&&(Ai(W)||eu(W));return yn?mt=Fr.render:Bn?Dt?Bn.renderEmpty?mt=Bn.renderEmpty:mt=Jc.render:mt=Bn.render:Dt&&(mt=Jc.render),mt?mt(re,{value:W,row:U,column:me,x:Ae,y:je,width:Ue,height:ot,selected:G,pv:pe,readonly:ne||!t.hasEditPermission.value,spriteLoader:be,imageLoader:ee,actionManager:k,tableMetaLoader:H,isMysql:p,isPg:y,isXcdbBase:g,t:o,padding:Ce,relatedColObj:Ie,relatedTableMeta:Q,renderCell:N,meta:Et,metas:l.value,tag:ie,fontSize:Me,textAlign:Be,mousePosition:ze,textColor:it,pk:Z,disabled:Ge,sqlUis:x.value,setCursor:F,cellRenderStore:tt,baseUsers:S.value,user:a.value,isUnderLookup:It,isPublic:n.value,path:$t,fontFamily:et,isRowHovered:cn,isRowChecked:Pn,rowMeta:wt,allowLocalUrl:(Rt=v.value)==null?void 0:Rt.allowLocalUrl}):Qn(re,{x:Ae+Ce,y:je,text:(W==null?void 0:W.toString())??"",fontFamily:`${pe?600:500} 13px Inter`,fillStyle:pe?"#3366FF":it,height:ot,py:Ce})},Y=async re=>{var U,Ae,je;if(!((Ae=(U=re.column)==null?void 0:U.columnObj)!=null&&Ae.uidt))return;const me=A.get(re.column.columnObj.uidt),W=j(`${re.column.id}-${re.pk}`);return i.keyboardKey="",i.event=void 0,me!=null&&me.handleClick?await me.handleClick({...re,cellRenderStore:W,isDoubleClick:re.event.detail===2,getCellPosition:(...Ue)=>{var ot;return(ot=t==null?void 0:t.getCellPosition)==null?void 0:ot.call(t,...Ue,re.path)},readonly:!t.hasEditPermission.value,updateOrSaveRow:t==null?void 0:t.updateOrSaveRow,actionManager:k,makeCellEditable:(Ue,ot,G=re.event.detail===2)=>D(Ue,ot,G),isPublic:n.value,openDetachedExpandedForm:C,openDetachedLongText:b,path:re.path??[],allowLocalUrl:(je=v.value)==null?void 0:je.allowLocalUrl,baseRoles:m.value,t:o}):!1},ae=async re=>{var U;const me=A.get(re.column.columnObj.uidt),W=j(`${re.column.id}-${re.pk}`);return i.keyboardKey=re.e.key,i.event=re.e,me!=null&&me.handleKeyDown?await me.handleKeyDown({...re,cellRenderStore:W,readonly:!t.hasEditPermission.value,updateOrSaveRow:t==null?void 0:t.updateOrSaveRow,actionManager:k,makeCellEditable:D,openDetachedLongText:b,allowLocalUrl:(U=v.value)==null?void 0:U.allowLocalUrl,path:re.path??[],t:o}):(console.log("No handler found for cell type",re.column.columnObj.uidt),!1)},he=async re=>{var U,Ae;if(!((Ae=(U=re.column)==null?void 0:U.columnObj)!=null&&Ae.uidt))return;const me=A.get(re.column.columnObj.uidt),W=j(`${re.column.id}-${re.pk}`);if(i.keyboardKey="",me!=null&&me.handleHover)return await me.handleHover({...re,cellRenderStore:W,getCellPosition:(...je)=>{var Ue;return(Ue=t==null?void 0:t.getCellPosition)==null?void 0:Ue.call(t,...je,re.path)},updateOrSaveRow:t==null?void 0:t.updateOrSaveRow,actionManager:k,makeCellEditable:D,setCursor:F,path:re.path??[],baseUsers:S.value,t:o})};let ye=null;return oi(()=>{ye=Ch(()=>{const re=Date.now();for(const[me,W]of M.entries())re>=W&&(I.delete(me),M.delete(me))},ku)}),Xu(()=>{ye&&clearInterval(ye)}),{cellTypesRegistry:A,renderCell:N,handleCellClick:Y,handleCellKeyDown:ae,handleCellHover:he}}class lC{constructor(n,o){vo(this,"loadingCache",new Map);this.getMeta=n,this.onSettled=o}async getTableMeta(n){var o;if(!this.loadingCache.get(n)){this.loadingCache.set(n,n);try{await this.getMeta(n,void 0,void 0,void 0,!0),(o=this.onSettled)==null||o.call(this)}finally{this.loadingCache.delete(n)}}}isLoading(n){return this.loadingCache.has(n)}clearCaches(){this.loadingCache.clear()}}var Lo=(t=>(t.ROW="ROW",t.GROUP="GROUP",t.ADD_NEW_ROW="ADD_NEW_ROW",t.EDIT_NEW_ROW_METHOD="EDIT_NEW_ROW_METHOD",t))(Lo||{});class Qc{constructor({groupPath:n,rowIndex:o,...l}){vo(this,"x");vo(this,"y");vo(this,"height");vo(this,"width");vo(this,"type");vo(this,"row");vo(this,"group");vo(this,"level");vo(this,"_groupPath");vo(this,"_rowIndex");Object.assign(this,l),this._groupPath=n,this._rowIndex=o}get isGroup(){return this.type==="GROUP"}get isRow(){return this.type==="ROW"}get isAddNewRow(){return this.type==="ADD_NEW_ROW"}get rowIndex(){var n,o;return this._rowIndex??((o=(n=this.row)==null?void 0:n.rowMeta)==null?void 0:o.rowIndex)}get groupPath(){var n,o;return this._groupPath??((o=(n=this.row)==null?void 0:n.rowMeta)==null?void 0:o.path)??[]}}class Jv{constructor(n=[]){vo(this,"elements");this.elements=n}findElementAt(n,o,l){const a=this.elements.filter(i=>{const r=o>=i.y&&o<=i.y+i.height,s=!l||(Array.isArray(l)?l.includes(i.type):i.type===l);return r&&s}).sort((i,r)=>(r.level||0)-(i.level||0));return a[0]?new Qc(a[0]):null}findElementAtWithX(n,o,l){const a=this.elements.filter(i=>{const r=o>=i.y&&o<=i.y+i.height,s=i.width!==void 0&&i.width!==null?n>=i.x&&n<=i.x+i.width:!0,u=!l||i.type===l;return r&&s&&u}).sort((i,r)=>(r.level||0)-(i.level||0));return a[0]?new Qc(a[0]):null}addElement(n){this.elements.push(n)}clear(){this.elements=[]}}function aC(t,n){if(t=t+1,n===1)return{border:"#E7E7E9",background:"#FFF",aggregation:{hover:"#F9F9FA",default:"#FFF",border:"#F4F4F5"}};if(n===2)switch(t){case 2:return{background:"#FFF",border:"#E7E7E9",aggregation:{hover:"#F9F9FA",default:"#FFF",border:"#F4F4F5"}};case 1:return{background:"#F9F9FA",border:"#d5d5d9",aggregation:{hover:"#F4F4F5",default:"#F9F9FA",border:"#E7E7E8"}}}if(n===3)switch(t){case 3:return{background:"#FFF",border:"#E7E7E9",aggregation:{hover:"#F9F9FA",default:"#FFF",border:"#F4F4F5"}};case 2:return{background:"#F9F9FA",border:"#d5d5d9",aggregation:{hover:"#F4F4F5",default:"#F9F9FA",border:"#E7E7E8"}};case 1:return{background:"#F4F4F5",border:"#9AA2AF",aggregation:{hover:"#E7E7E8",default:"#F4F4F5",border:"#E7E7E9"}}}return{background:"#FFF",border:"#E7E7E9",aggregation:{hover:"#F9F9FA",default:"#FFF",border:"#F4F4F5"}}}function gr(t,n,o){let l=To+li;if(t!=null&&t.isExpanded){if(t.path)l+=(t.count||0)*n,o&&(l+=Fo),l+=1;else if(t!=null&&t.groupCount){l+=ia;for(let a=0;a<(t==null?void 0:t.groupCount);a++){const i=t.groups.get(a);if(!i){l+=To+li;continue}l+=gr(i,n,o)}}}return l}function Zc(t,n,o,l,a,i=!1,r){let s=li,u=0,c=l-1,f=s;for(let p=0;p<l;p++){const g=t.get(p),y=gr(g,o,r);if(s+y>=n){u=p;const x=Fo-(n-s),w=n+a+To+li;for(let m=p;m<l;m++){const C=t.get(m),b=gr(C,o,r);if(s+b>w){c=m;break}s+=b,c=m}return{startIndex:u,endIndex:c,startGroupYOffset:x}}f=s,s+=y,u=p+1}const v=n-f;return{startIndex:u,endIndex:c,startGroupYOffset:v}}function ma(t){if(!t)return[];const n=[];return t.nestedIn&&t.nestedIn.length>0&&t.nestedIn.forEach(o=>n.push(o.groupIndex)),n}function El(t,n){return!Rl(t)||!Rl(n)?(console.error("Path is not an array",t,n),!1):(Rl(t)?t:[]).join()===(Rl(n)?n:[]).join()}function hr(t,n,o,l,a){var s;let i=li,r=t;if(!n||n.length===0)return o*l;for(let u=0;u<n.length;u++){const c=n[u],f=r.get(c);if(!f)return i;for(let v=0;v<c;v++){const p=r.get(v);p&&(i+=gr(p,l,a))}if(!f.isExpanded)return i;if(i+=To,(s=f.path)!=null&&s.length&&u===n.length-1)return i+=o*l+1,i;if(f.groups)i+=ia,r=f.groups;else return i}return i}function iC(t){function n(o,l=[]){for(const[a,i]of o)if(i){if(i.isExpanded&&i.path)return{group:i,index:a,path:[...l,a]};if(i.isExpanded&&i.groups){const r=n(i.groups,[...l,a]);if(r.group!==null)return r}}return{group:null,index:-1,path:[]}}return n(t)}function _a(t,n){if(!n||n.length===0)return null;let o=t,l=null;for(let a=0;a<n.length;a++){const i=n[a];if(l=o.get(i),!l)return null;if(a===n.length-1)return l;if(!l.isExpanded||!l.groups)return null;o=l.groups}return l}function rC(t,n){const o=_a(t,n);return!!(o!=null&&o.isExpanded)}function es(t){return t?t.nestedIn.reduce((n,o)=>(o.key!=="__nc_null__"&&!ml(o.column_uidt)&&![ve.Rollup,ve.Lookup,ve.Formula,ve.Barcode,ve.QrCode].includes(o.column_uidt)&&(n[o.title]=o.key,o.column_uidt===ve.Checkbox&&(n[o.title]=n[o.title]===rl.TRUE?!0:n[o.title]===rl.FALSE?!1:!!n[o.title])),n),{}):{}}function ef(t){const n=t.nestedIn.map(l=>`${l.key}-${l.column_name}`).join("_")||"default";return`${typeof t.value=="object"&&t.value!==null?JSON.stringify(t.value):String(t.value)}__${n}`}class sC{constructor(n,o){vo(this,"loadingCache",new Map);this.getBaseRole=n,this.onSettled=o}async loadBaseRole(n){var o;if(!this.loadingCache.has(n)){this.loadingCache.set(n,n);try{await this.getBaseRole(n),(o=this.onSettled)==null||o.call(this)}finally{this.loadingCache.delete(n)}}}isLoading(n){return this.loadingCache.has(n)}clearCaches(){this.loadingCache.clear()}}const uC=100,dC=100,Ba=50,tf=100,nf=50,cC=500;function fC({chunkStates:t,cachedRows:n,clearCache:o,loadData:l,rowSlice:a,totalRows:i,triggerRefreshCanvas:r,isAlreadyShownUpgradeModal:s,isExternalSource:u}){const{blockExternalSourceRecordVisibility:c,showUpgradeToSeeMoreRecordsModal:f}=ql(),v=V({start:a.value.start,end:a.value.end});let p;Ga(()=>{clearTimeout(p)});const g=async(b,S=!1)=>{if(t.value[b])return;const k=b*Ba,D=S?dC:Ba;if(!(k>=i.value)){if(!s.value&&k>=ol&&c(u.value)){s.value=!0,p&&clearTimeout(p),p=setTimeout(()=>{f({isExternalSource:u.value}),clearTimeout(p)},1e3);return}t.value[b]="loading",S&&(t.value[b+1]="loading");try{(await l({offset:k,limit:D},void 0,[])).forEach(I=>n.value.set(I.rowMeta.rowIndex,I)),t.value[b]="loaded",S&&(t.value[b+1]="loaded")}catch(F){console.error(`Error fetching chunk ${b}:`,F),t.value[b]=void 0,S&&(t.value[b+1]=void 0)}}},y=async b=>{if(b.length===0)return;const S=b[0],k=b[b.length-1],D=S*Ba,F=(k+1)*Ba-D;if(!(D>=i.value)){b.forEach(I=>t.value[I]="loading");try{(await l({offset:D,limit:F},void 0,[])).forEach(M=>n.value.set(M.rowMeta.rowIndex,M)),b.forEach(M=>t.value[M]="loaded")}catch(I){console.error(`Error fetching chunks group from ${S} to ${k}:`,I),b.forEach(M=>t.value[M]=void 0)}}},x=Ju(async(b,S)=>{if(b.size>0){const k=Array.from(b).sort((M,A)=>M-A),D=[];let F=[k[0]];for(let M=1;M<k.length;M++)k[M]===k[M-1]+1?F.push(k[M]):(D.push(F),F=[k[M]]);D.push(F);const I=Math.floor(uC/Ba);for(const M of D)if(M[0]===0&&S===0&&!t.value[0]){await g(0,!0);const A=M.filter(j=>j>1);if(A.length)for(let j=0;j<A.length;j+=I){const N=A.slice(j,j+I);await y(N)}}else if(M.length>I)for(let A=0;A<M.length;A+=I){const j=M.slice(A,A+I);await y(j)}else await y(M)}el(r)},cC,!0),w=()=>{const{start:b,end:S}=a.value,k=Math.floor(b/Ba),D=Math.floor((S-1)/Ba);let F="none";b>v.value.start?F="down":b<v.value.start&&(F="up"),v.value={start:b,end:S};const I=new Set;for(let M=k;M<=D;M++)t.value[M]||I.add(M);if(F==="down"||F==="none"){const M=D+1;S%Ba>Ba-nf&&!t.value[M]&&I.add(M)}else if(F==="up"){const M=k-1;M>=0&&b%Ba<nf&&!t.value[M]&&I.add(M)}el(r),o(Math.max(0,b-tf),Math.min(i.value,S+tf)),x(I,k)},m=V(null);return{fetchChunk:g,updateVisibleRows:()=>{m.value&&cancelAnimationFrame(m.value),m.value=requestAnimationFrame(()=>{w(),m.value=null})}}}function vC({width:t,height:n,columns:o,colSlice:l,cachedGroups:a,scrollLeft:i,scrollTop:r,rowSlice:s,rowHeight:u,activeCell:c,dragOver:f,hoverRow:v,selection:p,isAiFillMode:g,isFillMode:y,getFillHandlerPosition:x,spriteLoader:w,imageLoader:m,tableMetaLoader:C,partialRowHeight:b,vSelectedAllRecords:S,isRowDraggingEnabled:k,isAddingColumnAllowed:D,isAddingEmptyRowAllowed:F,isAddingEmptyRowPermitted:I,selectedRows:M,isDragging:A,draggedRowIndex:j,targetRowIndex:N,mousePosition:Y,renderCell:ae,meta:he,editEnabled:ye,totalWidth:re,totalRows:me,actualTotalRows:W,t:U,readOnly:Ae,isFieldEditAllowed:je,setCursor:Ue,totalColumnsWidth:ot,groupByColumns:G,totalGroups:pe,isGroupBy:ne,baseColor:be,fetchMissingGroupChunks:ee,elementMap:H,getDataCache:Ce,getRows:Ie,draggedRowGroupPath:Q,removeInlineAddRecord:ie,upgradeModalInlineState:Me,rowMetaColumnWidth:Be,rowColouringBorderWidth:it}){const Ge=V(),ze=V(new Set),{tryShowTooltip:Z}=ul(),{isMobileMode:Et,isAddNewRecordGridMode:_e,appInfo:yn}=tl(),{isWsOwner:It}=ql(),{isColumnSortedOrFiltered:$t,appearanceConfig:et}=tu(),cn=dn(Yi,V(!1)),{isRowColouringEnabled:Pn}=od(),Kt=ue(()=>o.value.filter(d=>d.fixed)),nn=ue(()=>Kt.value.reduce((d,_)=>d+pn(_.width),1)),wt=(d,_,O,T,se)=>{d.save(),T=Math.min(T,se%2===0?124:144)-24,d.beginPath(),d.roundRect(_+12,O+7.5,T,16,10),d.fillStyle="#E7E7E9",d.fill(),d.clip(),d.restore()};function Dn(d,_){var Ee,Ne,He,Ze,Ke,ft,Ye,qe,ht,zt,Le,Se,Mt,xe,Pe,gt;const O=t.value;d.textAlign="left";const T=lr,se=ot.value+(!D.value&&ne.value?((Ee=G==null?void 0:G.value)==null?void 0:Ee.length)*13+(((Ne=G==null?void 0:G.value)==null?void 0:Ne.length)-1)*13:0)+(D.value&&!Et.value?T:0)-i.value;d.fillStyle="#f4f4f5",d.fillRect(0,0,se,32),d.strokeStyle="#e7e7e9",d.lineWidth=1,d.beginPath(),d.moveTo(0,32),d.lineTo(se,32),d.stroke();const{start:q,end:L}=l.value,te=o.value.slice(q,L);let we=1;for(let X=0;X<q;X++)we+=pn((He=o.value[X])==null?void 0:He.width);we===1&&(we=0),d.fillStyle="#6a7184",d.font="550 12px Inter",d.textBaseline="middle",d.imageSmoothingEnabled=!1;let oe=we;for(const X of te){const Fe=X.columnObj,vt=X.id===((Ke=(Ze=o.value)==null?void 0:Ze[o.value.length-1])==null?void 0:Ke.id),Re=pn(X.width)+(vt&&!D.value&&ne.value?(((ft=G.value)==null?void 0:ft.length)-1)*13-1:0);if(X.fixed){oe+=Re,d.beginPath(),d.moveTo(oe-i.value,0),d.lineTo(oe-i.value,32),d.stroke();continue}if(Fe!=null&&Fe.id){const so=$t(Fe.id,!0);so&&(ga(d,{height:31.5,width:Re,x:oe-i.value,y:0,radius:0,fillStyle:"#ffffff88"}),ga(d,{height:32,width:Re,x:oe-i.value,y:0,radius:0,fillStyle:et[so].headerBgColor}))}d.fillStyle="#6a7184";const bt=8;let _t=bt;_t+=16,(Ye=X.isInvalidColumn)!=null&&Ye.isInvalid&&!((qe=X.isInvalidColumn)!=null&&qe.ignoreTooltip)&&(_t+=18),(zt=(ht=X==null?void 0:X.columnObj)==null?void 0:ht.description)!=null&&zt.length&&(_t+=18);const Xe=X!=null&&X.virtual?uc(X.columnObj,X.relatedColObj):dc(X.columnObj,X.abstractType);X.uidt&&w.renderIcon(d,{icon:X!=null&&X.virtual?Xe==null?void 0:Xe.icon:Xe,size:13,color:(Xe==null?void 0:Xe.hex)??"#6a7184",x:oe+8-i.value,y:8});const tn=X.virtual?cc(Fe,((Le=he.value)==null?void 0:Le.columns)||[]):(Fe==null?void 0:Fe.rqd)&&!(Fe!=null&&Fe.cdf),Yt=Re-(26+_t+(tn?4:0)),en=Hl(d,X.title,Yt);d.fillText(en,oe+26-i.value,16),tn&&(d.save(),d.fillStyle="#EF4444",d.fillText("*",oe+28-i.value+d.measureText(en).width,16),d.restore());let pt=oe+Re-bt;je.value&&!(Fe!=null&&Fe.readonly)?(pt-=16,w.renderIcon(d,{icon:"chevronDown",size:14,color:"#6a7184",x:pt-i.value,y:9})):(Se=he.value)!=null&&Se.synced&&(Fe!=null&&Fe.readonly)&&(pt-=16,w.renderIcon(d,{icon:"ncZap",size:14,color:"#6a7184",x:pt-i.value,y:9})),(Mt=X.isInvalidColumn)!=null&&Mt.isInvalid&&!((xe=X.isInvalidColumn)!=null&&xe.ignoreTooltip)&&(pt-=18,w.renderIcon(d,{icon:"alertTriangle",size:14,color:"#FF928C",x:pt-i.value,y:9})),(gt=(Pe=X==null?void 0:X.columnObj)==null?void 0:Pe.description)!=null&&gt.length&&(pt-=18,w.renderIcon(d,{icon:"ncInfo",size:13,color:"#6B7280",x:pt-i.value,y:9})),oe+=Re,Y&&Math.abs(oe-i.value-Y.x)<=10&&Y.y<=32&&!cn.value?(ze.value.add(X.id),d.strokeStyle="#9CDAFA",d.lineWidth=2,d.beginPath(),d.moveTo(oe-i.value,0),d.lineTo(oe-i.value,32),d.stroke(),d.strokeStyle="#e7e7e9",d.lineWidth=1):(ze.value.delete(X.id),d.beginPath(),d.moveTo(oe-i.value,0),d.lineTo(oe-i.value,32),d.stroke())}if(D.value&&!Et.value&&(d.fillStyle="#F9F9FA",d.fillRect(oe-i.value,0,T,32),w.renderIcon(d,{icon:"ncPlus",size:16,color:"#6a7184",x:oe+T/2-8-i.value,y:8}),d.beginPath(),d.moveTo(oe+T-i.value,0),d.lineTo(oe+T-i.value,32),d.stroke(),d.beginPath(),d.moveTo(oe-i.value,32),d.lineTo(oe+T-i.value,32),d.stroke()),!ne.value){const X=x();if(_&&oe-i.value>=_.x&&oe-i.value<=_.x+_.width||X&&oe-i.value+1>=X.x&&oe-i.value-1<=X.x)if(d.strokeStyle="#f4f4f5",X&&(_!=null&&_.y)&&(d.beginPath(),d.moveTo(oe-i.value,32),d.lineTo(oe-i.value,_.y),d.stroke()),X){if(!y.value&&!p.value.isSingleCell()){if(d.beginPath(),p.value.start.col!==p.value.end.col)d.moveTo(oe-i.value,_?_.y:32);else{let Fe=_?_.y+_.height:32;Fe===X.y&&(Fe-=X.size/2),d.moveTo(oe-i.value,Fe)}d.lineTo(oe-i.value,X.y-X.size/2),d.stroke()}d.beginPath(),d.moveTo(oe-i.value,X.y+X.size/2),d.lineTo(oe-i.value,(s.value.end-s.value.start+1)*u.value+32),d.stroke()}else _!=null&&_.y&&(_!=null&&_.height)&&(d.beginPath(),d.moveTo(oe-i.value,_.y+_.height),d.lineTo(oe-i.value,(s.value.end-s.value.start+1)*u.value+32),d.stroke());else if(te.filter(Fe=>!Fe.fixed).length){const Fe=Math.max(nn.value,oe-i.value);d.strokeStyle="#f4f4f5",d.beginPath(),d.moveTo(Fe,32),d.lineTo(Fe,(s.value.end-s.value.start+1)*u.value+33-b.value),d.stroke()}}Kt.value.length&&(oe=.5,Kt.value.forEach(X=>{var Cn,gn,xn,Vt,ln,an,Fn,Yn,ao,eo,Ro;const Fe=pn(X.width),vt=8;let Re=vt;const bt=X.columnObj;if(Re+=16,(Cn=X.isInvalidColumn)!=null&&Cn.isInvalid&&!((gn=X.isInvalidColumn)!=null&&gn.ignoreTooltip)&&(Re+=18),(Vt=(xn=X==null?void 0:X.columnObj)==null?void 0:xn.description)!=null&&Vt.length&&(Re+=18),d.fillStyle="#f4f4f5",d.fillRect(oe,0,Fe,32),(ln=X.columnObj)!=null&&ln.id){const Mo=$t(X.columnObj.id,!0);Mo&&(ga(d,{height:31.5,width:Fe,x:oe,y:0,radius:0,fillStyle:"#ffffff88"}),ga(d,{height:32,width:Fe,x:oe,y:0,radius:0,fillStyle:et[Mo].headerBgColor}))}d.fillStyle="#6a7184";const _t=X!=null&&X.virtual?uc(X.columnObj,X.relatedColObj):dc(X.columnObj,X.abstractType);X.uidt&&w.renderIcon(d,{icon:X!=null&&X.virtual?_t==null?void 0:_t.icon:_t,size:13,color:(_t==null?void 0:_t.hex)??"#6a7184",x:oe+8,y:8});const Xe=X.virtual?cc(bt,((an=he.value)==null?void 0:an.columns)||[]):(bt==null?void 0:bt.rqd)&&!(bt!=null&&bt.cdf),tn=Fe-(26+Re+(Xe?4:0)),Yt=Hl(d,X.title,tn),en=oe+(X.uidt?26:10),pt=16;if(X.id==="row_number")if(!Ae.value&&(S.value||Pt({x:0,y:0,width:O,height:32},Y))&&!ne.value){const Ve=en+(k.value?20:0),Eo=Pt({x:Ve,y:pt-8,width:16,height:16},Y);fc(d,Ve,pt-8,S.value,!1,w,Eo?"#3366FF":"#D9D9D9")}else d.fillText(Yt,en,pt);else d.fillText(Yt,en,pt),Xe&&(d.save(),d.fillStyle="#EF4444",d.fillText("*",oe+28+d.measureText(Yt).width,16),d.restore());let hn=oe+Fe-vt;X.uidt&&je.value&&!(bt!=null&&bt.readonly)?(hn-=16,w.renderIcon(d,{icon:"chevronDown",size:14,color:"#6a7184",x:hn,y:9})):(Fn=he.value)!=null&&Fn.synced&&(bt!=null&&bt.readonly)&&(hn-=16,w.renderIcon(d,{icon:"ncZap",size:14,color:"#6a7184",x:hn,y:9})),(Yn=X.isInvalidColumn)!=null&&Yn.isInvalid&&!((ao=X.isInvalidColumn)!=null&&ao.ignoreTooltip)&&(hn-=18,w.renderIcon(d,{icon:"alertTriangle",size:14,color:"#FF928C",x:hn,y:9})),(Ro=(eo=X==null?void 0:X.columnObj)==null?void 0:eo.description)!=null&&Ro.length&&(hn-=18,w.renderIcon(d,{icon:"ncInfo",size:13,color:"#6B7280",x:hn,y:9})),oe+=Fe;const so=Y&&Math.abs(oe-Y.x)<=10&&Y.y<=32;X.id==="row_number"&&(d.strokeStyle="#e7e7e9",d.lineWidth=2,d.beginPath(),d.moveTo(oe,0),d.lineTo(oe,32),d.stroke()),so&&X.id!=="row_number"&&!cn.value?(ze.value.add(X.id),d.strokeStyle="#9CDAFA",d.lineWidth=2,d.beginPath(),d.moveTo(oe,0),d.lineTo(oe,32),d.stroke(),d.strokeStyle="#e7e7e9",d.lineWidth=1):ze.value.delete(X.id)}),i.value?(d.strokeStyle="#D5D5D9",d.beginPath(),d.lineWidth=1,d.moveTo(oe,0),d.lineTo(oe,ne.value?n.value:32),d.stroke(),d.fillStyle="rgba(0, 0, 0, 0.04)",d.rect(oe,0,4,ne.value?n.value:32),d.fill()):(d.strokeStyle="#E7E7E9",d.beginPath(),d.lineWidth=1,d.moveTo(oe,0),d.lineTo(oe,ne.value?n.value:32),d.stroke()),d.shadowColor="transparent",d.shadowBlur=0,d.shadowOffsetX=0,d.shadowOffsetY=0)}const un=(d,_)=>{var q,L;if(!_)return;const O=o.value.filter(te=>te.fixed).reduce((te,we)=>te+pn(we.width),0),T=_.x<=O;let se="#3366ff";if(!_.col.isCellEditable){se="#9AA2AF";const te={x:_.x,y:_.y,height:_.height,width:_.width};Pt(te,Y)&&_.col.id!==((L=(q=ye.value)==null?void 0:q.column)==null?void 0:L.id)&&Z({mousePosition:Y,text:U("objects.permissions.editFieldTooltipTitle"),description:U("objects.permissions.editFieldTooltip"),rect:{...te},placement:"bottom"})}if(_.col.fixed||!T){Yo(d,_.x,_.y,_.width,_.height,2,{borderColor:se,borderWidth:2}),d.lineWidth=1;return}if(T){if(_.x+_.width<=O)return;const te={..._,x:O,width:_.width-(O-_.x)};Yo(d,te.x+1,te.y,te.width,te.height,2,{borderColor:se,borderWidth:2}),d.lineWidth=1}},Bn=d=>{var O,T;let _=0;for(let se=0;se<d;se++)_+=pn((O=o.value[se])==null?void 0:O.width);return _+((T=o.value[d])!=null&&T.fixed?0:1)},tt=(d,_)=>{var q;let O=0,T=!1,se=!1;for(let L=d;L<=_;L++)O+=pn((q=o.value[L])==null?void 0:q.width),T=T||!o.value[L].fixed,se=se||o.value[L].fixed;return O+(T&&se?1:0)},mt=d=>{const _=x(),O=c==null?void 0:c.value.path;if(!_)return!0;let T=0;for(const L of o.value)L.fixed&&(T+=pn(L.width));if(_.x<=T&&!_.fixedCol)return!1;if(y.value){const L=hr(a.value,O,p.value.start.row,u.value,F.value)-r.value+Fo;d.setLineDash([2,2]),d.strokeStyle=g.value?"#9751d7":"#3366ff",d.strokeRect(Bn(p.value.start.col)-i.value,L,tt(p.value.start.col,p.value.end.col),(p.value.end.row-p.value.start.row+1)*u.value),d.setLineDash([])}return d.fillStyle=g.value?"#9751d7":"#ff4a3f",d.beginPath(),d.arc(_.x+(_.fixedCol?0:1),_.y,_.size/2,0,Math.PI*2),d.fill(),Y&&Y.x>=_.x-_.size/2&&Y.x<=_.x+_.size/2&&Y.y>=_.y-_.size/2&&Y.y<=_.y+_.size/2&&Ue("crosshair"),!0},Dt=(d,_,{xOffset:O,yOffset:T,width:se},q)=>{var He,Ze,Ke,ft,Ye,qe;const L=((He=v.value)==null?void 0:He.rowIndex)===_.rowMeta.rowIndex&&El((Ze=v.value)==null?void 0:Ze.path,(Ke=_==null?void 0:_.rowMeta)==null?void 0:Ke.path),te=((ft=_.rowMeta)==null?void 0:ft.selected)||S.value,we=c.value.row===_.rowMeta.rowIndex&&El(c.value.path,(Ye=_==null?void 0:_.rowMeta)==null?void 0:Ye.path),oe=!_.rowMeta.selected&&M.value.length>=Wu||S.value;q?d.fillStyle=q:(d.fillStyle=L||we?"#F9F9FA":"#ffffff",_.rowMeta.selected&&(d.fillStyle="#F6F7FE")),d.fillRect(O,T,se,u.value);let Ee=O+4;const Ne=it.value?it.value+4:0;if(Ae.value||!(L||te||we)){let ht="13px";_.rowMeta.rowIndex+1>=1e3&&(ht="12px"),_.rowMeta.rowIndex+1>=1e4&&(ht="10px"),d.textBaseline="middle";const{width:zt}=Qn(d,{x:Ee+8,y:T,text:(_.rowMeta.rowIndex+1).toString(),maxWidth:Be.value-28-Ne,fontFamily:`500 ${ht} Inter`,isTagLabel:!0,fillStyle:"#6B7280"});Ee+=Math.max(24,zt+16)}else if((L||te||we)&&k.value){const ht=Pt({x:Ee,y:T+(u.value-16)/2,width:24,height:16},Y);ht&&!M.value.length&&!S.value?Yo(d,Ee,T+(u.value-24)/2,24,24,4,{backgroundColor:ht?Jn.gray[200]:"transparent"}):ht&&Ue("not-allowed"),w.renderIcon(d,{icon:"ncDrag",size:16,x:Ee+4,y:T+(u.value-16)/2,color:ht&&!M.value.length&&!S.value?"#3265FF":M.value.length?Jn.gray[400]:"#6B7280"}),Ee+=26}else Ee+=6;if(!Ae.value&&(te||L||we)){const ht=L&&Y.x>=Ee&&Y.x<=Ee+24&&!oe;fc(d,Ee,T+(u.value-16)/2,te,oe,w,ht?"#3366FF":"#D9D9D9"),Ee+=24}if((qe=_.rowMeta)!=null&&qe.commentCount){const ht=_.rowMeta.commentCount>99,zt=ht?"99+":_.rowMeta.commentCount.toString(),Le=18,Se=T+(u.value-Le)/2,Mt=(Fe,vt=!1)=>Qn(d,{x:Fe,y:Se,render:vt,text:zt,maxWidth:Be.value/2-Ne,fontFamily:`${ht?"600 10px":"500 13px"} Inter`,textAlign:"center",isTagLabel:!0,fillStyle:"#3366FF",height:Le+2}),{width:xe}=Mt(O+se/2-4),Pe=Math.max(20,xe+(ht?6:8)),gt=O+se-4-Pe-Ne,X=Pt({x:gt,y:Se,width:Pe,height:Le},Y);Yo(d,gt,Se,Pe,Le,{topLeft:6,topRight:6,bottomLeft:0,bottomRight:6},{backgroundColor:X?Jn.brand[100]:"#F0F3FF",borderColor:Jn.brand[200]}),Mt(gt+Pe/2,!0),ht&&Z({mousePosition:Y,text:`${_.rowMeta.commentCount} comments`,rect:{x:gt,y:Se,width:Pe,height:Le}})}else if(L||we){const ht={x:O+se-4-20-Ne,y:T+(u.value-20)/2,height:20,width:20},zt=Pt(ht,Y);oa(d,{buttonX:ht.x,buttonY:ht.y,buttonSize:20,icon:"maximize",iconData:{size:14,xOffset:3,yOffset:3,color:zt?Jn.gray[600]:Jn.gray[500]},borderRadius:6,spriteLoader:w,borderColor:zt?void 0:"transparent",background:zt?void 0:"transparent",setCursor:Ue})}if(Pn){const ht=u.value-8,zt=_.rowMeta.rowLeftBorderColor??null;ga(d,{x:O+se-8,radius:8,y:T+(u.value-ht)/2,height:ht,width:4,fillStyle:zt??"transparent",borderColor:zt??"transparent",borderWidth:0})}},Rt=(d,_)=>{if(!ie.value)return;_=_+120;const{lines:O}=gl(d,{x:t.value/2,y:_,text:U("upgrade.upgradeToSeeMoreRecordInline"),maxWidth:Math.min(t.value,520),fillStyle:"#101015",fontFamily:"700 16px Inter",height:100,lineHeight:24,maxLines:2,textAlign:"center"});_=_+O.length*24+8;const T=Math.max(me.value,W.value??0),{lines:se}=gl(d,{x:t.value/2,y:_,text:U("upgrade.upgradeToSeeMoreRecordInlineSubtitle",{plan:Iu.BUSINESS,limit:100,total:T,remaining:T-100}),maxWidth:Math.min(t.value,520),fillStyle:"#4A5268",fontFamily:"500 14px Inter",height:100,lineHeight:20,maxLines:4,textAlign:"center"});_=_+se.length*20+20;const q=(Ke=!1,ft=t.value/2)=>Qn(d,{x:ft+10,y:_,text:U("msg.learnMore"),maxWidth:120,height:32,verticalAlign:"middle",fontFamily:"600 14px Inter",fillStyle:"#374151",isTagLabel:!0,render:Ke}),L=(Ke=!1,ft=t.value/2)=>Qn(d,{x:ft+10,y:_,text:It.value?U("general.upgrade"):U("general.requestUpgrade"),maxWidth:120,height:32,verticalAlign:"middle",fontFamily:"600 14px Inter",fillStyle:"white",isTagLabel:!0,render:Ke}),te=q(!1),we=L(!1),oe=te.width+10*2+we.width+10*2+12,Ee=t.value/2-oe/2;_=_+20;const Ne=Pt({x:Ee,y:_,width:te.width+10*2,height:32},Y),He=Ke=>{ga(d,{x:Ee,radius:8,y:_,height:32,width:100,...Ke})};He({x:Ee,width:te.width+10*2,borderColor:"#E7E7E9",borderWidth:1,fillStyle:Ne?Jn.gray[100]:"white"}),q(!0,Ee);const Ze=Pt({x:Ee+te.width+10*2+12,y:_,width:we.width+10*2,height:32},Y);He({x:Ee+te.width+10*2+12,width:we.width+10*2,fillStyle:Ze?Jn.brand[600]:Jn.brand[500]}),L(!0,Ee+te.width+10*2+12),Me.value.isHoveredLearnMore=Ne,Me.value.isHoveredUpgrade=Ze,(Ne||Ze)&&Ue("pointer")};function ct(d,{row:_,initialXOffset:O,visibleCols:T,startColIndex:se,rowIdx:q,yOffset:L,group:te}){var ft,Ye,qe,ht,zt,Le,Se,Mt,xe;let we=null;const oe=[],Ee=ma(te),Ne=((ft=v.value)==null?void 0:ft.rowIndex)===q&&El((Ye=v.value)==null?void 0:Ye.path,((qe=_==null?void 0:_.rowMeta)==null?void 0:qe.path)??(te==null?void 0:te.path)),He=El((ht=c.value)==null?void 0:ht.path,Ee??(te==null?void 0:te.path)),Ze=c.value.row===q&&El(c.value.path,((zt=_==null?void 0:_.rowMeta)==null?void 0:zt.path)??(te==null?void 0:te.path)),Ke=_!=null&&_.row?(Le=_.rowMeta)!=null&&Le.is_set_as_background&&(Ne||_.rowMeta.selected||Ze)?_.rowMeta.rowHoverColor:_.rowMeta.rowBgColor:null;if(_){const Pe=Ht(_.row,((Se=he.value)==null?void 0:Se.columns)??[]);let gt=O;if(ne.value)for(let X=0;X<se;X++){const Fe=o.value[X];(Fe==null?void 0:Fe.id)==="row_number"&&(gt-=((Mt=G.value)==null?void 0:Mt.length)*13),gt+=pn(Fe==null?void 0:Fe.width)}T.forEach((X,Fe)=>{var pt,hn,on,so,Cn,gn;let vt=pn(X.width);if(X.id==="row_number"&&(vt-=O),X.fixed){gt+=vt;return}const Re=(pt=X.columnObj)!=null&&pt.id?$t((hn=X.columnObj)==null?void 0:hn.id):null,bt=Fe-1>=0&&T[Fe-1]&&((so=(on=T[Fe-1])==null?void 0:on.columnObj)!=null&&so.id)?$t((gn=(Cn=T[Fe-1])==null?void 0:Cn.columnObj)==null?void 0:gn.id):null,_t=se+Fe,Xe=ye.value&&c.value.row===q&&c.value.column===_t&&He;_.rowMeta.selected||p.value.isCellInRange({row:q,col:_t})&&He?(d.fillStyle=Ke?"#3366ff0d":"#F6F7FE",d.fillRect(gt-i.value,L,vt,u.value)):Ze&&(d.fillStyle="red");const tn=(p.value.isCellInRange({row:q,col:_t})||p.value.isCellInRange({row:q,col:_t-1}))&&He;d.strokeStyle=Ne||_.rowMeta.selected||tn||Ze||Re||bt?Jn.gray[200]:Jn.gray[100],d.beginPath(),d.moveTo(gt-i.value,L),d.lineTo(gt-i.value,L+u.value),d.stroke(),se+Fe===c.value.column&&q===c.value.row&&He&&(d.fillStyle="#FFFFFF",d.fillRect(gt-i.value,L,vt,u.value));const Yt=c.value.row===q&&c.value.column===_t&&He;Yt&&(we={col:X,x:gt-i.value,y:L,width:vt,height:u.value});const en=_.row[X.title];Ts(X.columnObj,_.row)&&oe.push({rowIndex:q,column:X}),d.save(),ae(d,X.columnObj,{value:en,x:gt-i.value,y:L,width:vt,height:u.value,row:_.row,rowMeta:_.rowMeta,selected:Yt,pv:X.pv,spriteLoader:w,readonly:X.readonly,imageLoader:m,tableMetaLoader:C,relatedColObj:X.relatedColObj,relatedTableMeta:X.relatedTableMeta,disabled:X==null?void 0:X.isInvalidColumn,mousePosition:Y,pk:Pe,path:Ee,skipRender:Xe,isRowHovered:Ne,isRowChecked:_.rowMeta.selected,isCellInSelectionRange:p.value.isCellInRange({row:q,col:_t})&&He,isRootCell:!0}),d.restore(),gt+=vt}),Kt.value.length&&(gt=ne.value?O:0,Kt.value.forEach((X,Fe)=>{let vt=pn(X.width);const Re=o.value.findIndex(Xe=>Xe.id===X.id),bt=ye.value&&c.value.row===q&&c.value.column===Re&&He;if(_.rowMeta.selected||p.value.isCellInRange({row:q,col:Re})&&He?(d.fillStyle=Ke?"#3366ff0d":"#F6F7FE",d.fillRect(gt,L,vt,u.value)):(d.fillStyle=Ne||Ze?"#F9F9FA":"#ffffff",d.fillRect(gt,L,vt,u.value)),Re===c.value.column&&q===c.value.row&&He&&(d.fillStyle="#FFFFFF",d.fillRect(gt,L,vt,u.value)),X.id==="row_number")ne.value&&(vt-=O),Dt(d,_,{xOffset:gt,yOffset:L,width:vt},Ke);else{const Xe=_.row[X.title],tn=c.value.row===q&&c.value.column===Re&&He;tn&&(we={col:X,x:gt,y:L,width:vt,height:u.value}),d.save(),Ts(X.columnObj,_.row)&&oe.push({rowIndex:q,column:X}),ae(d,X.columnObj,{value:Xe,x:gt,y:L,width:vt,height:u.value,row:_.row,rowMeta:_.rowMeta,selected:tn,pv:X.pv,readonly:X.readonly,spriteLoader:w,imageLoader:m,tableMetaLoader:C,relatedColObj:X.relatedColObj,relatedTableMeta:X.relatedTableMeta,mousePosition:Y,disabled:X==null?void 0:X.isInvalidColumn,pk:Pe,skipRender:bt,path:Ee,isRowHovered:Ne,isRowChecked:_.rowMeta.selected,isCellInSelectionRange:p.value.isCellInRange({row:q,col:Re})&&He,isRootCell:!0}),d.restore()}const _t=(p.value.isCellInRange({row:q,col:Re})||p.value.isCellInRange({row:q,col:Re-1}))&&He;d.strokeStyle=Fe!==0&&(Ne||_.rowMeta.selected||_t||Ze||Ke)?Jn.gray[200]:Jn.gray[100],d.lineWidth=1,d.beginPath(),d.moveTo(gt,L),d.lineTo(gt,L+u.value),d.stroke(),gt+=vt}),i.value&&!ne.value&&(d.fillStyle="rgba(0, 0, 0, 0.04)",d.rect(gt,L,4,u.value),d.fill(),d.strokeStyle="#D5D5D9",d.beginPath(),d.moveTo(gt,L),d.lineTo(gt,L+u.value),d.stroke()),T.filter(X=>!X.fixed).length||(d.strokeStyle="#f4f4f5",d.beginPath(),d.moveTo(gt,L),d.lineTo(gt,L+u.value),d.stroke()),d.fillStyle="transparent",d.strokeStyle="white",d.shadowColor="transparent",d.shadowBlur=0,d.shadowOffsetX=0,d.shadowOffsetY=0)}else{_={row:{},rowMeta:{rowIndex:q,selected:!1,commentCount:0,path:te?te.path:[]},oldRow:{}};let Pe=O;if(ne.value)for(let gt=0;gt<se;gt++){const X=o.value[gt];(X==null?void 0:X.id)==="row_number"&&(Pe-=((xe=G.value)==null?void 0:xe.length)*13),Pe+=pn(X==null?void 0:X.width)}T.forEach((gt,X)=>{let Fe=pn(gt.width);const vt=se+X;if(gt.id==="row_number"&&(Fe-=O),gt.fixed){Pe+=Fe;return}p.value.isCellInRange({row:q,col:vt})&&(d.fillStyle="#F6F7FE",d.fillRect(Pe-i.value,L,Fe,u.value)),d.strokeStyle="#f4f4f5",d.beginPath(),d.moveTo(Pe-i.value,L),d.lineTo(Pe-i.value,L+u.value),d.stroke(),c.value.row===q&&c.value.column===vt&&(we={col:gt,x:Pe-i.value,y:L,width:Fe,height:u.value}),Pe+=Fe}),Kt.value.length&&(Pe=ne.value?O:0,Kt.value.forEach(gt=>{let X=pn(gt.width);const Fe=o.value.findIndex(vt=>vt.id===gt.id);p.value.isCellInRange({row:q,col:Fe})?(d.fillStyle="#F6F7FE",d.fillRect(Pe,L,X,u.value)):(d.fillStyle=Ne||Ze?"#F9F9FA":"#ffffff",d.fillRect(Pe,L,X,u.value)),gt.id==="row_number"?(ne.value&&(X-=O),Dt(d,_,{xOffset:Pe,yOffset:L,width:X})):(c.value.row===q&&c.value.column===Fe&&(we={col:gt,x:Pe,y:L,width:X,height:u.value}),wt(d,Pe,L,X,q)),d.strokeStyle="#f4f4f5",d.beginPath(),d.moveTo(Pe,L),d.lineTo(Pe,L+u.value),d.stroke(),Pe+=X}),d.strokeStyle="#f4f4f5",d.beginPath(),d.moveTo(Pe,L),d.lineTo(Pe,L+u.value),d.stroke(),d.shadowColor="transparent",d.shadowBlur=0,d.shadowOffsetX=0,d.shadowOffsetY=0)}return{activeState:we,renderRedBorders:oe}}function nt(d){var Ze,Ke,ft,Ye,qe,ht,zt,Le,Se,Mt,xe,Pe,gt;const{end:_}=s.value,{start:O,end:T}=l.value,se=Math.floor(r.value/u.value),q=o.value.slice(O,T);let L=-b.value+33,te=null,we=1;for(let X=0;X<O;X++)we+=pn((Ze=o.value[X])==null?void 0:Ze.width);let oe=[];const Ee=Math.max(nn.value,re.value-i.value-256<t.value?re.value-i.value-256:t.value);let Ne=null;const He=Ce();for(let X=se;X<_;X++)if(L+u.value>0&&L<n.value&&(!ie.value||X<=Fh)){const Fe=He.cachedRows.value.get(X),vt=X+1<_?He.cachedRows.value.get(X+1):null;X===j.value&&(d.globalAlpha=.5);const Re=((Ke=v.value)==null?void 0:Ke.rowIndex)===X&&El((ft=v.value)==null?void 0:ft.path,(Ye=Fe==null?void 0:Fe.rowMeta)==null?void 0:Ye.path),bt=c.value.row===X&&El(c.value.path,(qe=Fe==null?void 0:Fe.rowMeta)==null?void 0:qe.path),_t=Fe!=null&&Fe.row?Fe.rowMeta.rowBgColor:null,Xe=((ht=v.value)==null?void 0:ht.rowIndex)===X+1&&El((zt=v.value)==null?void 0:zt.path,(Le=Fe==null?void 0:Fe.rowMeta)==null?void 0:Le.path),tn=c.value.row===X+1&&El(c.value.path,(Se=Fe==null?void 0:Fe.rowMeta)==null?void 0:Se.path),Yt=vt&&vt.rowMeta.selected;d.fillStyle=Re||bt?"#F9F9FA":"#ffffff",d.fillRect(0,L,Ee,u.value);const en=ct(d,{row:Fe,initialXOffset:we,visibleCols:q,rowIdx:X,startColIndex:O,yOffset:L});H.addElement({y:L,x:0,height:u.value,row:Fe,type:Lo.ROW}),te=en.activeState??te,oe=[...oe,...en.renderRedBorders],X===j.value&&(d.globalAlpha=1),d.strokeStyle=Re||(Mt=Fe==null?void 0:Fe.rowMeta)!=null&&Mt.selected||bt||Xe||tn||Yt||_t?Jn.gray[300]:Jn.gray[200],d.lineWidth=1,d.beginPath(),d.moveTo(0,L+u.value),d.lineTo(Ee,L+u.value),d.stroke(),ie.value&&X>=ol&&(d.fillStyle="rgba(231, 231, 233, 0.8)",d.fillRect(0,L,Ee,u.value),d.fill()),(Fe!=null&&Fe.rowMeta.isValidationFailed||Fe!=null&&Fe.rowMeta.isRowOrderUpdated)&&(Ne={row:Fe,yOffset:L}),L+=u.value}if(F.value&&!Et.value&&!ie.value){const X=Pt({x:0,y:L,height:Fo,width:Ee},Y);d.fillStyle=X&&I.value?"#F9F9FA":"#ffffff",d.fillRect(0,L,Ee,Fo),d.strokeStyle="#f4f4f5",d.beginPath(),d.moveTo(0,L+Fo),d.lineTo(Ee,L+Fo),d.stroke(),w.renderIcon(d,{icon:"ncPlus",color:X&&I.value?"#000000":"#4a5268",x:16,y:L+9,size:14}),X&&!I.value&&Z({mousePosition:Y,text:U("objects.permissions.addNewRecordTooltipTitle"),description:U("objects.permissions.addNewRecordTooltip"),rect:{x:0,y:L,width:Ee,height:Fo,targetWidth:258}}),I.value&&H.addElement({y:L,x:0,height:Fo,path:[],type:Lo.ADD_NEW_ROW})}if(Ne){const X="#fcbe3a";d.strokeStyle="orange",d.beginPath(),d.moveTo(0,Ne.yOffset),d.lineTo(Ee,Ne.yOffset),d.lineWidth=2,d.stroke(),d.strokeStyle="orange",d.beginPath(),d.moveTo(0,Ne.yOffset+u.value),d.lineTo(Ee,Ne.yOffset+u.value),d.lineWidth=2,d.stroke(),Yo(d,0,Ne.yOffset+u.value,90,25,{bottomRight:6},{backgroundColor:X}),Qn(d,{text:Ne.row.rowMeta.isValidationFailed?"Row filtered":"Row moved",x:10,y:Ne.yOffset+u.value,py:7,fillStyle:"#1f293a",fontSize:12,fontFamily:"600 12px Inter"})}un(d,te);for(const{rowIndex:X,column:Fe}of oe){if(((Pe=(xe=ye.value)==null?void 0:xe.column)==null?void 0:Pe.id)===Fe.id&&((gt=ye.value)==null?void 0:gt.rowIndex)===X)continue;const vt=-b.value+33+(X-s.value.start)*u.value,Re=Bn(o.value.findIndex(tn=>tn.id===Fe.id)),bt=pn(Fe.width),_t=o.value.filter(tn=>tn.fixed).reduce((tn,Yt)=>tn+pn(Yt.width),1),Xe=Re-i.value<=_t;if(d.strokeStyle="#ff4a3f",d.lineWidth=2,Fe.fixed||!Xe)Yo(d,Fe.fixed?Re:Re-i.value,vt,bt,u.value,2,{borderColor:"#ff4a3f",borderWidth:2});else if(Xe){if(Re+bt<=_t)continue;const tn=_t,Yt=Re+bt-_t-i.value;Yo(d,tn+1,vt,Yt,u.value,2,{borderColor:"#ff4a3f",borderWidth:2})}d.lineWidth=1}return mt(d),Rt(d,L),te}const rt=d=>{var T,se;if(!f.value)return;let _=0;for(let q=0;q<f.value.index;q++)_+=pn((T=o.value[q])==null?void 0:T.width);const O=pn((se=o.value[f.value.index-1])==null?void 0:se.width);d.fillStyle="#f4f4f5",d.globalAlpha=.6,d.fillRect(_-i.value,0,O,n.value),d.globalAlpha=1,d.strokeStyle="#3366ff",d.lineWidth=2,d.beginPath(),d.moveTo(_-i.value,0),d.lineTo(_-i.value,n.value),d.stroke()};function st(d){var L,te;const{start:_,end:O}=l.value;d.beginPath(),d.strokeStyle="#E7E7E9",d.moveTo(0,n.value-On-.5),d.lineTo(t.value,n.value-On-.5),d.stroke(),d.fillStyle="#F9F9FA",d.fillRect(0,n.value-On,t.value,On);let T=0;for(let we=0;we<_;we++)T+=pn((L=o.value[we])==null?void 0:L.width);const se=o.value.slice(_,O);let q=T;if(se.forEach(we=>{var He;const oe=pn(we.width);if(we.fixed){q+=oe;return}const Ee=(He=we.aggregation)==null?void 0:He.toString(),Ne=Pt({x:q-i.value,y:n.value-On,width:oe,height:On},Y);if(d.fillStyle=Ne?"#F4F4F5":"#F9F9FA",we.agg_fn&&![du.None].includes(we.agg_fn)){d.save(),d.beginPath(),d.rect(q-i.value,n.value-On,oe,On),d.fill(),d.clip(),d.textBaseline="middle",d.textAlign="right",d.font="600 12px Inter";const Ze=d.measureText(Ee??"").width;we.agg_prefix&&(d.font="400 12px Inter",d.fillStyle="#6a7184",d.fillText(we.agg_prefix,q+oe-Ze-16-i.value,n.value-On/2)),d.font="600 12px Inter",d.fillStyle="#4a5268",d.fillText(Ee??" - ",q+oe-8-i.value,n.value-On/2),cn.value&&Ne&&Z({mousePosition:Y,text:"Unlock this view to edit aggregation",rect:{x:q-i.value,y:n.value-On,width:oe,height:On}}),d.restore()}else if(Ne){if(cn.value)Z({mousePosition:Y,text:"Unlock this view to add aggregation",rect:{x:q-i.value,y:n.value-On,width:oe,height:On}});else{d.save(),d.beginPath(),d.rect(q-i.value,n.value-On,oe,On),d.fill(),d.clip(),d.font="600 10px Inter",d.fillStyle="#6a7184",d.textAlign="right",d.textBaseline="middle";const Ze=q+oe-8-i.value,Ke=n.value-On/2;d.fillText("Summary",Ze,Ke);const ft=d.measureText("Summary").width;w.renderIcon(d,{icon:"chevronDown",size:14,color:"#6a7184",x:Ze-ft-18,y:Ke-7})}d.restore()}d.beginPath(),d.strokeStyle="#f4f4f5",d.moveTo(q-i.value,n.value-On),d.lineTo(q-i.value,n.value),d.stroke(),q+=oe}),Kt.value.length){q=0;const we=Kt.value.find(Ee=>Ee.id==="row_number"),oe=Kt.value.find(Ee=>Ee.id!=="row_number");if(we&&oe){const Ee=pn(we.width)+pn(oe.width),Ne=Pt({x:q,y:n.value-On,width:Ee,height:On},Y);d.fillStyle=Ne?"#F4F4F5":"#F9F9FA",d.fillRect(q,n.value-On,Ee,On),d.fillStyle="#6a7184",d.textBaseline="middle";let He=Ee-16;if(oe.agg_fn&&![du.None].includes(oe.agg_fn)){d.save(),d.beginPath(),d.rect(q,n.value-On,Ee,On),d.clip();const ft=(te=oe.aggregation)==null?void 0:te.toString();d.textAlign="right",d.font="600 12px Inter";const Ye=d.measureText(ft??"").width;if(oe.agg_prefix){d.font="400 12px Inter",d.fillStyle="#6a7184",d.fillText(oe.agg_prefix,Ee-Ye-16,n.value-On/2);const ht=d.measureText(oe.agg_prefix).width;He-=ht}d.font="600 12px Inter",d.fillStyle="#4a5268",d.fillText(ft??" - ",Ee-8,n.value-On/2),cn.value&&Ne&&Z({mousePosition:Y,text:"Unlock this view to add aggregation.",rect:{x:q,y:n.value-On,width:Ee,height:On}});const qe=d.measureText(ft??"").width;He-=qe,d.restore()}else if(Ne){if(cn.value)Z({mousePosition:Y,text:"Unlock this view to add aggregation.",rect:{x:q,y:n.value-On,width:Ee,height:On}});else{d.save(),d.beginPath(),d.rect(q,n.value-On,Ee,On),d.clip(),d.font="600 10px Inter",d.textAlign="right";const ft=q+Ee-8,Ye=n.value-On/2;d.fillText("Summary",ft,Ye);const qe=d.measureText("Summary").width;He-=qe,w.renderIcon(d,{icon:"chevronDown",size:14,color:"#6a7184",x:ft-qe-18,y:Ye-7})}He-=18,d.restore()}const Ze=ne.value?pe.value:Math.max(me.value,W.value??0),Ke=ne.value?U(Ze!==1?"objects.groups":"objects.group"):U(Ze!==1?"objects.records":"objects.record");Qn(d,{text:`${Intl.NumberFormat("en",{notation:"compact"}).format(Ze)} ${Ke}`,x:q+8,y:n.value-On+2,fillStyle:"#6a7184",textAlign:"left",fontSize:12,maxWidth:He-16,fontFamily:"500 12px Inter"}),n.value&&Z({mousePosition:Y,text:`${Ze} ${Ke}`,rect:{x:q,y:n.value-On,width:He-16,height:On}}),d.strokeStyle="#e7e7e9",d.beginPath(),d.moveTo(q,n.value-On),d.lineTo(q,n.value),d.stroke(),q+=Ee,Kt.value.slice(2).forEach(ft=>{var zt;const Ye=pn(ft.width),qe=Pt({x:q,y:n.value-On,width:Ye,height:On},Y);d.fillStyle="#F9F9FA",d.fillRect(q,n.value-On,Ye,On);const ht=(zt=oe.aggregation)==null?void 0:zt.toString();if(sa(ht)){d.save(),d.beginPath(),d.rect(q,n.value-On,Ye,On),d.clip(),d.font="600 12px Inter";const Le=d.measureText(ht).width;ft.agg_prefix&&(d.font="400 12px Inter",d.fillStyle="#6a7184",d.fillText(ft.agg_prefix,q+Ye-Le-16,n.value-On/2)),d.font="600 12px Inter",d.fillStyle="#4a5268",d.fillText(ht,q+Ye-8,n.value-On/2),d.restore()}else if(qe){d.save(),d.beginPath(),d.rect(q,n.value-On,Ye,On),d.clip(),d.font="600 10px Inter",d.fillStyle="#6a7184",d.textAlign="right",d.textBaseline="middle";const Le=q+Ye-8,Se=n.value-On/2;d.fillText("Summary",Le,Se);const Mt=d.measureText("Summary").width;cn.value||w.renderIcon(d,{icon:"chevronDown",size:14,color:"#6a7184",x:Le-Mt-18,y:Se-7}),d.restore()}d.strokeStyle="#e7e7e9",d.beginPath(),d.moveTo(q,n.value-On),d.lineTo(q,n.value),d.stroke(),q+=Ye}),d.strokeStyle="#f4f4f5",d.beginPath(),d.moveTo(q,n.value-On),d.lineTo(q,n.value),d.stroke(),d.shadowColor="transparent",d.shadowBlur=0,d.shadowOffsetX=0,d.shadowOffsetY=0}}}const lt=(d,_=[])=>{if(!A.value||j.value===null||N.value===null)return;let O;ne.value?O=hr(a.value,_,N.value,u.value,F.value)-r.value+Fo:O=(N.value-s.value.start)*u.value-b.value+Fo,d.strokeStyle="#3366ff",d.lineWidth=2,d.beginPath(),d.moveTo(G.value.length*13,O),d.lineTo(d.canvas.width,O),d.stroke(),d.save();const T=Y.y,se=500,q=Y.x;d.translate(q+se/2,T),d.rotate(.5*Math.PI/180),d.translate(-(q+se/2),-T),d.beginPath(),d.roundRect(q,T-u.value/2,se,u.value,6),d.clip(),d.shadowColor="rgba(0, 0, 0, 0.10)",d.shadowBlur=16,d.shadowOffsetY=12,d.shadowOffsetX=0,d.save(),d.shadowColor="rgba(0, 0, 0, 0.06)",d.shadowBlur=6,d.shadowOffsetY=4,d.fillStyle="#ffffff",d.fill(),d.restore(),d.strokeStyle="#D5D5D9",d.lineWidth=1,d.stroke();const te=Ce(_).cachedRows.value.get(j.value);if(te){let we=q;o.value.forEach(oe=>{var Ne;const Ee=pn(oe.width);we-q<se&&(d.save(),ae(d,oe.columnObj,{value:te.row[oe.title],x:we,y:T-u.value/2,width:Math.min(Ee,se-(we-q)),height:u.value,row:te.row,rowMeta:te.rowMeta,selected:!1,readonly:!0,pv:oe.pv,spriteLoader:w,imageLoader:m,relatedColObj:oe.relatedColObj,relatedTableMeta:oe.relatedTableMeta,disabled:oe==null?void 0:oe.isInvalidColumn,mousePosition:{x:-1,y:-1},pk:Ht(te.row,((Ne=he.value)==null?void 0:Ne.columns)??[])}),d.restore()),we+=Ee})}d.restore()};function xt(d,_,O,T,se,q){var zt,Le,Se;if(!_.path)return O;const te=Ce(_.path).cachedRows.value,{start:we,end:oe}=l.value,Ee=o.value.slice(we,oe),Ne=[];let He=null,Ze=[],Ke=null;O+=1;const ft=T*13+1,Ye=Math.max(nn.value-ft,re.value-i.value-256<t.value?re.value-i.value-256-2*ft:t.value),qe=O;for(let Mt=se;Mt<=q;Mt++){const xe=te==null?void 0:te.get(Mt);xe||Ne.push(Mt);const Pe=((zt=v.value)==null?void 0:zt.rowIndex)===Mt&&El((Le=v.value)==null?void 0:Le.path,((Se=xe==null?void 0:xe.rowMeta)==null?void 0:Se.path)??_.path);Yo(d,ft,O,Ye,u.value,0,{backgroundColor:Pe?"#F9F9FA":"#fff"}),d.save(),d.rect(ft,O,Ye,u.value),d.clip();const gt=ct(d,{row:xe,initialXOffset:ft,visibleCols:Ee,startColIndex:we,rowIdx:Mt,yOffset:O,group:_});d.restore(),H.addElement({y:O,x:ft,group:_,level:T,height:u.value,path:_.nestedIn,rowIndex:Mt,row:xe,type:Lo.ROW}),He=gt.activeState??He,Ze=[...Ze,...gt.renderRedBorders],d.strokeStyle="#e7e7e9",d.beginPath(),d.moveTo(ft,O+u.value),d.lineTo(Ye+ft,O+u.value),d.stroke(),(xe!=null&&xe.rowMeta.isValidationFailed||xe!=null&&xe.rowMeta.isRowOrderUpdated||xe!=null&&xe.rowMeta.isGroupChanged)&&(Ke={row:xe,yOffset:O}),O+=u.value}if(F.value&&!Et.value){const Mt=Pt({x:0,y:O,height:Fo,width:Ye},Y);Yo(d,T*13,O,Ye+2,Fo,{bottomLeft:8,bottomRight:8,topRight:0,topLeft:0},{backgroundColor:Mt&&I.value?"#F9F9FA":"#ffffff",borders:{bottom:!0},borderColor:"#e7e7e9",borderWidth:1}),w.renderIcon(d,{icon:_e.value?"ncPlus":"form",color:Mt&&I.value?"#000000":"#4a5268",x:16+T*13,y:O+9,size:14});const{width:xe}=Qn(d,{x:36+T*13,y:O+2,fontFamily:"600 13px Inter",height:Fo,fillStyle:"#374151",text:`${U("activity.newRecord")}`});w.renderIcon(d,{icon:"chevronDown",color:Mt&&I.value?"#000000":"#4a5268",x:36+T*13+xe+12,y:O+10,size:14}),Mt&&!I.value&&Z({mousePosition:Y,text:U("objects.permissions.addNewRecordTooltipTitle"),description:U("objects.permissions.addNewRecordTooltip"),rect:{x:T*13,y:O,height:Fo,width:Ye,targetWidth:258}}),H.addElement({x:36+T*13+xe+12,y:O+9,width:16,group:_,level:T,height:Fo,path:_.nestedIn,groupPath:_==null?void 0:_.path,type:Lo.EDIT_NEW_ROW_METHOD}),I.value&&H.addElement({y:O,x:T*13,group:_,level:T,height:Fo,path:_.nestedIn,groupPath:_==null?void 0:_.path,type:Lo.ADD_NEW_ROW}),O+=Fo}if(Ke){const Mt="#fcbe3a",xe=T*13;d.strokeStyle="orange",d.beginPath(),d.moveTo(xe,Ke.yOffset),d.lineTo(Ye+xe+2,Ke.yOffset),d.lineWidth=2,d.stroke(),d.strokeStyle="orange",d.beginPath(),d.moveTo(xe,Ke.yOffset+u.value),d.lineTo(Ye+xe+2,Ke.yOffset+u.value),d.lineWidth=2,d.stroke(),Yo(d,xe,Ke.yOffset+u.value,90,25,{bottomRight:6},{backgroundColor:Mt}),Qn(d,{text:Ke.row.rowMeta.isValidationFailed?"Row filtered":"Row moved",x:10+xe,y:Ke.yOffset+u.value,py:7,fillStyle:"#1f293a",fontSize:12,fontFamily:"600 12px Inter"})}const ht=()=>{var Mt,xe,Pe,gt;for(const{rowIndex:X,column:Fe}of Ze){if(((xe=(Mt=ye.value)==null?void 0:Mt.column)==null?void 0:xe.id)===Fe.id&&((Pe=ye.value)==null?void 0:Pe.rowIndex)===X&&!El((gt=ye.value)==null?void 0:gt.path,_==null?void 0:_.path))continue;const vt=qe+X*u.value,Re=Bn(o.value.findIndex(tn=>tn.id===Fe.id)),bt=pn(Fe.width),_t=o.value.filter(tn=>tn.fixed).reduce((tn,Yt)=>tn+pn(Yt.width),1),Xe=Re-i.value<=_t;if(d.strokeStyle="#ff4a3f",d.lineWidth=2,Fe.fixed||!Xe)Yo(d,Fe.fixed?Re:Re-i.value,vt,bt,u.value,2,{borderColor:"#ff4a3f",borderWidth:2});else if(Xe){if(Re+bt<=_t)continue;const tn=_t,Yt=Re+bt-_t-i.value;Yo(d,tn+1,vt,Yt,u.value,2,{borderColor:"#ff4a3f",borderWidth:2})}d.lineWidth=1}un(d,He),mt(d)};if(Ne!=null&&Ne.length){const Mt=Math.max(...Ne),xe=Math.min(...Ne);Ie(xe,Mt,_.path)}return{yOffset:O,postRenderCbk:ht}}function Ot(d,{level:_=0,yOffset:O,pGroup:T,startIndex:se,endIndex:q,_isStartGroup:L}){var Ye,qe,ht,zt,Le;const te=(T==null?void 0:T.groups)??a.value,we=[],oe=Kt.value.find(Se=>Se.id==="row_number"),Ee=Kt.value.find(Se=>Se.id!=="row_number"),Ne=(_+1)*13,He=pn(oe==null?void 0:oe.width)+pn(Ee==null?void 0:Ee.width)-Ne,Ze=Math.max(nn.value-(_+1)*13,re.value-i.value-256<t.value?re.value-i.value-256-2*Ne:t.value);let Ke=O;const ft=[];for(let Se=se;Se<=q;Se++){const Mt=(L??!0)&&Se===se,xe=te.get(Se);xe||we.push(Se);const Pe=Ke,gt=gr(xe,u.value,F.value);if(Pe+gt<0||Pe>n.value){Ke+=gt;continue}xe&&H.addElement({y:Pe,x:Ne,level:_,height:To,path:xe.nestedIn,groupIndex:Se,group:xe,type:Lo.GROUP});const{background:Fe,border:vt,aggregation:{hover:Re,default:bt,border:_t}}=aC(_,G.value.length);if(Pe+gt>=0&&Pe<n.value){let Xe=Ke+To;if(xe!=null&&xe.isExpanded){const Cn=Xe,gn=Array.from({length:se},(Vt,ln)=>{const an=te.get(ln);return gr(an,u.value,F.value)}).reduce((Vt,ln)=>Vt+ln,0),xn=Mt?r.value-gn:0;if(Yo(d,Ne,Pe+To,Ze,gt-li-To,{bottomRight:8,bottomLeft:8},{backgroundColor:Fe,borderColor:vt,borders:{top:!1,right:!0,bottom:!0,left:!0}}),xe.path){const Vt=n.value-Xe,ln=u.value,an=Math.min(xe.count,Math.max(0,Math.floor(-(Pe+To-Fo)/ln))),Fn=Math.ceil(Vt/ln),Yn=Math.min(an+Fn,xe.count-1),{yOffset:ao,postRenderCbk:eo}=xt(d,xe,Cn+an*u.value,_+1,an,Yn);Xe=ao,ft.push(eo)}else{const{endIndex:Vt}=Zc(xe.groups,xn,u.value,xe.groupCount,n.value-Pe-To-ia,!0,F.value),{currentOffset:ln,missingChunks:an,postRenderCbk:Fn}=Ot(d,{level:_+1,yOffset:Cn+ia,pGroup:xe,startIndex:0,endIndex:Math.max(0,Vt),_isStartGroup:Mt});if(ft.push(Fn),Xe=ln,an.length){const Yn=Math.min(...an),ao=Math.max(...an);ee(Yn,ao,xe)}}}if(Yo(d,Ne,Pe,Ze,To,xe!=null&&xe.isExpanded?{topLeft:8,topRight:8,bottomLeft:0,bottomRight:0}:8,{backgroundColor:Fe,borderColor:vt,borders:{bottom:!(xe!=null&&xe.isExpanded)||!!((Ye=xe==null?void 0:xe.path)!=null&&Ye.length),top:!0,left:!0,right:!0}}),(qe=yn.value)!=null&&qe.ee){const{start:Cn,end:gn}=l.value,xn=o.value.slice(Cn,gn);let Vt=1;for(let ln=0;ln<Cn;ln++)Vt+=pn((ht=o.value[ln])==null?void 0:ht.width);xn.forEach((ln,an)=>{const Fn=pn(ln.width);if(ln.fixed){Vt+=Fn;return}const Yn=Pt({x:Vt-i.value,y:Math.max(Ke,Fo)+1,width:Fn,height:To-1+(xe!=null&&xe.isExpanded&&!(xe!=null&&xe.path)?ia:0)},Y);Yn&&Ue("pointer"),d.fillStyle=Yn?Re:bt;const ao=Vt-i.value,eo=Math.max(0,nn.value-ao),Mo=an===xn.length-1?1:0,Ve=Math.max(ao,nn.value),Eo=Math.max(Fn-eo-Mo,0);if(ln.agg_fn&&![du.None].includes(ln.agg_fn)){d.save(),d.beginPath(),Yo(d,Ve,Pe+1,Eo,To-2+(xe!=null&&xe.isExpanded&&!(xe!=null&&xe.path)?ia:0),{topLeft:0,bottomLeft:0,topRight:an===xn.length-1?8:0,bottomRight:an===xn.length-1?8:0},{backgroundColor:Yn?Re:bt}),d.fill(),d.clip(),d.textBaseline="middle",d.textAlign="right",d.font="600 12px Inter";const qn=d.measureText((xe==null?void 0:xe.aggregations[ln.title])??" - ").width;ln.agg_prefix&&(d.font="400 12px Inter",d.fillStyle="#6a7184",d.fillText(ln.agg_prefix,Vt+Fn-qn-16-i.value,Pe+(To+(xe!=null&&xe.isExpanded&&!(xe!=null&&xe.path)?ia:0))/2)),d.fillStyle="#374151",d.font="600 12px Inter",d.fillText((xe==null?void 0:xe.aggregations[ln.title])??" - ",Vt+Fn-8-i.value,Pe+(To+(xe!=null&&xe.isExpanded&&!(xe!=null&&xe.path)?ia:0))/2),d.restore()}else if(Yn&&!cn.value){d.save(),d.beginPath(),Yo(d,Ve,Pe+1,Eo,To-2+(xe!=null&&xe.isExpanded&&!(xe!=null&&xe.path)?ia:0),{topLeft:0,bottomLeft:0,topRight:an===xn.length-1?8:0,bottomRight:an===xn.length-1?8:0},{backgroundColor:Yn?Re:bt}),d.fill(),d.clip(),d.font="600 10px Inter",d.fillStyle="#6a7184",d.textAlign="right",d.textBaseline="middle";const qn=Vt+Fn-8-i.value,to=Pe+(To+(xe!=null&&xe.isExpanded&&!(xe!=null&&xe.path)?ia:0))/2;d.fillText("Summary",qn,to);const no=d.measureText("Summary").width;w.renderIcon(d,{icon:"chevronDown",size:14,color:"#6a7184",x:qn-no-18,y:to-7}),d.restore()}d.save(),d.rect(Math.max(Vt-i.value,nn.value),Pe+1,Fn,To-2+(xe!=null&&xe.isExpanded&&!(xe!=null&&xe.path)?ia:0)),d.clip(),d.beginPath(),d.strokeStyle=_t,d.moveTo(Vt-i.value,Pe+1),d.lineTo(Vt-i.value,Pe+To-2+(xe!=null&&xe.isExpanded&&!(xe!=null&&xe.path)?ia:0)),d.stroke(),d.restore(),Vt+=Fn})}w.renderIcon(d,{icon:xe!=null&&xe.isExpanded?"ncChevronDown":"ncChevronRight",size:16,color:"#374150",x:Ne+12,y:Pe+(To-16)/2});const tn=He-(Ne+16+16),Yt=Ne+34,en=Pe+(To-30)/2,pt=Pt({x:Ne,y:Pe,width:He,height:To},Y);let hn=0,on=0;pt&&Ue("pointer"),!pt||!yn.value.isOnPrem?(on=Qn(d,{text:`${(xe==null?void 0:xe.count)??"-"}`,x:Ne+He-12,y:en-1,height:To,verticalAlign:"middle",fontFamily:"600 12px Inter",fillStyle:"#374151",textAlign:"right"}).width,hn=Qn(d,{text:"Count",x:Ne+He-12-on-8,y:en-1,height:To,verticalAlign:"middle",textAlign:"right",fontFamily:"400 12px Inter",fillStyle:"#6A7184"}).width):oa(d,{buttonX:Ne+He-12-24,buttonY:en+1,buttonSize:28,icon:"ncMoreVertical",iconData:{size:16,xOffset:6,yOffset:6,color:"#374151"},borderRadius:8,borderColor:"#ffffff",background:"#ffffff",hoveredBackground:"#f4f4f5",mousePosition:Y,spriteLoader:w,setCursor:Ue}),d.save(),d.letterSpacing="1px";const{isTruncated:so}=Qn(d,{text:(((zt=xe==null?void 0:xe.column)==null?void 0:zt.title)??"").toUpperCase(),fillStyle:"#4A5268",x:Yt,maxWidth:tn-20-on,fontFamily:"600 10px Inter",y:Pe,py:6});so&&Z({mousePosition:Y,text:(((Le=xe==null?void 0:xe.column)==null?void 0:Le.title)??"").toUpperCase(),rect:{x:Yt,y:Pe,height:16,width:tn-20-on}}),d.restore(),yt(d,xe,Yt,en+22,tn-hn-on,Se),Ke=Xe}Ke+=li}return{currentOffset:Ke,missingChunks:we,postRenderCbk:()=>ft.map(Se=>Se==null?void 0:Se())}}function yt(d,_,O,T,se,q){var L,te,we,oe;if(!_){wt(d,O-11,T-To/2+2,se,q);return}if([ve.SingleSelect,ve.MultiSelect,ve.LinkToAnotherRecord].includes((L=_==null?void 0:_.column)==null?void 0:L.uidt)&&!(_.value in rl.VAR_TITLES)){const Ee=((te=_==null?void 0:_.column)==null?void 0:te.uidt)===ve.LinkToAnotherRecord?Bs(_):_.value,Ne=Array.isArray(Ee)?Ee:Ee.split(","),He=_.color.split(",");let Ze=O,Ke=0;for(let ft=0;ft<Ne.length;ft++){const Ye=Ne[ft]||"",qe=He[ft]||"#ccc",ht=Ye in rl.VAR_TITLES?rl.VAR_TITLES[Ye]:Ye,zt=ir.isReadable(qe,"#fff",{level:"AA",size:"large"})?"#fff":ir.mostReadable(qe,["#1f293a","#fff"]).toHex8String();d.save(),d.font="700 13px Inter";const Le=12,Se=0,Mt=se-(Ze-O),Pe=d.measureText(ht||"").width+Le*2+Se;if(Ze>O&&(Pe>Mt-30||Mt<50)){d.fillStyle="#6a7184",d.font="400 12px Inter";const X=Math.min(Ze,O+se-24);d.fillText(`+${Ne.length-Ke}`,X,T),d.restore();break}const{x:gt}=Il(d,{x:Ze,y:T-7,height:22,width:Mt,padding:0,textColor:zt,text:ht||"",tag:{tagPaddingX:12,tagPaddingY:2,tagHeight:22,tagRadius:12,tagBgColor:qe,tagSpacing:0,tagFontFamily:"700 13px Inter"}});if(d.restore(),Ze=gt+8,Ke++,Ze+30>=O+se){if(ft<Ne.length-1){d.save(),d.fillStyle="#6a7184",d.font="400 12px Inter";const Fe=Math.max(24,O+se-Ze)<24?O+se-24:Ze;d.fillText(`+${Ne.length-Ke}`,Fe,T),d.restore()}break}}}else if(_.value in rl.VAR_TITLES){const Ee=_.value in rl.VAR_TITLES?rl.VAR_TITLES[_.value]:(we=Bs(_))==null?void 0:we.join(", "),Ne=((oe=_.column)==null?void 0:oe.uidt)===ve.Checkbox;Qn(d,{text:Ee,fillStyle:Ne?"#1f293a":"#6A7184",fontFamily:"700 13px Inter",x:O,y:T-To/2+8,height:20,maxWidth:se})}else if(Ah(_.column)||Ds(_.column)){let Ee=_.value;try{Ee=JSON.parse(_.value)}catch{Ee=_.value}ae(d,_.column,{value:Ee,x:O-11,y:T-16,width:se,height:u.value,row:{},selected:!1,pv:!1,spriteLoader:w,readonly:!0,textColor:"#1f293a",imageLoader:m,tableMetaLoader:C,relatedColObj:_.relatedColumn,relatedTableMeta:_.relatedTableMeta,mousePosition:Y,skipRender:!1,renderCell:ae,fontFamily:"700 13px Inter",isGroupHeader:!0})}else{let Ee=_.value;try{Ee=JSON.parse(_.value)}catch{Ee=_.value}ae(d,_.column,{value:Ee,x:O-11,y:T-13,width:se,height:u.value,row:{},selected:!1,pv:!1,spriteLoader:w,readonly:!0,textColor:"#1f293a",imageLoader:m,meta:he,tableMetaLoader:C,relatedColObj:_.relatedColumn,relatedTableMeta:_.relatedTableMeta,mousePosition:Y,skipRender:!1,renderAsPlainCell:!0,fontFamily:"700 13px Inter",isGroupHeader:!0})}}function Qe(){var q;const d=Ge.value;if(!d)return;const _=d.getContext("2d");if(!_)return;const O=window.devicePixelRatio||1;d.width=t.value*O,d.height=n.value*O,d.style.width=`${t.value}px`,_.scale(O,O),_.clearRect(0,0,t.value,d.height);let T;H.clear();let se;if(!((q=G.value)!=null&&q.length))T=nt(_);else{_.save(),_.fillStyle=be.value,_.fillRect(0,0,t.value,n.value),_.restore();const{startIndex:L,endIndex:te,startGroupYOffset:we}=Zc(a.value,r.value,u.value,pe.value,n.value,!1,F.value),{missingChunks:oe,postRenderCbk:Ee}=Ot(_,{level:0,yOffset:we,startIndex:L,endIndex:te});if(se=Ee,oe.length){const Ne=Math.min(...oe),He=Math.max(...oe);ee(Ne,He)}}Dn(_,T),rt(_),lt(_,Q.value),st(_),_.beginPath(),_.rect(0,Fo,re.value,n.value-Fo-On),_.clip(),se==null||se(),_.restore()}return{canvasRef:Ge,renderActiveState:un,renderCanvas:Qe,colResizeHoveredColIds:ze}}function pC(t,n,o,l,a,i,r){const s=dn(Yi,V(!1)),u=V(!1),c=V(null),f=x=>{var b,S;let w=0;const m=n.value.filter(k=>k.fixed);for(const k of m){const D=pn(k.width);if(x>=w&&x<w+D)return null;w+=D}let C=m.reduce((k,D)=>k+pn(D.width),0);for(let k=0;k<o.value.start;k++)(b=n.value[k])!=null&&b.fixed||(C+=pn((S=n.value[k])==null?void 0:S.width));w=C-l.value;for(let k=o.value.start;k<o.value.end;k++){const D=n.value[k];if(!(D!=null&&D.fixed)){const F=pn(D==null?void 0:D.width);if(x>=w&&x<w+F)return D;w+=F}}return null},v=x=>{var b;if(!u.value||!c.value)return;const w=(b=t.value)==null?void 0:b.getBoundingClientRect();if(!w)return;const m=x.clientX-w.left,C=f(m);C&&C.id!==c.value.id&&(i.value={id:C.id,index:n.value.findIndex(S=>S.id===C.id)},requestAnimationFrame(a))},p=()=>{c.value&&i.value&&r("reorderColumns",c.value.index,i.value.index-1),g()};function g(){u.value=!1,c.value=null,i.value=null,window.removeEventListener("mousemove",v),window.removeEventListener("mouseup",p),requestAnimationFrame(a)}const y=x=>{if(s.value)return;const w=f(x);w&&(u.value=!0,c.value={id:w.id,index:n.value.findIndex(m=>m.id===w.id),startX:x},window.addEventListener("mousemove",v),window.addEventListener("mouseup",p))};return Ga(g),{isDragging:u,dragStart:c,startDrag:y}}function hC(t,n,o,l,a,i){const s=V(!1),u=V(null),c=V(null),f=dn(Yi,V(!1)),v=ue(()=>{var b;if(!c.value)return null;const w=n.value.filter(S=>S.fixed);let m=0;for(const S of w){const k=pn(S.width),D=m+k;if(Math.abs(c.value.x-D)<=8/2)return S.uidt?{id:S.id,width:k,x:m}:null;m=D}let C=0;for(let S=0;S<o.value.start;S++)n.value[S]&&(C+=pn((b=n.value[S])==null?void 0:b.width));m=C-l.value;for(let S=o.value.start;S<o.value.end;S++){const k=n.value[S],D=pn(k.width),F=m+D;if(Math.abs(c.value.x-F)<=8/2)return{id:k.id,width:D,x:m};m=F}return null}),p=w=>{var m;try{const C=(m=t.value)==null?void 0:m.getBoundingClientRect();if(!C)return;if(c.value={x:w.clientX-C.left,y:w.clientY-C.top},s.value&&u.value){const b=c.value.x-u.value.startX,S=Math.max(50,u.value.initialWidth+b);a==null||a(u.value.id,S)}}catch(C){console.error("Error in handleMouseMove:",C),g()}};function g(){s.value=!1,u.value=null,c.value=null,window.removeEventListener("mousemove",p),window.removeEventListener("mouseup",x)}const y=w=>{var b,S;const m=(b=t.value)==null?void 0:b.getBoundingClientRect();if(!m||f.value)return;c.value={x:w.clientX-m.left,y:w.clientY-m.top};const C=v.value;if(!C){c.value=null;return}s.value=!0,u.value={id:C.id,initialWidth:C.width,startX:((S=c.value)==null?void 0:S.x)||0},window.addEventListener("mousemove",p),window.addEventListener("mouseup",x)};function x(){if(s.value&&u.value&&c.value&&u.value&&c.value){const m=c.value.x-u.value.startX,C=Math.max(50,u.value.initialWidth+m);i==null||i(u.value.id,C)}g()}return Ga(()=>{g()}),{isResizing:s,activeColumn:u,resizeableColumn:v,handleMouseMove:p,handleMouseDown:y,RESIZE_HANDLE_WIDTH:8,cleanupResize:g}}const of={[ve.Attachment]:{minWidth:100,maxWidth:Number.POSITIVE_INFINITY},[ve.Button]:{minWidth:100,maxWidth:320}},mC=t=>t in of?of[t]:{minWidth:50,maxWidth:Number.POSITIVE_INFINITY},gC=(t,n)=>{if(t.uidt){const{minWidth:o,maxWidth:l}=mC(t.uidt);return Math.min(Math.max(n,o),l)}return n},wC=[ve.SingleSelect,ve.MultiSelect,ve.User],lf=100,Kr=1;function yC({activeCell:t,columns:n,triggerReRender:o,scrollToCell:l,selection:a,editEnabled:i,copyValue:r,clearCell:s,clearSelectedRangeOfCells:u,makeCellEditable:c,expandForm:f,cachedGroups:v,isAddingEmptyRowAllowed:p,isAddingEmptyRowPermitted:g,addEmptyRow:y,addNewColumn:x,onActiveCellChanged:w,handleCellKeyDown:m,isGroupBy:C,getDataCache:b,removeInlineAddRecord:S}){const{isDataReadOnly:k}=wl(),{$e:D}=ua(),F=dn(Ti,V()),M=Ju(async A=>{var G,pe,ne,be,ee,H,Ce,Ie,Q,ie,Me,Be,it,Ge,ze,Z,Et,_e,yn;if(Gf()||Eh()||Hf())return;if(document.querySelector(".nc-dropdown-single-select-cell.active,.nc-dropdown-multi-select-cell.active"))return A.preventDefault(),!0;if(Wl()||td()||Yf()||qf()||(ra()||ji()||Xf())&&!Mh())return;const N=Va()?A.metaKey:A.ctrlKey,Y=A.altKey;let ae=[],he,ye={};if(C.value){if((G=t.value.path)!=null&&G.length)ae=t.value.path;else{const It=iC(v.value);if((pe=It.path)!=null&&pe.length)ae=It.path;else return}he=_a(v.value,ae),ye=es(he)}N&&A.key==="f"&&i.value&&(i.value=null);const re=b(ae),{cachedRows:me,totalRows:W}=re;if(A.key===" "&&!A.shiftKey){const It=Wl();if(!i.value&&t.value.row!==-1&&!It){A.preventDefault();const $t=me.value.get(t.value.row);if(!$t||S.value&&$t.rowMeta.rowIndex&&$t.rowMeta.rowIndex>ol)return;f($t,void 0,!1,ae);return}}if(t.value.row!==-1&&t.value.column!==-1&&a.value.isSingleCell()&&!N){const It=n.value[t.value.column],$t=me.value.get(t.value.row);if($t&&(It!=null&&It.columnObj)&&!i.value){if(S.value&&$t.rowMeta.rowIndex&&$t.rowMeta.rowIndex>=ol)return;const et=$t.row[It.columnObj.title],cn=Ht($t.row,((ne=F.value)==null?void 0:ne.columns)??[]);if(await m({e:A,column:It,row:$t,pk:cn,value:et,path:ae}))return}}let U=!1,Ae=!1;if(N&&(!i.value||wd.includes((ee=(be=i.value)==null?void 0:be.column)==null?void 0:ee.uidt)))switch(A.key.toLowerCase()){case"c":A.preventDefault(),r({row:t.value.row,col:t.value.column},ae);return}A.shiftKey&&a.value.isEmpty()&&a.value.startRange({row:t.value.row,col:t.value.column});const je=N,Ue=W.value-1,ot=n.value.length-1;if(Y)switch(A.keyCode){case 82:{p.value&&g.value&&!S.value&&g.value&&(D("c:shortcut",{key:"ALT + R"}),y(void 0,void 0,void 0,ye,ae),t.value.row=W.value,t.value.column=1,t.value.path=ae,a.value.clear(),l(t.value.row,1,ae));return}case 67:{x();break}}switch(A.key){case"Delete":case"Backspace":if(k.value)return;if(!i.value||wC.includes((Ce=(H=n.value[t.value.column])==null?void 0:H.columnObj)==null?void 0:Ce.uidt)){if(A.preventDefault(),a.value.isSingleCell()){if(S.value&&t.value.row>=ol)return;await(s==null?void 0:s({row:t.value.row,col:t.value.column,path:ae}))}else await u(ae),a.value.clear();requestAnimationFrame(o)}return;case"Enter":if(A.shiftKey)return;if(i.value){const It=[ve.Attachment,ve.Barcode,ve.QrCode],$t=(Q=n.value[t.value.column])==null?void 0:Q.columnObj;if($t&&It.includes($t.uidt))return;i.value=null,t.value.row++,w()}else{A.preventDefault();const It=n.value[t.value.column];if((Ie=It==null?void 0:It.columnObj)!=null&&Ie.uidt&&!Pv.includes(It.columnObj.uidt)&&!It.columnObj.readonly){if(S.value&&t.value.row&&t.value.row>=ol)return;const $t=me.value.get(t.value.row);c($t,n.value[t.value.column],!0),a.value.clear()}}break;case"Escape":i.value&&(i.value=null,a.value.clear(),a.value.startRange({row:t.value.row,col:t.value.column}),a.value.endRange({row:t.value.row,col:t.value.column}),requestAnimationFrame(o));return;case"ArrowUp":{const It=((ie=a.value._end)==null?void 0:ie.row)??t.value.row;if(It>0){A.preventDefault();const $t=je?0:It-1;if(A.shiftKey){const et={row:Math.max((((Me=a.value._start)==null?void 0:Me.row)??0)-lf-1,$t),col:((Be=a.value._end)==null?void 0:Be.col)??t.value.column};a.value.endRange(et),l(et.row,et.col,ae,!1),Ae=!0}else t.value.row=$t,U=!0,w()}break}case"ArrowDown":{const It=((it=a.value._end)==null?void 0:it.row)??t.value.row;if(It<Ue){A.preventDefault();const $t=je?Ue:It+1;if(A.shiftKey){const et={row:Math.min((((Ge=a.value._start)==null?void 0:Ge.row)??0)+lf-1,$t),col:((ze=a.value._end)==null?void 0:ze.col)??t.value.column};a.value.endRange(et),Ae=!0}else t.value.row=$t,U=!0,w()}break}case"ArrowLeft":{const It=((Z=a.value._end)==null?void 0:Z.col)??t.value.column;if(It>Kr){A.preventDefault();const $t=je?Kr:It-1;A.shiftKey?(a.value.endRange({row:((Et=a.value._end)==null?void 0:Et.row)??t.value.row,col:$t}),Ae=!0):(t.value.column=$t,U=!0)}break}case"ArrowRight":{const It=((_e=a.value._end)==null?void 0:_e.col)??t.value.column;if(It<ot){A.preventDefault();const $t=je?ot:It+1;A.shiftKey?(a.value.endRange({row:((yn=a.value._end)==null?void 0:yn.row)??t.value.row,col:$t}),Ae=!0):(t.value.column=$t,U=!0)}break}case"Tab":{let It=!1;if(A.preventDefault(),!A.shiftKey&&t.value.row===Ue&&t.value.column===ot)p.value&&!S.value&&g.value&&(y(void 0,!1,void 0,ye,ae),It=!0);else if(A.shiftKey&&t.value.row===0&&t.value.column===Kr)return;A.shiftKey?t.value.column>Kr?t.value.column--:t.value.row>0&&(t.value.row--,t.value.column=ot):t.value.column<ot?t.value.column++:t.value.row<(It?Ue+1:Ue)&&(t.value.row++,t.value.column=Kr),U=!0;break}}if(U||Ae){i.value=null,(!A.shiftKey||A.key==="Tab")&&(a.value.clear(),a.value.startRange({row:t.value.row,col:t.value.column}),a.value.endRange({row:t.value.row,col:t.value.column}));const It=A.key!=="ArrowUp"&&A.key!=="ArrowDown";U?l(t.value.row,t.value.column,ae,It):Ae&&l(a.value._end.row,a.value._end.col,ae,It)}o()},50);Tl("keydown",M)}const af=100;function bC({selection:t,activeCell:n,canvasRef:o,scrollLeft:l,columns:a,triggerReRender:i,scrollToCell:r,elementMap:s,getDataCache:u}){const c=V(!1),f=(y,x)=>{var F,I,M,A,j,N,Y;const w=s.findElementAt(y,x,Lo.ROW),m=w==null?void 0:w.rowIndex,C=(I=(F=w==null?void 0:w.row)==null?void 0:F.rowMeta)==null?void 0:I.path;let b=0;const S=a.value.filter(ae=>ae.fixed);for(let ae=0;ae<S.length;ae++){if(!((M=S[ae])!=null&&M.width))continue;const he=pn((A=S[ae])==null?void 0:A.width);if(y>=b&&y<b+he)return{row:m,col:ae===0?-1:a.value.findIndex(ye=>ye.id===S[ae].id),path:C??[]};b+=he}const k=y+l.value-b;let D=0;for(let ae=S.length;ae<a.value.length;ae++){if((N=(j=a.value)==null?void 0:j[ae])!=null&&N.fixed)continue;const he=pn((Y=a.value[ae])==null?void 0:Y.width);if(k>=D&&k<D+he)return{row:m,col:ae,path:C??[]};D+=he}return{row:m,col:-1,path:C??[]}};return{handleMouseDown:y=>{var m;const x=(m=o.value)==null?void 0:m.getBoundingClientRect();if(!x||y.button!==0)return;const w=f(y.clientX-x.left,y.clientY-x.top);if(y.shiftKey){w.col!==-1&&(c.value=!0,t.value.endRange(w),i());return}w.col!==-1&&(c.value=!0,t.value.startRange(w),n.value={row:w.row,column:w.col,path:w.path},i())},handleMouseMove:y=>{var C,b,S,k,D;if(!c.value)return;const x=(C=o.value)==null?void 0:C.getBoundingClientRect();if(!x)return;const w=f(y.clientX-x.left,y.clientY-x.top);if(Rs(w.row))return;const m=u(w==null?void 0:w.path);if(w.col!==-1){w.row=Math.max(0,Math.min(w.row,m.totalRows.value-1));const F=Math.max(((b=t.value._start)==null?void 0:b.row)??0,w.row),I=Math.min(((S=t.value._start)==null?void 0:S.row)??0,w.row);if(F-I>=af){const M=w.row>(((k=t.value._start)==null?void 0:k.row)??0)?1:-1,A=(((D=t.value._start)==null?void 0:D.row)??0)+(af-1)*M;w.row=Math.max(0,Math.min(A,m.totalRows.value-1))}t.value.endRange(w),r(w.row,w.col,w.path,t.value.isDifferentColSelection()),i()}},handleMouseUp:()=>{var y,x,w,m;if(c.value=!1,!t.value.isEmpty())return!(((y=t.value.end)==null?void 0:y.row)===((x=t.value.start)==null?void 0:x.row)&&((w=t.value.end)==null?void 0:w.col)===((m=t.value.start)==null?void 0:m.col))}}}const Qv=(t,n,o,l)=>{var c;const{isPg:a,isMysql:i,meta:r,metas:s}=o,u=(n.title&&t.row[n.title])??"";return(c=l==null?void 0:l.skipUidt)!=null&&c.includes(n.uidt)?u:as.parseValue(u,{col:n,isMysql:i,isPg:a,meta:r,metas:s,rowId:Ho(n)?Ht(t.row,r==null?void 0:r.columns):null})},Zv=(t,n,o,l)=>{let a="<table>",i="";const r=[];return t.forEach((s,u)=>{let c="<tr>";const f=[];n.forEach((v,p)=>{const g=Qv(s,v,o,l);c+=`<td>${g}</td>`,i=`${i}${g}${n.length-1!==p?"	":""}`,f.push(g)}),a+=`${c}</tr>`,t.length-1!==u&&(i=`${i}
`),r.push(f)}),a+="</table>",{html:a,text:i,json:r}};function _C({isFillMode:t,isAiFillMode:n,selection:o,canvasRef:l,getFillHandlerPosition:a,triggerReRender:i,columns:r,bulkUpdateRows:s,meta:u,activeCell:c,isPasteable:f,elementMap:v,getDataCache:p,getRows:g}){const{isMysql:y,isPg:x}=Ca(),{$api:w}=ua(),{appInfo:m}=tl(),{maxAttachmentsAllowedInCell:C,showUpgradeToAddMoreAttachmentsInCell:b}=ql(),S=V(null),k=V(!1),D=ue(()=>{const N={};if(N[`${c.value.row}-${c.value.column}`]=!0,o.value._start===null||o.value._end===null)return N;if(t.value&&S.value){const Y=Math.min(S.value.start.row,o.value._start.row),ae=Math.max(S.value.end.row,o.value._start.row),he=Math.min(S.value.start.col,o.value._start.col),ye=Math.max(S.value.end.col,o.value._start.col);for(let re=Y;re<=ae;re++)for(let me=he;me<=ye;me++)N[`${re}-${me}`]=!0}else for(let Y=o.value.start.row;Y<=o.value.end.row;Y++)for(let ae=o.value.start.col;ae<=o.value.end.col;ae++)N[`${Y}-${ae}`]=!0;return N}),F=(N,Y)=>{const ae=a();if(!ae)return!1;const he=ae.size/2,ye=N-ae.x,re=Y-ae.y;return ye*ye+re*re<=he*he},I=N=>{var ye;const Y=(ye=l.value)==null?void 0:ye.getBoundingClientRect();if(!Y)return;k.value=!1;const ae=N.clientX-Y.left,he=N.clientY-Y.top;F(ae,he)&&(t.value=!0,o.value.isSingleCell()&&o.value.startRange({row:c.value.row,col:c.value.column}),S.value=new zs,S.value.startRange({row:o.value.start.row,col:o.value.start.col}),S.value.endRange({row:o.value.end.row,col:o.value.end.col})),i()},M=N=>{var he,ye;const Y=(he=l.value)==null?void 0:he.getBoundingClientRect();if(!Y||!t.value||k.value)return;const ae=v.findElementAt(0,N.clientY-Y.top,Lo.ROW);ae&&(o.value.endRange({row:ae.rowIndex,col:o.value.end.col??((ye=S.value)==null?void 0:ye.end.col)}),i())},A=async({rawMatrix:N,cpCols:Y,rowToPaste:ae})=>{var G,pe;if(N.length===0)return;const he=ae.end-ae.start>0?1:-1,ye=he===-1?N.reverse():N,re=ye[0].map((ne,be)=>ye.map(ee=>ee[be])),me=[],W=Math.abs(ae.end-ae.start)+1;for(const[ne,be]of re.entries()){const ee=Y[ne],H=as.populateFillHandle({column:ee,highlightedData:be,numberOfRows:W});H&&me.push(H)}const U=[],Ae=(G=c.value)==null?void 0:G.path,{cachedRows:je}=p(Ae);let Ue=0;const ot={};for(let ne=ae.start+he*N.length;he===1?ne<=ae.end:ne>=ae.end;ne+=he){const be=e(je).get(ne);if(be){for(const[ee,H]of Y.entries()){const Ce=Ml({value:me[ee][Ue],to:H.uidt,column:H,appInfo:e(m),maxAttachmentsAllowedInCell:C.value,showUpgradeToAddMoreAttachmentsInCell:b,isInfoShown:ot[H.title],markInfoShown:()=>{ot[H.title]=!0}},y((pe=u.value)==null?void 0:pe.source_id),!0);be.row[H.title]=Ce}U.push(be)}Ue++}await(s==null?void 0:s(U,Y.map(ne=>ne.title),void 0,void 0,Ae))};return{getFillHandlerPosition:a,handleFillStart:I,handleFillMove:M,handleFillEnd:async()=>{var N,Y,ae,he;if(t.value)try{k.value=!0;const ye=!!n.value,re=(N=c.value)==null?void 0:N.path,{cachedRows:me}=p(re);if(S.value===null)return;if(o.value._start!==null&&o.value._end!==null){const W={row:o.value._start.row,col:o.value._start.col};let U,Ae;const je=Math.min(S.value.start.col,S.value.end.col,o.value._start.col,o.value._end.col),Ue=Math.max(S.value.start.col,S.value.end.col,o.value._start.col,o.value._end.col);S.value?(U=Math.min(S.value.start.row,o.value._start.row),Ae=Math.max(S.value.end.row,o.value._start.row)):(U=o.value.start.row,Ae=o.value.end.row);const ot=await g(U,Ae,re),pe=e(r).slice(je,Ue+1).map(it=>it.columnObj),ne=Zv(ot,pe,{isPg:x,isMysql:y,meta:e(u)},{skipUidt:[ve.Percent,ve.Currency]}).json,be=o.value._start.row<=o.value._end.row?1:-1,ee=Math.max(S.value.start.row,S.value.end.row),H=Math.min(S.value.start.row,S.value.end.row);if(!ye){await A({rawMatrix:ne,cpCols:pe,rowToPaste:{start:be===1?Math.min(H,o.value._start.row):Math.max(ee,o.value._start.row),end:be===1?Math.max(ee,o.value._end.row):Math.min(H,o.value._end.row)}}),c.value.column=W.col,c.value.row=W.row,c.value.path=re,S.value=null,t.value=!1;return}let Ce=be===1?0:ne.length-1;const Ie=[],Q=[],ie=[],Me=[],Be={};for(let it=o.value._start.row;be===1?it<=o.value._end.row:it>=o.value._end.row;it+=be){const Ge=e(me).get(it);if(!Ge)continue;let ze=0;D.value[`${it}-${o.value.start.col}`]||Ie.push(Ge);for(let Z=o.value.start.col;Z<=o.value.end.col;Z++){const Et=e(r)[Z],_e=Et==null?void 0:Et.columnObj;if(!_e){ze++;continue}if(!f(Ge,_e)){ze++;continue}if(o.value._start&&o.value._end&&o.value._start.col<=Z&&Z<=o.value._end.col){pe.findIndex(It=>It.id===_e.id)===-1&&(Me.includes(_e.title)||ie.push(_e.title)),!ie.includes(_e.title)&&!Me.includes(_e.title)&&ie.push(_e.title);let yn;try{yn=Ml({value:(Y=ne[Ce])==null?void 0:Y[ze],to:_e.uidt,column:_e,appInfo:e(m),maxAttachmentsAllowedInCell:C.value,showUpgradeToAddMoreAttachmentsInCell:b,isInfoShown:Be[_e.title],markInfoShown:()=>{Be[_e.title]=!0}},y((ae=u.value)==null?void 0:ae.source_id),!0)}catch(It){if(It instanceof ki)throw It;yn=null}yn!==void 0&&(ye||(Ge.row[_e.title]=yn))}else ye&&(Me.push(_e.title),Q.find(yn=>{var It,$t;return Ht(yn.row,(It=u.value)==null?void 0:It.columns)===Ht(Ge.row,($t=u.value)==null?void 0:$t.columns)})||Q.push(Ge));ze++}be===1?Ce=Ce<ne.length-1?Ce+1:0:Ce=Ce>=1?Ce-1:ne.length-1}if(ye){const it=ot.map(ze=>{var Et;const Z={Id:Ht(ze.row,(Et=u.value)==null?void 0:Et.columns)};for(const _e of ie)Z[_e]=ze.row[_e];for(const _e of Me)Z[_e]="FILL";return Z}),Ge=Ie.map(ze=>{var Z;return Ht(ze.row,(Z=u.value)==null?void 0:Z.columns)});w.ai.dataFill((he=u.value)==null?void 0:he.id,{rows:it,generateIds:Ge,numRows:Ge.length}).then(ze=>{if(!(o.value._start===null||o.value._end===null)){for(const Z of Ie.concat(Q)){const Et=ze.find(_e=>{var yn,It;return Ht(Z.row,(yn=u.value)==null?void 0:yn.columns)===Ht(_e,(It=u.value)==null?void 0:It.columns)});if(Et)for(const _e of ie.concat(Me))Z.row[_e]=Et[_e]}s==null||s(Ie.concat(Q),ie.concat(Me),void 0,void 0,re).then(()=>{c.value.column=W.col,c.value.row=W.row,S.value=null,t.value=!1})}}).catch(ze=>{o.value.clear(),S.value=null,t.value=!1});return}s==null||s(Ie,ie,void 0,void 0,re).then(()=>{c.value.column=W.col,c.value.row=W.row,c.value.path=re,S.value=null,t.value=!1})}else S.value=null,t.value=!1}catch(ye){(!(ye instanceof za)||!ye.isErrorSuppressed)&&(console.error(ye,ye.isErrorSuppressed),Zt.error((ye==null?void 0:ye.message)||"Something went wrong"))}}}}function xC({isDragging:t,draggedRowGroupPath:n,draggedRowIndex:o,targetRowIndex:l,canvasRef:a,rowHeight:i,updateRecordOrder:r,triggerRefreshCanvas:s,scrollToCell:u,elementMap:c,getDataCache:f}){const v=V(0),p=V(0),g=(C,b)=>{const S=b,k=c.findElementAt(C,S);if(k!=null&&k.isRow||k!=null&&k.isAddNewRow)return k},y=C=>{var I;const b=(I=a.value)==null?void 0:I.getBoundingClientRect();if(!b)return;const S=g(C.clientX-b.left,C.clientY-b.top);if(!S)return;const{cachedRows:k}=f(S.groupPath),D=S.rowIndex,F=k.value.get(D);F&&(F.rowMeta.isDragging=!0,k.value.set(D,F),t.value=!0,o.value=D,l.value=D+1,v.value=C.clientY,p.value=C.clientY,n.value=S.groupPath,window.addEventListener("mousemove",x),window.addEventListener("mouseup",w))};function x(C){var I;p.value=C.clientY;const b=(I=a.value)==null?void 0:I.getBoundingClientRect();if(!b)return;const S=g(C.clientX-b.left,C.clientY-b.top+i.value/2);if(!S||!El(S.groupPath,n.value))return;const{totalRows:k}=f(S.groupPath);l.value=S.rowIndex??k.value,s();const D=100,F=C.clientY-b.top;F<D?u(Math.max(0,l.value-2),0):F>b.height-D&&u(Math.min(k.value-1,l.value+2),0)}async function w(){if(o.value!==null&&o.value+1!==l.value){const{totalRows:C}=f(n.value);await r(o.value,l.value===C.value?null:l.value,void 0,void 0,n.value)}m()}function m(){t.value=!1,o.value=null,l.value=null,n.value=null,window.removeEventListener("mousemove",x),window.removeEventListener("mouseup",w),s()}return Ga(()=>{m()}),{handleDragStart:y}}const Cu=5e3;function kC({activeCell:t,columns:n,scrollToCell:o,selection:l,editEnabled:a,expandRows:i,view:r,meta:s,syncCellData:u,bulkUpsertRows:c,bulkUpdateRows:f,updateOrSaveRow:v,getRows:p,getDataCache:g}){const{$api:y}=ua(),{isDataReadOnly:x}=wl(),{getMeta:w,metas:m}=ai(),{isMysql:C,isPg:b}=Ca(),{appInfo:S}=tl(),{addUndo:k,clone:D,defineViewScope:F}=Mi(),{t:I}=la(),{isUIAllowed:M}=wl(),{copy:A}=qs(),{cleaMMCell:j,clearLTARCell:N,addLTARRef:Y,syncLTARRefs:ae}=ad(),{isSqlView:he}=Fl(),{isAllowed:ye}=nd(),{maxAttachmentsAllowedInCell:re,showUpgradeToAddMoreAttachmentsInCell:me}=ql(),{batchUploadFiles:W}=Ri(),U=dn(Ea,jo()),Ae=dn(zl,V(!1)),{base:je}=Uo(Ca()),Ue=ue(()=>(n.value??[]).map(Q=>Q.columnObj)),ot=ue(()=>M("dataEdit")),G=ue(()=>{var Q;return he.value||Ae.value||!ot.value?!1:!a.value||a.value&&wd.includes((Q=a.value.column)==null?void 0:Q.uidt)&&!(t.value.row===-1||t.value.column===-1)});function pe(Q,ie,Me=!1,Be=!1){return!Q||!ie?(Me&&Zt.toast("Please select a cell to paste"),!1):(ie.id&&ye(pl.FIELD,ie.id,vl.RECORD_FIELD_EDIT),(_o(ie)||xa(ie)||ie!=null&&ie.readonly)&&(!Be||!ml(ie))?(Me&&Zt.toast(I("msg.info.pasteNotSupported")),!1):ie.ai?(Me&&Zt.toast(I("msg.info.autoIncFieldNotEditable")),!1):ie.pk&&!Q.rowMeta.new?(Me&&Zt.toast(I("msg.info.editingPKnotSupported")),!1):!0)}const ne=async Q=>{var ze,Z,Et,_e,yn,It,$t,et,cn,Pn,Kt,nn,wt,Dn,un,Bn,tt,mt,Dt,Rt,ct,nt,rt,st,lt,xt,Ot,yt,Qe,d,_;if(!G.value||!((ze=s.value)!=null&&ze.id)||ra()||Wl()||ji()||Gf()||Th()||Hf()||Yf()||qf()||td())return;Q.preventDefault();const ie=t.value.path,Me=g(ie),{totalRows:Be,cachedRows:it}=Me;let Ge=((Z=Q.clipboardData)==null?void 0:Z.getData("text/plain"))||"";Ge!=null&&Ge.endsWith(`
`)&&(Ge=Ge.replace(/\n$/,""));try{if(Ge!=null&&Ge.includes(`
`)||Ge!=null&&Ge.includes("	")){const O=rv.parse(Ge,{delimiter:"	",escapeChar:"\\"});if(O.errors.length>0)return Zt.error((Et=O.errors[0])==null?void 0:Et.message);let T=O.data;T=T.map(Pe=>Pe.map(gt=>gt==="null"?"":gt));let se=!1;T.length>Cu&&(T=T.slice(0,Cu),se=!0);const q=Math.max(T.length,l.value.end.row-l.value.start.row+1),L=((_e=T[0])==null?void 0:_e.length)||0,te=t.value.column,oe=e(Ue).length-te,Ee=Math.max(0,L-oe),Ne=Be.value,He=l.value.start.row,Ze=Math.max(0,Ne-He),Ke=Math.max(0,q-Ze);let ft={continue:!1,expand:Ke>0||Ee>0};if(ft.expand&&(ft=await(i==null?void 0:i({newRows:Ke,newColumns:Ee,cellsOverwritten:Math.min(Ze,q)*(L-Ee),rowsUpdated:Math.min(Ze,q)})),!ft.continue))return;let Ye;const qe=[];if(ft.expand){if(Ye=Ue.value.slice(l.value.start.col,l.value.start.col+L),Ee>0){const Pe=(await y.dbTableColumn.hash((yn=s.value)==null?void 0:yn.id)).hash,gt=(($t=(It=s.value)==null?void 0:It.columns)==null?void 0:$t.length)||0;for(let X=0;X<Ee;X++){const Fe={uidt:ve.SingleLineText,order:gt+X,column_order:{order:gt+X,view_id:(et=r.value)==null?void 0:et.id},view_id:(cn=r.value)==null?void 0:cn.id,table_name:(Pn=s.value)==null?void 0:Pn.table_name},vt=Mf({metaColumns:[...((Kt=s.value)==null?void 0:Kt.columns)??[],...qe.map(({column:Re})=>Re)],formState:Fe});qe.push({op:"add",column:{...Fe,title:vt}})}await y.dbTableColumn.bulk((nn=s.value)==null?void 0:nn.id,{hash:Pe,ops:qe}),await w((wt=s==null?void 0:s.value)==null?void 0:wt.id,!0),Ye=[...Ye,...qe.map(({column:X})=>X)]}}else Ye=Ue.value.slice(l.value.start.col,l.value.start.col+L);await p(l.value.start.row,l.value.start.row+T.length,ie);const ht=e(it),zt=[],Le=[],Se=[];let Mt=!1;const xe={};for(let Pe=0;Pe<q;Pe++){const gt=Pe%T.length;let X;if(Pe<Ze){const Fe=He+Pe;X=D(ht.get(Fe))||{row:{},oldRow:{},rowMeta:{isExistingRow:!0,rowIndex:Fe}},zt.push(X)}else X={row:{},oldRow:{},rowMeta:{isExistingRow:!1}},Le.push(X);if(T[gt])for(let Fe=0;Fe<T[gt].length;Fe++){const vt=Ye[Fe];if(vt)if(pe(X,vt)){Se.push(vt.title);let Re;try{Re=Ml({value:T[gt][Fe],to:vt.uidt,column:vt,appInfo:e(S),oldValue:vt.uidt===ve.Attachment?X.row[vt.title]:void 0,maxAttachmentsAllowedInCell:re.value,showUpgradeToAddMoreAttachmentsInCell:me,isInfoShown:xe[vt.title],markInfoShown:()=>{xe[vt.title]=!0}},C((Dn=s.value)==null?void 0:Dn.source_id),!0),sr(vt,Re)}catch(bt){if(bt instanceof ki)throw bt;if(bt instanceof ur)await cr({api:y,col:vt,addOptions:bt.missingOptions}),Re=bt.value.join(",");else if(bt instanceof za)Re=null;else throw bt}Re!==void 0&&(X.row[vt.title]=Re)}else(Jo(vt)||Cl(vt)||Ho(vt))&&!Mt&&(Zt.toast(I("msg.info.groupPasteIsNotSupportedOnLinksColumn")),Mt=!0)}}ft.expand?(await(c==null?void 0:c(Le,zt,Se,void 0,qe.map(({column:Pe})=>Pe),!1,ie)),o==null||o(void 0,void 0,ie)):await(f==null?void 0:f(zt,Se,void 0,!1,ie)),se&&Zt.warning(`Paste operation limited to ${Cu} rows. Additional rows were truncated.`)}else if(l.value.isSingleCell()){const O=e(it).get(t.value.row),T=e(Ue)[t.value.column];if(!O||!T)return;if(Jo(T)&&!((un=T.meta)!=null&&un.custom)){if(!pe(O,T,!0,!0))return;const q=Ml({value:Ge,to:T.uidt,column:T,appInfo:e(S)},C((Bn=s.value)==null?void 0:Bn.source_id));if(q===void 0||!Sa(q))return;const L=(mt=(tt=s.value)==null?void 0:tt.columns)==null?void 0:mt.find(we=>{var oe;return we.id===((oe=T.colOptions)==null?void 0:oe.fk_child_column_id)});if(!L)return;const te=await w(T.colOptions.fk_related_model_id);return O.oldRow[T.title]=O.row[T.title],O.oldRow[L.title]=O.row[T.title]?Ht(O.row[T.title],te.columns):null,O.row[T.title]=q==null?void 0:q.value,O.row[L.title]=q!=null&&q.value?Ht(q.value,te.columns):null,await(u==null?void 0:u({...t.value,updatedColumnTitle:L.title},ie))}if(Ho(T)){if(!pe(O,T,!0,!0))return;const q=Ml({value:Ge,to:T.uidt,column:T,appInfo:e(S)},C((Dt=s.value)==null?void 0:Dt.source_id));if(q===void 0||!Sa(q))return;const L=Ht(O.row,(Rt=s.value)==null?void 0:Rt.columns);if(!L)return;const te=O.row[T.title];O.row[T.title]=q.value;let we;try{we=await y.dbDataTableRow.nestedListCopyPasteOrDeleteAll((ct=s.value)==null?void 0:ct.id,T.id,[{operation:"copy",rowId:q.rowId,columnId:q.columnId,fk_related_model_id:q.fk_related_model_id},{operation:"paste",rowId:L,columnId:T.id,fk_related_model_id:T.colOptions.fk_related_model_id||q.fk_related_model_id}],{viewId:(nt=r==null?void 0:r.value)==null?void 0:nt.id})}catch{O.row[T.title]=te;return}if(we&&(we!=null&&we.link)&&(we!=null&&we.unlink)&&Array.isArray(we.link)&&Array.isArray(we.unlink)){if(!we.link.length&&!we.unlink.length){O.row[T.title]=te;return}k({redo:{fn:async(oe,Ee,Ne,He,Ze)=>{var Ye,qe,ht,zt,Le,Se;const Ke=Ht(Ne.row,(Ye=s.value)==null?void 0:Ye.columns),ft=e(it).get(oe.row);!ft||!Ke||Ke===Ht(ft.row,(qe=s.value)==null?void 0:qe.columns)&&T.id===Ee.id&&(await Promise.all([Ze.link.length&&y.dbDataTableRow.nestedLink((ht=s.value)==null?void 0:ht.id,T.id,encodeURIComponent(Ke),Ze.link,{viewId:(zt=r==null?void 0:r.value)==null?void 0:zt.id}),Ze.unlink.length&&y.dbDataTableRow.nestedUnlink((Le=s.value)==null?void 0:Le.id,T.id,encodeURIComponent(Ke),Ze.unlink,{viewId:(Se=r==null?void 0:r.value)==null?void 0:Se.id})]),ft.row[T.title]=He,await(u==null?void 0:u(oe,oe==null?void 0:oe.path)))},args:[D(t.value),D(T),D(O),D(q.value),we]},undo:{fn:async(oe,Ee,Ne,He,Ze)=>{var Ye,qe,ht,zt,Le,Se;const Ke=Ht(Ne.row,(Ye=s.value)==null?void 0:Ye.columns),ft=e(it).get(oe.row);!ft||!Ke||Ke===Ht(ft.row,(qe=s.value)==null?void 0:qe.columns)&&T.id===Ee.id&&(await Promise.all([Ze.unlink.length&&y.dbDataTableRow.nestedLink((ht=s.value)==null?void 0:ht.id,T.id,encodeURIComponent(Ke),Ze.unlink),Ze.link.length&&y.dbDataTableRow.nestedUnlink((zt=s.value)==null?void 0:zt.id,T.id,encodeURIComponent(Ke),Ze.link)]),ft.row[T.title]=He,await(u==null?void 0:u((Se=(Le=oe.activeCell)==null?void 0:Le.value)==null?void 0:Se.path)))},args:[D(t.value),D(T),D(O),D(te),we]},scope:F({view:r==null?void 0:r.value})})}return await(u==null?void 0:u(t.value,ie))}if(!pe(O,T,!0))return;let se;try{se=Ml({value:Ge,to:T.uidt,column:T,appInfo:e(S),files:T.uidt===ve.Attachment&&((st=(rt=Q.clipboardData)==null?void 0:rt.files)!=null&&st.length)?(lt=Q.clipboardData)==null?void 0:lt.files:void 0,oldValue:O.row[T.title],maxAttachmentsAllowedInCell:re.value,showUpgradeToAddMoreAttachmentsInCell:me},C((xt=s.value)==null?void 0:xt.source_id)),sr(T,se)}catch(q){if(q instanceof ki)throw q;if(q instanceof ur)await cr({api:y,col:T,addOptions:q.missingOptions}),se=q.value.join(",");else if(q instanceof za)se=null;else throw q}if(T.uidt===ve.Attachment&&((yt=(Ot=Q.clipboardData)==null?void 0:Ot.files)!=null&&yt.length)&&(se!=null&&se.length)){const q=await be(se,T.id,O.row[T.title])||[],L=Rl(O.row[T.title])?O.row[T.title]:[];O.row[T.title]=q.length||L.length?JSON.stringify(L.concat(q)):null}else se!==void 0&&(O.row[T.title]=se);await(u==null?void 0:u(t.value,ie))}else{const{start:O,end:T}=l.value,se=Math.min(O.row,T.row),q=Math.max(O.row,T.row),L=Math.min(O.col,T.col),te=Math.max(O.col,T.col),we=await p(se,q,ie),oe=e(Ue).slice(L,te+1),Ee=[];let Ne,He=!1;const Ze={},Ke=(Qe=Q.clipboardData)==null?void 0:Qe.files;for(const ft of we)if(!(!ft||ft.rowMeta.new))for(const Ye of oe){if(!Ye.title||!pe(ft,Ye)){(Jo(Ye)||Cl(Ye)||Ho(Ye))&&!He&&(Zt.toast(I("msg.info.groupPasteIsNotSupportedOnLinksColumn")),He=!0);continue}if(Ke!=null&&Ke.length){if(Ye.uidt!==ve.Attachment)continue;if(Ne===void 0){const qe=Ml({value:"",to:Ye.uidt,column:Ye,appInfo:e(S),files:Ke,oldValue:ft.row[Ye.title],maxAttachmentsAllowedInCell:re.value,showUpgradeToAddMoreAttachmentsInCell:me,isInfoShown:Ze[Ye.title],markInfoShown:()=>{Ze[Ye.title]=!0}},C((d=s.value)==null?void 0:d.source_id),!0);if(qe!=null&&qe.length){const ht=await be(qe,Ye.id,ft.row[Ye.title]);Ne=ht?JSON.stringify(ht):null}}}else try{Ne=Ml({value:Ge,to:Ye.uidt,column:Ye,appInfo:e(S),oldValue:ft.row[Ye.title],maxAttachmentsAllowedInCell:re.value,showUpgradeToAddMoreAttachmentsInCell:me,isInfoShown:Ze[Ye.title],markInfoShown:()=>{Ze[Ye.title]=!0}},C((_=s.value)==null?void 0:_.source_id),!0),sr(Ye,Ne)}catch(qe){if(qe instanceof ki)throw qe;if(qe instanceof ur)await cr({api:y,col:Ye,addOptions:qe.missingOptions}),Ne=qe.value.join(",");else if(qe instanceof za)Ne=null;else throw qe}Ee.push(Ye.title),Ne!==void 0&&(ft.row[Ye.title]=Ne)}if(!Ee.length)return;await(f==null?void 0:f(we,Ee,void 0,!1,ie))}}catch(O){(!(O instanceof za)||!O.isErrorSuppressed)&&(console.error(O,O.isErrorSuppressed),Zt.error(await hl(O)))}};async function be(Q,ie,Me){var it;const Be=[];try{const Ge=await W(Q,[wa,je.value.id,(it=s.value)==null?void 0:it.id,ie].join("/"));for(const ze of Ge)Be.push({...ze,title:Tf(ze==null?void 0:ze.title,[...Ie(Me),...Be].map(Z=>(Z==null?void 0:Z.title)||(Z==null?void 0:Z.fileName)))});return Be}catch(Ge){Zt.error(await hl(Ge)||I("msg.error.internalError"))}}const ee=async(Q,ie)=>{var ze;const{html:Me,text:Be}=Zv(Q,ie,{meta:s.value,isPg:b,isMysql:C}),it=new Blob([Me],{type:"text/html"}),Ge=new Blob([Be],{type:"text/plain"});return((ze=navigator.clipboard)==null?void 0:ze.write([new ClipboardItem({[it.type]:it,[Ge.type]:Ge})]))??A(Be)};async function H(Q,ie=!1){var Et;if(!Q)return;const Me=Q==null?void 0:Q.path,Be=g(Me),{cachedRows:it}=Be,Ge=n.value[Q.col],ze=it.value.get(Q.row);if(!Ge||!(Ge!=null&&Ge.columnObj)||!ze||!Ge.isCellEditable)return;const Z=Ge.columnObj;if(!Z||x.value||!Q||!ot.value||Z.readonly||xa(Z)&&!ml(Z)||!ml(Z)&&_o(Z)){(Z.readonly||xa(Z)&&!ml(Z)||!ml(Z)&&_o(Z))&&Zt.toast(I("msg.info.computedFieldClearWarning"));return}if(_o(Z)){let _e;const yn=ze.row[Z.title],It=Z.fk_model_id===((Et=Z.colOptions)==null?void 0:Et.fk_related_model_id);Ho(Z)&&ze&&(_e=await j(ze,Z)),k({undo:{fn:async($t,et,cn,Pn,Kt,nn)=>{var Bn,tt,mt;const wt=Ht(cn.row,(Bn=s.value)==null?void 0:Bn.columns),Dn=it.value.get($t.row),un=Ue.value[$t.col];if(Dn&&un&&un.title&&wt===Ht(Dn.row,(tt=s.value)==null?void 0:tt.columns)&&un.id===et.id)Jo(un)||Cl(un)?(Dn.row[un.title]=cn.row[un.title],await Y(Dn,Dn.row[un.title],un),await ae(Dn,Dn.row)):Ho(un)&&(await y.dbDataTableRow.nestedLink((mt=s.value)==null?void 0:mt.id,un.id,encodeURIComponent(wt),Pn),Dn.row[un.title]=Kt??null),t.value.column=$t.col,t.value.row=$t.row,t.value.path=Me,nn&&U.trigger({shouldShowLoading:!1}),o==null||o(void 0,void 0,Me);else throw new Error(I("msg.recordCouldNotBeFound"))},args:[D(Q),D(Z),D(ze),_e,yn,It]},redo:{fn:async($t,et,cn,Pn)=>{var Dn,un;const Kt=Ht(cn.row,(Dn=s.value)==null?void 0:Dn.columns),nn=it.value.get($t.row),wt=Ue.value[$t.col];if(nn&&Kt===Ht(nn.row,(un=s.value)==null?void 0:un.columns)&&wt&&wt.id===et.id)Jo(wt)||Cl(wt)?await N(nn,wt):Ho(wt)&&await j(nn,wt),t.value.column=$t.col,t.value.row=$t.row,t.value.path=Me,Pn&&U.trigger({shouldShowLoading:!1}),o==null||o(void 0,void 0,Me);else throw new Error(I("msg.recordCouldNotBeFound"))},args:[D(Q),D(Z),D(ze),It]},scope:F({view:r.value})}),(Jo(Z)||Cl(Z))&&await N(ze,Z),It&&U.trigger({shouldShowLoading:!1});return}if(Z.title)switch(Z.uidt){case ve.Checkbox:ze.row[Z.title]=!1;break;case ve.Rating:ze.row[Z.title]=0;break;default:ze.row[Z.title]=null;break}ie||await(v==null?void 0:v(ze,Z.title,void 0,void 0,void 0,Me))}async function Ce(Q,ie=[]){try{if(l.value.start!==null&&l.value.end!==null&&!l.value.isSingleCell()){const Me=await p(l.value.start.row,l.value.end.row,ie),Be=e(Ue).slice(l.value.start.col,l.value.end.col+1);await ee(Me,Be),Zt.toast(I(`msg.toast.nCell${Me.length*Be.length===1?"":"s"}Copied`,{n:Me.length*Be.length}))}else{const Me=g(ie),Be=(Q==null?void 0:Q.row)??t.value.row,it=(Q==null?void 0:Q.col)??t.value.column;if(Be!=null&&it!=null){const Ge=e(Me.cachedRows).get(Be),ze=e(Ue)[it];if(!Ge||!ze)return;const Z=Qv(Ge,ze,{meta:s.value,metas:m.value,isPg:b,isMysql:C});await A(sa(Z)?Z:""),Zt.toast(I("msg.toast.nCellCopied",{n:1}))}}}catch(Me){console.log(Me),Zt.error(I("msg.error.copyToClipboardError"))}}function Ie(Q){const ie=jn(Q);return ie&&Array.isArray(ie)?ie:[]}return Tl(document,"paste",ne),{copyValue:Ce,clearCell:H,isPasteable:pe}}const Vu=(t,n,o,l=[],a)=>{var u;const i=`${o.id}-${o.uidt}-${t}-${n==null?void 0:n.toString()}-${l.join("-")}-${(u=a==null?void 0:a.meta)==null?void 0:u.columnsHash}`,r=vc.get(i);if(!Ai(r))return sa(r)?r:void 0;const s=$h(t,n,o,a);return vc.set(i,s),sa(s)?s:void 0};function CC({rowHeightEnum:t,cachedRows:n,clearCache:o,chunkStates:l,totalRows:a,actualTotalRows:i,loadData:r,scrollLeft:s,scrollTop:u,width:c,height:f,scrollToCell:v,aggregations:p,vSelectedAllRecords:g,selectedRows:y,updateRecordOrder:x,expandRows:w,updateOrSaveRow:m,bulkUpdateRows:C,bulkUpsertRows:b,expandForm:S,addEmptyRow:k,onActiveCellChanged:D,addNewColumn:F,mousePosition:I,setCursor:M,getRows:A,cachedGroups:j,toggleExpand:N,totalGroups:Y,groupSyncCount:ae,groupByColumns:he,fetchMissingGroupChunks:ye,getDataCache:re}){const{metas:me,getMeta:W,getPartialMeta:U}=ai(),{getBaseRoles:Ae}=As(),{isAllowed:je}=nd(),Ue=V({start:0,end:0}),ot=V({start:0,end:0}),G=V({row:-1,column:-1,path:[]}),pe=V(new zs),ne=V({path:[],rowIndex:-2}),be=V(null),ee=V(!1),H=V(null),Ce=new Sk(()=>An()),Ie=new Ik(()=>An()),Q=new lC(W,()=>An),ie=new sC(Ae,()=>An),Me=dn(Js,void 0),Be=dn(Ea,jo()),it=new Jv([]),Ge=V(!1),ze=V(-1),Z=V([]),Et=V(-1),_e=V({isHoveredLearnMore:!1,isHoveredUpgrade:!1}),{isMobileMode:yn}=tl(),{$api:It}=ua(),{t:$t}=la(),{gridViewCols:et,metaColumnById:cn,updateGridViewColumn:Pn}=Ha(),{eventBus:Kt,isDefaultView:nn,meta:wt,allFilters:Dn,sorts:un,isPkAvail:Bn,view:tt,isSqlView:mt,isExternalSource:Dt,isAlreadyShownUpgradeModal:Rt,gridEditEnabled:ct}=Fl(),{addUndo:nt,defineViewScope:rt}=Mi(),{activeView:st}=Uo(yr()),{meta:lt,ctrl:xt}=Ef(),{isDataReadOnly:Ot,isUIAllowed:yt}=wl(),{isAiFeaturesEnabled:Qe,aiIntegrations:d,generateRows:_}=kr(),O=Nm(),T=ul(),{blockExternalSourceRecordVisibility:se,blockRowColoring:q}=ql(),{isRowColouringEnabled:L}=od(),te=dn(wr,V([])),we=Ca(),{isMysql:oe,isPg:Ee}=we,{sqlUis:Ne}=Uo(we),{basesUser:He}=Uo(As()),Ze=ue(()=>q.value?Wc:Wc+zc+4),Ke=ue(()=>L.value?zc:0),ft=ue(()=>{var We,jt;return(We=wt.value)!=null&&We.base_id?He.value.get((jt=wt.value)==null?void 0:jt.base_id)||[]:[]}),{hideTooltip:Ye}=T,qe=dn(zl,V(!1)),ht=dn(Ks,V(!1)),{loadAutomation:zt}=O,Le=new Ak(It,zt,Da,wt,An,re),Se=ue(()=>{var We;return!!((We=he.value)!=null&&We.length)}),Mt=ue(()=>!Se.value&&se(Dt.value)&&a.value>=ol),xe=ue(()=>{var We;return(((We=wt.value)==null?void 0:We.columns)??[]).some(jt=>$f(jt))}),Pe=ue(()=>{var We,jt;return!!((We=Dn.value)!=null&&We.length)||!!((jt=un.value)!=null&&jt.length)||qe.value}),gt=ue(()=>{var We;return((We=un.value)==null?void 0:We.length)||qe.value||!Bn.value}),X=ue(()=>yt("dataEdit")&&!mt.value&&!qe.value),Fe=ue(()=>yt("fieldAdd")),vt=ue(()=>xe.value&&!gt.value),Re=ue(()=>{var We;return X.value&&!((We=wt.value)!=null&&We.synced)}),bt=ue(()=>{var We;return(We=wt.value)!=null&&We.id?je(pl.TABLE,wt.value.id,vl.TABLE_RECORD_ADD):!0}),_t=ue(()=>!ht.value&&Fe.value&&!mt.value),Xe=ue(()=>yn.value?56:Bo[`${(t==null?void 0:t.value)??1}`]??32),tn=ue(()=>u.value%Xe.value),Yt=ue(()=>(Va()?!!(lt!=null&&lt.value):!!(xt!=null&&xt.value))&&Qe.value),en=V([]),pt=ue(()=>{var St;const We=[],jt=te.value.map(kt=>{var Un,ho,Vl,Ao,bl,al,io,Al,fa,La,Zo;if(!kt.id)return!1;const sn=et.value[kt.id];if(!sn)return!1;let bn,Rn;if(kt.extra={},[ve.Lookup,ve.Rollup].includes(kt.uidt)?(bn=(Vl=(ho=(Un=me.value)==null?void 0:Un[kt.fk_model_id])==null?void 0:ho.columns)==null?void 0:Vl.find(oo=>{var Ll;return oo.id===((Ll=kt==null?void 0:kt.colOptions)==null?void 0:Ll.fk_relation_column_id)}),bn&&((Ao=bn.colOptions)!=null&&Ao.fk_related_model_id)&&((bl=me.value)!=null&&bl[bn.colOptions.fk_related_model_id]?Rn=(al=me.value)==null?void 0:al[bn.colOptions.fk_related_model_id]:We.push([bn.id,bn.colOptions.fk_related_model_id]))):Oh(kt.uidt,kt.colOptions)&&(io=kt.colOptions)!=null&&io.fk_related_model_id&&((Al=me.value)!=null&&Al[kt.colOptions.fk_related_model_id]?Rn=(fa=me.value)==null?void 0:fa[kt.colOptions.fk_related_model_id]:We.push([kt.id,kt.colOptions.fk_related_model_id])),[ve.SingleSelect,ve.MultiSelect].includes(kt.uidt)?kt.extra=Lv(kt):[ve.User,ve.CreatedBy,ve.LastModifiedBy].includes(kt.uidt)&&(kt.extra=Nv(kt,ft.value)),[ve.DateTime].includes(kt.uidt)&&(jn(kt.meta),kt.extra.timezone=void 0,kt.extra.isDisplayTimezone=void 0),[ve.Formula].includes(kt.uidt)&&[ve.DateTime].includes((La=kt.meta)==null?void 0:La.display_type)){const oo=(Zo=kt.meta)==null?void 0:Zo.display_column_meta;if(oo.meta){oo.meta;const Ll={timezone:void 0,isDisplayTimezone:void 0};oo.extra=Ll}}const Tt=Dh(kt,d.value,qe.value||!X.value||mt.value),_n=Ne.value[kt.source_id]??Object.values(Ne.value)[0],Zn=Qr(kt)||!pf(kt)||je(pl.FIELD,kt.id,vl.RECORD_FIELD_EDIT),Ko=Vu(sn.aggregation,p.value[kt.title],kt,[],{col:kt,meta:wt.value,metas:me.value,isMysql:oe,isPg:Ee});return{id:kt.id,grid_column_id:sn.id,title:kt.title,uidt:kt.uidt,width:sn.width,fixed:yn.value&&!Se.value?!1:Se.value?!!kt.pv:pn(sn.width)>c.value*.75?!1:!!kt.pv,readonly:kt.readonly||Ot.value||!X.value||qe.value||!1,isCellEditable:Zn,pv:!!kt.pv,virtual:_o(kt),aggregation:Ko,agg_prefix:sn.aggregation?$t(`aggregation.${sn.aggregation}`).replace("Percent ",""):"",agg_fn:sn.aggregation,columnObj:kt,relatedColObj:bn,relatedTableMeta:Rn,isInvalidColumn:{...Tt,tooltip:Tt.ignoreTooltip?null:Tt.tooltip&&$t(Tt.tooltip)},abstractType:_n==null?void 0:_n.getAbstractType(kt)}}).filter(kt=>!!kt).sort((kt,sn)=>!!sn.fixed-!!kt.fixed);return en.value.push(...We),jt.splice(0,0,{id:"row_number",grid_column_id:"row_number",uidt:null,title:"#",width:`${Ze.value+((St=he.value)==null?void 0:St.length)*13}px`,fixed:!0,pv:!1,columnObj:{uidt:ve.AutoNumber}}),jt}),hn=ue(()=>pt.value.map(We=>{var jt;return We.id==="row_number"?pn(We.width)-((jt=he.value)==null?void 0:jt.length)*13:pn(We.width)})),on=ue(()=>hn.value.reduce((We,jt)=>We+jt,0)),so=ue(()=>!mt.value),Cn=ue(()=>{var We;if(pe.value.start.col===pe.value.end.col){const jt=pt.value[pe.value.start.col],St=jt==null?void 0:jt.columnObj;return St?{enabled:ba(St)||is(St),disabled:!((We=St==null?void 0:St.colOptions)!=null&&We.fk_integration_id)}:{enabled:!1,disabled:!1}}return{enabled:!1,disabled:!1}}),gn=ue(()=>{if(pe.value.start.col===pe.value.end.col){const We=pt.value[pe.value.start.col],jt=We==null?void 0:We.columnObj;return jt?{enabled:Of(jt),disabled:!1}:{enabled:!1,disabled:!1}}return{enabled:!1,disabled:!1}}),xn=ue(()=>{var We;return pe.value.isEmpty()&&G.value.column&&((We=pt.value[G.value.column])==null?void 0:We.virtual)||!pe.value.isEmpty()&&Array.from({length:pe.value.end.col-pe.value.start.col+1}).every((jt,St)=>{var kt;return!((kt=pt.value[pe.value.start.col+St])!=null&&kt.isCellEditable)})}),Vt=ue(()=>{var jt,St,kt,sn,bn;const We=re((jt=G==null?void 0:G.value)==null?void 0:jt.path);return!(!Ot.value&&!ht.value&&(!be.value||wd.includes((kt=(St=be.value)==null?void 0:St.column)==null?void 0:kt.uidt))&&(!pe.value.isEmpty()||G.value.row!==null&&G.value.column!==null)&&!((bn=(sn=We.cachedRows.value.get((isNaN(pe.value.end.row)?G.value.row:pe.value.end.row)??-1))==null?void 0:sn.rowMeta)!=null&&bn.new)&&G.value.column!==null&&te.value[G.value.column-1]&&We.totalRows.value&&!xn.value&&!mt.value)}),ln=ue(()=>{let We=0;return he.value.length&&(We+=he.value.length*13),pt.value.reduce((jt,St)=>jt+pn(St.width),We)+256}),an=ue(()=>{switch(he.value.length){case 1:return"#F9F9FA";case 2:return"#F4F4F5";case 3:return"#E7E7E9";default:return"#F9F9FA"}}),Fn=(We,jt=0,St=hn.value.length)=>{let kt=0;for(let sn=0;sn<St;sn++){if(kt>We)return Math.max(0,sn-1);kt+=hn.value[sn]??0}return St-1};function Yn(We,jt=0){let St=0;const kt=pt.value.filter(Tt=>Tt.fixed);for(const Tt of kt){const _n=hn.value[pt.value.indexOf(Tt)]??180;if(We>=St&&We<St+_n)return Tt.uidt||(St+=_n),{column:Tt,xOffset:St};St+=_n}const sn=ot.value.start,bn=ot.value.end;St=hn.value.slice(0,sn).reduce((Tt,_n)=>Tt+_n,0)-jt,he.value.length&&(St+=he.value.length*13);for(let Tt=sn;Tt<bn;Tt++){const _n=hn.value[Tt]??180;if(We>=St&&We<St+_n)return{column:pt.value[Tt],xOffset:St};St+=_n}return{column:null,xOffset:St}}function ao(We,jt=0){let St=0;const kt=pt.value.filter(Tt=>Tt.fixed);for(const Tt of kt){const _n=hn.value[pt.value.indexOf(Tt)]??180;if(We===Tt.id)return Tt.uidt||(St+=_n),{column:Tt,xOffset:St,width:Tt.width};St+=_n}const sn=ot.value.start,bn=ot.value.end;St=hn.value.slice(0,sn).reduce((Tt,_n)=>Tt+_n,0)-jt,he.value.length&&(St+=he.value.length*13);for(let Tt=sn;Tt<bn;Tt++){const _n=hn.value[Tt]??180;if(pt.value[Tt]&&We===pt.value[Tt].id)return{column:pt.value[Tt],xOffset:St,width:pt.value[Tt].width};St+=_n}return{column:null,xOffset:St,width:"0px"}}function eo(We,jt,St=[]){const kt=hr(j.value,St,jt,Xe.value,Re.value)-u.value+Fo;if(We.fixed){let Rn=0;for(let Tt=0;Tt<pt.value.length;Tt++){const _n=pt.value[Tt];if((_n==null?void 0:_n.id)===We.id)break;_n!=null&&_n.fixed&&(Rn+=pn(_n==null?void 0:_n.width))}return{x:Rn,y:kt,width:pn(We.width),height:Xe.value}}let sn=Fk;pt.value.forEach(Rn=>{Rn.fixed&&(sn+=pn(Rn.width))});const bn=sn;for(const Rn of pt.value){if(Rn.id===We.id)break;Rn.fixed||(sn+=pn(Rn.width))}return{x:bn+(sn-bn)-s.value,y:kt,width:pn(We.width),height:Xe.value}}const Ro=()=>{var sn,bn,Rn;if(Vt.value)return null;const We=G==null?void 0:G.value.path;if((pe.value.end.row<Ue.value.start||pe.value.end.row>=Ue.value.end)&&!Se.value||Se.value&&We&&!rC(j.value,We))return null;if(pe.value.isSingleCell()){if(Mt.value&&pe.value.start.row>=ol)return null;const Tt=pt.value[pe.value.end.col];if(Tt!=null&&Tt.virtual||xa(Tt==null?void 0:Tt.columnObj)||Tt!=null&&Tt.columnObj&&ba(Tt==null?void 0:Tt.columnObj))return null}else if(pt.value.slice(pe.value.start.col,pe.value.end.col+1).every(Zn=>Zn==null?void 0:Zn.virtual))return null;let jt=0;const St=pt.value.filter(Tt=>Tt.fixed);for(let Tt=0;Tt<=Math.min(pe.value.end.col,St.length-1);Tt++)(sn=pt.value[Tt])!=null&&sn.fixed&&(jt+=pn((bn=pt.value[Tt])==null?void 0:bn.width));for(let Tt=St.length;Tt<=pe.value.end.col;Tt++)jt+=pn((Rn=pt.value[Tt])==null?void 0:Rn.width);pe.value.end.col>=St.length&&(jt-=s.value);const kt=hr(j.value,We,pe.value.end.row,Xe.value,Re.value)-u.value+Fo+Xe.value;return{x:jt,y:kt,size:Yt.value?10:8,fixedCol:pe.value.end.col<St.length}},{handleCellClick:Mo,renderCell:Ve,handleCellHover:Eo,handleCellKeyDown:qn}=oC({getCellPosition:eo,actionManager:Le,updateOrSaveRow:m,makeCellEditable:yl,meta:wt,hasEditPermission:X,setCursor:M}),{canvasRef:to,renderCanvas:no,colResizeHoveredColIds:Qo}=vC({width:c,mousePosition:I,elementMap:it,height:f,columns:pt,colSlice:ot,groupByColumns:he,cachedGroups:j,scrollLeft:s,baseColor:an,scrollTop:u,totalGroups:Y,rowSlice:Ue,rowHeight:Xe,activeCell:G,dragOver:H,hoverRow:ne,selection:pe,getFillHandlerPosition:Ro,isAiFillMode:Yt,isFillMode:ee,imageLoader:Ie,spriteLoader:Ce,tableMetaLoader:Q,partialRowHeight:tn,vSelectedAllRecords:g,isRowDraggingEnabled:vt,selectedRows:y,isDragging:Ge,draggedRowIndex:ze,targetRowIndex:Et,renderCell:Ve,meta:wt,editEnabled:be,totalWidth:ln,totalRows:a,actualTotalRows:i,t:$t,isAddingColumnAllowed:_t,readOnly:ht,isFieldEditAllowed:Fe,setCursor:M,isGroupBy:Se,totalColumnsWidth:on,getDataCache:re,fetchMissingGroupChunks:ye,getRows:A,draggedRowGroupPath:Z,isAddingEmptyRowAllowed:Re,isAddingEmptyRowPermitted:bt,removeInlineAddRecord:Mt,upgradeModalInlineState:_e,rowMetaColumnWidth:Ze,rowColouringBorderWidth:Ke}),{handleDragStart:dl}=xC({canvasRef:to,rowHeight:Xe,isDragging:Ge,draggedRowGroupPath:Z,draggedRowIndex:ze,targetRowIndex:Et,scrollToCell:v,triggerRefreshCanvas:An,updateRecordOrder:x,elementMap:it,getDataCache:re}),{fetchChunk:ri,updateVisibleRows:Ma}=fC({cachedRows:n,chunkStates:l,clearCache:o,totalRows:a,loadData:r,rowSlice:Ue,triggerRefreshCanvas:An,isAlreadyShownUpgradeModal:Rt,isExternalSource:Dt}),{clearCell:kn,copyValue:Ta,isPasteable:Ka}=kC({activeCell:G,selection:pe,columns:pt,editEnabled:be,scrollToCell:v,expandRows:w,view:tt,meta:wt,syncCellData:async(We,jt=[])=>{var Rn;const St=re(jt),kt=St.cachedRows.value.get(We.row),sn=We.column!==void 0?te.value[We.column-1]:null;if(!kt||!sn){An();return}if(!We.updatedColumnTitle&&_o(sn)){sn.fk_model_id===((Rn=sn.colOptions)==null?void 0:Rn.fk_related_model_id)&&(Be==null||Be.trigger({shouldShowLoading:!1})),An();return}const bn=St.cachedRows.value.get(We.row);if(bn){const Tt={...bn,rowMeta:{...bn.rowMeta,isUpdatedFromCopyNPaste:{...bn.rowMeta.isUpdatedFromCopyNPaste||{},[We.updatedColumnTitle||sn.title]:!0}}};St.cachedRows.value.set(We.row,Tt),An()}await(m==null?void 0:m(kt,We.updatedColumnTitle||sn.title,void 0,void 0,void 0,jt)),An()},bulkUpdateRows:C,bulkUpsertRows:b,fetchChunk:ri,updateOrSaveRow:m,getRows:A,getDataCache:re}),{handleFillEnd:Oi,handleFillMove:ll,handleFillStart:ca}=_C({isFillMode:ee,isAiFillMode:Yt,selection:pe,canvasRef:to,getFillHandlerPosition:Ro,triggerReRender:An,getRows:A,meta:wt,columns:pt,bulkUpdateRows:C,isPasteable:Ka,activeCell:G,elementMap:it,getDataCache:re}),$a=(We,jt,St)=>{if(pt.value.findIndex(Rn=>Rn.id===We)===-1)return;const sn=cn.value[We];if(!sn)return;const bn=gC(sn,jt);St(`${bn}px`),Me==null||Me.trigger()},Ja=(We,jt)=>{var St,kt,sn,bn;!((St=wt.value)!=null&&St.columns)||!((kt=wt.value)!=null&&kt.columnsById)||(wt.value.columns=(wt.value.columns||[]).map(Rn=>(Rn.id!==We||(Rn.meta={...jn(Rn.meta||{}),defaultViewColOrder:jt}),Rn)),(bn=(sn=wt.value)==null?void 0:sn.columnsById)!=null&&bn[We]&&(wt.value.columnsById[We].meta={...jn(wt.value.columnsById[We].meta),defaultViewColOrder:jt}))},{handleMouseMove:Xl,handleMouseDown:Oa,resizeableColumn:Qa,isResizing:ut}=hC(to,pt,ot,s,(We,jt)=>$a(We,jt,St=>et.value[We].width=St),(We,jt)=>$a(We,jt,St=>Pn(We,{width:St}))),{isDragging:Kl,startDrag:No}=pC(to,pt,ot,s,An,H,(We,jt,St)=>{var Vl,Ao,bl,al,io;const kt=pt.value[jt],sn=pt.value[St];if(!kt||!sn||!((Vl=wt.value)!=null&&Vl.columns))return;const bn=et.value[kt.id],Rn=et.value[sn.id];if(!bn||!Rn)return;const Tt=St<pt.value.length-1?pt.value[St+1]:null,_n=Tt?et.value[Tt.id]:null,Zn=pt.value[pt.value.length-1],Ko=et.value[Zn.id];if(_n===null&&Ko===null)return;const Un=_n?Rn.order+(_n.order-Rn.order)/2:Ko.order+1,ho=bn.order;bn.order=Un,nn.value&&bn.fk_column_id&&(wt.value.columns=(bl=((Ao=wt.value)==null?void 0:Ao.columns)??[])==null?void 0:bl.map(Al=>(Al.id!==bn.fk_column_id||(Al.meta={...jn(Al.meta||{}),defaultViewColOrder:Un}),Al)),(io=(al=wt.value)==null?void 0:al.columnsById)!=null&&io[bn.fk_column_id]&&(wt.value.columnsById[bn.fk_column_id].meta={...jn(wt.value.columnsById[bn.fk_column_id].meta),defaultViewColOrder:Un})),nt({undo:{fn:async()=>{bn.order=ho,nn.value&&Ja(bn.fk_column_id,ho),await Pn(kt.id,{order:ho}),Kt.emit(qo.FIELD_RELOAD)},args:[]},redo:{fn:async()=>{bn.order=Un,nn.value&&Ja(bn.fk_column_id,Un),await Pn(kt.id,{order:Un}),Kt.emit(qo.FIELD_RELOAD)},args:[]},scope:rt({view:st.value})}),Pn(kt.id,{order:Un},!0),Kt.emit(qo.FIELD_RELOAD)});yC({activeCell:G,triggerReRender:An,columns:pt,scrollToCell:v,selection:pe,editEnabled:be,isGroupBy:Se,cachedGroups:j,getDataCache:re,copyValue:Ta,clearCell:kn,clearSelectedRangeOfCells:Dl,makeCellEditable:yl,expandForm:S,isAddingEmptyRowAllowed:Re,isAddingEmptyRowPermitted:bt,addEmptyRow:k,onActiveCellChanged:D,addNewColumn:F,handleCellKeyDown:qn,removeInlineAddRecord:Mt});const{handleMouseDown:So,handleMouseMove:Po,handleMouseUp:bo}=bC({selection:pe,activeCell:G,canvasRef:to,scrollLeft:s,columns:pt,triggerReRender:An,scrollToCell:v,elementMap:it,getDataCache:re});async function Dl(We){if(!X.value||Ot.value)return;const jt=pe.value.start,St=pe.value.end,kt=Math.min(jt.col,St.col),sn=Math.max(jt.col,St.col),bn=pt.value.slice(kt,sn+1),Rn=await A(jt.row,St.row,We),Tt=[];let _n=!1;for(const Zn of Rn)for(const Ko of bn){const Un=Ko.columnObj;if(!(!Zn||!Un||!Un.title||!Ko.isCellEditable)){if(_o(Un)){(Jo(Un)||Cl(Un)||Ho(Un))&&!_n&&(Zt.info($t("msg.info.groupClearIsNotSupportedOnLinksColumn")),_n=!0);continue}$s(Un)||Un.readonly||(Zn.row[Un.title]=null,Tt.push(Un.title))}}await C(Rn,Tt,void 0,!1,We)}const Xo=V();Gn(()=>{var jt;return Se.value&&!G.value.path?null:re(G.value.path).cachedRows.value.get(((jt=be.value)==null?void 0:jt.row.rowMeta.rowIndex)??1/0)},We=>{We!=null&&(Xo.value=We)},{deep:!0}),Gn(Xo,We=>{var jt;(jt=be.value)!=null&&jt.row&&(be.value.row=We)},{deep:!0}),Gn(be,We=>{ct.value=We});function Da(We,jt){var St;return _((St=wt.value)==null?void 0:St.id,We,jt)}function rn(We,jt){var _n;const St=cn.value[jt.id],kt=We.rowMeta.rowIndex+1,sn=We.rowMeta.path;if(Se.value&&!sn&&!(sn!=null&&sn.legth))return;const bn=hr(j.value,sn,kt,Xe.value,Re.value)+Fo;let Rn=(((_n=he.value)==null?void 0:_n.length)??0)*13;const Tt=pt.value.findIndex(Zn=>Zn.id===jt.id);if(jt.fixed){const Zn=pt.value.filter(Ko=>Ko.fixed);for(const Ko of Zn){const Un=hn.value[pt.value.indexOf(Ko)]??10;if(Ko.id===jt.id)break;Rn+=Un}}else{const Zn=ot.value.start,Ko=hn.value.slice(0,Zn).reduce((Un,ho)=>Un+ho,0);Rn+=Ko;for(let Un=Zn;Un<Tt;Un++)Rn+=hn.value[Un]??10}return be.value={rowIndex:kt,x:Rn+([ve.LongText,ve.Formula].includes(St.uidt)?-1:0),y:bn-1,column:St,row:We,minHeight:Xe.value,height:[ve.LongText,ve.Formula].includes(St.uidt)?"auto":Xe.value+2,width:pn(jt.width)+([ve.LongText,ve.Formula].includes(St.uidt)?2:0)+2,fixed:jt.fixed,path:sn,isCellEditable:jt.isCellEditable},Ye(),!0}function yl(We,jt,St=!0){const kt=cn.value[jt.id];if(We=typeof We=="number"?n.value.get(We):We,!We||!kt)return null;if(Mt.value&&We.rowMeta.rowIndex&&We.rowMeta.rowIndex>=ol)return;const sn=kt.id&&!je(pl.FIELD,kt.id,vl.RECORD_FIELD_EDIT);if((!X.value||ht.value||qe.value||!Re.value||sn)&&[ve.LongText,ve.Attachment,ve.JSON,ve.Links,ve.Lookup,ve.Barcode,ve.QrCode,ve.LinkToAnotherRecord,ve.Formula].includes(kt.uidt)){rn(We,jt);return}const bn=xa(kt)&&!ml(kt);if(!X.value||be.value||ht.value||bn)return null;if(!Bn.value&&!We.rowMeta.new)return Zt.info($t("msg.info.updateNotAllowedWithoutPK")),null;if(kt.ai)return Zt.info($t("msg.info.autoIncFieldNotEditable")),null;if(kt.pk&&!We.rowMeta.new)return Zt.info($t("msg.info.editingPKnotSupported")),null;if(kt.readonly)return Zt.info($t("msg.info.fieldReadonly")),null;rn(We,jt)}function An(){no()}return Gn(Xe,()=>{Kf(),An()}),Gn(Yt,()=>{An()}),Kt.on(We=>{[qo.TRIGGER_RE_RENDER,qo.ON_ROW_COLOUR_INFO_UPDATE].includes(We)&&Lh(()=>{Nh(),An()})}),Gn(()=>en.value.length,async()=>{en.value.length&&(await Promise.all(en.value.map(async([We,jt])=>{try{await W(jt,!1,!1,void 0,!0)}catch{}me.value[jt]||await U(We,jt)})),en.value=[],An())}),{rowSlice:Ue,colSlice:ot,activeCell:G,editEnabled:be,rowHeight:Xe,totalWidth:ln,columnWidths:hn,columns:pt,canvasRef:to,isDragging:Kl,selection:pe,hoverRow:ne,resizeableColumn:Qa,partialRowHeight:tn,readOnly:ht,colResizeHoveredColIds:Qo,isResizing:ut,fetchChunk:ri,updateVisibleRows:Ma,findColumnIndex:Fn,triggerRefreshCanvas:An,startDrag:No,findClickedColumn:Yn,findColumnPosition:ao,syncGroupCount:ae,totalGroups:Y,isGroupBy:Se,fetchMissingGroupChunks:ye,groupByColumns:he,cachedGroups:j,toggleExpand:N,elementMap:it,makeCellEditable:yl,resizeMouseMove:Xl,startResize:Oa,onMouseUpSelectionHandler:bo,onMouseMoveSelectionHandler:Po,onMouseDownSelectionHandler:So,onMouseDownFillHandlerStart:ca,onMouseMoveFillHandlerMove:ll,onMouseUpFillHandlerEnd:Oi,isFillHandlerActive:ee,isFillHandleDisabled:Vt,isRowReOrderEnabled:vt,onMouseDownRowReorderStart:dl,isRowReorderActive:Ge,isSelectedOnlyScript:gn,isSelectedOnlyAI:Cn,isSelectionReadOnly:xn,isInsertBelowDisabled:Pe,isOrderColumnExists:xe,isPrimaryKeyAvailable:Bn,meta:wt,view:tt,isAddingEmptyRowAllowed:Re,isAddingEmptyRowPermitted:bt,isAddingColumnAllowed:_t,getCellPosition:eo,clearCell:kn,copyValue:Ta,clearSelectedRangeOfCells:Dl,actionManager:Le,imageLoader:Ie,baseRoleLoader:ie,handleCellClick:Mo,handleCellHover:Eo,renderCell:Ve,totalColumnsWidth:on,isFieldEditAllowed:Fe,isDataEditAllowed:X,isContextMenuAllowed:so,removeInlineAddRecord:Mt,upgradeModalInlineState:_e,isRowDraggingEnabled:vt,rowMetaColumnWidth:Ze,isRowColouringEnabled:L,rowColouringBorderWidth:Ke}}const RC={class:"flex !w-full text-[13px] text-gray-800 items-center justify-between"},SC=xo({__name:"Aggregation",props:{column:{}},emits:["update:column"],setup(t,{emit:n}){const a=Ra(t,"column",n),{updateAggregate:i,getAggregations:r}=nu(),{gridViewCols:s}=Ha(),u=dn(Yi,V(!1)),c=ue(()=>s.value[a.value.id]),f=ue(()=>r(a.value.columnObj)),v=p=>{i(a.value.id,p),a.value=null};return(p,g)=>{var m;const y=Sl,x=Ya,w=qa;return(m=e(a))!=null&&m.uidt?(h(),J(w,{key:0,disabled:e(u),class:"!max-h-55 overflow-auto",variant:"small"},{default:K(()=>[(h(!0),B(Qt,null,po(e(f),(C,b)=>(h(),J(x,{key:b,onClick:S=>v(C)},{default:K(()=>{var S;return[z("div",RC,[Je(ce(p.$t(`aggregation_type.${C}`))+" ",1),((S=e(c))==null?void 0:S.aggregation)===C?(h(),J(y,{key:0,class:"text-brand-500",icon:"check"})):ge("",!0)])]}),_:2},1032,["onClick"]))),128))]),_:1},8,["disabled"])):ge("",!0)}}}),IC=Object.assign(Ol(SC,[["__scopeId","data-v-b0c35ac1"]]),{__name:"SmartsheetGridCanvasContextAggregation"}),FC=xo({__name:"Tooltip",props:{tooltipStyle:{},theme:{default:"dark"}},setup(t){const n=ul(),{tooltipText:o}=Uo(n);return(l,a)=>(h(),B("div",{class:Gt(["tooltip",[`tooltip-${"theme"in l?l.theme:e(Ph)}`]]),style:Xn(l.tooltipStyle)},[("ncIsString"in l?l.ncIsString:e(Ii))(e(o))?(h(),B(Qt,{key:1},[Je(ce(e(o)),1)],64)):(h(),J($o(e(o)),{key:0}))],6))}}),AC=Object.assign(FC,{__name:"SmartsheetGridCanvasComponentsTooltip"});function EC(){const t=document.createElement("div");t.style.width="100px",t.style.height="100px",t.style.overflow="scroll",t.style.position="absolute",t.style.top="-9999px",document.body.appendChild(t);const n=t.offsetWidth-t.clientWidth;return document.body.removeChild(t),n>0}const MC={class:"absolute inset-0 overflow-hidden"},Ru=1e3/60,rf=100,TC=180,$C=12,sf=.98,uf=.01,OC=xo({__name:"Scroller",props:{width:{type:Number,required:!0},height:{type:Number,required:!0},scrollWidth:{type:Number,default:0},scrollHeight:{type:Number,default:0}},emits:["scroll"],setup(t,{expose:n,emit:o}){const l=t,a=o,i=Nn(l,"scrollWidth"),r=Nn(l,"scrollHeight"),s=Nn(l,"height"),u=Nn(l,"width"),c=V(),f=V(),v=V(null),p=V(null),g=V(0),y=V(0),x=V(!1),w=V(0),m=V(0),C=V(null),b=V({startTime:0,startPosition:{x:0,y:0},currentPosition:{x:0,y:0},velocity:{x:0,y:0},touchHistory:[],animation:null}),S=V(!0),k=V(null),D=V(!1),F=()=>{S.value=!0,k.value&&clearTimeout(k.value),D.value||(k.value=setTimeout(()=>{S.value=!1},2e3))},I=ue(()=>r.value>s.value),M=ue(()=>i.value>u.value),A=ue(()=>{const H=s.value/r.value;return Math.max(H*100,10)}),j=ue(()=>{const H=u.value/i.value;return Math.max(H*100,10)}),N=ue(()=>{const H=s.value-72-(s.value-72)*A.value/100;return g.value/(r.value-s.value)*H}),Y=ue(()=>{const H=u.value-12-(u.value-12)*j.value/100;return y.value/(i.value-u.value)*H}),ae=(H,Ce,Ie)=>{if(H<Ce){const Q=H-Ce;return Ce+Q*Math.exp(-12)}if(H>Ie){const Q=H-Ie;return Ie+Q*Math.exp(-12)}return H},he=(H,Ce)=>{if(!f.value)return;let Ie=g.value,Q=y.value;if(H!==void 0){const ie=f.value.scrollHeight-c.value.clientHeight;Ie=ae(H,0,ie)}if(Ce!==void 0){const ie=f.value.scrollWidth-c.value.clientWidth;Q=ae(Ce,0,ie)}(Ie!==g.value||Q!==y.value)&&(g.value=Ie,y.value=Q,F(),a("scroll",{left:y.value,top:g.value}))},ye=V(!1),re=H=>{H.preventDefault(),ye.value&&H.shiftKey?he(g.value,y.value+H.deltaY):he(g.value+H.deltaY,y.value+H.deltaX)},me=(H,Ce)=>{Ce.preventDefault(),Ce.stopPropagation(),x.value=!0,C.value=H,w.value=H==="vertical"?Ce.clientY:Ce.clientX,m.value=H==="vertical"?g.value:y.value,document.addEventListener("mousemove",W),document.addEventListener("mouseup",U)};function W(H){if(!x.value)return;const Ce=C.value==="vertical"?H.clientY-w.value:H.clientX-w.value,Ie=C.value==="vertical"?(f.value.scrollHeight-c.value.clientHeight)/(c.value.clientHeight-c.value.clientHeight*A.value/100):(f.value.scrollWidth-c.value.clientWidth)/(c.value.clientWidth-c.value.clientWidth*j.value/100),Q=m.value+Ce*Ie;C.value==="vertical"?he(Q,void 0):he(void 0,Q)}function U(){x.value=!1,C.value=null,document.removeEventListener("mousemove",W),document.removeEventListener("mouseup",U)}const Ae=(H,Ce)=>{if(Ce.target===(H==="vertical"?v.value:p.value))return;const Ie=Ce.currentTarget.getBoundingClientRect(),Q=H==="vertical"?Ce.clientY-Ie.top:Ce.clientX-Ie.left,ie=H==="vertical"?Ie.height:Ie.width,Me=Q/ie,it=(H==="vertical"?f.value.scrollHeight-c.value.clientHeight:f.value.scrollWidth-c.value.clientWidth)*Me;H==="vertical"?he(it,void 0):he(void 0,it)},je=()=>{const H=Date.now(),Ie=b.value.touchHistory.filter(Be=>H-Be.time<=rf);if(Ie.length<2)return{x:0,y:0};const Q=Ie[0],ie=Ie[Ie.length-1],Me=ie.time-Q.time;return Me===0?{x:0,y:0}:{x:(Q.position.x-ie.position.x)/Me*1e3,y:(Q.position.y-ie.position.y)/Me*1e3}},Ue=H=>{b.value.animation&&(cancelAnimationFrame(b.value.animation),b.value.animation=null);const Ce=H.touches[0],Ie=Date.now();b.value={startTime:Ie,startPosition:{x:Ce.clientX,y:Ce.clientY},currentPosition:{x:Ce.clientX,y:Ce.clientY},velocity:{x:0,y:0},touchHistory:[{time:Ie,position:{x:Ce.clientX,y:Ce.clientY}}],animation:null}},ot=H=>{const Ce=H.touches[0],Ie=Date.now();for(b.value.touchHistory.push({time:Ie,position:{x:Ce.clientX,y:Ce.clientY}});b.value.touchHistory.length>0&&Ie-b.value.touchHistory[0].time>rf;)b.value.touchHistory.shift();const Q=b.value.currentPosition.x-Ce.clientX,ie=b.value.currentPosition.y-Ce.clientY;b.value.currentPosition={x:Ce.clientX,y:Ce.clientY},he(g.value+ie,y.value+Q)},G=(H,Ce,Ie)=>{const Q=Ce-H,ie=TC*Q,Me=$C*Ie,Be=ie-Me,it=Ie+Be*(Ru/1e3);return{position:H+it*(Ru/1e3),velocity:it}},pe=(H,Ce)=>H+Ce*(Ru/1e3),ne=()=>{const H=b.value;if(!H.animation)return;const Ce=f.value.scrollHeight-c.value.clientHeight,Ie=f.value.scrollWidth-c.value.clientWidth;let Q=y.value,ie=g.value,Me=H.velocity.x,Be=H.velocity.y;if(Q<0||Q>Ie){const it=Q<0?0:Ie,Ge=G(Q,it,Me);Q=Ge.position,Me=Ge.velocity}else Q=pe(Q,Me),Me*=sf;if(ie<0||ie>Ce){const it=ie<0?0:Ce,Ge=G(ie,it,Be);ie=Ge.position,Be=Ge.velocity}else ie=pe(ie,Be),Be*=sf;he(ie,Q),H.velocity={x:Me,y:Be},Math.abs(Me)>uf||Math.abs(Be)>uf||Q<0||Q>Ie||ie<0||ie>Ce?H.animation=requestAnimationFrame(ne):H.animation=null},be=()=>{b.value.velocity=je(),b.value.animation=requestAnimationFrame(ne)},ee=({left:H,top:Ce})=>{if(H!==void 0){const Ie=f.value.scrollWidth-c.value.clientWidth;y.value=Math.max(0,Math.min(H,Ie))}if(Ce!==void 0){const Ie=f.value.scrollHeight-c.value.clientHeight;g.value=Math.max(0,Math.min(Ce,Ie))}F(),a("scroll",{left:y.value,top:g.value})};return oi(()=>{F(),ye.value=navigator.userAgent.toLowerCase().includes("windows")||navigator.userAgent.toLowerCase().includes("linux"),D.value=EC()}),Xu(()=>{b.value.animation&&cancelAnimationFrame(b.value.animation)}),Ga(()=>{document.removeEventListener("mousemove",W),document.removeEventListener("mouseup",U)}),n({scrollTo:ee,getScrollPosition:()=>({left:y.value,top:g.value}),wrapperRef:c}),(H,Ce)=>(h(),B("div",{ref_key:"wrapperRef",ref:c,class:"relative overflow-hidden",style:Xn({width:`${e(u)}px`,height:`${e(s)}px`})},[z("div",MC,[z("div",{ref_key:"contentWrapper",ref:f,class:"custom-scrollbar-content",onWheel:re,onTouchstart:Ue,onTouchmove:ot,onTouchend:be},[Yu(H.$slots,"default",{},void 0,!0)],544)]),Nt(z("div",{class:Gt([{"scrollbar-visible":e(S)},"custom-scrollbar-track vertical"]),onClick:Ce[1]||(Ce[1]=Ie=>Ae("vertical",Ie))},[z("div",{ref_key:"verticalScrollbar",ref:v,class:"custom-scrollbar-thumb vertical",style:Xn({height:`${e(A)}%`,transform:`translateY(${e(N)}px)`}),onMousedown:Ce[0]||(Ce[0]=Ie=>me("vertical",Ie))},null,36)],2),[[ya,e(I)]]),Nt(z("div",{class:Gt([{"scrollbar-visible":e(S)},"custom-scrollbar-track horizontal"]),onClick:Ce[3]||(Ce[3]=Ie=>Ae("horizontal",Ie))},[z("div",{ref_key:"horizontalScrollbar",ref:p,class:"custom-scrollbar-thumb horizontal",style:Xn({width:`${e(j)}%`,transform:`translateX(${e(Y)}px)`}),onMousedown:Ce[2]||(Ce[2]=Ie=>me("horizontal",Ie))},null,36)],2),[[ya,e(M)]])],4))}}),DC=Object.assign(Ol(OC,[["__scopeId","data-v-bb0999a4"]]),{__name:"SmartsheetGridCanvasComponentsScroller"});function LC(t){var n,o,l,a;if((t==null?void 0:t.columnObj.uidt)===ve.LongText){if((o=jn((n=t==null?void 0:t.columnObj)==null?void 0:n.meta))!=null&&o.richMode)return cu.RichText;if((a=jn((l=t.columnObj)==null?void 0:l.meta))!=null&&a[Bh])return cu.AIPrompt}return t.columnObj.uidt?cu[t.columnObj.uidt]:""}const NC={class:"flex flex-row flex-1 items-center justify-start gap-x-3"},PC={class:"flex flex-row items-center flex-1 justify-start gap-x-3"},BC=xo({__name:"AddNewRowMenu",props:{path:{default:()=>[]},onNewRecordToGridClick:{},onNewRecordToFormClick:{},removeInlineAddRecord:{type:Boolean}},setup(t){const n=t,{removeInlineAddRecord:o}=xr(n),{isAddNewRecordGridMode:l}=tl();return(a,i)=>{const r=Sl,s=Ya,u=qa,c=Yl("e");return h(),J(u,{variant:"small"},{default:K(()=>[Nt((h(),J(s,{class:"nc-new-record-with-grid group",disabled:e(o),onClick:i[0]||(i[0]=f=>a.onNewRecordToGridClick(a.path??[]))},{default:K(()=>{var f;return[z("div",NC,[(h(),J($o((f=("viewIcons"in a?a.viewIcons:e(Ci))[e(Ul).GRID])==null?void 0:f.icon),{class:"nc-view-icon text-inherit"})),Je(" "+ce(a.$t("activity.newRecord"))+" - "+ce(a.$t("objects.viewType.grid")),1)]),e(l)?(h(),J(r,{key:0,icon:"check",class:"w-4 h-4 text-primary"})):ge("",!0)]}),_:1},8,["disabled"])),[[c,["c:row:add:grid"]]]),Nt((h(),J(s,{class:"nc-new-record-with-form group",onClick:i[1]||(i[1]=f=>a.onNewRecordToFormClick(a.path??[]))},{default:K(()=>{var f;return[z("div",PC,[(h(),J($o((f=("viewIcons"in a?a.viewIcons:e(Ci))[e(Ul).FORM])==null?void 0:f.icon),{class:"nc-view-icon text-inherit"})),Je(" "+ce(a.$t("activity.newRecord"))+" - "+ce(a.$t("objects.viewType.form")),1)]),e(l)?ge("",!0):(h(),J(r,{key:0,icon:"check",class:"w-4 h-4 text-primary"}))]}),_:1})),[[c,["c:row:add:form"]]])]),_:1})}}}),df=Object.assign(Ol(BC,[["__scopeId","data-v-2b50c72e"]]),{__name:"SmartsheetGridCanvasComponentsAddNewRowMenu"}),WC=xo({__name:"GroupHeaderMenu",props:{group:{}},emits:["toggleExpand","toggleExpandAll"],setup(t,{emit:n}){const o=t,l=n,{group:a}=xr(o),i=u=>{l("toggleExpand",u)},r=()=>{const u=ma(a.value);l("toggleExpandAll",u,!0)},s=()=>{const u=ma(a.value);l("toggleExpandAll",u,!1)};return(u,c)=>{const f=Sl,v=Ya,p=qa;return h(),J(p,{variant:"small"},{default:K(()=>{var g;return[(g=e(a))!=null&&g.isExpanded?(h(),J(v,{key:0,onClick:c[0]||(c[0]=y=>i(e(a)))},{default:K(()=>[le(f,{icon:"minimize"}),c[2]||(c[2]=Je(" Collapse group "))]),_:1,__:[2]})):(h(),J(v,{key:1,onClick:c[1]||(c[1]=y=>i(e(a)))},{default:K(()=>[le(f,{icon:"maximize"}),c[3]||(c[3]=Je(" Expand group "))]),_:1,__:[3]})),le(v,{onClick:r},{default:K(()=>[le(f,{icon:"maximizeAll"}),c[4]||(c[4]=Je(" Expand all "))]),_:1,__:[4]}),le(v,{onClick:s},{default:K(()=>[le(f,{icon:"minimizeAll"}),c[5]||(c[5]=Je(" Collapse all "))]),_:1,__:[5]})]}),_:1})}}}),zC=Object.assign(WC,{__name:"SmartsheetGridCanvasComponentsGroupHeaderMenu"}),VC={key:0,class:"absolute h-full flex items-center justify-center z-70 w-full inset-0 bg-white/30"},jC=["height","width"],UC={class:"absolute pointer-events-none inset-0"},GC={key:4,class:"nc-edit-or-add-provider-wrapper"},HC={class:"flex shadow-nc-sm rounded-lg"},YC={class:"flex items-center gap-2"},qC={"data-testid":"nc-pagination-add-record",class:"flex items-center gap-2"},XC=5,cf=96,KC=128,JC=xo({__name:"index",props:{totalRows:{},actualTotalRows:{},data:{},groupDataCache:{},rowHeightEnum:{},loadData:{type:Function},callAddEmptyRow:{type:Function},deleteRow:{type:Function},updateOrSaveRow:{type:Function},deleteSelectedRows:{type:Function},clearInvalidRows:{type:Function},deleteRangeOfRows:{type:Function},updateRecordOrder:{type:Function},bulkUpdateRows:{type:Function},bulkDeleteAll:{type:Function},bulkUpsertRows:{type:Function},expandForm:{type:Function},removeRowIfNew:{type:Function},rowSortRequiredRows:{},applySorting:{type:Function},clearCache:{type:Function},syncCount:{type:Function},selectedRows:{},chunkStates:{},isBulkOperationInProgress:{type:Boolean},selectedAllRecords:{type:Boolean},getRows:{type:Function},getDataCache:{type:Function},cachedGroups:{},totalGroups:{},groupByColumns:{},toggleExpand:{type:Function},toggleExpandAll:{type:Function},groupSyncCount:{type:Function},fetchMissingGroupChunks:{type:Function},clearGroupCache:{type:Function}},emits:["bulkUpdateDlg","update:selectedAllRecords"],setup(t,{expose:n,emit:o}){const l=t,a=o;wo(Gh,!0);const{loadData:i,callAddEmptyRow:r,updateOrSaveRow:s,deleteRow:u,expandForm:c,clearCache:f,syncCount:v,bulkUpdateRows:p,bulkUpsertRows:g,deleteRangeOfRows:y,clearInvalidRows:x,updateRecordOrder:w,applySorting:m,bulkDeleteAll:C,removeRowIfNew:b,getRows:S,getDataCache:k,toggleExpand:D,groupSyncCount:F,fetchMissingGroupChunks:I,clearGroupCache:M,toggleExpandAll:A}=l,j=Ra(l,"selectedAllRecords",a),{eventBus:N,isSqlView:Y}=Fl(),{withLoading:ae}=vs(),{showRecordPlanLimitExceededModal:he,navigateToPricing:ye}=ql(),re=Nn(l,"totalRows"),me=Nn(l,"actualTotalRows"),W=Nn(l,"totalGroups"),U=Nn(l,"chunkStates"),Ae=Nn(l,"data"),je=Nn(l,"cachedGroups"),Ue=Nn(l,"rowHeightEnum"),ot=Nn(l,"selectedRows"),G=Nn(l,"rowSortRequiredRows"),pe=Nn(l,"groupByColumns"),ne=Nn(l,"groupDataCache"),be=V(),ee=V(0),H=V(0),Ce=V(),Ie=V(null),Q=V(null),ie=V(null),Me=V(null),Be=V(null),it=V(!1),Ge=V(null),ze=V(!1),Z=V(!1),Et=V(),_e=V(null),yn=V(null),It=V(null),$t=V(!1),et=Si({x:0,y:0}),cn=Si(Wh),Pn=new Set([ve.LongText,ve.DateTime,ve.SingleSelect,ve.MultiSelect,ve.Formula]),Kt=V();wo(Hh,cn),wo(Yh,yn);const nn=jo();wo(Rf,nn);const wt=V(),Dn=jo(),un=jo();wo(Hu,Dn),wo(If,un),wo(Ff,wt);const{isExpandedFormCommentMode:Bn}=Uo(Ir()),tt=V(!1),mt=dn(Ea,jo()),Dt=dn(Js,void 0),Rt=dn(Qu,jo()),ct=dn(zl,V(!1)),nt=dn(Yi,V(!1)),{height:rt,width:st}=zh(be),{height:lt,width:xt}=qu(),{aggregations:Ot,loadViewAggregate:yt}=nu(),{isDataReadOnly:Qe,isUIAllowed:d,isMetaReadOnly:_}=wl(),{isMobileMode:O,isAddNewRecordGridMode:T,setAddNewRecordGridMode:se,appInfo:q}=tl(),L=fs(),{$e:te}=ua(),{t:we}=la(),oe=ul(),{targetReference:Ee,placement:Ne}=Uo(oe),He=V(),{floatingStyles:Ze}=dk(Ee,He,{placement:Ne,middleware:[ak(8),rk(),ik({padding:5})]}),{tryShowTooltip:Ke,hideTooltip:ft}=oe;let Ye={index:null,isSelectionStarted:!1,path:[]};const{isGroupBy:qe,rowSlice:ht,colSlice:zt,editEnabled:Le,activeCell:Se,totalWidth:Mt,columnWidths:xe,rowHeight:Pe,updateVisibleRows:gt,columns:X,findColumnIndex:Fe,canvasRef:vt,triggerRefreshCanvas:Re,resizeableColumn:bt,resizeMouseMove:_t,isDragging:Xe,startDrag:tn,startResize:Yt,hoverRow:en,selection:pt,makeCellEditable:hn,findClickedColumn:on,findColumnPosition:so,elementMap:Cn,onMouseMoveSelectionHandler:gn,onMouseDownSelectionHandler:xn,onMouseUpSelectionHandler:Vt,onMouseDownFillHandlerStart:ln,onMouseMoveFillHandlerMove:an,onMouseUpFillHandlerEnd:Fn,isFillHandlerActive:Yn,onMouseDownRowReorderStart:ao,isRowReOrderEnabled:eo,isRowReorderActive:Ro,isOrderColumnExists:Mo,isInsertBelowDisabled:Ve,isPrimaryKeyAvailable:Eo,meta:qn,view:to,isAddingColumnAllowed:no,isAddingEmptyRowAllowed:Qo,isAddingEmptyRowPermitted:dl,isSelectedOnlyScript:ri,isSelectedOnlyAI:Ma,isSelectionReadOnly:kn,copyValue:Ta,clearCell:Ka,clearSelectedRangeOfCells:Oi,handleCellClick:ll,handleCellHover:ca,actionManager:$a,imageLoader:Ja,readOnly:Xl,baseRoleLoader:Oa,colResizeHoveredColIds:Qa,totalColumnsWidth:ut,isFieldEditAllowed:Kl,isContextMenuAllowed:No,isDataEditAllowed:So,removeInlineAddRecord:Po,upgradeModalInlineState:bo,isRowDraggingEnabled:Dl,rowMetaColumnWidth:Xo,rowColouringBorderWidth:Da}=CC({rowHeightEnum:Ue,cachedRows:Ae,mousePosition:et,clearCache:f,chunkStates:U,totalRows:re,actualTotalRows:me,loadData:i,scrollLeft:H,width:st,height:rt,scrollToCell:Jl,scrollTop:ee,aggregations:Ot,vSelectedAllRecords:j,selectedRows:ot,updateRecordOrder:w,expandRows:At,updateOrSaveRow:s,expandForm:c,bulkUpdateRows:p,bulkUpsertRows:g,addEmptyRow:Ln,onActiveCellChanged:ho,addNewColumn:Vn,setCursor:yl,getRows:S,cachedGroups:je,toggleExpand:D,totalGroups:W,groupSyncCount:F,groupByColumns:pe,fetchMissingGroupChunks:I,getDataCache:k}),rn=V("auto");function yl(fe,ke){var Oe;ke&&!ke(rn.value)||(Ro.value&&(fe="grabbing"),rn.value!==fe&&(rn.value=fe,vt.value&&((Oe=vt.value.style)==null?void 0:Oe.cursor)!==fe&&(vt.value.style.cursor=fe)))}const An=ue({get(){return it.value},set(fe){var ke;!fe&&Z.value&&((ke=Et.value)!=null&&ke.shouldKeepModalOpen())||(it.value=fe)}}),We=ue({get(){return Z.value},set(fe){var ke;!fe&&((ke=Et.value)!=null&&ke.shouldKeepModalOpen())||(Z.value=fe)}}),jt=ue(()=>{var fe;return Pn.has((fe=Le.value)==null?void 0:fe.column.uidt)}),St=ue(()=>{var fe;return(fe=Kt.value)==null?void 0:fe.wrapperRef}),kt=ue(()=>X.value.filter(fe=>fe.fixed).reduce((fe,ke)=>fe+pn(ke.width),0)),sn=ue(()=>{var dt,Ct;if(!Le.value||!St.value)return{verticalStuck:!1,horizontalStuck:!1,isStuck:!1};if(((dt=Le.value.column)==null?void 0:dt.uidt)===ve.LongText||((Ct=Le.value.column)==null?void 0:Ct.uidt)===ve.Formula)return{verticalStuck:!0,horizontalStuck:!0,isStuck:!0};const fe=Le.value.y-ee.value-Pe.value+1,Oe=Math.max(32,Math.min(St.value.clientHeight-Pe.value-36,fe))!==fe;let Ft=!1;if(!Le.value.fixed){const Xt=Le.value.x-H.value;Ft=Math.max(kt.value,Math.min(St.value.clientWidth-Le.value.width,Xt))!==Xt}return{verticalStuck:Oe,horizontalStuck:Ft,isStuck:Oe||Ft}}),bn=ue(()=>{var Oe,Ft,dt;if(!Le.value)return{top:0,left:0};const fe=Math.max(Fo-1,Math.min(((Oe=St.value)==null?void 0:Oe.clientHeight)-Pe.value-On,Le.value.y-ee.value-Pe.value)),ke=Le.value.fixed?Le.value.x:Math.max(kt.value,Math.min(((Ft=St.value)==null?void 0:Ft.clientWidth)-Le.value.width,Le.value.x-H.value));return{top:`${fe+(sn.value.horizontalStuck&&!qe.value?1:0)}px`,left:`${ke+(sn.value.isStuck&&((dt=Le.value)!=null&&dt.fixed)?-1:0)}px`}}),Rn=ue(()=>{const fe=Po.value?412:256;if(!qe.value)return k().totalRows.value*Pe.value+32+fe;const ke=W.value*(To+li);function Oe(Ft){let dt=0;for(const[,Ct]of Ft)Ct!=null&&Ct.isExpanded&&(Ct.path?(dt+=Ct.count*Pe.value,Qo.value&&!Po.value&&(dt+=Fo),dt+=1):Ct!=null&&Ct.groups&&(dt+=((Ct==null?void 0:Ct.groupCount)??0)*(To+li),dt+=Oe(Ct.groups)));return dt}return ke+Oe(je.value)+32+fe}),Tt=ue({get:()=>ot.value.length&&Qe.value||An.value||Ge.value===null&&!ot.value.length&&!j.value?!1:ze.value,set:fe=>{ze.value=fe}});function _n(){if(!ot.value.length&&!j.value)return;k().cachedRows.value.forEach(ke=>{ke.rowMeta.selected&&(ke.rowMeta.selected=!1)}),j.value=!1}Gn(j,fe=>{k().cachedRows.value.forEach(Oe=>{Oe.rowMeta.selected=!!fe})});const Zn=()=>{var Oe,Ft;if(!((Oe=St.value)!=null&&Oe.clientWidth)||!((Ft=St.value)!=null&&Ft.clientHeight)){setTimeout(Zn,50);return}const fe=Math.max(0,Fe(H.value)),ke=Math.min(xe.value.length,Fe(H.value+St.value.clientWidth+XC)+1);if((fe!==zt.value.start||ke!==zt.value.end)&&(zt.value={start:fe,end:ke}),!qe.value){const dt=k(),Ct=Math.max(0,Math.floor(ee.value/Pe.value)),Xt=Math.ceil(St.value.clientHeight/Pe.value),Jt=Math.min(Ct+Xt,dt.totalRows.value),Bt=Math.min(dt.totalRows.value,Jt);(Ct!==ht.value.start||Bt!==ht.value.end)&&(ht.value={start:Ct,end:Bt}),gt()}};function Ko(){Se.value.row=-1,Se.value.column=-1,pt.value.clear(),Le.value=null}async function Un({row:fe,level:ke}){var Jt,Bt;const Oe=(Bt=(Jt=fe.rowMeta)==null?void 0:Jt.path)==null?void 0:Bt.slice(0,ke),Ft=Oe!=null&&Oe.length?_a(je.value,Oe):void 0,dt=(Ft==null?void 0:Ft.groups)??je.value,Ct=Math.max(...dt.keys());setTimeout(()=>{Ko()},150),await I(0,Ct,Ft??void 0,!0);const Xt=(Lt,fn,Wn=[])=>{for(let zn=0;zn<fn;zn++){const En=Lt.get(zn);En!=null&&En.groupCount?Xt(En.groups,En.groupCount,En.path??[...Wn,zn]):f(Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,[...Wn,zn])}};Xt(dt,(Ft==null?void 0:Ft.groupCount)??W.value,Ft?ma(Ft):[]),await F(Ft),setTimeout(()=>{var Lt;(Lt=Kt.value)==null||Lt.scrollTo({top:Math.max(0,Math.min(Rn.value,ee.value))})},150)}function ho(){if(qe.value){let fe=function(ke){for(const[,Oe]of ke)if(Oe!=null&&Oe.isExpanded)if(Oe!=null&&Oe.path){const{isRowSortRequiredRows:Ft}=k(Oe.path);x==null||x(Oe.path,{onGroupRowChange:Un}),Ft.value.length&&(m==null||m(Ft.value,Oe.path))}else Oe.groups&&fe(Oe.groups)};fe(je.value)}else x==null||x([]),G.value.length&&(m==null||m(G.value,[]));Zn(),requestAnimationFrame(Re)}const Vl=(fe=[])=>{if(he())return;se(!0);let ke={};if(qe.value){const Oe=_a(je.value,fe);ke=es(Oe)}Ln(void 0,void 0,void 0,ke,fe),ie.value=null,An.value=!1};function Ao(fe=[]){if(he())return;se(!1);let ke={};if(qe.value){const Oe=_a(je.value,fe);ke=es(Oe)}Rt.trigger({overwrite:ke,path:fe}),ie.value=null,An.value=!1}const bl=fe=>{var ke;if(fe)An.value=!0;else if(We.value){const Oe=(ke=Et.value)==null?void 0:ke.shouldKeepModalOpen();An.value=Oe,We.value=Oe,Oe||(_e.value=null,It.value=null)}};function al(fe=!1,ke){We.value=!1,An.value=!1,_e.value=null,ke!=null&&ke.id?setTimeout(()=>{var dt;let Oe=0,Ft=!1;for(const Ct of X.value){if(Ct.id===(ke==null?void 0:ke.id)){Ft=!0;break}Ct!=null&&Ct.fixed||(Oe+=pn(Ct.width))}Ft&&((dt=Kt.value)==null||dt.scrollTo({left:Oe,top:0}))},200):fe&&setTimeout(()=>{var Oe;(Oe=Kt.value)==null||Oe.scrollTo({left:Mt.value})},200)}function io(fe,ke){var zn,En,In,R,$,de;const Oe=ot.value.length>=Wu,Ft=!fe.rowMeta.selected&&Oe||j.value||Xl.value,dt=((zn=fe.rowMeta)==null?void 0:zn.selected)||j.value,Ct=ke?ma(ke):[],Xt=((En=en.value)==null?void 0:En.rowIndex)===fe.rowMeta.rowIndex&&(((In=en.value)==null?void 0:In.path)??[]).join()===Ct.join(),Jt=Se.value.row===fe.rowMeta.rowIndex&&((R=Se.value.path)==null?void 0:R.join())===Ct.join(),Bt=[];let Lt=4;pe.value&&(Lt+=(($=pe.value)==null?void 0:$.length)*13);const fn=Lt,Wn=Da.value?Da.value+8:0;if(Xl.value||!(Xt||dt||Jt)?(Bt.push({x:Lt,width:Xo.value/2-8,action:"none"}),Lt+=Xo.value/2-8+16):(Xt||dt||Jt)&&Dl.value?(Bt.push({x:Lt,width:26,action:ot.value.length?"none":"reorder"}),Lt+=26):Lt+=6,!Xl.value&&(dt||Xt||Jt)&&!ct.value&&(Bt.push({x:Lt,width:20,action:Ft?"none":"select"}),Lt+=24),(de=fe.rowMeta)!=null&&de.commentCount){const De=fe.rowMeta.commentCount>99,Wt=De?"99+":fe.rowMeta.commentCount.toString(),qt=$l,{width:vn}=Qn(qt,{x:fn+Xo.value/2-4-Wn,y:0,render:!1,text:Wt,maxWidth:Xo.value/2-Wn,fontFamily:`600 ${De?"10px":"12px"} Inter`,textAlign:"center",isTagLabel:!0,fillStyle:"#3366FF"});Bt.push({x:fn+Xo.value-4-Math.max(20,vn+8)-Wn,width:Math.max(20,vn+8),action:"comment"})}else Bt.push({x:fn+Xo.value-4-20-Wn,width:20,action:"comment"});return{isAtMaxSelection:Oe,isCheckboxDisabled:Ft,regions:Bt,currentX:Lt}}const Al=({e:fe,row:ke,x:Oe,onlyDrag:Ft,group:dt})=>{var Lt,fn,Wn,zn;const{isAtMaxSelection:Ct,isCheckboxDisabled:Xt,regions:Jt}=io(ke,dt),Bt=Jt.find(En=>Oe>=En.x&&Oe<En.x+En.width);if(Bt&&!(Ft&&Bt.action!=="reorder"&&Bt.action!=="select")){switch(Bt.action){case"select":if(!Xt&&((Lt=ke.rowMeta)!=null&&Lt.selected||!Ct)&&(nl(),Ft)){ke.rowMeta.selected=!((fn=ke.rowMeta)!=null&&fn.selected);const En=ma(dt);(Wn=ke.rowMeta)!=null&&Wn.selected&&pc(ke.rowMeta.rowIndex)&&(Ye={index:ke.rowMeta.rowIndex,path:En,isSelectionStarted:!1});const In=k(En);In==null||In.cachedRows.value.set(ke==null?void 0:ke.rowMeta.rowIndex,ke)}break;case"reorder":fe.detail===1&&eo.value&&ao(fe);break;case"comment":Bn.value=!!((zn=ke.rowMeta)!=null&&zn.commentCount),c(ke,void 0,!1,dt==null?void 0:dt.path);break}requestAnimationFrame(Re)}},fa=()=>{const fe=V(!0),{close:ke}=rs(Sm,{modelValue:fe,"onUpdate:modelValue":Oe});function Oe(){fe.value=!1,ke(1e3)}},La=({row:fe,x:ke,group:Oe})=>{const{regions:Ft}=io(fe,Oe),dt=Ft.find(Ct=>ke>=Ct.x&&ke<Ct.x+Ct.width);if(dt)switch(dt.action){case"select":return"pointer";case"reorder":if(eo.value)return Ro.value?"grabbing":"grab";break;case"comment":return"pointer"}};let Zo=null,oo={},Ll=null;async function si(fe){var zn,En,In,R;const ke=new Jv(Cn.elements);Ll=$=>ui($,ke),document.addEventListener("mouseup",Ll),oo={isCreateOrEditColumnDropdownOpen:We.value,openColumnDropdownField:Be.value,editEnabled:Le.value,openAggregationFieldId:(zn=Q.value)==null?void 0:zn.id,openAddNewRowDropdown:ie.value,openGroupContextMenuDropdown:Me.value,isDropdownVisible:An.value,editColumn:_e.value,columnOrder:It.value},Le.value=null,Q.value=null,ie.value=null,Me.value=null,Be.value=null,An.value=!1,_e.value=null,It.value=null,We.value=!1,We.value||(Ie.value=null),Ge.value=null,Zo=null;const Oe=(En=vt.value)==null?void 0:En.getBoundingClientRect();if(!Oe)return;const Ft=fe.clientY-Oe.top,dt=fe.clientX-Oe.left,Ct=Pc(fe);if(!Ct)return;if(Ft<=Fo){if(dt>Xo.value)Yt(fe),await el(()=>{bt.value||(tn(fe.clientX-Oe.left),requestAnimationFrame(Re))});else{No.value&&j.value&&(Ge.value={row:0,col:-1,path:[]},requestAnimationFrame(Re));return}return}if(Ft>rt.value-36)return;const Xt=ke.findElementAt(et.x,et.y,[Lo.ADD_NEW_ROW,Lo.ROW,Lo.GROUP]),Jt=Xt==null?void 0:Xt.group,Bt=Xt==null?void 0:Xt.row,Lt=Xt==null?void 0:Xt.rowIndex,fn=Jt?ma(Jt):[];if(!Bt)return;if(dt<Xo.value+pe.value.length*13){if(Ct!==fl.SINGLE_CLICK)return;Al({e:fe,row:Bt,x:dt,onlyDrag:!0,group:Jt});return}if(ln(fe),Yn.value)return;const{column:Wn}=on(dt,H.value);if(Wn!=null&&Wn.columnObj||(pt.value.clear(),Se.value={row:-1,column:-1,path:[]},Le.value=null),(Lt!==((In=Se.value)==null?void 0:In.row)||!El(fn.map($=>`${$}`),(R=Se.value)==null?void 0:R.path))&&(ho(),_n()),Ct===fl.RIGHT_CLICK&&(Wn!=null&&Wn.id)){pt.value.isEmpty()&&(Se.value.row=Lt,Se.value.column=X.value.findIndex(De=>De.id===Wn.id),Se.value.path=fn);const $=X.value.findIndex(De=>De.id===Wn.id);pt.value.isCellInRange({row:Lt,col:$})||(pt.value.clear(),pt.value.startRange({row:Lt,col:$}),pt.value.endRange({row:Lt,col:$})),No.value&&(Ge.value={row:Lt,col:$,path:fn},requestAnimationFrame(Re));return}Ct!==fl.DOUBLE_CLICK&&(Zo=Se.value,xn(fe)),requestAnimationFrame(Re)}function Jl(fe,ke,Oe,Ft=!0){var De,Wt,qt,vn,wn,Mn,fo;const dt=fe??Se.value.row??-1,Ct=ke??Se.value.column??-1,Xt=Oe??Se.value.path??[];let Jt=0,Bt=0;qe.value&&je.value?(Jt=hr(je.value,Xt,dt,Pe.value,Qo.value),Bt=Jt+Pe.value+cf):(Jt=dt*Pe.value,Bt=Jt+Pe.value+cf);const Lt=((De=Kt.value)==null?void 0:De.getScrollPosition().top)??0,fn=rt.value;if(Jt<Lt?(Wt=Kt.value)==null||Wt.scrollTo({top:Jt}):Bt>Lt+fn&&((qt=Kt.value)==null||qt.scrollTo({top:Bt-fn})),!Ft)return;const Wn=X.value.filter(at=>at.fixed).reduce((at,Ut)=>at+pn(Ut.width),0)+KC;let zn=0;for(let at=0;at<Ct;at++){const Ut=X.value[at];Ut&&(Ut.fixed||(zn+=pn(Ut.width)))}const En=(vn=X.value[Ct])==null?void 0:vn.width,In=pn(En);let R=zn+In;zn+=Wn,R+=Wn;const $=((wn=Kt.value)==null?void 0:wn.getScrollPosition().left)??0,de=st.value;zn<$+Wn?(Mn=Kt.value)==null||Mn.scrollTo({left:zn-Wn}):R>$+de&&((fo=Kt.value)==null||fo.scrollTo({left:R-de}))}async function ui(fe,ke){var Wt,qt,vn,wn,Mn,fo,at,Ut,lo;fe.preventDefault(),Ll&&(document.removeEventListener("mouseup",Ll),Ll=null,Ye={index:null,path:[],isSelectionStarted:!1}),await Fn();const Oe=(Wt=vt.value)==null?void 0:Wt.getBoundingClientRect();if(!Oe)return;const Ft=fe.clientY-Oe.top,dt=fe.clientX-Oe.left;if(Le.value)return;if(Vt(fe)&&!(Ft<=Fo||Ft>rt.value-36||dt<=Xo.value)){requestAnimationFrame(Re);return}if(Ro.value)return;const Ct=Pc(fe);if(!Ct)return;if(O.value){if(Ft>32&&Ft<rt.value-36){const mn=ke.findElementAt(dt,Ft,[Lo.ROW,Lo.GROUP,Lo.ADD_NEW_ROW]),go=mn==null?void 0:mn.group,Tn=mn==null?void 0:mn.row,Io=((qt=Tn==null?void 0:Tn.rowMeta)==null?void 0:qt.rowIndex)??-1;if(mn!=null&&mn.isGroup)D(go);else if(mn!=null&&mn.isRow&&Tn){if(Po.value&&Io>=ol)return;c(Tn,void 0,!1,go==null?void 0:go.path)}requestAnimationFrame(Re);return}else if(Ft<32)return}if(Ft<=Fo)if(dt<Xo.value+pe.value.length*13){if(Ct!==fl.SINGLE_CLICK||Xl.value||qe.value)return;Pt({x:Dl.value?30:10,y:8,height:16,width:16},et)&&(j.value=!j.value,nl()),requestAnimationFrame(Re);return}else{const mn=ut.value-H.value+pe.value.length*13,go=lr;if(dt>=mn&&dt<=mn+go){if(!no.value||oo.isCreateOrEditColumnDropdownOpen&&!oo.editColumn)return;We.value=!0,Ie.value={top:`${Oe.top}px`,left:`${mn+Oe.left}px`,width:`${go}px`,height:"32px",position:"fixed"},An.value=!0,requestAnimationFrame(Re);return}const{column:Tn,xOffset:Io}=on(dt,H.value),ea=!d("fieldEdit");if(Tn)if(Ct===fl.RIGHT_CLICK){if(ea)return;Be.value=Tn.columnObj,yn.value=Tn.columnObj,An.value=!0,Ie.value={top:`${Oe.top}px`,left:`${Oe.left+Io}px`,width:`${Tn.width}`,height:"32px",position:"fixed"},requestAnimationFrame(Re);return}else{const zo=pn(Tn.width);let Pa=Io+zo-8;Pa-=16,((vn=pe.value)==null?void 0:vn.length)===1&&Tn.fixed&&(Pa+=13);const Di=Pa;if(Di<=dt&&Di+14>=dt){if(ea||oo.isDropdownVisible&&oo.openColumnDropdownField===Tn.columnObj)return;Ie.value={top:`${Oe.top}px`,left:`${Oe.left+Io}px`,width:`${Tn.width}`,height:"32px",position:"fixed"},Be.value=Tn.columnObj,yn.value=Tn.columnObj,An.value=!0,requestAnimationFrame(Re);return}else if(Ct===fl.DOUBLE_CLICK){if(rn.value==="col-resize")return;Wo(fe,!1,Tn.columnObj,Io),pt.value.startRange({row:NaN,col:NaN}),pt.value.endRange({row:NaN,col:NaN}),Se.value={row:-1,column:-1,path:((wn=Se.value)==null?void 0:wn.path)??[]},requestAnimationFrame(Re);return}else if(!qe.value&&dt<Io+zo-20-((Mn=Tn.columnObj)!=null&&Mn.description?24:0)){const Za=X.value.findIndex(Ni=>Ni.id===Tn.id),Li=k(),Ki=Math.min(Li.totalRows.value-1,99);pt.value.startRange({row:0,col:Za}),pt.value.endRange({row:Ki,col:Za}),_n(),Se.value={row:0,column:Za,path:[]},ho(),requestAnimationFrame(Re)}}requestAnimationFrame(Re);return}if(Ft>rt.value-36){if(nt.value&&d("fieldAdd")){fa();return}const{column:mn,xOffset:go}=on(dt,H.value);if(mn&&mn.id!=="row_number"){if(oo.isDropdownVisible&&oo.openAggregationFieldId&&oo.openAggregationFieldId===mn.id)return;Q.value=mn,An.value=!0,Ie.value={top:`${Oe.top+rt.value-36}px`,left:`${Oe.left+go}px`,width:mn.width,height:"36px",position:"fixed"}}requestAnimationFrame(Re);return}const Xt=ke.findElementAt(dt,Ft,[Lo.ADD_NEW_ROW,Lo.ROW,Lo.GROUP]);let Jt=Xt==null?void 0:Xt.group;const Bt=Xt==null?void 0:Xt.row,Lt=((fo=Bt==null?void 0:Bt.rowMeta)==null?void 0:fo.rowIndex)??-1,fn=Jt?ma(Jt):[],Wn=(Xt==null?void 0:Xt.type)===Lo.ADD_NEW_ROW;!Jt&&(Xt!=null&&Xt.groupPath)&&(Jt=je.value.get(fn[0]));const zn=k(fn);if(Xt!=null&&Xt.isGroup){if(Ct===fl.SINGLE_CLICK){const{column:mn,xOffset:go}=on(dt,H.value);if(mn&&(mn!=null&&mn.fixed)||!q.value.ee){const Tn=pn(mn.width),Io=dt-Tn,ea=Ft>Xt.y+8&&Ft<Xt.y+Xt.height-8;if(Io>65&&Io<Tn+65&&ea&&q.value.isOnPrem){if(oo.isDropdownVisible&&oo.openGroupContextMenuDropdown&&((at=oo.openGroupContextMenuDropdown.path)==null?void 0:at.join(","))===((Ut=Jt==null?void 0:Jt.path)==null?void 0:Ut.join(","))){requestAnimationFrame(Re);return}Me.value=Jt,An.value=!0,Ie.value={top:`${Oe.top+Ft-36}px`,left:`${Oe.left+go}px`,width:"300px",height:"36px",position:"fixed"},requestAnimationFrame(Re);return}D(Jt)}else if(mn){if(oo.isDropdownVisible&&oo.openAggregationFieldId&&oo.openAggregationFieldId===mn.id)return;Q.value=mn,An.value=!0,Ie.value={top:`${Oe.top+Ft-36}px`,left:`${Oe.left+go}px`,width:mn.width,height:"36px",position:"fixed"}}}requestAnimationFrame(Re);return}if(Po.value){if(Lt>=ol)return;if(bo.value.isHoveredLearnMore){window.open("https://nocodb.com/pricing","_blank","noopener,noreferrer");return}if(bo.value.isHoveredUpgrade)return ye({limitOrFeature:Hs.LIMIT_EXTERNAL_SOURCE_PER_WORKSPACE})}if(Wn&&Ct===fl.SINGLE_CLICK&&dt<ut.value-H.value){if(Qo.value)if(qe.value){const mn=ke.findElementAtWithX(dt,Ft,Lo.EDIT_NEW_ROW_METHOD);if(mn){if(El(oo.openAddNewRowDropdown,fn)){An.value=!0,ie.value=[],requestAnimationFrame(Re);return}ie.value=fn,An.value=!0,Ie.value={top:`${Oe.top+mn.y-120}px`,left:`${Oe.left+dt+140}px`,width:mn.width,height:"36px",position:"fixed"},requestAnimationFrame(Re);return}const go=es(Jt);T.value||!qe.value?Ln(void 0,void 0,void 0,go,fn):Oo({overwrite:go,path:fn})}else{if(Po.value)return;await Ln()}pt.value.clear(),Se.value.row=Lt,Se.value.column=1,Se.value.path=fn,requestAnimationFrame(Re);return}else if(Lt>zn.totalRows.value&&!qe.value){pt.value.clear(),Se.value={row:-1,column:-1,path:[]},ho(),requestAnimationFrame(Re);return}if(dt<Xo.value+pe.value.length*13){if(!Bt||![fl.SINGLE_CLICK,fl.RIGHT_CLICK].includes(Ct))return;switch(Ct){case fl.SINGLE_CLICK:Al({e:fe,row:Bt,x:dt,group:Xt==null?void 0:Xt.group});break;case fl.RIGHT_CLICK:No.value&&(Ge.value={row:Lt,col:-1,path:fn},requestAnimationFrame(Re));break}return}const En={...Se.value};(Lt<ht.value.start||Lt>=ht.value.end)&&(Se.value.row=-1,Se.value.column=-1,Se.value.path=[],requestAnimationFrame(Re));const{column:In}=on(dt,H.value);if(!In){Se.value.row=-1,Se.value.column=-1,Se.value.path=[],pt.value.clear(),requestAnimationFrame(Re);return}if(!Bt){En.row!==-1&&En.column!==-1&&Lt===-1&&ho();return}const R=Ht(Bt==null?void 0:Bt.row,(lo=qn.value)==null?void 0:lo.columns),$=X.value.findIndex(mn=>mn.id===In.id);if(Ct===fl.RIGHT_CLICK){Se.value.row=Lt,Se.value.column=$,Se.value.path=fn,requestAnimationFrame(Re);return}const de=await ll({event:fe,row:Bt,column:In,value:Bt==null?void 0:Bt.row[In.title],mousePosition:{x:dt,y:Ft},pk:R,selected:(Zo==null?void 0:Zo.row)===Lt&&(Zo==null?void 0:Zo.column)===$&&El(Zo==null?void 0:Zo.path,fn),imageLoader:Ja,path:fn,baseRoleLoader:Oa});if(Se.value.row=Lt,Se.value.column=$,Se.value.path=fn,de){pt.value.startRange({row:Lt,col:$}),pt.value.endRange({row:Lt,col:$}),requestAnimationFrame(Re);return}In!=null&&In.fixed||Jl(),requestAnimationFrame(Re);const De=In.columnObj.uidt;if(Ct===fl.DOUBLE_CLICK){if(Pv.includes(De)||![ve.Barcode,ve.QrCode,ve.Lookup].includes(De)&&(In!=null&&In.virtual))return;hn(Bt,In)}}const di=(fe,ke,Oe,Ft)=>{const dt=[];let Ct=Oe+1;const Xt=$l;return Xt.save(),Xt.font="550 12px Inter",X.value.slice(fe,ke).forEach(Jt=>{var $,de,De,Wt,qt,vn,wn,Mn,fo,at,Ut;const Bt=pn(Jt.width),Lt=Jt.id==="row_number";if(Lt&&qe.value){Ct+=Bt;return}const fn=8;let Wn=fn+16;Jt.uidt&&(Wn+=26,dt.push({x:Ct+8-Ft,width:13,type:"columnIcon",text:LC(Jt)})),($=Jt.isInvalidColumn)!=null&&$.isInvalid&&!((de=Jt.isInvalidColumn)!=null&&de.ignoreTooltip)&&(Wn+=18),(Wt=(De=Jt==null?void 0:Jt.columnObj)==null?void 0:De.description)!=null&&Wt.length&&(Wn+=18);const zn=Bt-Wn,En=Xt.measureText(Jt.title).width,In=En>zn;dt.push({x:Ct+(Jt.uidt?26:Dl.value?30:10)-Ft,width:Math.max(Jt.uidt?0:16,In?zn:En),type:"title",text:Jt.title,disableTooltip:!In});let R=Ct+Bt-fn-(Kl.value?16:0);if(Lt){Ct+=Bt;return}Kl.value&&!((qt=Jt.columnObj)!=null&&qt.readonly)?dt.push({x:R-Ft,width:14,type:"columnChevron",disableTooltip:!0,text:null}):(vn=qn.value)!=null&&vn.synced&&((wn=Jt.columnObj)!=null&&wn.readonly)&&dt.push({x:R-Ft,width:14,type:"synced",disableTooltip:!1,text:"This field is synced"}),(Mn=Jt.isInvalidColumn)!=null&&Mn.isInvalid&&!((fo=Jt.isInvalidColumn)!=null&&fo.ignoreTooltip)&&(R-=18,dt.push({x:R-Ft,width:14,type:"error",text:Jt.isInvalidColumn.tooltip||"Invalid Column"})),(Ut=(at=Jt==null?void 0:Jt.columnObj)==null?void 0:at.description)!=null&&Ut.length&&(R-=18,dt.push({x:R-Ft,width:14,type:"info",text:Jt.columnObj.description})),Ct+=Bt}),Xt.restore(),dt.forEach(Jt=>{Jt.y=8,Jt.height=Jt.width}),dt},Xi=fe=>{var Ft,dt,Ct,Xt,Jt;const ke=(Ft=vt.value)==null?void 0:Ft.getBoundingClientRect();if(!ke)return;cn.clientX=fe.clientX,cn.clientY=fe.clientY,et.x=fe.clientX-ke.left,et.y=fe.clientY-ke.top;let Oe=Qa.value.size?"col-resize":"auto";if(ft(),et.y<32){const Bt=X.value.filter(zn=>zn.fixed),Lt=ut.value-H.value+((dt=pe.value)==null?void 0:dt.length)*13,fn=lr;if(et.x>=Lt&&et.x<=Lt+fn&&Kl.value&&(Oe="pointer"),Bt.length){const En=di(0,Bt.length,0,0).find(In=>et.x>=In.x&&et.x<=In.x+In.width);["title","columnChevron"].includes(En==null?void 0:En.type)&&Kl.value&&(Oe="pointer"),En&&!En.disableTooltip&&Ke({rect:En,text:En.text,mousePosition:et})}if(!Bt.some(zn=>{const En=pn(zn.width);return et.x>=0&&et.x<=En})){let zn=0;for(let In=0;In<zt.value.start;In++)zn+=pn(X.value[In].width);const En=Bt.reduce((In,R)=>In+pn(R.width),0);if(et.x>=En){const R=di(zt.value.start,zt.value.end,zn,H.value).find($=>et.x>=$.x&&et.x<=$.x+$.width);["title","columnChevron"].includes(R==null?void 0:R.type)&&Kl.value&&(Oe="pointer"),R&&!R.disableTooltip&&Ke({rect:R,text:R.text,mousePosition:et})}}}if(Yn.value)an(fe);else if(Xe.value||bt.value)et.x>=st.value-200?(Ct=Kt.value)==null||Ct.scrollTo({left:H.value+10}):et.x<=200&&((Xt=Kt.value)==null||Xt.scrollTo({left:H.value-10}));else{if(fe.clientY-ke.top<=32&&bt.value)_t(fe);else if(et.y>rt.value-36){Oe=et.x<ut.value-H.value?"pointer":"auto",yl(Oe),requestAnimationFrame(Re);return}else{const Lt=Cn.findElementAt(et.x,et.y,[Lo.ADD_NEW_ROW,Lo.ROW]);if(Lt){if(Po.value&&!(Lt!=null&&Lt.group)&&(Lt!=null&&Lt.rowIndex)&&(Lt==null?void 0:Lt.rowIndex)>=ol)return;en.value={rowIndex:Lt==null?void 0:Lt.rowIndex,path:ma(Lt==null?void 0:Lt.group)}}gn(fe)}requestAnimationFrame(Re)}if(et.y>32){const Bt=Cn.findElementAt(et.x,et.y,[Lo.ADD_NEW_ROW,Lo.ROW]),Lt=Bt==null?void 0:Bt.row,fn=Bt==null?void 0:Bt.rowIndex,Wn=ma(Bt==null?void 0:Bt.group),{column:zn}=on(et.x,H.value);if(!Lt||!zn){(Bt==null?void 0:Bt.type)===Lo.ADD_NEW_ROW&&et.x<ut.value-H.value?yl("pointer"):yl("auto");return}const En=Ht((Lt==null?void 0:Lt.row)??{},(Jt=qn.value)==null?void 0:Jt.columns),In=X.value.findIndex(R=>R.id===zn.id);ca({event:fe,row:Lt,column:zn,value:Lt==null?void 0:Lt.row[zn.title],mousePosition:et,pk:En,selected:Se.value.row===fn&&Se.value.column===In,imageLoader:Ja,path:Wn})}if(Oe&&yl(Oe),et.x<Xo.value+pe.value.length*13&&et.y>Fo&&et.y<=rt.value-36){const Bt=Cn.findElementAt(et.x,et.y,[Lo.ADD_NEW_ROW,Lo.ROW]),Lt=Bt==null?void 0:Bt.row;if(Oe=La({row:Lt,x:et.x,group:Bt==null?void 0:Bt.group})||Oe,Oe&&yl(Oe),!Lt||Ai(Lt.rowMeta.rowIndex)||!pc(Ye.index)||qe.value&&!El(Ye.path,Bt.groupPath))return;const{isAtMaxSelection:fn,isCheckboxDisabled:Wn,regions:zn}=io(Lt,Bt==null?void 0:Bt.group);if(fn||Wn)return;const En=zn.find(de=>et.x>=de.x&&et.x<de.x+de.width);if(!En||En.action!=="select")return;const In=Math.min(Ye.index,Lt.rowMeta.rowIndex),R=Math.min(In+Wu,Math.max(Ye.index,Lt.rowMeta.rowIndex));if(In===R&&In===Ye.index&&Ye.isSelectionStarted)return;k(Bt.groupPath).cachedRows.value.forEach(de=>{de.rowMeta.rowIndex>=In&&de.rowMeta.rowIndex<=R?de.rowMeta.selected=!0:Ye.isSelectionStarted&&(de.rowMeta.selected=!1)}),Ye.isSelectionStarted||(Ye.isSelectionStarted=!0),requestAnimationFrame(Re)}},ci=()=>{yl("auto"),ft(),en.value={path:[],rowIndex:-2},requestAnimationFrame(Re)},fi=ae(async fe=>{var ke;if(qe.value){if((ke=fe==null?void 0:fe.path)!=null&&ke.length){f(Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,fe==null?void 0:fe.path),v(fe==null?void 0:fe.path),Zn(),Le.value=null,requestAnimationFrame(Re);return}await F(),ne.value.clear(),M(Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY),setTimeout(()=>{var Oe;(Oe=Kt.value)==null||Oe.scrollTo({top:Math.max(0,Math.min(Rn.value,ee.value))})},150)}else f(Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY),await v(),gt();Zn(),requestAnimationFrame(Re)});let vi=null,E=null;const P=fe=>{vi&&cancelAnimationFrame(vi),E&&clearTimeout(E),vi=requestAnimationFrame(()=>{ee.value=Math.max(0,fe.top),Mt.value<st.value?H.value=0:H.value=Math.max(0,fe.left),Zn(),Re()}),E=window.setTimeout(()=>{var Oe;(Oe=vt.value)!=null&&Oe.getBoundingClientRect()&&requestAnimationFrame(Re)},150)},Te=()=>{Zn(),gt()};async function At({newRows:fe,newColumns:ke,cellsOverwritten:Oe,rowsUpdated:Ft}){tt.value=!0;const dt={continue:!1,expand:!0},{close:Ct}=rs(vv,{modelValue:tt,newRows:fe,newColumns:ke,cellsOverwritten:Oe,rowsUpdated:Ft,isAddingEmptyRowPermitted:dl.value,meta:qn.value,"onUpdate:expand":Jt,"onUpdate:modelValue":Xt});function Xt(){tt.value=!1,Ct(1e3)}async function Jt(Bt){dt.continue=!0,dt.expand=Bt,Ct(1e3)}return await ka(tt).toBe(!1),dt}async function Sn(fe,ke,Oe=[]){await(s==null?void 0:s(fe,null,null,{metaValue:qn.value,viewMetaValue:to.value},ke,Oe))}function Vn(fe=null,ke=!1){var Oe,Ft;if(It.value=fe,_e.value=null,Be.value=null,!!no.value)if(te("c:shortcut",{key:"ALT + C"}),ke)An.value=!0,We.value=!0,requestAnimationFrame(Re);else{const dt=(Oe=vt.value)==null?void 0:Oe.getBoundingClientRect();if(!dt)return;(Ft=Kt.value)==null||Ft.scrollTo({left:ut.value}),Ie.value={top:`${dt.top}px`,right:`${256-lr}px`,width:`${lr}px`,height:"32px",position:"fixed"},An.value=!0,We.value=!0,requestAnimationFrame(Re)}}function Wo(fe,ke=!1,Oe,Ft){var dt;if(d("fieldEdit")&&!O.value&&(ke||!_.value||Uh.includes(Oe.uidt))&&!Y.value){const Ct=(dt=vt.value)==null?void 0:dt.getBoundingClientRect();if(ke&&($t.value=!0),!(Oe!=null&&Oe.id))return;const{column:Xt,xOffset:Jt}=so(Oe.id,H.value);Ie.value={top:`${Ct.top}px`,left:`${Ct.left+(Ft??Jt)}px`,width:(Xt==null?void 0:Xt.width)??"180px",height:"32px",position:"fixed"},Be.value=null,_e.value=Oe,An.value=!0,We.value=!0}}function $n(fe){var Oe,Ft;(Oe=Kt.value)==null||Oe.scrollTo({left:Mt.value});const ke=(Ft=vt.value)==null?void 0:Ft.getBoundingClientRect();ke&&setTimeout(()=>{if(oo.isCreateOrEditColumnDropdownOpen&&!oo.editColumn)return;const dt=ut.value-H.value;Ie.value={top:`${ke.top}px`,left:`${dt+ke.left}px`,width:`${lr}px`,height:"32px",position:"fixed"},Be.value=null,Ce.value=fe,An.value=!0,We.value=!0,requestAnimationFrame(Re)},500)}async function Ln(fe,ke=!1,Oe,Ft={},dt=[]){if(he({focusBtn:null})||Po.value&&!ke&&!Oe&&!fe&&!dt.length)return;const Ct=k(dt);x==null||x(dt,{onGroupRowChange:Un}),Ct!=null&&Ct.isRowSortRequiredRows.value.length&&(m==null||m(Ct==null?void 0:Ct.isRowSortRequiredRows.value,dt));const Xt=r==null?void 0:r(fe,void 0,Ft,dt);return!ke&&Xt&&Sn(Xt,Oe,dt),Zn(),requestAnimationFrame(Re),el().then(()=>{var Jt,Bt,Lt;Se.value={row:fe??Ct.totalRows.value-1,column:((Jt=Ge.value)==null?void 0:Jt.col)??1,path:dt},pt.value.startRange({row:fe??Ct.totalRows.value-1,col:((Bt=Ge.value)==null?void 0:Bt.col)??1}),pt.value.endRange({row:fe??Ct.totalRows.value-1,col:((Lt=Ge.value)==null?void 0:Lt.col)??1}),Jl()}),Xt}async function Oo({overwrite:fe,path:ke}){const Oe=await Ln(void 0,!0,void 0,fe,ke);Oe&&(c==null||c(Oe,void 0,!0,ke))}const co=(fe,ke)=>{var Ct;const Oe=k(fe==null?void 0:fe.path),{cachedRows:Ft}=Oe,dt=Ft.value.get(ke==="above"?fe.row:fe.row+1);if(dt){const Xt=Ht(dt.row,(Ct=qn.value)==null?void 0:Ct.columns);Ln(fe.row+(ke==="above"?0:1),!1,Xt,{},fe==null?void 0:fe.path)}else Ln(void 0,!1,void 0,{},fe==null?void 0:fe.path)},mo=async fe=>{var Ct,Xt,Jt;if(Rs((Ct=Se.value)==null?void 0:Ct.row)||Rs((Xt=Se.value)==null?void 0:Xt.column))return;const ke=((Jt=Le.value)==null?void 0:Jt.path)||Se.value.path,Oe=_a(je.value,ke),Ft=es(Oe),dt=k(ke);switch(Le.value=null,pt.value.clear(),fe){case Gl.NEXT:Se.value.row<dt.totalRows.value-1?Se.value.row++:Qo.value&&dl.value&&!Po.value&&(Ln(void 0,!1,void 0,Ft,ke),Se.value.row++);break;case Gl.PREV:Se.value.row>0&&Se.value.row--;break}await el(()=>{ho()}),pt.value.startRange({row:Se.value.row,col:Se.value.column}),pt.value.endRange({row:Se.value.row,col:Se.value.column}),requestAnimationFrame(Re),el(()=>{Jl(void 0,void 0,void 0,!1)})},Ql=fe=>{a("bulkUpdateDlg",fe)};Gn([rt,st,xt,lt],()=>{el(()=>{Zn(),requestAnimationFrame(Re)})}),Gn(Rn,fe=>{var ke;ee.value>fe-rt.value&&((ke=Kt.value)==null||ke.scrollTo({top:Math.max(fe-rt.value-256,0)}))}),Gn(Pe,()=>{Zn(),requestAnimationFrame(Re)}),Gn([()=>{var fe;return(fe=X.value)==null?void 0:fe.length},()=>re.value],()=>{el(()=>{Zn(),requestAnimationFrame(Re)})}),Gn(Se,fe=>{var Bt,Lt,fn,Wn;const ke=fe.path;if(qe.value&&Rs(ke))return;const Oe=k(ke),Ft=fe.row!==null?(Bt=Oe.cachedRows.value.get(fe.row))==null?void 0:Bt.row:void 0,dt=Ft&&fe.column!==null?(Lt=X.value[fe.column])==null?void 0:Lt.columnObj:void 0,Ct=Ft&&dt?Ft[dt.title]:void 0,Xt=Ht(Ft,(fn=qn.value)==null?void 0:fn.columns),Jt=(Wn=to.value)==null?void 0:Wn.id;N.emit(qo.CELL_SELECTED,{rowId:Xt,colId:dt==null?void 0:dt.id,val:Ct,viewId:Jt})},{deep:!0});function Nl(){Le.value=null,pt.value.startRange({row:Se.value.row,col:Se.value.column}),pt.value.endRange({row:Se.value.row,col:Se.value.column}),requestAnimationFrame(Re)}mt.on(fi),Dt==null||Dt.on(Te),Rt==null||Rt.on(Oo),nn.on(Nl);const{isViewColumnsLoading:Pl}=Ha();Gn(to,async(fe,ke)=>{try{fe&&fe.id!==(ke==null?void 0:ke.id)&&(fe.fk_model_id===L.params.viewId||ct.value)&&(Kf(),await ka(Pl).toMatch(Oe=>!Oe),qe.value?(await F(),Zn()):(await v(),Zn(),gt()),await yt())}catch(Oe){Zu.isCancel(Oe)||(console.error(Oe),Zt.error(we("msg.errorLoadingData")))}},{immediate:!0}),Ga(()=>{mt.off(fi),Dt==null||Dt.off(Te),Rt==null||Rt.off(Oo),nn.off(Nl)}),N.on(async(fe,ke)=>{fe===qo.CLEAR_NEW_ROW?(pt.value.clear(),Se.value.row=-1,Se.value.column=-1,b(ke),requestAnimationFrame(Re)):fe===qo.FIELD_RELOAD&&(Zn(),requestAnimationFrame(Re))});function nl(fe,ke=!1){Se.value&&(Se.value.row>=0||Se.value.column>=0||ke)&&(Se.value={row:-1,column:-1,path:fe??[]},Le.value=null,Yn.value=!1,pt.value.clear(),ho(),requestAnimationFrame(Re))}function _l(fe){D(fe),An.value=!1,Me.value=null,requestAnimationFrame(Re)}const va=(fe,ke)=>{An.value=!1,Me.value=null,A(fe,ke),requestAnimationFrame(Re)};Xs(be,fe=>{const ke=fe.target;ra()||Wl()||ji()||Xf()||ke&&Vh(ke,["ant-select-dropdown","nc-dropdown"])||(ho(),!document.querySelector(".canvas-aggregation, .canvas-header-column-menu, .canvas-header-add-new-row-menu, .canvas-group-context-menu")&&td())||(Be.value=null,Q.value=null,ie.value=null,Me.value=null,(Se.value.row>=0||Se.value.column>=0||Le.value)&&nl(Se.value.path,!0))},{ignore:[".nc-edit-or-add-provider-wrapper",".canvas-aggregation",".canvas-header-column-menu",".canvas-header-add-new-row-menu",".canvas-group-context-menu"]}),Zr("Escape",()=>{Be.value=null,Q.value=null,ie.value=null,Me.value=null,An.value=!1});const Zl={[ve.LongText]:2,[ve.Formula]:2};function cl(fe){var Oe,Ft,dt,Ct;const ke=((Ft=(Oe=Le.value)==null?void 0:Oe.column)==null?void 0:Ft.title)??"";ke&&(Ct=(dt=Le.value)==null?void 0:dt.row)!=null&&Ct.row&&(Le.value.row.row[ke]=fe)}const Na=ue(()=>{var fe;return!!((fe=Le.value)!=null&&fe.row)});id(Na,fe=>{un.trigger(fe)},{isGridCell:!0,immediate:!0}),Gn(Po,fe=>{T.value&&fe&&se(!fe)},{immediate:!0}),n({scrollToRow:Jl,openColumnCreate:$n});const xl=ue(()=>L.query);return Gn([()=>Ae.value.size,()=>xl.value.expand,()=>xl.value.rowId],([fe,ke,Oe])=>{var Ft,dt;if(ke==="true"&&!Oe&&!qe.value&&fe>0){const Ct=Ae.value.keys().next().value,Xt=(Ft=Ae.value)==null?void 0:Ft.get(Ct);Xt&&c(Xt,void 0,void 0,Array.isArray((dt=Xt.rowMeta)==null?void 0:dt.path)?Xt.rowMeta.path:[])}},{immediate:!0}),(fe,ke)=>{var In;const Oe=Ys,Ft=Fx,dt=Hi,Ct=Im,Xt=ld,Jt=gv,Bt=Fm,Lt=Am,fn=Sl,Wn=da,zn=Sr,En=Yl("e");return h(),B("div",{ref_key:"wrapperRef",ref:be,class:"w-full h-full"},[fe.isBulkOperationInProgress?(h(),B("div",VC,[le(Oe,{size:"regular"})])):ge("",!0),le(DC,{ref_key:"scroller",ref:Kt,class:"relative sticky","scroll-height":e(Rn),"scroll-width":e(Mt),height:e(rt),width:e(st),onScroll:P},{default:K(()=>{var R,$;return[z("div",{class:"sticky top-0 left-0",style:Xn({height:`${e(Rn)}px`,width:`${e(Mt)}px`})},[(h(),J(jh,{to:"body"},[le(kf,{name:"tooltip"},{default:K(()=>[e(oe).tooltipText?(h(),J(AC,{key:0,ref_key:"tooltipRef",ref:He,"tooltip-style":e(Ze)},null,8,["tooltip-style"])):ge("",!0)]),_:1})])),le(dt,{visible:e(Tt),"onUpdate:visible":ke[3]||(ke[3]=de=>yo(Tt)?Tt.value=de:null),trigger:["contextmenu"],"overlay-class-name":"nc-dropdown-grid-context-menu"},{overlay:K(()=>{var de,De;return[e(Ge)&&((de=e(Ge))==null?void 0:de.row)!==-1&&(((De=e(Ge))==null?void 0:De.col)!==-1||e(ot).length||e(j)||e(qe))?(h(),J(Ft,{key:0,"context-menu-target":e(Ge),"onUpdate:contextMenuTarget":ke[0]||(ke[0]=Wt=>yo(Ge)?Ge.value=Wt:null),"selected-all-records":e(j),"onUpdate:selectedAllRecords":ke[1]||(ke[1]=Wt=>yo(j)?j.value=Wt:null),selection:e(pt),columns:e(X),"active-cell":e(Se),"action-manager":e($a),"is-group-by":e(qe),"get-data-cache":e(k),"clear-cell":e(Ka),"is-primary-key-available":e(Eo),"is-selection-read-only":e(kn),"is-selection-only-a-i":e(Ma),"is-selection-only-script":e(ri),"is-insert-below-disabled":e(Ve),"is-order-column-exists":e(Mo),"delete-row":e(u),"delete-range-of-rows":e(y),"delete-selected-rows":fe.deleteSelectedRows,"bulk-delete-all":e(C),"call-add-new-row":co,"copy-value":e(Ta),"read-only":!fe.hasEditPermission,"get-rows":e(S),"bulk-update-rows":e(p),"expand-form":e(c),"clear-selected-range-of-cells":e(Oi),onClick:ke[2]||(ke[2]=Wt=>Tt.value=!1),onBulkUpdateDlg:Ql},null,8,["context-menu-target","selected-all-records","selection","columns","active-cell","action-manager","is-group-by","get-data-cache","clear-cell","is-primary-key-available","is-selection-read-only","is-selection-only-a-i","is-selection-only-script","is-insert-below-disabled","is-order-column-exists","delete-row","delete-range-of-rows","delete-selected-rows","bulk-delete-all","copy-value","read-only","get-rows","bulk-update-rows","expand-form","clear-selected-range-of-cells"])):ge("",!0)]}),default:K(()=>[z("canvas",{ref_key:"canvasRef",ref:vt,class:"sticky top-0 left-0",height:`${e(rt)}px`,width:`${e(st)}px`,oncontextmenu:"return false",onMousedown:si,onMousemove:Xi,onMouseleave:ci},null,40,jC)]),_:1},8,["visible"]),z("div",UC,[(R=e(Le))!=null&&R.row?(h(),B("div",{key:($=e(Le))==null?void 0:$.rowIndex,style:Xn({top:e(bn).top,left:e(bn).left,width:`${e(Le).width}px`,minHeight:`${e(Le).minHeight+(Zl[e(Le).column.uidt]??0)}px`,height:`${e(Le).height}px`,borderRadius:"2px",willChange:"top, left, width, height"}),class:Gt(["nc-canvas-table-editable-cell-wrapper pointer-events-auto",{[`row-height-${e(Ue)??1}`]:!0,"on-stick ":e(sn).isStuck,"border-[#3366ff]":e(sn).isStuck&&e(Le).isCellEditable,"border-[#9AA2AF]":e(sn).isStuck&&!e(Le).isCellEditable}])},[z("div",{ref_key:"activeCellElement",ref:wt,class:Gt(["relative w-[calc(100%-5px)] h-[calc(100%-5px)] rounded-br-[9px] bg-white",{"px-[0.550rem]":!e(jt)&&!e(Le).fixed,"px-[0.49rem]":e(Le).fixed,"top-[0.5px]":e(qe)&&e(sn).isStuck,"top-[2.5px]":e(qe),"left-[2.5px] ":e(qe)&&!e(Le).fixed,"left-[2px] ":e(qe)&&e(Le).fixed,"left-[-1px] top-[2px]":!e(qe)&&e(sn).isStuck,"left-[2px] top-[3.5px]":!e(qe)&&!e(sn).isStuck}]),onClick:ke[7]||(ke[7]=de=>e(Dn).trigger(de))},[le(Jt,{row:e(Le).row},{default:K(({state:de})=>[e(_o)(e(Le).column)&&e(Le).column.title?(h(),J(Ct,{key:0,modelValue:e(Le).row.row[e(Le).column.title],"onUpdate:modelValue":ke[4]||(ke[4]=De=>e(Le).row.row[e(Le).column.title]=De),column:e(Le).column,row:e(Le).row,path:e(Le).path,active:"","read-only":!e(So)||!e(Le).isCellEditable,"is-allowed":e(Le).isCellEditable,onSave:De=>{var Wt;return(Wt=e(s))==null?void 0:Wt(e(Le).row,e(Le).column.title,de,void 0,void 0,e(Le).path)},onNavigate:mo},null,8,["modelValue","column","row","path","read-only","is-allowed","onSave"])):(h(),J(Xt,{key:1,"model-value":e(Le).row.row[e(Le).column.title],column:e(Le).column,"row-index":e(Le).rowIndex,path:e(Le).path,active:"","edit-enabled":"","read-only":!e(So)||!e(Le).isCellEditable,"is-allowed":e(Le).isCellEditable,"onUpdate:modelValue":cl,onSave:ke[5]||(ke[5]=De=>{var Wt;return(Wt=e(s))==null?void 0:Wt(...De)}),onSaveWithState:ke[6]||(ke[6]=De=>{var Wt;return(Wt=e(s))==null?void 0:Wt(...De)}),onNavigate:mo},null,8,["model-value","column","row-index","path","read-only","is-allowed"]))]),_:1},8,["row"])],2)],6)):ge("",!0)])],4)]}),_:1},8,["scroll-height","scroll-width","height","width"]),e(Ie)?(h(),J(dt,{key:1,trigger:["click"],visible:e(An)&&!!(e(Be)||e(We)||e(Q)||e(ie)||e(Me)),"overlay-class-name":`!bg-transparent !min-w-[220px] ${!e(Q)&&!e(Be)&&!e(Me)&&!e(ie)?"!border-none !shadow-none":""}`,placement:"bottomRight",onVisibleChange:bl,"onUpdate:visible":bl},{overlay:K(()=>{var R;return[e(Q)?(h(),J(IC,{key:0,column:e(Q),"onUpdate:column":ke[8]||(ke[8]=$=>yo(Q)?Q.value=$:null),class:"canvas-aggregation"},null,8,["column"])):e(Be)?(h(),J(Bt,{key:1,"is-open":e(An),"onUpdate:isOpen":ke[9]||(ke[9]=$=>yo(An)?An.value=$:null),column:e(Be),class:"canvas-header-column-menu",onEdit:Wo,onAddColumn:ke[10]||(ke[10]=$=>Vn($,!0))},null,8,["is-open","column"])):e(ie)?(h(),J(df,{key:2,class:"canvas-header-add-new-row-menu",path:e(ie),"on-new-record-to-grid-click":Vl,"on-new-record-to-form-click":Ao},null,8,["path"])):e(Me)?(h(),J(zC,{key:3,class:"canvas-group-context-menu",group:e(Me),onToggleExpand:_l,onToggleExpandAll:va},null,8,["group"])):ge("",!0),e(We)?(h(),B("div",GC,[(h(),J(Lt,{key:((R=e(_e))==null?void 0:R.id)||"new",ref_key:"columnEditOrAddProviderRef",ref:Et,column:e(It)?null:e(_e),"column-position":e(It),"edit-description":e($t),preload:e(Ce),onSubmit:ke[11]||(ke[11]=$=>{var de;return al(!((de=e(_e))!=null&&de.id),$)}),onCancel:ke[12]||(ke[12]=$=>al()),onMounted:ke[13]||(ke[13]=$=>Ce.value=void 0),onClick:ke[14]||(ke[14]=ro(()=>{},["stop"])),onKeydown:ke[15]||(ke[15]=ro(()=>{},["stop"]))},null,8,["column","column-position","edit-description","preload"]))])):ge("",!0)]}),default:K(()=>[e(Be)||e(We)||e(Q)||e(ie)||e(Me)?(h(),B("div",{key:0,style:Xn(e(Ie)),class:"hide pointer-events-none"},null,4)):ge("",!0)]),_:1},8,["visible","overlay-class-name"])):ge("",!0),z("div",{class:"absolute bottom-12 z-5 left-2",onClick:ke[18]||(ke[18]=ro(()=>{},["stop"]))},[e(Qo)&&!e(Po)?(h(),J(zn,{key:0,entity:e(pl).TABLE,"entity-id":(In=e(qn))==null?void 0:In.id,permission:e(vl).TABLE_RECORD_ADD,"show-overlay":""},{default:K(({isAllowed:R})=>[le(dt,{disabled:!R},{overlay:K(()=>[le(df,{path:e(ie),"on-new-record-to-grid-click":Vl,"on-new-record-to-form-click":Ao},null,8,["path"])]),default:K(()=>[z("div",HC,[e(O)?Nt((h(),J(Wn,{key:0,class:"nc-grid-add-new-row",size:"small",type:"secondary",shadow:!1,onClick:ke[16]||(ke[16]=ro($=>Ao(),["stop"]))},{default:K(()=>[z("div",YC,[le(fn,{icon:"plus"}),ke[19]||(ke[19]=Je(" New Record "))])]),_:1})),[[En,[e(T)?"c:row:add:grid":"c:row:add:form"]]]):Nt((h(),J(Wn,{key:1,class:Gt(["nc-grid-add-new-row",{"!rounded-r-none !border-r-0":!e(qe)}]),size:"small",type:"secondary",shadow:!1,onClick:ke[17]||(ke[17]=ro($=>e(T)&&!e(qe)?Ln():Ao(),["stop"]))},{default:K(()=>[z("div",qC,[le(fn,{icon:"plus"}),e(T)||e(qe)?(h(),B(Qt,{key:0},[Je(ce(fe.$t("activity.newRecord")),1)],64)):(h(),B(Qt,{key:1},[Je(ce(fe.$t("activity.newRecord"))+" - "+ce(fe.$t("objects.viewType.form")),1)],64))])]),_:1},8,["class"])),[[En,[e(T)&&!e(qe)?"c:row:add:grid":"c:row:add:form"]]]),!e(O)&&!e(qe)?(h(),J(Wn,{key:2,size:"small",class:"!rounded-l-none nc-add-record-more-info",type:"secondary",shadow:!1},{default:K(()=>[le(fn,{icon:"arrowUp"})]),_:1})):ge("",!0)])]),_:2},1032,["disabled"])]),_:1},8,["entity","entity-id","permission"])):ge("",!0)])],512)}}}),QC=Object.assign(Ol(JC,[["__scopeId","data-v-09b5d084"]]),{__name:"SmartsheetGridCanvas"}),ZC=xo({__name:"Aggregation",props:{group:{},maxDepth:{},scrollLeft:{}},setup(t){return(n,o)=>(h(),B("div"))}}),e2=Object.assign(ZC,{__name:"SmartsheetGridAggregation"}),t2=ko(()=>Co(()=>Promise.resolve().then(()=>cv),void 0,import.meta.url).then(t=>t.default||t)),n2=xo({__name:"GroupByTable",props:{group:{},loadGroups:{type:Function},loadGroupData:{type:Function},loadGroupPage:{type:Function},groupWrapperChangePage:{type:Function},redistributeRows:{type:Function},depth:{},maxDepth:{},rowHeight:{},paginationFixedSize:{},paginationHideSidebars:{type:Boolean},scrollLeft:{},viewWidth:{},scrollable:{}},emits:["update:paginationData"],setup(t,{emit:n}){const o=t,a=Ra(o,"group",n),{t:i}=la(),r=cs(),s=dn(Ti,V()),u=dn(ds,V()),c=dn(zl,V(!1)),f=V(!1),{eventBus:v,allFilters:p,isExternalSource:g,validFiltersFromUrlParams:y}=Fl(),{showUpgradeToSeeMoreRecordsModal:x}=ql(),{user:w}=tl(),{withLoading:m}=vs(),C=r.currentRoute,b=ue(()=>C.value.query),S=V(),k=V(!1),D=V(),F=V(),I=ue(()=>b.value.group),M=ue({get(){return!!b.value.rowId},set(Q){Q||(r.push({query:{...b.value,rowId:void 0,group:void 0}}),D.value={},F.value={})}});function A(Q,ie,Me=!1,Be){var Ge;const it=Ht(Q.row,(Ge=s.value)==null?void 0:Ge.columns);if(F.value=ie,it&&!c.value)r.push({query:{...b.value,group:a.value.key,rowId:it}});else{if(Be&&Be!==a.value.key)return;D.value=Q,k.value=!0,f.value=!Me}}const j=Q=>{v.emit(qo.CLEAR_NEW_ROW,Q)};function N(Q,ie,Me=s.value){if(Q.nested||!Q.rows)return;ie=ie??Q.rows.length;const Be=Q.nestedIn.reduce((Ge,ze)=>(ze.key!=="__nc_null__"&&!ml(ze.column_uidt)&&![ve.Rollup,ve.Lookup,ve.Formula,ve.Barcode,ve.QrCode].includes(ze.column_uidt)&&(Ge[ze.title]=ze.key,ze.column_uidt===ve.Checkbox&&(Ge[ze.title]=Ge[ze.title]===rl.TRUE?!0:Ge[ze.title]===rl.FALSE?!1:!!Ge[ze.title])),Ge),{});Q.count=Q.count+1;const it=Pm([...p.value,...y.value],Me==null?void 0:Me.columns,{currentUser:w.value??void 0});return Q.rows.splice(ie,0,{row:{...it,...dm(Me==null?void 0:Me.columns),...Be},oldRow:{},rowMeta:{new:!0}}),Q.rows[ie]}const Y=ue(()=>!a.value.nested&&a.value.rows?a.value.rows:[]),{deleteRow:ae,deleteSelectedRows:he,deleteRangeOfRows:ye,updateOrSaveRow:re,bulkUpdateRows:me,selectedAllRecords:W,removeRowIfNew:U}=Bm({meta:s,viewMeta:u,formattedData:Y,paginationData:V(a.value.paginationData),callbacks:{changePage:Q=>o.loadGroupPage(a.value,Q),loadData:()=>o.loadGroupData(a.value,!0),globalCallback:()=>{var Q;return(Q=o.redistributeRows)==null?void 0:Q.call(o)}}}),Ae=async Q=>{a.value.count=a.value.count-1,await ae(Q)},je=m(async Q=>{await o.loadGroupData(a.value,!0,{...(Q==null?void 0:Q.offset)!==void 0?{offset:Q.offset}:{}})});wo(Wf,V(!0));const Ue=ue(()=>({fixedSize:o.paginationFixedSize?o.paginationFixedSize-2:void 0,hideSidebars:o.paginationHideSidebars,extraStyle:"background: transparent !important; border-top: 0px;"}));function ot(){return Y.value.findIndex(Q=>{var ie;return b.value.rowId===Ht(Q.row,(ie=s.value)==null?void 0:ie.columns)})}const G=async Q=>{var Ge,ze,Z,Et,_e;let Me=ot()+(Q===Gl.NEXT?1:-1);for(;(ze=(Ge=Y.value[Me])==null?void 0:Ge.rowMeta)!=null&&ze.new;)Me=Me+(Q===Gl.NEXT?1:-1);const Be=((Z=a.value.paginationData)==null?void 0:Z.page)||1;if(Me<0){if(Be===1)return Zt.info(i("msg.info.noMoreRecords"));await o.loadGroupPage(a.value,Be-1),Me=Y.value.length-1}else if(Me>=Y.value.length){if((Et=a.value.paginationData)!=null&&Et.isLastPage)return Zt.info(i("msg.info.noMoreRecords"));await o.loadGroupPage(a.value,Be+1),Me=0}const it=Ht(Y.value[Me].row,(_e=s.value)==null?void 0:_e.columns);it&&await r.push({query:{...b.value,rowId:it}})},pe=(Q,ie)=>{var Me;if((((Me=a.value.paginationData)==null?void 0:Me.pageSize)??10)*Q>100&&x({isExternalSource:g.value}))return!0;ie==null||ie()},ne=async()=>{var ie,Me,Be,it,Ge,ze,Z,Et,_e,yn;const Q=ot();if(!((ie=a.value.paginationData)!=null&&ie.isLastPage)&&Q===(((Me=a.value.paginationData)==null?void 0:Me.pageSize)??10)-1&&pe((Be=a.value.paginationData)!=null&&Be.page?((it=a.value.paginationData)==null?void 0:it.page)+1:1)){(ze=(Ge=S.value)==null?void 0:Ge.stopLoading)==null||ze.call(Ge);return}if(!((Z=a.value.paginationData)!=null&&Z.isLastPage)&&Q===((Et=a.value.paginationData)==null?void 0:Et.pageSize)){const It=(_e=a.value.paginationData)!=null&&_e.page?((yn=a.value.paginationData)==null?void 0:yn.page)+1:1;await o.loadGroupPage(a.value,It)}G(Gl.NEXT)},be=async()=>{var ie,Me,Be;const Q=ot();if(!((ie=a.value.paginationData)!=null&&ie.isFirstPage)&&Q===1){const it=(Me=a.value.paginationData)!=null&&Me.page?((Be=a.value.paginationData)==null?void 0:Be.page)-1:1;await o.loadGroupPage(a.value,it)}G(Gl.PREV)},ee=ue(()=>{var ie;const Q=ot();return((ie=a.value.paginationData)==null?void 0:ie.isLastPage)&&Q===Y.value.length-1}),H=ue(()=>{var ie;const Q=ot();return((ie=a.value.paginationData)==null?void 0:ie.isFirstPage)&&Q===0});async function Ce(){he&&(await he(),await je({shouldShowLoading:!1}))}const Ie=dn(Ea,jo());return Ga(async()=>{Ie==null||Ie.off(je)}),Ie==null||Ie.on(je),v.on(Q=>{(Q===qo.GROUP_BY_RELOAD||Q===qo.DATA_RELOAD)&&(Ie==null||Ie.trigger())}),(Q,ie)=>{var it;const Me=t2,Be=sd;return h(),B(Qt,null,[e(a).rows?(h(),J(cd,{key:0,"selected-all-records":e(W),"onUpdate:selectedAllRecords":ie[0]||(ie[0]=Ge=>yo(W)?W.value=Ge:null),class:"nc-group-table",data:e(a).rows,"v-group":e(a),"pagination-data":e(a).paginationData,"load-data":async()=>{},"change-page":Ge=>pe(Ge,()=>o.loadGroupPage(e(a),Ge)),"call-add-empty-row":Ge=>N(e(a),Ge),"expand-form":A,"row-height-enum":Q.rowHeight,"delete-row":Ae,"delete-selected-rows":Ce,"delete-range-of-rows":e(ye),"update-or-save-row":e(re),"remove-row-if-new":e(U),"bulk-update-rows":e(me),"hide-header":!0,pagination:e(Ue),"disable-skeleton":!0,"disable-virtual-y":!0},null,8,["selected-all-records","data","v-group","pagination-data","change-page","call-add-empty-row","row-height-enum","delete-range-of-rows","update-or-save-row","remove-row-if-new","bulk-update-rows","pagination"])):ge("",!0),(h(),J(Mu,null,{default:K(()=>[e(D)&&e(k)?(h(),J(Me,{key:0,modelValue:e(k),"onUpdate:modelValue":[ie[1]||(ie[1]=Ge=>yo(k)?k.value=Ge:null),ie[2]||(ie[2]=Ge=>j(e(D)))],"load-row":!e(c),row:e(D),state:e(F),meta:e(s),view:e(u)},null,8,["modelValue","load-row","row","state","meta","view"])):ge("",!0)]),_:1})),e(M)&&((it=e(s))!=null&&it.id)&&e(I)===e(a).key?(h(),J(Be,{key:1,ref_key:"expandedFormRef",ref:S,modelValue:e(M),"onUpdate:modelValue":ie[3]||(ie[3]=Ge=>yo(M)?M.value=Ge:null),row:e(D)??{row:{},oldRow:{},rowMeta:{}},meta:e(s),"load-row":!e(c),state:e(F),"row-id":e(b).rowId,view:e(u),"show-next-prev-icons":"","first-row":e(H),"last-row":e(ee),"expand-form":A,onNext:ne,onPrev:be},null,8,["modelValue","row","meta","load-row","state","row-id","view","first-row","last-row"])):ge("",!0)],64)}}}),o2=Object.assign(n2,{__name:"SmartsheetGridGroupByTable"}),l2=ko(()=>Co(()=>import("./BALLsGq5.js").then(t=>t.V),__vite__mapDeps([7,1,2,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,3,26,27,28,29,30,31,32,33,34,35]),import.meta.url).then(t=>t.default||t)),a2=ko(()=>Co(()=>import("./B1qoNiTF.js").then(t=>t.C),__vite__mapDeps([36,1,2,12,13,37,38,39,28,23,22,26,27,40]),import.meta.url).then(t=>t.default||t)),i2=ko(()=>Co(()=>Promise.resolve().then(()=>fd),void 0,import.meta.url).then(t=>t.default||t)),r2={class:"pointer-events-none"},s2=xo({__name:"GroupByLabel",props:{column:{},modelValue:{}},setup(t){return wo(Ks,V(!0)),wo(qh,V(!0)),(n,o)=>{const l=l2,a=a2,i=i2;return h(),B("div",r2,[le(i,{row:{row:{[n.column.title]:n.modelValue},rowMeta:{}}},{default:K(()=>[e(_o)(n.column)?(h(),J(l,{key:0,"model-value":n.modelValue,class:"!text-gray-600",column:n.column,"read-only":!0},null,8,["model-value","column"])):(h(),J(a,{key:1,"model-value":n.modelValue,class:"!text-gray-600",column:n.column,"edit-enabled":!1,"read-only":!0},null,8,["model-value","column"]))]),_:1},8,["row"])])}}}),u2=Object.assign(s2,{__name:"SmartsheetGridGroupByLabel"}),d2=ko(()=>Co(()=>import("./DCKYOzKD.js"),__vite__mapDeps([78,1,2,65,66,67,68,43,44,45,46,47,48,24,23,3,22,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,69,70,39,71,32,31,33,30,34,72,73,28,26,27,74,75,76,79,80,81,19,82,83,84,85,86,87,88,89,90,91,36,12,13,37,38,40,92,93,94,29,95,96,97,98,99,7,8,9,10,11,14,15,16,17,18,20,21,25,35,100,101,102,103,104,105,106,107,108,109,110]),import.meta.url).then(t=>t.default||t)),c2=ko(()=>Co(()=>import("./CPGfyxPl.js"),__vite__mapDeps([111,20,1,2,21,32,31,33,30,34,112]),import.meta.url).then(t=>t.default||t)),f2={key:0,class:"flex sticky top-0 z-5"},v2={class:"flex items-center"},p2={class:"flex"},h2={key:1,class:"flex min-w-[100px] flex-wrap"},m2={key:1,class:"text-gray-400"},g2={class:"text-xs group-hover:hidden text-gray-500 nc-group-row-count"},w2={class:"text-[#374151] ml-2"},y2={class:"flex items-center gap-2"},b2=xo({__name:"GroupBy",props:{group:{},callAddEmptyRow:{type:Function},expandForm:{type:Function},loadGroups:{type:Function},loadGroupData:{type:Function},loadGroupPage:{type:Function},groupWrapperChangePage:{type:Function},loadGroupAggregation:{type:Function},redistributeRows:{type:Function},viewWidth:{},scrollLeft:{},fullPage:{type:Boolean},depth:{},maxDepth:{},rowHeight:{}},emits:["update:paginationData"],setup(t,{emit:n}){const o=t,a=Ra(o,"group",n),i=dn(Ti,V()),r=dn(wr,V()),s=Nn(o,"scrollLeft"),{isViewDataLoading:u,isPaginationLoading:c}=Uo(yr()),{gridViewCols:f}=Ha(),{withLoading:v}=vs(),p=dn(Ku,jo()),g=ue(()=>{var W,U;return(U=(W=i.value)==null?void 0:W.columns)==null?void 0:U.find(Ae=>Ae.pv)}),y=ue(()=>!g.value||!g.value.id?{width:"100px"}:f.value[g.value.id]),x=dn(Ea,jo());p==null||p.on(async W=>{var U,Ae;if((U=r.value)!=null&&U.length&&((!W||!((Ae=W==null?void 0:W.fields)!=null&&Ae.length))&&await o.loadGroupAggregation(a.value),W!=null&&W.fields)){const je=W.fields.reduce((Ue,ot)=>{const G=r.value.find(pe=>pe.title===ot.title);return G!=null&&G.id&&(Ue[G.id]=ot.aggregation??f.value[G.id].aggregation??Wa.None),Ue},{});await o.loadGroupAggregation(a.value,Object.entries(je).map(([Ue,ot])=>({field:Ue,type:ot})))}});const w=async(W,U,Ae)=>{u.value=!0,c.value=!0,await o.loadGroupData(W,U,Ae),u.value=!1,c.value=!1},m=o.depth??0,C=V(),b=V(),S=V(),k=ue(()=>{var W;return o.fullPage??(((W=S.value)==null?void 0:W.offsetWidth)??0)>(o.viewWidth??0)}),D=V(),F=ue(()=>D.value?Array.isArray(D.value)?D.value.map(W=>W.replace("group-panel-","")):[D.value.replace("group-panel-","")]:[]),I=V([]),M=async W=>{var U,Ae,je,Ue;if(W=Array.isArray(W)?W:[W],W.length>0&&a.value.children&&!I.value.includes(W[W.length-1])){await ka(()=>{var pe;return((pe=a.value.children)==null?void 0:pe.length)>0}).toBeTruthy({timeout:1e4});const ot=W[W.length-1].replace("group-panel-",""),G=a.value.children.find(pe=>`${pe.key}`===ot);G&&(G.nested?(je=(Ae=(U=G.children)==null?void 0:U[0])==null?void 0:Ae.children)!=null&&je.length||o.loadGroups({},G,{triggerChildOnly:!0}):(Ue=G.rows)!=null&&Ue.length||w(G))}I.value=W},A=v(W=>{a.value.nested?o.loadGroups({...(W==null?void 0:W.offset)!==void 0?{offset:W.offset}:{}},a.value):(w(a.value,!0,{...(W==null?void 0:W.offset)!==void 0?{offset:W.offset}:{}}),o.loadGroupAggregation(a.value))});oi(async()=>{x==null||x.on(A)}),Ga(async()=>{x==null||x.off(A)}),Gn([()=>a.value.key],async(W,U)=>{W!==U&&(a.value.nested?a.value.nested&&await o.loadGroups({},a.value):await w(a.value,!0))}),oi(async()=>{var W,U;a.value.root===!0&&!((U=(W=a.value)==null?void 0:W.children)!=null&&U.length)&&await o.loadGroups({},a.value)}),a.value.root===!0&&wo(zf,C);const j=V(),N=ue(()=>{if(a.value.root===!0)return j.value??0;if(o.scrollLeft&&o.viewWidth&&b.value){const W=b.value.scrollWidth+12+12;return o.scrollLeft+o.viewWidth+20>W?W-o.viewWidth-20:Math.max(Math.min(W-o.viewWidth,(o.scrollLeft??0)-12),0)}return 0}),Y=W=>{a.value.root&&(j.value=W.target.scrollLeft)},ae=async W=>{Array.isArray(D.value)?D.value.push(`group-panel-${W}`):D.value=[`group-panel-${W}`],await M(`group-panel-${W}`)},he=W=>{Array.isArray(D.value)?D.value=D.value.filter(U=>U!==`group-panel-${W}`):D.value=[]},ye=ue(()=>{var Ue;const W=Number((((Ue=y.value)==null?void 0:Ue.width)??"").replace("px",""))+55+o.maxDepth*9,U=o.maxDepth??1,Ae=a.value.root?j.value??0:s.value??0,je=ot=>{switch(ot){case 3:return`${W-18}px`;case 2:return`${W-9}px`;case 1:default:return`${W}px`}};return m===0?Ae<29?`${W+Ae-(.02*(Ae*Ae)+1.07*Ae)}px`:je(U):m===1?Ae<30?`${W+Ae-9-23/20*Ae}px`:je(U):m===2?Ae<=14?`${W+Ae-18-Ae}px`:je(U):`${W}px`}),re=ue(()=>{if(o.maxDepth===3)switch(m){case 2:return"#F9F9FA";case 1:return"#F4F4F5";default:return"#F1F1F1"}if(o.maxDepth===2)switch(m){case 1:return"#F9F9FA";default:return"#F4F4F5"}return o.maxDepth===1,"#F9F9FA"});async function me(){var U;if(m!==0)return;const W=await o.callAddEmptyRow();W&&((U=o.expandForm)==null||U.call(o,W,void 0,!0))}return(W,U)=>{const Ae=Sl,je=da,Ue=Xh,ot=Ya,G=qa,pe=Hi,ne=e2,be=Vm,ee=zm,H=d2,Ce=c2,Ie=Yl("e");return h(),B(Qt,null,[z("div",{ref_key:"wrapper",ref:C,class:Gt([{"overflow-y-auto":e(a).root===!0},"h-full"]),style:Xn(`${!e(a).root&&e(a).nested?"padding-left: 8px; padding-right: 8px;":""}`),onScroll:Y},[z("div",{ref_key:"scrollable",ref:b,style:Xn(`${e(a).root===!0?"width: fit-content":"width: 100%"}`)},[e(a).root===!0?(h(),B("div",f2,[z("div",{class:"border-b-1 border-gray-200 mb-2",style:Xn([{"background-color":"#f4f4f5"},{"padding-left":`${(W.maxDepth||1)*9}px`}])},null,4),le(cd,{ref_key:"tableHeader",ref:S,class:"mb-2",data:[],"hide-checkbox":!0,"header-only":!0},null,512)])):ge("",!0),z("div",{class:Gt({"pl-2":e(a).root===!0})},[le(ee,{"active-key":e(D),"onUpdate:activeKey":U[1]||(U[1]=Q=>yo(D)?D.value=Q:null),class:"nc-group-wrapper !rounded-lg",bordered:!1,onChange:M},{default:K(()=>{var Q;return[(h(!0),B(Qt,null,po(((Q=e(a))==null?void 0:Q.children)??[],ie=>(h(),J(be,{key:`group-panel-${ie.key}`,class:"!border-1 border-gray-300 nc-group rounded-[8px] mb-2",style:Xn(`background: ${e(re)};`),"show-arrow":!1},{header:K(()=>[z("div",{class:Gt([{"!rounded-b-none":e(F).includes(ie.key.toString()),"!border-b-1":e(m)===(W.maxDepth??1)-1&&e(F).includes(ie.key.toString())},"flex !sticky w-full items-center rounded-b-lg select-none transition-all !rounded-t-[8px] !h-10"])},[z("div",{class:Gt([{"!rounded-bl-[8px]":!e(F).includes(ie.key.toString())},"!sticky flex z-10 justify-between !h-9.8 border-r-1 !rounded-tl-[8px] group pr-2 border-gray-300 overflow-clip items-center !left-0"]),style:Xn(`width:${e(ye)};background: ${e(re)};`)},[z("div",v2,[le(je,{class:"!border-0 !shadow-none !bg-transparent !hover:bg-transparent",type:"secondary",size:"small"},{default:K(()=>[le(Ae,{icon:"chevronDown",class:"transition-all",style:Xn(`${e(F).includes(ie.key.toString())?"transform: rotate(360deg)":"transform: rotate(270deg)"}`)},null,8,["style"])]),_:2},1024),z("div",p2,[ie.column.uidt==="MultiSelect"?(h(!0),B(Qt,{key:0},po(Object.entries(ie.key.split(",")),([Me,Be])=>(h(),J(Ue,{key:`panel-tag-${ie.column.id}-${Be}`,class:"!py-0 !px-[12px] !rounded-[12px]",color:ie.color.split(",")[+Me]},{default:K(()=>[z("span",{class:"nc-group-value",style:Xn({color:e(ir).isReadable(ie.color.split(",")[+Me]||"#ccc","#fff",{level:"AA",size:"large"})?"#fff":e(ir).mostReadable(ie.color.split(",")[+Me]||"#ccc",["#0b1d05","#fff"]).toHex8String(),"font-size":"14px","font-weight":500})},ce(Be in("GROUP_BY_VARS"in W?W.GROUP_BY_VARS:e(rl)).VAR_TITLES?("GROUP_BY_VARS"in W?W.GROUP_BY_VARS:e(rl)).VAR_TITLES[Be]:Be),5)]),_:2},1032,["color"]))),128)):!(ie.key in("GROUP_BY_VARS"in W?W.GROUP_BY_VARS:e(rl)).VAR_TITLES)&&e($m)(ie.column)?(h(),B("div",h2,[(h(!0),B(Qt,null,po(("parseKey"in W?W.parseKey:e(Bs))(ie),(Me,Be)=>(h(),B(Qt,{key:Be},[Me?(h(),J(u2,{key:0,column:ie.column,"model-value":Me},null,8,["column","model-value"])):(h(),B("span",m2,"No mapped value"))],64))),128))])):(h(),J(Ue,{key:`panel-tag-${ie.column.id}-${ie.key}`,class:Gt(["!py-0 !px-[12px]",`${ie.column.uidt==="SingleSelect"?"!rounded-[12px]":"!rounded-[6px]"}`]),color:ie.color},{default:K(()=>{var Me;return[z("span",{class:"nc-group-value font-semibold text-[13px]",style:Xn({color:e(ir).isReadable(ie.color||"#ccc","#fff",{level:"AA",size:"large"})?"#fff":e(ir).mostReadable(ie.color||"#ccc",["#0b1d05","#fff"]).toHex8String()})},[ie.key in("GROUP_BY_VARS"in W?W.GROUP_BY_VARS:e(rl)).VAR_TITLES?(h(),B(Qt,{key:0},[Je(ce(("GROUP_BY_VARS"in W?W.GROUP_BY_VARS:e(rl)).VAR_TITLES[ie.key]),1)],64)):(h(),B(Qt,{key:1},[Je(ce((Me=("parseKey"in W?W.parseKey:e(Bs))(ie))==null?void 0:Me.join(", ")),1)],64))],4)]}),_:2},1032,["class","color"]))])]),z("div",{style:Xn(`background: linear-gradient(to right, hsla(0, 0%, 97%, 0), ${e(re)} 18%);`),class:"flex !h-10 absolute right-0 pl-8 pr-2 items-center"},[z("div",g2,[z("span",null,ce(W.$t("datatype.Count")),1),z("span",w2,ce(ie.count),1)]),le(pe,{class:"!hidden !group-hover:block"},{overlay:K(()=>[le(G,{variant:"small"},{default:K(()=>[e(F).includes(ie.key.toString())?(h(),J(ot,{key:0,onClick:Me=>he(ie.key)},{default:K(()=>[le(Ae,{icon:"minimize"}),U[5]||(U[5]=Je(" Collapse group "))]),_:2,__:[5]},1032,["onClick"])):(h(),J(ot,{key:1,onClick:Me=>ae(ie.key)},{default:K(()=>[le(Ae,{icon:"maximize"}),U[6]||(U[6]=Je(" Expand group "))]),_:2,__:[6]},1032,["onClick"]))]),_:2},1024)]),default:K(()=>[le(je,{size:"small",type:"text",onClick:U[0]||(U[0]=ro(()=>{},["stop"]))},{default:K(()=>[le(Ae,{icon:"threeDotVertical"})]),_:1})]),_:2},1024)],4)],6),le(ne,{"scroll-left":o.scrollLeft||e(j),"max-depth":W.maxDepth,group:ie,depth:e(m)},null,8,["scroll-left","max-depth","group","depth"])],2)]),default:K(()=>[!ie.nested&&ie.rows?(h(),J(o2,{key:0,group:ie,"max-depth":W.maxDepth,depth:W.depth,"load-groups":W.loadGroups,"load-group-data":w,"load-group-page":W.loadGroupPage,"group-wrapper-change-page":W.groupWrapperChangePage,"row-height":W.rowHeight,"redistribute-rows":W.redistributeRows,"pagination-fixed-size":e(k)?o.viewWidth:void 0,"pagination-hide-sidebars":!0,"scroll-left":o.scrollLeft||e(j),"view-width":W.viewWidth,scrollable:e(b)},null,8,["group","max-depth","depth","load-groups","load-group-page","group-wrapper-change-page","row-height","redistribute-rows","pagination-fixed-size","scroll-left","view-width","scrollable"])):(h(),J(ep,{key:1,group:ie,"load-groups":W.loadGroups,"load-group-data":w,"load-group-page":W.loadGroupPage,"group-wrapper-change-page":W.groupWrapperChangePage,"row-height":W.rowHeight,"load-group-aggregation":W.loadGroupAggregation,"redistribute-rows":W.redistributeRows,"view-width":W.viewWidth,depth:e(m)+1,"max-depth":W.maxDepth,"scroll-left":e(N),"full-page":e(k)},null,8,["group","load-groups","load-group-page","group-wrapper-change-page","row-height","load-group-aggregation","redistribute-rows","view-width","depth","max-depth","scroll-left","full-page"]))]),_:2},1032,["style"]))),128))]}),_:1},8,["active-key"])],2)],4)],38),e(a).root?(h(),J(H,{key:0,"pagination-data":e(a).paginationData,"onUpdate:paginationData":U[2]||(U[2]=Q=>e(a).paginationData=Q),"show-size-changer":!1,"scroll-left":e(j),"custom-label":"groups",depth:W.maxDepth,"change-page":Q=>W.groupWrapperChangePage(Q,e(a))},null,8,["pagination-data","scroll-left","depth","change-page"])):(h(),J(Ce,{key:1,"pagination-data":e(a).paginationData,"onUpdate:paginationData":U[3]||(U[3]=Q=>e(a).paginationData=Q),"align-count-on-right":"","custom-label":"groups","align-left":"","show-api-timing":"","change-page":Q=>W.groupWrapperChangePage(Q,e(a)),"hide-sidebars":!0,style:Xn(`${o.depth&&o.depth>0?"border-radius: 0 0 8px 8px !important; background: transparent; border-top: 0px; height: 24px; padding-bottom: 8px;":""}`),"fixed-size":void 0},null,8,["pagination-data","change-page","style"])),W.depth!==0?(h(),B("div",{key:2,class:"absolute bottom-12 z-5 left-2",onClick:U[4]||(U[4]=ro(()=>{},["stop"]))},[Nt((h(),J(je,{class:"nc-group-grid-add-new-row",size:"small",type:"secondary",shadow:!1,onClick:ro(me,["stop"])},{default:K(()=>[z("div",y2,[le(Ae,{icon:"plus"}),U[7]||(U[7]=Je(" New Record "))])]),_:1})),[[Ie,["c:row:add:grid"]]])])):ge("",!0)],64)}}}),ep=Object.assign(Ol(b2,[["__scopeId","data-v-1ee01c28"]]),{__name:"SmartsheetGridGroupBy"}),Jr=100,_2=100,ff=t=>t==="asc"?"+":t==="desc"?"-":t==="count-asc"?"~+":t==="count-desc"?"~-":"+",x2=(t,n,o,l)=>{const{gridViewCols:a}=Ha(),i=Ca(),{base:r}=Uo(i),{$api:s}=ua(),{getMeta:u,metas:c}=ai(),{appInfo:f}=tl(),{nestedFilters:v,sorts:p}=Fl(),{fetchBulkAggregatedData:g,sharedView:y}=ju(),x=cs(),w=dn(zl,V(!1)),m=dn(Kh,V(null)),C=V([]),b=ue(()=>x.currentRoute.value.query),S=ue(()=>{var G,pe,ne;return(pe=(G=n.value)==null?void 0:G.columns)!=null&&pe.length?(ne=n.value)==null?void 0:ne.columns.reduce((be,ee)=>(be[ee.id]=ee,be),{}):{}}),k=ue(()=>Object.values(a.value).reduce((G,pe)=>{const ne=pe.title;return G[ne]=pe,G},{})),D=ue(()=>{const G=[];return Object.values(a.value).forEach(pe=>{var ne,be;if(pe.group_by){const ee=(be=(ne=n==null?void 0:n.value)==null?void 0:ne.columns)==null?void 0:be.find(H=>H.id===pe.fk_column_id);ee&&G.push({column:ee,sort:pe.group_by_sort||"asc",order:pe.group_by_order||1})}}),G.sort((pe,ne)=>(pe.order??1/0)-(ne.order??1/0)),G}),F=V(new Map),I=V(0),M=V([]),A=G=>Math.floor(G/Jr),j=V(Su.light),N=V(j.value[0]),Y=()=>{const G=N.value,pe=j.value.indexOf(N.value);return pe===j.value.length-1?N.value=j.value[0]:N.value=j.value[pe+1],G},ae=async(G,pe,ne=!1)=>{var Ie,Q,ie,Me,Be,it,Ge,ze,Z,Et,_e,yn,It,$t;const be=pe?pe.chunkStates:M.value;if(be[G]==="loading"||be[G]==="loaded"&&!ne)return;be[G]="loading";const ee=G*Jr,H=pe?re(pe):0,Ce=D.value[H];if(!(!Ce||!((Ie=t.value)!=null&&Ie.id)||!((Q=r.value)!=null&&Q.id)))try{const et=ye(pe)??[],cn=w.value?await s.public.dataGroupBy(y.value.uuid,{offset:ee,limit:Jr,where:o.value,sort:`${ff(Ce.sort)}${Ce.column.title}`,column_name:Ce.column.title,subGroupColumnName:(ie=D.value[H+1])==null?void 0:ie.column.title,sortArrJson:JSON.stringify(p.value),filterArrJson:JSON.stringify([...v.value??[],...et])},{headers:{"xc-password":m.value}}):await s.dbViewRow.groupBy("noco",r.value.id,t.value.fk_model_id,t.value.id,{offset:ee,limit:Jr,where:o.value,sort:`${ff(Ce.sort)}${Ce.column.title}`,column_name:Ce.column.title,sortArrJson:JSON.stringify(p.value),filterArrJson:JSON.stringify([...v.value||[],...et]),subGroupColumnName:(Me=D.value[H+1])==null?void 0:Me.column.title}),Pn=[];for(const Kt of cn.list){let nn={};if(Ce.column.uidt===ve.LinkToAnotherRecord){const Rt=await u(Ce.column.colOptions.fk_related_model_id);if(!Rt)continue;nn.relatedTableMeta=Rt;const ct=((Be=Rt.columns)==null?void 0:Be.find(nt=>nt.pv))||((it=Rt.columns)==null?void 0:it[0]);nn.relatedColumn=ct,nn.displayValueProp=ct==null?void 0:ct.title}if(Ce.column.uidt===ve.Lookup){const Rt=(ze=(Ge=n.value)==null?void 0:Ge.columns)==null?void 0:ze.find(lt=>{var xt,Ot;return lt.id===((Ot=(xt=Ce.column)==null?void 0:xt.colOptions)==null?void 0:Ot.fk_relation_column_id)});if(!Rt)continue;const ct=await u(Rt.colOptions.fk_related_model_id);if(!ct)continue;const nt=(Z=ct.columns)==null?void 0:Z.find(lt=>{var xt;return lt.id===((xt=Ce.column.colOptions)==null?void 0:xt.fk_lookup_column_id)});if(!nt)continue;let rt=ct,st=nt;if(nt.uidt===ve.LinkToAnotherRecord){const lt=await u(nt.colOptions.fk_related_model_id);lt&&(rt=lt,st=((Et=lt.columns)==null?void 0:Et.find(xt=>xt.pv))||((_e=lt.columns)==null?void 0:_e[0]))}nn.relatedTableMeta=rt,nn.relatedColumn=st,nn.displayValueProp=st==null?void 0:st.title}const wt=cn.list.indexOf(Kt),Dn=Om(Kt[Ce.column.title]??Kt[Ce.column.column_name],Ce.column,nn==null?void 0:nn.displayValueProp),un=ee+wt;nn={...nn,groupIndex:un,column:Ce.column,groups:new Map,chunkStates:[],count:+Kt.count,groupCount:+Kt.__sub_group_count__,isExpanded:!1,color:Dm(Dn,Ce.column,Y),expandedGroups:0,value:Dn,nestedIn:pe?[...pe.nestedIn,{title:Ce.column.title,column_name:Ce.column.title,key:Dn,column_uidt:Ce.column.uidt,column_id:Ce.column.id,groupIndex:un}]:[{title:Ce.column.title,column_name:Ce.column.title,key:Dn,column_uidt:Ce.column.uidt,column_id:Ce.column.id,groupIndex:un}],aggregations:{}};const Bn=ma(nn);let tt=(((It=(yn=b.value)==null?void 0:yn.path)==null?void 0:It.split("-"))??[]).map(Rt=>+Rt);tt=[...tt.slice(0,nn.nestedIn.length),...Array(Math.max(0,nn.nestedIn.length-tt.length)).fill("")];const mt=Bn.join("-")===tt.join("-"),Dt=nn.nestedIn.map(Rt=>`${Rt.key}-${Rt.column_name}`).join("_")||"default";nn.isExpanded=C.value.includes(Dt)||mt,H===D.value.length-1&&(nn.path=Bn),pe?pe.groups.set(un,nn):F.value.set(un,nn),Pn.push(nn)}if(($t=f.value)!=null&&$t.ee&&Pn.length){const Kt=new gc,nn=Object.values(a.value).map(un=>({field:un.fk_column_id,type:un.aggregation??Wa.None})).filter(un=>un.type!==Wa.None),wt=Pn.map(un=>({where:o==null?void 0:o.value,alias:Kt.generateAlias(un.value),filterArrJson:JSON.stringify([...v.value,...ye(un)])}));let Dn={};nn.length&&(Dn=w.value?await g({aggregation:nn,filterArrJson:JSON.stringify(v.value)},wt):await s.dbDataTableBulkAggregate.dbDataTableBulkAggregate(n.value.id,{viewId:t.value.id,aggregation:nn,filterArrJson:JSON.stringify(v.value)},wt),await Kt.process(Dn,(un,Bn)=>{const tt=Pn.find(mt=>mt.value.toString()===un.toString());Object.keys(Bn).forEach(mt=>{const Dt=k.value[mt],Rt=S.value[Dt.fk_column_id];Bn[mt]=Vu(Dt.aggregation,Bn[mt],Rt,[un.toString()],{col:Rt,meta:n.value,metas:c.value,isMysql:i.isMysql,isPg:i.isPg})??""}),tt&&Object.assign(tt.aggregations,Bn)}))}pe?be[G]="loaded":(I.value=cn.pageInfo.totalRows||I.value,M.value[G]="loaded")}catch(et){console.error(`Error fetching group chunk at level ${H}:`,et),be[G]=void 0}};function he(G,pe=""){var be;if(!((be=G==null?void 0:G.nestedIn)!=null&&be.length))return pe;const ne=ee=>`"${ee}"`;return G.nestedIn.reduce((ee,H)=>{if(H.key===rl.NULL)ee+=`${ee.length?"~and":"@"}(${H.title},gb_null)`;else if(H.column_uidt===ve.Checkbox)ee+=`${ee.length?"~and":"@"}(${H.title},${H.key===rl.TRUE?"checked":"notchecked"})`;else if([ve.Date,ve.DateTime,ve.CreatedTime,ve.LastModifiedTime].includes(H.column_uidt))ee+=`${ee.length?"~and":"@"}(${H.title},gb_eq,exactDate,${ne(H.key)})`;else if([ve.User,ve.CreatedBy,ve.LastModifiedBy].includes(H.column_uidt))try{const Ce=JSON.parse(H.key);ee+=`${ee.length?"~and":"@"}(${H.title},gb_eq,${ne((Array.isArray(Ce)?Ce:[Ce]).map(Ie=>Ie.id).join(","))})`}catch(Ce){console.error(Ce)}else ee+=`${ee.length?"~and":"@"}(${H.title},gb_eq,${ne(H.key)})`;return ee},pe)}function ye(G,pe=[]){var ne;return(ne=G==null?void 0:G.nestedIn)!=null&&ne.length?G.nestedIn.reduce((be,ee)=>{if(ee.key===rl.NULL)be.push({fk_column_id:ee.column_id,comparison_op:"gb_null"});else if(ee.column_uidt===ve.Checkbox)be.push({fk_column_id:ee.column_id,comparison_op:ee.key===rl.TRUE?"checked":"notchecked"});else if([ve.Date,ve.DateTime,ve.CreatedTime,ve.LastModifiedTime].includes(ee.column_uidt))be.push({fk_column_id:ee.column_id,comparison_op:"gb_eq",comparison_sub_op:"exactDate",value:ee.key});else if([ve.User,ve.CreatedBy,ve.LastModifiedBy].includes(ee.column_uidt))try{const H=JSON.parse(ee.key);be.push({fk_column_id:ee.column_id,comparison_op:"gb_eq",value:(Array.isArray(H)?H:[H]).map(Ce=>Ce.id).join(",")})}catch(H){console.error(H)}else be.push({fk_column_id:ee.column_id,comparison_op:"gb_eq",value:ee.key});return be??[]},pe):pe}function re(G){var pe;return((pe=G.nestedIn)==null?void 0:pe.length)||0}const me=async(G,pe,ne,be=!1)=>{const ee=A(G),H=A(pe),Ce=ne?ne.chunkStates:M.value,Ie=Array.from({length:H-ee+1},(Q,ie)=>ee+ie).filter(Q=>!Ce[Q]||be);if(await Promise.all(Ie.map(Q=>ae(Q,ne,be))),l==null||l.syncVisibleData(),be){let Q=!1;for(let ie=G;ie<=pe;ie++){const Me=F.value.get(ie);(Me==null?void 0:Me.count)===0&&(Q=!0),Q&&F.value.delete(ie)}}await Promise.all(Ie.map(Q=>ae(Q,ne,be)))},W=(G,pe,ne)=>{if(G===Number.NEGATIVE_INFINITY&&pe===Number.POSITIVE_INFINITY){F.value=new Map,M.value=[];return}const be=ne?ne.groups:F.value;if(be.size<=_2)return;const ee=Math.max(0,G),H=Math.min((ne?ne.count:I.value)-1,pe),Ce=new Map;for(let Ie=ee;Ie<=H;Ie++){const Q=be.get(Ie);Q&&Ce.set(Ie,Q)}ne?(ne.groups=Ce,ne.chunkStates=ne.chunkStates.map((Ie,Q)=>Q>=A(ee)&&Q<=A(H)?Ie:void 0)):(F.value=Ce,M.value=M.value.map((Ie,Q)=>Q>=A(ee)&&Q<=A(H)?Ie:void 0))};async function U(G){var pe,ne,be,ee;if(!(!t.value||!((ne=(pe=n.value)==null?void 0:pe.columns)!=null&&ne.length)))if(G){const H=(ee=D.value)==null?void 0:ee[G.nestedIn.length];if(!H)return;const Ce=ye(G)??[];G.groupCount=w.value?await s.public.dataGroupByCount(y.value.uuid,{where:o==null?void 0:o.value,column_name:H.column.title,filterArrJson:JSON.stringify([...v.value||[],...Ce])},{headers:{"xc-password":m.value}}):await s.dbViewRow.groupByCount("noco",r.value.id,t.value.fk_model_id,t.value.id,{where:o==null?void 0:o.value,column_name:H.column.title,filterArrJson:JSON.stringify(Ce)})}else{const H=(be=D.value)==null?void 0:be[0];if(!H)return;I.value=w.value?await s.public.dataGroupByCount(y.value.uuid,{where:o==null?void 0:o.value,column_name:H.column.title,filterArrJson:JSON.stringify(v.value)},{headers:{"xc-password":m.value}}):await s.dbViewRow.groupByCount("noco",r.value.id,t.value.fk_model_id,t.value.id,{where:o==null?void 0:o.value,column_name:H.column.title})}}async function Ae(G,pe){var Ce;if(!((Ce=f.value)!=null&&Ce.ee))return;const ne=100,be=new gc,ee=pe?pe.map(Ie=>{const Q=k.value[Ie.title];return Q?{field:Q.fk_column_id,type:Ie.aggregation??Q.aggregation??Wa.None}:null}).filter(Boolean):Object.values(a.value).map(Ie=>({field:Ie.fk_column_id,type:Ie.aggregation??Wa.None})).filter(Ie=>Ie.type!==Wa.None);if(!ee.length)return;const H=new Map;pe&&pe.forEach(Ie=>{const Q=k.value[Ie.title];Q!=null&&Q.fk_column_id&&H.set(Q.fk_column_id,Ie.aggregation??Q.aggregation??Wa.None)});for(let Ie=0;Ie<G.length;Ie+=ne){const Q=G.slice(Ie,Ie+ne),ie=Q.map(Me=>({where:o==null?void 0:o.value,alias:be.generateAlias(ef(Me)),filterArrJson:JSON.stringify([...v.value||[],...ye(Me)])}));try{const Me=w.value?await g({aggregation:ee,filterArrJson:JSON.stringify(v.value)},ie):await s.dbDataTableBulkAggregate.dbDataTableBulkAggregate(n.value.id,{viewId:t.value.id,aggregation:ee,filterArrJson:JSON.stringify(v.value)},ie);await be.process(Me,(Be,it)=>{const Ge=Q.find(ze=>ef(ze)===Be.toString());Ge&&(Object.keys(it).forEach(ze=>{const Z=k.value[ze],Et=S.value[Z.fk_column_id],_e=H.get(Z.fk_column_id)??Z.aggregation;it[ze]=Vu(_e,it[ze],Et,[Be.toString()],{col:Et,meta:n.value,metas:c.value,isMysql:i.isMysql,isPg:i.isPg})??""}),Object.assign(Ge.aggregations,it))})}catch(Me){console.error("Error refreshing group aggregations batch:",Me)}}l==null||l.syncVisibleData()}const je=async G=>{G.isExpanded=!G.isExpanded;const pe=G.nestedIn.map(ne=>`${ne.key}-${ne.column_name}`).join("_")||"default";if(G.isExpanded)C.value.includes(pe)||C.value.push(pe);else{const ne=C.value.indexOf(pe);ne!==-1&&C.value.splice(ne,1)}},Ue=async(G,pe)=>{let ne;if(G!=null&&G.length||(G=[0]),G.length===1)ne=F.value;else{let be=F.value;for(let ee=0;ee<G.length-1;ee++){const H=be.get(G[ee]);if(!H||!H.groups)return;be=H.groups}ne=be}ne.forEach(be=>{const ee=be.nestedIn.map(H=>`${H.key}-${H.column_name}`).join("_")||"default";if(be.isExpanded=pe,pe)C.value.includes(ee)||C.value.push(ee);else{const H=C.value.indexOf(ee);H!==-1&&C.value.splice(H,1)}}),l==null||l.syncVisibleData()};return{isGroupBy:ue(()=>!!D.value.length),cachedGroups:F,groupByColumns:D,totalGroups:I,chunkStates:M,syncCount:U,fetchMissingGroupChunks:me,clearGroupCache:W,toggleExpand:je,GROUP_CHUNK_SIZE:Jr,buildNestedWhere:he,buildNestedFilterArr:ye,CHUNK_SIZE:50,columnsById:S,gridViewColByTitle:k,updateGroupAggregations:Ae,toggleExpandAll:Ue}};function k2(t,n,o,l){const a=Jh(),{activeTable:i}=Uo(a),r=dn(Ea,jo()),s=ue(()=>t.value||i.value),{t:u}=la(),c=Qh("optimisedQuery",()=>!0),f=dn(zl,V(!1)),{getMeta:v}=ai(),p=dn(Ku),{addUndo:g,clone:y,defineViewScope:x}=Mi(),{base:w}=Uo(Ca()),{$api:m}=ua(),{appInfo:C}=tl(),b=V(!1),{cachedGroups:S,totalGroups:k,toggleExpand:D,groupByColumns:F,isGroupBy:I,buildNestedFilterArr:M,clearGroupCache:A,syncCount:j,fetchMissingGroupChunks:N,updateGroupAggregations:Y,toggleExpandAll:ae}=x2(n,s,o,{syncVisibleData:wt}),{insertRow:he,updateRowProperty:ye,addEmptyRow:re,deleteRow:me,deleteRowById:W,updateOrSaveRow:U,cachedRows:Ae,clearCache:je,totalRows:Ue,actualTotalRows:ot,bulkUpdateView:G,removeRowIfNew:pe,syncCount:ne,fetchChunk:be,recoverLTARRefs:ee,getChunkIndex:H,selectedRows:Ce,chunkStates:Ie,isRowSortRequiredRows:Q,clearInvalidRows:ie,applySorting:Me,CHUNK_SIZE:Be,isLastRow:it,isFirstRow:Ge,getExpandedRowIndex:ze,loadData:Z,updateRecordOrder:Et,selectedAllRecords:_e,loadAggCommentsCount:yn,navigateToSiblingRow:It,getRows:$t,getDataCache:et,groupDataCache:cn}=jm({meta:s,viewMeta:n,callbacks:{syncVisibleData:wt,getCount:Kt,getWhereFilter:async nt=>(o==null?void 0:o.value)??"",getWhereFilterArr:nn,reloadAggregate:Pn,findGroupByPath:nt=>_a(S.value,nt)},groupByColumns:F,where:o,isPublic:f});function Pn(nt){var yt;const{fields:rt,path:st}=nt;if(p==null||p.trigger(nt),!I.value||!((yt=C.value)!=null&&yt.ee))return;function lt(Qe){const d=[Qe];if(Qe.groups&&Qe.groups.size>0)for(const _ of Qe.groups.values())d.push(...lt(_));return d}const xt=_a(S.value,st);if(!xt)return;const Ot=lt(xt);if(Y(Ot,rt),st.length>1)for(let Qe=st.length-1;Qe>0;Qe--){const d=st.slice(0,Qe),_=_a(S.value,d);if(_){const O=lt(_);Y(O,rt)}}}p==null||p.on((nt={})=>{const{path:rt,fields:st}=nt;if(!(rt!=null&&rt.length)&&I.value){let lt=function(Ot){const yt=Array.from(Ot.values());xt.push(...yt);for(const Qe of yt)Qe.groups&&Qe.groups.size>0&&lt(Qe.groups)};const xt=[];lt(S.value),xt.length&&Y(xt,st)}});function Kt(nt){if(!(nt!=null&&nt.length))return;let rt=S.value;const st=[...nt];for(let Ot=0;Ot<nt.length-1;Ot++){const yt=st[Ot],Qe=rt.get(yt);if(!Qe||!Qe.groups){console.warn(`Invalid path: Group at index ${yt} not found or has no subgroups`);return}rt=Qe.groups}const lt=st[nt.length-1],xt=rt.get(lt);if(!xt){console.warn(`Target group at path [${nt}] not found`);return}return xt.count}async function nn(nt=[],rt=!1){let st=_a(S.value,nt);if(!st)try{let lt=S.value,xt,Ot;for(let yt=0;yt<nt.length;yt++){const Qe=nt[yt],d=lt.get(Qe);if(!d){Ot=Qe;break}if(yt===nt.length-1){Ot=Qe;break}if(!d.isExpanded||!d.groups)return[];xt=d,lt=d.groups}Ot!==void 0&&await N(Ot,Ot,xt),st=_a(S.value,nt)}catch(lt){return console.error(`Failed to load group for path ${nt}:`,lt),[]}return M(st)}function wt(){l==null||l.trigger()}async function Dn(nt=[]){var xt,Ot,yt,Qe;let rt=[],st="";b.value=!0;const lt=et(nt);for(const d of lt.selectedRows.value){const{row:_,rowMeta:O}=d;if(!O.selected||O.new)continue;const T=hc((xt=s==null?void 0:s.value)==null?void 0:xt.columns),se=Ht(_,(Ot=s==null?void 0:s.value)==null?void 0:Ot.columns),q=Bi(_,(yt=s==null?void 0:s.value)==null?void 0:yt.columns);T&&se&&(st||(st=T),rt.push({[st]:se,pkData:q,row:y(_),rowMeta:O}))}if(rt.length){try{const{list:d}=await m.dbTableRow.list(wa,w==null?void 0:w.value.id,(Qe=s.value)==null?void 0:Qe.id,{pks:rt.map(_=>_[st]).join(","),getHiddenColumns:!0,limit:rt.length});rt=rt.map(_=>{var q;const O=_.row,T=Bi(O,(q=s.value)==null?void 0:q.columns),se=d.find(L=>Object.keys(T).every(te=>L[te]===T[te]));return se?{..._,row:{...se}}:{..._}}),await Rt(rt.map(_=>_.pkData))}catch(d){const _=await hl(d);return b.value=!1,Zt.error(`${u("msg.error.deleteRowFailed")}: ${_}`)}await mt(rt,!1,nt),g({undo:{fn:async(d,_)=>{const O=d.reverse(),T=await un(O,void 0,!0,_);Array.isArray(T)&&await Promise.all(O.map((se,q)=>ee(se.row)))},args:[rt,y(nt)]},redo:{fn:async(d,_)=>{try{b.value=!0,await Rt(d.map(O=>O.pkData)),await mt(d,!1,_),await ne(_)}finally{b.value=!1}},args:[rt,y(nt)]},scope:x({view:n.value})}),b.value=!1,await ne(nt)}}async function un(nt,{metaValue:rt=s.value,viewMetaValue:st=n.value}={},lt=!1,xt=[]){var Qe;if(!rt||!st)throw new Error("Meta value or view meta value is undefined");const Ot=et(xt);b.value=!0;const yt=new Set((Qe=rt.columns)==null?void 0:Qe.filter(d=>!d.pk&&(Eu(d)||Ds(d))).map(d=>d.title));try{const _=(await Promise.all(nt.map(async q=>{const{missingRequiredColumns:L,insertObj:te}=await ev({meta:rt,ltarState:{},getMeta:v,row:q.row,undo:lt});if(L.size===0){const we={...te};for(const oe of yt)delete we[oe];return{insertObj:we,rowIndex:q.rowMeta.rowIndex}}return null}))).filter(Boolean),O=await m.dbDataTableRow.create(rt.id,_.map(q=>q.insertObj),{viewId:st.id,undo:lt});_.sort((q,L)=>(q.rowIndex??0)-(L.rowIndex??0));const T=new Map;for(const[q,L]of Ot.cachedRows.value)T.set(q,{...L,rowMeta:{...L.rowMeta,rowIndex:q}});for(const{insertObj:q,rowIndex:L}of _){if(T.has(L)){const we=Array.from(T.entries()).filter(([oe])=>oe>=L).sort((oe,Ee)=>Ee[0]-oe[0]);for(const[oe,Ee]of we){const Ne=oe+1;T.set(Ne,{...Ee,rowMeta:{...Ee.rowMeta,rowIndex:Ne}})}}const te={row:{...q,id:O[_.indexOf({insertObj:q,rowIndex:L})]},oldRow:{},rowMeta:{rowIndex:L,new:!1,path:xt}};T.set(L,te)}const se=new Set;for(const[q,L]of T){if(se.has(L.rowMeta.rowIndex)){console.error(`Op: bulkInsertRows ${lt}:  Duplicate index detected:`,L.rowMeta.rowIndex);break}se.add(L.rowMeta.rowIndex)}return Ot.cachedRows.value=T,Ot.totalRows.value+=_.length,await ne(xt),wt(),O}catch(d){const _=await hl(d);throw Zt.error(`Failed to bulk insert rows: ${_}`),d}finally{b.value=!1}}async function Bn(nt,rt,{metaValue:st=s.value}={},lt=!1,xt=[]){b.value=!0;const Ot=et(xt);await Promise.all(nt.map(async d=>{d.rowMeta&&(d.rowMeta.changed=!1,await ka(()=>{var _,O;return!((_=d.rowMeta)!=null&&_.new&&((O=d.rowMeta)!=null&&O.saving))}).toMatch(_=>_),d.rowMeta.saving=!0)}));const yt=[],Qe=nt.map(d=>{const _=Bi(d.row,st==null?void 0:st.columns),O=rt.reduce((T,se)=>({...T,[se]:d.row[se]}),{});return yt.push({pk:Ht(d.row,st==null?void 0:st.columns),rowIndex:d.rowMeta.rowIndex}),{...O,..._}});try{const d=await m.dbTableRow.bulkUpdate(wa,st==null?void 0:st.base_id,st==null?void 0:st.id,Qe);Pn({fields:rt.map(_=>({title:_})),path:xt}),d.forEach(_=>{var se;const O=Ht(_,st==null?void 0:st.columns),T=(se=yt.find(q=>q.pk===O))==null?void 0:se.rowIndex;if(T!=null){const q=Ot.cachedRows.value.get(T);q&&(q.rowMeta.saving=!1,q.row={...q.row,..._},Ot.cachedRows.value.set(T,q))}})}catch(d){console.error(d),Zt.error(await hl(d)),b.value=!1;return}finally{nt.forEach(d=>{d.rowMeta&&(d.rowMeta.saving=!1)})}lt||g({undo:{fn:async(d,_,O)=>{await Bn(d.map(T=>({...T,row:T.oldRow,oldRow:T.row})),_,void 0,!0,O)},args:[y(nt),rt,y(xt)]},redo:{fn:async(d,_,O)=>{await Bn(d,_,void 0,!0,O)},args:[y(nt),rt,y(xt)]},scope:x({view:n.value})}),Me(nt),wt(),r==null||r.trigger(),b.value=!1}async function tt(nt,rt,st,{metaValue:lt=s.value,viewMetaValue:xt=n.value}={},Ot,yt=!1,Qe=[]){var _;const d=et(Qe);try{b.value=!0;const O=(s.value.columns??[]).filter(He=>Ot.some(Ze=>Ze.title===He.title)),T=rt.filter(He=>!d.cachedRows.value.has(He.rowMeta.rowIndex)),se=new Set(T.map(He=>Math.floor(He.rowMeta.rowIndex/Be)));await Promise.all(Array.from(se).map(He=>be(He,Qe)));const q=He=>Ht(He.row,lt==null?void 0:lt.columns),L=rt.map(He=>{const Ze=He??d.cachedRows.value.get(He.rowMeta.rowIndex);return O.forEach(Ke=>{Ze.oldRow[Ke.title]=void 0}),y(Ze)}),te=He=>{var Ke;const Ze={...He};return(Ke=lt==null?void 0:lt.columns)==null||Ke.forEach(ft=>{(ft.system||_o(ft))&&delete Ze[ft.title]}),Ze};rt=rt.map(He=>{const Ze=d.cachedRows.value.get(He.rowMeta.rowIndex);return Ze?{...Ze,row:{...Ze.row,...He.row},oldRow:Ze.row}:He});const we=await m.dbTableRow.bulkUpsert(wa,(lt==null?void 0:lt.base_id)??((_=w.value)==null?void 0:_.id),lt==null?void 0:lt.id,[...nt.map(He=>te(He.row)),...rt.map(He=>te(He.row))],{}),oe=new Set(Array.from(d.cachedRows.value.values()).map(He=>q(He))),[Ee,Ne]=we.reduce(([He,Ze],Ke)=>oe.has(Ht(Ke,lt==null?void 0:lt.columns))?[He,[...Ze,{row:Ke,rowMeta:{},oldRow:Ke}]]:[[...He,{row:Ke,rowMeta:{},oldRow:{}}],Ze],[[],[]]);Ee.forEach((He,Ze)=>{const Ke=d.totalRows.value+Ze;He.rowMeta.rowIndex=Ke,d.cachedRows.value.set(Ke,{...He,rowMeta:{...He.rowMeta,rowIndex:Ke}})}),Ne.forEach(He=>{const Ze=Array.from(d.cachedRows.value.entries()).find(([Ke,ft])=>q(ft)===q(He));Ze&&d.cachedRows.value.set(Ze[0],{...He,rowMeta:{...He.rowMeta,rowIndex:Ze[0]}})}),d.totalRows.value+=Ee.length,yt||g({undo:{fn:async(He,Ze,Ke)=>{var ft,Ye,qe;try{b.value=!0,await Rt(He.map(zt=>Bi(zt.row,lt==null?void 0:lt.columns))),await Bn(Ze.map(zt=>({...zt,row:zt.oldRow,oldRow:zt.row})),st,{metaValue:lt},!0,Ke),b.value=!0;const ht=(await m.dbTableColumn.hash((ft=s.value)==null?void 0:ft.id)).hash;await m.dbTableColumn.bulk((Ye=s.value)==null?void 0:Ye.id,{hash:ht,ops:O.map(zt=>({op:"delete",column:zt}))}),He.forEach(zt=>{d.cachedRows.value.delete(zt.rowMeta.rowIndex)}),d.totalRows.value=d.totalRows.value-He.length,wt(),await v((qe=s.value)==null?void 0:qe.id,!0)}catch{}finally{b.value=!1}},args:[y(Ee),y(L),y(Qe)]},redo:{fn:async(He,Ze,Ke)=>{var ft,Ye,qe;try{b.value=!0;const ht=(await m.dbTableColumn.hash((ft=s.value)==null?void 0:ft.id)).hash;await m.dbTableColumn.bulk((Ye=s.value)==null?void 0:Ye.id,{hash:ht,ops:O.map(zt=>({op:"add",column:zt}))}),await tt(He,Ze,st,{metaValue:lt,viewMetaValue:xt},Ot,!0,Ke),b.value=!0,await v((qe=s.value)==null?void 0:qe.id,!0),wt()}finally{b.value=!1}},args:[y(Ee),y(Ne),y(Qe)]},scope:x({view:n.value})}),r==null||r.trigger(),wt(),await ne(Qe)}catch(O){Zt.error(await hl(O))}finally{b.value=!1}}async function mt(nt,rt=!0,st=[]){const lt=et(st),xt=Math.max(...lt.cachedRows.value.keys()),Ot=new Map,yt=new Set(nt.map(T=>(rt?T.row:T).rowMeta.rowIndex)),Qe=new Set;let d=0;for(let T=0;T<=xt+1;T++){if(yt.has(T)){d++,Qe.add(H(T));continue}if(lt.cachedRows.value.has(T)){const se=lt.cachedRows.value.get(T);if(se){const q=T-d;se.rowMeta.rowIndex=q,Ot.set(q,se),Qe.add(H(T)),Qe.add(H(q))}}}const _=new Map;for(const[T,se]of Ot){const q=H(se.rowMeta.rowIndex);_.set(q,(_.get(q)||0)+1)}for(const T of Qe)(!_.has(T)||_.get(T)<Be)&&(lt.chunkStates.value[T]=void 0);const O=new Set;for(const[T,se]of Ot){if(O.has(se.rowMeta.rowIndex)){console.error("Op: updateCacheAfterDelete: Duplicate index detected:",se.rowMeta.rowIndex);break}O.add(se.rowMeta.rowIndex)}lt.cachedRows.value=Ot,lt.totalRows.value=Math.max(0,lt.totalRows.value-nt.length),await ne(st),wt()}async function Dt(nt,rt=[]){var d,_,O,T;if(!nt._start||!nt._end)return;b.value=!0;const st=et(rt),lt=Math.min(nt._start.row,nt._end.row),xt=Math.max(nt._start.row,nt._end.row);let Ot=[],yt="";await $t(lt,xt,rt);for(let se=lt;se<=xt;se++){const q=st.cachedRows.value.get(se);if(!q){console.warn(`Record at index ${se} not found in local cache`);continue}const{row:L,rowMeta:te}=q;if(!te.new){const we=hc((d=s==null?void 0:s.value)==null?void 0:d.columns),oe=Ht(L,(_=s==null?void 0:s.value)==null?void 0:_.columns),Ee=Bi(L,(O=s==null?void 0:s.value)==null?void 0:O.columns);we&&oe&&(yt||(yt=we),Ot.push({[yt]:oe,pkData:Ee,...q,rowIndex:se}))}}if(!Ot.length)return;const{list:Qe}=await m.dbTableRow.list(wa,w==null?void 0:w.value.id,(T=s.value)==null?void 0:T.id,{pks:Ot.map(se=>se[yt]).join(","),getHiddenColumns:"true",limit:Ot.length});try{Ot=Ot.map(se=>{var we;const q=se.row,L=Bi(q,(we=s.value)==null?void 0:we.columns),te=Qe.find(oe=>Object.keys(L).every(Ee=>oe[Ee]===L[Ee]));return te?(se.row=te,se):(console.warn(`Full record not found for row with index ${se.rowMeta.rowIndex}`),se)}),await Rt(Ot.map(se=>se.pkData))}catch(se){const q=await hl(se);throw Zt.error(`${u("msg.error.deleteRowFailed")}: ${q}`),b.value=!1,se}g({undo:{fn:async(se,q)=>{const L=se.reverse(),te=await un(L,void 0,!0,q);Array.isArray(te)&&await Promise.all(L.map((we,oe)=>ee(we.row)))},args:[Ot,y(rt)]},redo:{fn:async(se,q)=>{await Rt(se.map(L=>L.pkData)),await mt(se,!1,q)},args:[Ot,y(rt)]},scope:x({view:n.value})}),await mt(Ot,!1,rt),b.value=!1}async function Rt(nt,{metaValue:rt=s.value,viewMetaValue:st=n.value}={}){try{const lt=await m.dbDataTableRow.delete(rt==null?void 0:rt.id,nt.length===1?nt[0]:nt,{viewId:st==null?void 0:st.id});return Pn({path:[]}),nt.length===1&&lt?[lt]:lt}catch(lt){const xt=await hl(lt);Zt.error(`Bulk delete failed: ${xt}`)}}async function ct(nt=[]){var rt;try{b.value=!0,await m.dbTableRow.bulkDeleteAll("noco",w.value.id,s.value.id,{where:o==null?void 0:o.value,viewId:(rt=n.value)==null?void 0:rt.id})}catch{}finally{je(Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,nt),await ne(nt),wt==null||wt(),b.value=!1}}return{cachedRows:Ae,loadData:Z,insertRow:he,updateRowProperty:ye,addEmptyRow:re,deleteRow:me,deleteRowById:W,deleteSelectedRows:Dn,deleteRangeOfRows:Dt,updateOrSaveRow:U,bulkUpdateRows:Bn,bulkUpsertRows:tt,bulkUpdateView:G,bulkDeleteAll:ct,loadAggCommentsCount:yn,syncCount:ne,removeRowIfNew:pe,navigateToSiblingRow:It,getExpandedRowIndex:ze,optimisedQuery:c,isLastRow:it,isFirstRow:Ge,clearCache:je,totalRows:Ue,actualTotalRows:ot,selectedRows:Ce,syncVisibleData:wt,chunkStates:Ie,clearInvalidRows:ie,applySorting:Me,isRowSortRequiredRows:Q,isBulkOperationInProgress:b,updateRecordOrder:Et,selectedAllRecords:_e,getRows:$t,getDataCache:et,groupDataCache:cn,cachedGroups:S,totalGroups:k,toggleExpand:D,groupByColumns:F,isGroupBy:I,groupSyncCount:j,fetchMissingGroupChunks:N,clearGroupCache:A,toggleExpandAll:ae}}const C2=ko(()=>Co(()=>Promise.resolve().then(()=>cv),void 0,import.meta.url).then(t=>t.default||t)),R2=ko(()=>Co(()=>import("./8cIDi64c.js"),__vite__mapDeps([113,1,2]),import.meta.url).then(t=>t.default||t)),S2=xo({__name:"index",setup(t,{expose:n}){const o=dn(Ti,V()),l=dn(ds,V()),a=dn(Ea,jo()),i=cs(),r=i.currentRoute,{xWhere:s,eventBus:u,isExternalSource:c}=Fl(),{t:f}=la(),{isFeatureEnabled:v}=Zh(),{blockExternalSourceRecordVisibility:p,showUpgradeToSeeMoreRecordsModal:g}=ql(),y=V(!1),x=ue(()=>r.value.query),w=V(),m=V(!1),C=V(),b=V(),S=jo();wo(Js,S);const k=V();pb(l,o,s,S);const{loadData:D,updateOrSaveRow:F,addEmptyRow:I,deleteRow:M,deleteSelectedRows:A,cachedRows:j,clearCache:N,removeRowIfNew:Y,navigateToSiblingRow:ae,deleteRangeOfRows:he,bulkUpdateRows:ye,bulkUpsertRows:re,syncCount:me,totalRows:W,actualTotalRows:U,syncVisibleData:Ae,optimisedQuery:je,isLastRow:Ue,isFirstRow:ot,chunkStates:G,updateRecordOrder:pe,clearInvalidRows:ne,isRowSortRequiredRows:be,applySorting:ee,isBulkOperationInProgress:H,selectedAllRecords:Ce,bulkDeleteAll:Ie,getRows:Q,getDataCache:ie,cachedGroups:Me,groupByColumns:Be,groupSyncCount:it,fetchMissingGroupChunks:Ge,toggleExpand:ze,totalGroups:Z,clearGroupCache:Et,toggleExpandAll:_e,groupDataCache:yn}=k2(o,l,s,S),It=ue(()=>{var bt;const Re=(bt=l.value)==null?void 0:bt.view;if((Re==null?void 0:Re.row_height)!==void 0)switch(Re==null?void 0:Re.row_height){case 0:return 1;case 1:return 2;case 2:return 4;case 3:return 6;default:return 1}});wo(em,V(!1)),wo(tm,V(!1)),wo(nm,V(!0)),wo(om,V(!1)),wo(lm,It);const $t=dn(zl,V(!1));wo(rr,a);const et=V(!1);function cn(Re,bt,_t=!1,Xe=[]){var Yt;const tn=Ht(Re.row,(Yt=o.value)==null?void 0:Yt.columns);if(b.value=bt,tn&&!$t.value){C.value=void 0;const en={query:{...x.value,rowId:tn,path:Xe.join("-"),expand:void 0}};x.value.expand?i.replace(en):i.push(en)}else C.value=Re,m.value=!0,et.value=!_t}n({loadData:D,openColumnCreate:Re=>{var bt;(bt=k.value)==null||bt.openColumnCreate(Re)}});const Kt=ue({get(){return!!x.value.rowId},set(Re){Re||i.push({query:{...x.value,path:void 0,rowId:void 0}})}}),nn=Re=>{et.value||u.emit(qo.CLEAR_NEW_ROW,Re)},wt=()=>{je.value?(je.value=!1,Zt.info(f("msg.optimizedQueryDisabled"))):(je.value=!0,Zt.info(f("msg.optimizedQueryEnabled")))},Dn=iv(),{windowSize:un,leftSidebarWidth:Bn}=xr(Dn),tt=V(0);u.on(Re=>{(Re===qo.GROUP_BY_RELOAD||Re===qo.DATA_RELOAD)&&(a==null||a.trigger())});const mt=()=>{ae(Gl.NEXT)},Dt=()=>{ae(Gl.PREV)},Rt=()=>{if($t.value){tt.value=un.value;return}tt.value=un.value-Bn.value},ct=ue(()=>v(fu.INFINITE_SCROLLING)),nt=ue(()=>v(fu.CANVAS_GRID_VIEW)),rt=ue(()=>v(fu.CANVAS_GROUP_GRID_VIEW)&&!p(c.value));Gn([un,Bn],Rt),oi(()=>{Rt()});const{selectedAllRecords:st,formattedData:lt,paginationData:xt,loadData:Ot,changePage:yt,aggCommentCount:Qe,addEmptyRow:d,deleteRow:_,updateOrSaveRow:O,deleteSelectedRows:T,deleteRangeOfRows:se,bulkUpdateRows:q,removeRowIfNew:L,isFirstRow:te,islastRow:we,getExpandedRowIndex:oe,navigateToSiblingRow:Ee}=Wm(o,l,s),{isGroupBy:Ne,rootGroup:He,loadGroupData:Ze,loadGroups:Ke,loadGroupPage:ft,groupWrapperChangePage:Ye,loadGroupAggregation:qe,groupBy:ht,redistributeRows:zt,loadDisallowedLookups:Le}=Lm(),Se=ue(()=>{switch(ht.value.length){case 1:return"#F9F9FA";case 2:return"#F4F4F5";case 3:return"#E7E7E9";default:return"#F9F9FA"}}),Mt=Re=>{var bt;if(x.value.rowId)if(ct.value){const _t=(bt=Array.from(j.value.values()).find(tn=>Ht(tn.row,o.value.columns)===x.value.rowId))==null?void 0:bt.rowMeta.rowIndex;if(_t===void 0)return;const Xe=j.value.get(_t);if(!Xe)return;Xe.rowMeta.commentCount=Re,Ae==null||Ae()}else{const _t=Qe.value.findIndex(tn=>tn.row_id===x.value.rowId),Xe=lt.value.findIndex(tn=>{var Yt;return Ht(tn.row,(Yt=o.value)==null?void 0:Yt.columns)===x.value.rowId});if(Xe===-1)return;if(_t===-1){Qe.value.push({row_id:x.value.rowId,count:Re}),lt.value[Xe].rowMeta.commentCount=Re;return}if(Number(Qe.value[_t].count)===Re)return;Qe.value[_t].count=Re,lt.value[Xe].rowMeta.commentCount=Re}},xe=(Re,bt)=>{var _t;if((((_t=xt.value)==null?void 0:_t.pageSize)??25)*Re>100&&g({isExternalSource:c.value}))return!0;bt==null||bt()},Pe=()=>{var bt,_t,Xe,tn;const Re=oe();if(!xt.value.isLastPage&&Re===(xt.value.pageSize??25)-1&&xe((bt=xt.value)!=null&&bt.page?((_t=xt.value)==null?void 0:_t.page)+1:1)){(tn=(Xe=w.value)==null?void 0:Xe.stopLoading)==null||tn.call(Xe);return}Ee(Gl.NEXT)},gt=()=>{Ee(Gl.PREV)},X=V([]),Fe=ue(()=>{const Re=ie(X.value);return Re==null?void 0:Re.selectedRows.value}),vt=Re=>{X.value=Re,y.value=!0};return Gn([()=>{var Re;return(Re=l.value)==null?void 0:Re.id},()=>{var Re;return(Re=o.value)==null?void 0:Re.columns}],async()=>{await Le()}),(Re,bt)=>{var Yt;const _t=C2,Xe=sd,tn=R2;return h(),B("div",{class:"relative flex flex-col h-full min-h-0 w-full nc-grid-wrapper","data-testid":"nc-grid-wrapper",style:Xn(`background-color: ${e(Ne)&&!e(rt)?`${e(Se)}`:"var(--nc-grid-bg)"};`)},[!e(Ne)&&!e(ct)?(h(),J(cd,{key:0,ref_key:"tableRef",ref:k,"selected-all-records":e(st),"onUpdate:selectedAllRecords":bt[0]||(bt[0]=en=>yo(st)?st.value=en:null),data:e(lt),"pagination-data":e(xt),"load-data":e(Ot),"change-page":en=>xe(en,()=>e(yt)(en)),"call-add-empty-row":e(d),"delete-row":e(_),"update-or-save-row":e(O),"delete-selected-rows":e(T),"delete-range-of-rows":e(se),"bulk-update-rows":e(q),"expand-form":cn,"remove-row-if-new":e(L),"row-height-enum":e(It),onToggleOptimisedQuery:wt,onBulkUpdateDlg:bt[1]||(bt[1]=en=>y.value=!0)},null,8,["selected-all-records","data","pagination-data","load-data","change-page","call-add-empty-row","delete-row","update-or-save-row","delete-selected-rows","delete-range-of-rows","bulk-update-rows","remove-row-if-new","row-height-enum"])):e(ct)&&(e(nt)&&!e(Ne)||e(rt)&&e(Ne))?(h(),J(QC,{key:1,ref_key:"tableRef",ref:k,"selected-all-records":e(Ce),"onUpdate:selectedAllRecords":bt[2]||(bt[2]=en=>yo(Ce)?Ce.value=en:null),"load-data":e(D),"call-add-empty-row":e(I),"delete-row":e(M),"update-or-save-row":e(F),"delete-selected-rows":e(A),"delete-range-of-rows":e(he),"apply-sorting":e(ee),"bulk-update-rows":e(ye),"bulk-upsert-rows":e(re),"update-record-order":e(pe),"bulk-delete-all":e(Ie),"clear-cache":e(N),"clear-invalid-rows":e(ne),data:e(j),"total-rows":e(W),"actual-total-rows":e(U),"sync-count":e(me),"get-rows":e(Q),"chunk-states":e(G),"expand-form":cn,"remove-row-if-new":e(Y),"row-height-enum":e(It),"selected-rows":e(Fe),"row-sort-required-rows":e(be),"total-groups":e(Z),"get-data-cache":e(ie),"cached-groups":e(Me),"group-by-columns":e(Be),"group-data-cache":e(yn),"clear-group-cache":e(Et),"toggle-expand":e(ze),"group-sync-count":e(it),"fetch-missing-group-chunks":e(Ge),"is-bulk-operation-in-progress":e(H),"toggle-expand-all":e(_e),onToggleOptimisedQuery:wt,onBulkUpdateDlg:vt},null,8,["selected-all-records","load-data","call-add-empty-row","delete-row","update-or-save-row","delete-selected-rows","delete-range-of-rows","apply-sorting","bulk-update-rows","bulk-upsert-rows","update-record-order","bulk-delete-all","clear-cache","clear-invalid-rows","data","total-rows","actual-total-rows","sync-count","get-rows","chunk-states","remove-row-if-new","row-height-enum","selected-rows","row-sort-required-rows","total-groups","get-data-cache","cached-groups","group-by-columns","group-data-cache","clear-group-cache","toggle-expand","group-sync-count","fetch-missing-group-chunks","is-bulk-operation-in-progress","toggle-expand-all"])):e(Ne)?(h(),J(ep,{key:3,group:e(He),"load-groups":e(Ke),"load-group-data":e(Ze),"call-add-empty-row":e(d),"expand-form":cn,"load-group-page":e(ft),"group-wrapper-change-page":e(Ye),"row-height":e(It),"load-group-aggregation":e(qe),"max-depth":e(ht).length,"redistribute-rows":e(zt),"view-width":e(tt)},null,8,["group","load-groups","load-group-data","call-add-empty-row","load-group-page","group-wrapper-change-page","row-height","load-group-aggregation","max-depth","redistribute-rows","view-width"])):(h(),J(E1,{key:2,ref_key:"tableRef",ref:k,"selected-all-records":e(Ce),"onUpdate:selectedAllRecords":bt[3]||(bt[3]=en=>yo(Ce)?Ce.value=en:null),"load-data":e(D),"call-add-empty-row":e(I),"delete-row":e(M),"update-or-save-row":e(F),"delete-selected-rows":e(A),"delete-range-of-rows":e(he),"apply-sorting":e(ee),"bulk-update-rows":e(ye),"bulk-upsert-rows":e(re),"get-rows":e(Q),"update-record-order":e(pe),"bulk-delete-all":e(Ie),"clear-cache":e(N),"clear-invalid-rows":e(ne),data:e(j),"total-rows":e(W),"actual-total-rows":e(U),"sync-count":e(me),"chunk-states":e(G),"expand-form":cn,"remove-row-if-new":e(Y),"row-height-enum":e(It),"selected-rows":e(Fe),"row-sort-required-rows":e(be),"is-bulk-operation-in-progress":e(H),onToggleOptimisedQuery:wt,onBulkUpdateDlg:bt[4]||(bt[4]=en=>y.value=!0)},null,8,["selected-all-records","load-data","call-add-empty-row","delete-row","update-or-save-row","delete-selected-rows","delete-range-of-rows","apply-sorting","bulk-update-rows","bulk-upsert-rows","get-rows","update-record-order","bulk-delete-all","clear-cache","clear-invalid-rows","data","total-rows","actual-total-rows","sync-count","chunk-states","remove-row-if-new","row-height-enum","selected-rows","row-sort-required-rows","is-bulk-operation-in-progress"])),(h(),J(Mu,null,{default:K(()=>[e(C)&&e(m)?(h(),J(_t,{key:0,modelValue:e(m),"onUpdate:modelValue":[bt[5]||(bt[5]=en=>yo(m)?m.value=en:null),bt[6]||(bt[6]=en=>nn(e(C)))],"load-row":!e($t),row:e(C),state:e(b),meta:e(o),view:e(l)},null,8,["modelValue","load-row","row","state","meta","view"])):ge("",!0)]),_:1})),e(Kt)&&((Yt=e(o))!=null&&Yt.id)?(h(),J(Xe,{key:4,ref_key:"expandedFormRef",ref:w,modelValue:e(Kt),"onUpdate:modelValue":bt[7]||(bt[7]=en=>yo(Kt)?Kt.value=en:null),row:e(C)??{row:{},oldRow:{},rowMeta:{}},meta:e(o),"load-row":!e($t),state:e(b),"row-id":e(x).rowId,view:e(l),"show-next-prev-icons":"","first-row":e(ct)?e(ot):e(te),"last-row":e(ct)?e(Ue):e(we),"expand-form":cn,onNext:bt[8]||(bt[8]=en=>e(ct)?mt():Pe()),onPrev:bt[9]||(bt[9]=en=>e(ct)?Dt():gt()),onUpdateRowCommentCount:Mt},null,8,["modelValue","row","meta","load-row","state","row-id","view","first-row","last-row"])):ge("",!0),(h(),J(Mu,null,{default:K(()=>[e(y)?(h(),J(tn,{key:0,modelValue:e(y),"onUpdate:modelValue":bt[10]||(bt[10]=en=>yo(y)?y.value=en:null),meta:e(o),view:e(l),path:e(X),"bulk-update-rows":e(ye),rows:e(Fe)},null,8,["modelValue","meta","view","path","bulk-update-rows","rows"])):ge("",!0)]),_:1}))],4)}}}),I2=Object.assign(S2,{__name:"SmartsheetGrid"}),CR=Object.freeze(Object.defineProperty({__proto__:null,default:I2},Symbol.toStringTag,{value:"Module"}));export{fd as R,I2 as _,B1 as a,nu as b,CR as c,Vu as g,cv as i,tu as u};
