const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./BrCOfC5t.js","./DRA9KN5F.js","./entry.CNP42Mi6.css","./CJAyvGKH.js","./D187WxNH.js","./KAvfy7MV.js","./Flow.BbpY5sE0.css"])))=>i.map(i=>d[i]);
import{e as z,J as Q,T as X,r as I,ac as Y,I as T,o as u,w as P,a as i,c as S,K as x,ad as M,b,bD as W,L as e,t as g,ag as D,_ as Z,b9 as j,bo as B,a8 as F,a7 as ee,V as se,n as v,U as oe,S as ne,Y as le,aG as $,g as te,cf as ae,aX as ce,Q as ie,aS as de,aD as re,a_ as ue}from"./DRA9KN5F.js";import{_ as he}from"./BMufqs0w.js";import{R as J,O as L,_ as _e}from"./KAvfy7MV.js";const be={class:"flex items-center gap-2"},fe={class:"flex items-center gap-2"},me={class:"select-none nc-erd-config-option-label"},pe={key:0,class:"flex items-center gap-2"},we={class:"select-none nc-erd-config-option-label"},ge={key:1,class:"flex flex-row items-center"},ke={class:"ml-2 select-none nc-erd-config-option-label"},ve={key:2,class:"flex items-center gap-2"},Te={class:"select-none nc-erd-config-option-label"},ye=z({__name:"ConfigPanel",props:{config:{}},setup(w){const s=w,{includeM2M:y}=Q(),l=X(s,"config"),k=I(!1);return(f,a)=>{const h=W,m=Y("e");return u(),T(e(L),{class:"flex flex-col gap-y-1 bg-white border-1 rounded-lg border-gray-200 z-50 px-3 py-2 nc-erd-context-menu shadow-md",position:e(J).TopRight},{default:P(()=>[i("div",be,[M(b(h,{checked:e(l).showAllColumns,"onUpdate:checked":a[0]||(a[0]=d=>e(l).showAllColumns=d),class:"nc-erd-showColumns-checkbox"},null,8,["checked"]),[[m,["c:erd:showAllColumns"]]]),i("span",{class:"select-none nc-erd-config-option-label nc-erd-showColumns-label text-xs",onDblclick:a[1]||(a[1]=d=>k.value=!0)},g(f.$t("activity.erd.showColumns")),33)]),i("div",fe,[M(b(h,{checked:e(l).showPkAndFk,"onUpdate:checked":a[2]||(a[2]=d=>e(l).showPkAndFk=d),class:D(["nc-erd-showPkAndFk-checkbox",[`nc-erd-showPkAndFk-checkbox-${e(l).showAllColumns?"enabled":"disabled"}`,`nc-erd-showPkAndFk-checkbox-${e(l).showPkAndFk?"checked":"unchecked"}`]]),disabled:!e(l).showAllColumns},null,8,["checked","class","disabled"]),[[m,["c:erd:showPkAndFk"]]]),i("span",me,g(f.$t("activity.erd.showPkAndFk")),1)]),e(l).singleTableMode?x("",!0):(u(),S("div",pe,[M(b(h,{checked:e(l).showViews,"onUpdate:checked":a[3]||(a[3]=d=>e(l).showViews=d),class:"nc-erd-showViews-checkbox"},null,8,["checked"]),[[m,["c:erd:showViews"]]]),i("span",we,g(f.$t("activity.erd.showSqlViews")),1)])),!e(l).singleTableMode&&e(k)&&e(y)?(u(),S("div",ge,[M(b(h,{checked:e(l).showMMTables,"onUpdate:checked":a[4]||(a[4]=d=>e(l).showMMTables=d),class:"nc-erd-showMMTables-checkbox"},null,8,["checked"]),[[m,["c:erd:showMMTables"]]]),i("span",ke,g(f.$t("activity.erd.showMMTables")),1)])):x("",!0),e(k)&&e(y)?(u(),S("div",ve,[M(b(h,{checked:e(l).showJunctionTableNames,"onUpdate:checked":a[5]||(a[5]=d=>e(l).showJunctionTableNames=d),class:"nc-erd-showJunctionTableNames-checkbox"},null,8,["checked"]),[[m,["c:erd:showJunctionTableNames"]]]),i("span",Te,g(f.$t("activity.erd.showJunctionTableNames")),1)])):x("",!0)]),_:1},8,["position"])}}}),Me=Object.assign(Z(ye,[["__scopeId","data-v-86453fd1"]]),{__name:"ErdConfigPanel"}),xe={class:"flex flex-col"},Ae={class:"flex items-center gap-1.5 p-2"},Ce={class:"flex items-center gap-1.5 p-2"},Se=z({__name:"HistogramPanel",setup(w){return(s,y)=>(u(),T(e(L),{class:"text-xs bg-white border-1 rounded border-gray-200 shadow-md p-1.5 z-50 nc-erd-histogram",position:e(J).TopLeft},{default:P(()=>[i("div",xe,[i("div",Ae,[(u(),T(j(("iconMap"in s?s.iconMap:e(B)).table),{class:"!text-gray-600/75"})),i("div",null,g(s.$t("objects.table")),1)]),i("div",Ce,[(u(),T(j(("iconMap"in s?s.iconMap:e(B)).eye))),i("div",null,g(s.$t("objects.sqlView")),1)])])]),_:1},8,["position"]))}}),Pe=Object.assign(Se,{__name:"ErdHistogramPanel"}),Ve=ce(()=>ue(()=>import("./BrCOfC5t.js"),__vite__mapDeps([0,1,2,3,4,5,6]),import.meta.url).then(w=>w.default||w)),Fe={class:"relative h-full"},$e={class:"h-full w-full flex flex-col justify-center items-center"},Ie=z({__name:"View",props:{sourceId:{type:String,default:""},table:{type:Object,default:null},showAllColumns:{type:Boolean,default:!0},baseId:{type:String,default:void 0}},setup(w){const s=w,{bases:y}=F(ee()),{base:l}=F(se()),k=v(()=>s.baseId??l.value.id),f=oe(),{baseTables:a}=F(f),h=v(()=>a.value.get(k.value)??[]),m=v(()=>{var t;return((t=y.value.get(k.value))==null?void 0:t.sources)||[]}),{metas:d,getMeta:E}=ne(),O=I([]),A=I(!0),o=le({showPkAndFk:!0,showViews:!1,showAllColumns:s.showAllColumns,singleTableMode:!!s.table,showMMTables:!1,showJunctionTableNames:!1,isFullScreen:!1}),R=async t=>{const r=async c=>{await Promise.all(c.map(async p=>{await E(p.id)}))},_=t.filter(c=>!d.value[c.id]&&c.source_id===s.sourceId);for(let c=0;c<_.length;c+=5){const p=_.slice(c,c+5);await r(p)}},N=async()=>{let t=[];if(s.table){const n=await E(s.table.id);t=h.value.filter(r=>{var _,c;return r.id===((_=s.table)==null?void 0:_.id)||((c=n==null?void 0:n.columns)==null?void 0:c.find(p=>{var C;return re(p.uidt)&&((C=p.colOptions)==null?void 0:C.fk_related_model_id)===r.id}))})}else t=h.value;await R(t),O.value=t.filter(n=>{var r;return o.showMMTables||!o.showMMTables&&!n.mm||n.id===((r=s.table)==null?void 0:r.id)}).filter(n=>o.singleTableMode||!o.showViews&&n.type!=="view"||o.showViews),A.value=!1},U=()=>{o.isFullScreen=!o.isFullScreen};$([d,h],N,{flush:"post",immediate:!0}),$(o,N,{flush:"post",deep:!0});const G=v(()=>O.value.filter(t=>{var n,r;return s!=null&&s.sourceId?t.source_id===s.sourceId:t.source_id===((r=(n=m.value)==null?void 0:n.filter(_=>_.enabled)[0])==null?void 0:r.id)})),V=v(()=>{var t;return(t=m.value)==null?void 0:t.find(n=>s!=null&&s.sourceId?n.id===s.sourceId:n.enabled)}),H=v(()=>V.value&&!V.value.is_meta&&!V.value.is_local);return $(()=>o.showAllColumns,()=>{o.showPkAndFk=o.showAllColumns}),te(async()=>{s.baseId&&(a.value.get(s.baseId)||await f.loadProjectTables(s.baseId))}),(t,n)=>{const r=de,_=he,c=_e,p=Me,C=Pe,q=Ve;return u(),S("div",{class:D(["w-full bg-white border-1 border-gray-100 rounded-lg",{"z-100 h-screen w-screen fixed top-0 left-0 right-0 bottom-0":e(o).isFullScreen,"nc-erd-vue-flow-single-table":e(o).singleTableMode,"nc-erd-vue-flow":!e(o).singleTableMode}]),style:ae(e(o).isFullScreen?"":"height: inherit")},[i("div",Fe,[b(q,{tables:e(G),config:e(o)},{default:P(()=>[b(_,{modelValue:e(A),"onUpdate:modelValue":n[0]||(n[0]=K=>ie(A)?A.value=K:null),inline:"",class:"bg-gray-300/50"},{default:P(()=>[i("div",$e,[b(r,{size:"large"})])]),_:1},8,["modelValue"]),b(c,{config:e(o),onToggleFullScreen:U},null,8,["config"]),s.table?(u(),T(p,{key:0,config:e(o)},null,8,["config"])):x("",!0),!e(o).singleTableMode&&e(H)?(u(),T(C,{key:1})):x("",!0)]),_:1},8,["tables","config"])])],6)}}}),Ne=Object.assign(Ie,{__name:"ErdView"});export{Ne as default};
