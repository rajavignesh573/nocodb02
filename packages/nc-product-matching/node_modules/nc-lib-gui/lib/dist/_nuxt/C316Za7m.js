import{aj as e,lc as u,ld as x,ch as C,fV as f,aC as k,jd as D,kx as L,aF as g,kv as h}from"./DRA9KN5F.js";const R=5,M=[e.QrCode,e.Barcode,e.Button];function b(t){return[e.Date,e.DateTime,e.CreatedTime,e.LastModifiedTime].includes(t)}const v=t=>D(t)||t===e.Time?"=":[e.SingleSelect,e.Collaborator,e.LinkToAnotherRecord,e.Date,e.CreatedTime,e.LastModifiedTime,e.DateTime].includes(t)?"is":"is equal",_=t=>D(t)||t===e.Time?"!=":[e.SingleSelect,e.Collaborator,e.LinkToAnotherRecord,e.Date,e.CreatedTime,e.LastModifiedTime,e.DateTime].includes(t)?"is not":"is not equal",S=t=>t===e.Attachment?"filenames contain":"is like",V=t=>t===e.Attachment?"filenames don't contain":"is not like",B=t=>[e.Date,e.DateTime,e.CreatedTime,e.LastModifiedTime].includes(t)?"is after":">",A=t=>[e.Date,e.DateTime,e.CreatedTime,e.LastModifiedTime].includes(t)?"is before":"<",w=t=>[e.Date,e.DateTime,e.CreatedTime,e.LastModifiedTime].includes(t)?"is on or after":">=",U=t=>[e.Date,e.DateTime,e.CreatedTime,e.LastModifiedTime].includes(t)?"is on or before":"<=",F=(t,i)=>[{text:"is checked",value:"checked",ignoreVal:!0,includedTypes:[e.Checkbox]},{text:"is not checked",value:"notchecked",ignoreVal:!0,includedTypes:[e.Checkbox]},{text:v(t),value:"eq",ignoreVal:!1,excludedTypes:[e.Checkbox,e.MultiSelect,e.Attachment,e.User,e.CreatedBy,e.LastModifiedBy]},{text:_(t),value:"neq",ignoreVal:!1,excludedTypes:[e.Checkbox,e.MultiSelect,e.Attachment,e.User,e.CreatedBy,e.LastModifiedBy]},{text:S(t),value:"like",ignoreVal:!1,excludedTypes:[e.Checkbox,e.SingleSelect,e.MultiSelect,e.User,e.CreatedBy,e.LastModifiedBy,e.Collaborator,e.Date,e.DateTime,e.CreatedTime,e.LastModifiedTime,e.Time,...u]},{text:V(t),value:"nlike",ignoreVal:!1,excludedTypes:[e.Checkbox,e.SingleSelect,e.MultiSelect,e.User,e.CreatedBy,e.LastModifiedBy,e.Collaborator,e.Date,e.DateTime,e.CreatedTime,e.LastModifiedTime,e.Time,...u]},{text:"is empty",value:"empty",ignoreVal:!0,excludedTypes:[e.Checkbox,e.SingleSelect,e.MultiSelect,e.User,e.CreatedBy,e.LastModifiedBy,e.Collaborator,e.Attachment,e.LinkToAnotherRecord,e.Lookup,e.Date,e.DateTime,e.CreatedTime,e.LastModifiedTime,e.Time,...u]},{text:"is not empty",value:"notempty",ignoreVal:!0,excludedTypes:[e.Checkbox,e.SingleSelect,e.MultiSelect,e.User,e.CreatedBy,e.LastModifiedBy,e.Collaborator,e.Attachment,e.LinkToAnotherRecord,e.Lookup,e.Date,e.DateTime,e.CreatedTime,e.LastModifiedTime,e.Time,...u]},{text:"is null",value:"null",ignoreVal:!0,excludedTypes:[...u,e.Checkbox,e.SingleSelect,e.MultiSelect,e.User,e.CreatedBy,e.LastModifiedBy,e.Collaborator,e.Attachment,e.LinkToAnotherRecord,e.Lookup,e.Date,e.DateTime,e.CreatedTime,e.LastModifiedTime,e.Time]},{text:"is not null",value:"notnull",ignoreVal:!0,excludedTypes:[...u,e.Checkbox,e.SingleSelect,e.MultiSelect,e.User,e.CreatedBy,e.LastModifiedBy,e.Collaborator,e.Attachment,e.LinkToAnotherRecord,e.Lookup,e.Date,e.DateTime,e.CreatedTime,e.LastModifiedTime,e.Time]},{text:"contains all of",value:"allof",ignoreVal:!1,includedTypes:[e.MultiSelect,e.User,e.CreatedBy,e.LastModifiedBy]},{text:"contains any of",value:"anyof",ignoreVal:!1,includedTypes:[e.MultiSelect,e.SingleSelect,e.User,e.CreatedBy,e.LastModifiedBy]},{text:"does not contain all of",value:"nallof",ignoreVal:!1,includedTypes:[e.MultiSelect,e.User,e.CreatedBy,e.LastModifiedBy]},{text:"does not contain any of",value:"nanyof",ignoreVal:!1,includedTypes:[e.MultiSelect,e.SingleSelect,e.User,e.CreatedBy,e.LastModifiedBy]},{text:B(t),value:"gt",ignoreVal:!1,includedTypes:[...u,e.Date,e.DateTime,e.LastModifiedTime,e.CreatedTime,e.Time]},{text:A(t),value:"lt",ignoreVal:!1,includedTypes:[...u,e.Date,e.DateTime,e.LastModifiedTime,e.CreatedTime,e.Time]},{text:w(t),value:"gte",ignoreVal:!1,includedTypes:[...u,e.Date,e.DateTime,e.LastModifiedTime,e.CreatedTime,e.Time]},{text:U(t),value:"lte",ignoreVal:!1,includedTypes:[...u,e.Date,e.DateTime,e.Time,e.CreatedTime,e.LastModifiedTime]},{text:"is within",value:"isWithin",ignoreVal:!0,includedTypes:[e.Date,e.DateTime,e.LastModifiedTime,e.CreatedTime]},{text:"is blank",value:"blank",ignoreVal:!0,excludedTypes:[e.Checkbox,e.Links,e.Rollup]},{text:"is not blank",value:"notblank",ignoreVal:!0,excludedTypes:[e.Checkbox,e.Links,e.Rollup]}],W=(t,i)=>{const a=i&&L(i);return t==="isWithin"?[{text:"the past week",value:"pastWeek",ignoreVal:!0,includedTypes:[e.Date,e.DateTime,e.LastModifiedTime,e.CreatedTime]},{text:"the past month",value:"pastMonth",ignoreVal:!0,includedTypes:[e.Date,e.DateTime,e.LastModifiedTime,e.CreatedTime]},{text:"the past year",value:"pastYear",ignoreVal:!0,includedTypes:[e.Date,e.DateTime,e.LastModifiedTime,e.CreatedTime]},{text:"the next week",value:"nextWeek",ignoreVal:!0,includedTypes:[e.Date,e.DateTime,e.LastModifiedTime,e.CreatedTime]},{text:"the next month",value:"nextMonth",ignoreVal:!0,includedTypes:[e.Date,e.DateTime,e.LastModifiedTime,e.CreatedTime]},{text:"the next year",value:"nextYear",ignoreVal:!0,includedTypes:[e.Date,e.DateTime,e.LastModifiedTime,e.CreatedTime]},{text:"the next number of days",value:"nextNumberOfDays",ignoreVal:!1,includedTypes:[e.Date,e.DateTime,e.LastModifiedTime,e.CreatedTime]},{text:"the past number of days",value:"pastNumberOfDays",ignoreVal:!1,includedTypes:[e.Date,e.DateTime,e.LastModifiedTime,e.CreatedTime]}]:[{text:"today",value:"today",ignoreVal:!0,includedTypes:[...a?[]:[e.Date,e.DateTime,e.LastModifiedTime,e.CreatedTime]]},{text:"tomorrow",value:"tomorrow",ignoreVal:!0,includedTypes:[...a?[]:[e.Date,e.DateTime,e.LastModifiedTime,e.CreatedTime]]},{text:"yesterday",value:"yesterday",ignoreVal:!0,includedTypes:[...a?[]:[e.Date,e.DateTime,e.LastModifiedTime,e.CreatedTime]]},{text:"one week ago",value:"oneWeekAgo",ignoreVal:!0,includedTypes:[...a?[]:[e.Date,e.DateTime,e.LastModifiedTime,e.CreatedTime]]},{text:"one week from now",value:"oneWeekFromNow",ignoreVal:!0,includedTypes:[...a?[]:[e.Date,e.DateTime,e.LastModifiedTime,e.CreatedTime]]},{text:"one month ago",value:"oneMonthAgo",ignoreVal:!0,includedTypes:[e.Date,e.DateTime,e.LastModifiedTime,e.CreatedTime]},{text:"one month from now",value:"oneMonthFromNow",ignoreVal:!0,includedTypes:[e.Date,e.DateTime,e.LastModifiedTime,e.CreatedTime]},{text:"number of days ago",value:"daysAgo",ignoreVal:!1,includedTypes:[...a?[]:[e.Date,e.DateTime,e.LastModifiedTime,e.CreatedTime]]},{text:"number of days from now",value:"daysFromNow",ignoreVal:!1,includedTypes:[...a?[]:[e.Date,e.DateTime,e.LastModifiedTime,e.CreatedTime]]},{text:a?"exact month":"exact date",value:"exactDate",ignoreVal:!1,includedTypes:[e.Date,e.DateTime,e.LastModifiedTime,e.CreatedTime]}]},O=(t,i,a)=>{var l,d,s;if(t.some(o=>o.logical_op==="or"))return{};const n={};for(const o of t)if(["checked","notchecked","allof","eq"].includes(o.comparison_op)){const r=i.find(m=>m.id===o.fk_column_id);if(r){if([e.Number,e.Decimal,e.SingleLineText,e.LongText,e.SingleSelect,e.GeoData,e.Email,e.PhoneNumber,e.URL,e.Time,e.Year,e.Currency,e.Percent,e.Rating,e.Duration,e.JSON].includes(r.uidt)||[e.Date,e.DateTime].includes(r.uidt)&&o.comparison_sub_op==="exactDate")n[r.title]=o.value;else if([e.Checkbox].includes(r.uidt)&&["checked","notchecked"].includes(o.comparison_op))n[r.title]=o.comparison_op==="checked";else if([e.MultiSelect].includes(r.uidt)&&["allof"].includes(o.comparison_op))n[r.title]=o.value;else if([e.User].includes(r.uidt)&&["allof"].includes(o.comparison_op)&&(((l=g(r.meta))==null?void 0:l.is_multi)||((s=(d=o.value)==null?void 0:d.indexOf)==null?void 0:s.call(d,","))<0)){const T=o.value.split(",").map(c=>{var p;return c==="@me"?(p=a==null?void 0:a.currentUser)==null?void 0:p.id:c}).filter(c=>c).join(",");n[r.title]=T}}}return n},N=(t,i,a,n)=>{const l=["empty","notempty","null","notnull"].includes(i.value);return i.includedTypes?t.fk_column_id&&i.includedTypes.includes(a)?l?n:!0:!1:i.excludedTypes?t.fk_column_id&&!i.excludedTypes.includes(a)?l?n:!0:!1:l?n:!0},E=(t,i,a)=>{if(i.includedTypes)return t.fk_column_id&&i.includedTypes.includes(a);if(i.excludedTypes)return t.fk_column_id&&!i.excludedTypes.includes(a)},G=(t,i,a)=>{if(!i||f(i))return!1;const n=x.create({client:a??C.PG});if([e.Attachment,e.Rating,e.Checkbox,e.QrCode,e.Barcode,e.Collaborator,e.GeoData,e.SpecificDBType].includes(i.uidt))return!1;const l=n.getAbstractType(i);return["integer","float","text","string"].includes(l)?!t.comparison_op||["eq","lt","gt","lte","gte","like","nlike","neq"].includes(t.comparison_op):!1},P=(t,i,a)=>{if(!i)return[];const n=x.create({client:a??C.PG});return t.filter(l=>{if(M.includes(l.uidt)||f(l)||k(l)&&!l.pk)return!1;const d=n.getAbstractType(l),s=n.getAbstractType(i);return[d,s].every(o=>["float","integer"].includes(o))||[d,s].every(o=>["text","string"].includes(o))?!0:s===d})},y=t=>t.uidt===e.Formula?h({formulaColumn:t})||t.uidt:t.btLookupColumn?t.btLookupColumn.uidt:t.uidt,j=async({rootMeta:t,getMeta:i})=>{var n,l,d;const a=[];for(const s of t.columns){if(s.uidt!==e.Lookup){a.push({...s,filterUidt:y(s)});continue}let o=s;for(;o&&o.uidt===e.Lookup;){const m=(l=(n=await i(o.fk_model_id))==null?void 0:n.columns)==null?void 0:l.find(c=>c.id===o.colOptions.fk_relation_column_id);if(!m)break;const T=await i((m==null?void 0:m.colOptions).fk_related_model_id);if(o=(d=T==null?void 0:T.columns)==null?void 0:d.find(c=>c.id===o.colOptions.fk_lookup_column_id),(o==null?void 0:o.id)===s.id)break}const r={...s,btLookupColumn:o};r.filterUidt=y(r),a.push(r)}return a},I=({filter:t,column:i,showNullAndEmptyInFilter:a})=>{var l,d;const n=i.filterUidt??i.uidt;f(i)&&(t.dynamic=!1),t.fk_value_col_id=null,t.comparison_op=(d=F(n,(l=g(i.meta))==null?void 0:l.date_format).find(s=>N(t,s,n,a)))==null?void 0:d.value,b(n)&&!["blank","notblank"].includes(t.comparison_op)?t.comparison_op==="isWithin"?t.comparison_sub_op="pastNumberOfDays":t.comparison_sub_op="exactDate":t.comparison_sub_op=null};export{R as M,P as a,W as b,F as c,E as d,G as e,I as f,O as g,b as h,N as i,j};
