const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./CEywAgwo.js","./DRA9KN5F.js","./entry.CNP42Mi6.css","./QeWwuUYP.js","./index._6B72PDH.css","./BhKW-HeQ.js","./ytmFgNfN.js","./Pagination.Cmvjwryu.css","./Table.Cfa4WPno.css","./By5RWL3d.js","./-iDxnmJF.js","./CkpISeXq.js","./Editor.D7XJoluS.css","./CtCRqrd3.js","./boyBAVNN.js","./Editor.C6FZ3q1a.css"])))=>i.map(i=>d[i]);
var gs=Object.defineProperty;var ys=(T,d,t)=>d in T?gs(T,d,{enumerable:!0,configurable:!0,writable:!0,value:t}):T[d]=t;var F=(T,d,t)=>ys(T,typeof d!="symbol"?d+"":d,t);import{bi as vs,c as B,o as b,a as v,e as mt,r as U,n as G,ai as ce,bv as bs,g as pt,I as N,cS as _s,w as p,K as X,an as Le,aq as ws,L as e,b9 as He,bo as qe,t as k,b as g,at as xs,ap as It,d as P,$ as ks,_ as ft,f as lt,al as Lt,a8 as it,V as Ds,aa as Ts,cT as _t,X as Ge,aG as rt,ac as Ss,M as Rt,N as ct,ag as ue,O as $s,a0 as Ut,a1 as ut,cU as Cs,ar as Et,cV as Ot,Q as Re,bO as Ft,ad as at,af as wt,b3 as Nt,cW as Pt,a3 as At,bU as jt,a4 as Pe,a5 as Ue,aj as c,cX as Is,cY as ht,cZ as Ls,c_ as dt,c$ as Mt,d0 as Bt,d1 as zt,d2 as Rs,d3 as Ye,d4 as Vt,aF as Jt,d5 as Ht,d6 as Us,a_ as gt,J as xt,G as Es,bd as Os,a9 as Fs,U as Ns,Y as Ps,d7 as As,d8 as js,d9 as Ms,T as Bs,R as zs,bz as Vs,aX as qt,da as Js,db as Hs,aH as qs,aJ as Gs,dc as Ys,dd as kt,de as Je,x as Ks,df as Ws,dg as ot,ah as Dt,dh as nt,di as Qs,bY as Ie,dj as Ne,dk as Xs}from"./DRA9KN5F.js";import{u as Zs}from"./0J_Jm9qQ.js";import{C as Gt,_ as Yt}from"./-iDxnmJF.js";import{g as ea}from"./BYKJ-MHf.js";import{p as Tt}from"./lL-0_K96.js";import{U as ta,a as sa}from"./phJnKPvr.js";const aa={class:"nc-icon",viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"};function oa(T,d){return b(),B("svg",aa,d[0]||(d[0]=[v("path",{fill:"currentColor",d:"M7 15h2c0 1.08 1.37 2 3 2s3-.92 3-2c0-1.1-1.04-1.5-3.24-2.03C9.64 12.44 7 11.78 7 9c0-1.79 1.47-3.31 3.5-3.82V3h3v2.18C15.53 5.69 17 7.21 17 9h-2c0-1.08-1.37-2-3-2s-3 .92-3 2c0 1.1 1.04 1.5 3.24 2.03C14.36 11.56 17 12.22 17 15c0 1.79-1.47 3.31-3.5 3.82V21h-3v-2.18C8.47 18.31 7 16.79 7 15"},null,-1)]))}const na=vs({name:"mdi-currency-usd",render:oa}),la={key:0,class:"flex items-center"},ia={class:"text-red-500 ml-2"},ra={key:1,class:"flex items-center"},ca={class:"text-green-500 ml-2"},ua={key:0,class:"flex items-center"},da=mt({__name:"ProgressPanel",setup(T,{expose:d}){const t=U([]),m=U(),u=U(!0),o=()=>{var w,x;const _=(x=(w=m.value)==null?void 0:w.$el)==null?void 0:x.firstElementChild;_&&(_.scrollTop=_.scrollHeight)},D=(_,w)=>{_!=null&&_.trim()&&(t.value.push({msg:_,status:w}),u.value&&ks(o))},i=_=>{const{scrollTop:w,scrollHeight:x,clientHeight:L}=_.target;u.value=w+L>=x-10};function h(_){let w="";for(const{msg:L}of t.value)w+=`${L}
`;const x=document.createElement("a");x.setAttribute("href",`data:text/plain;charset=utf-8,${encodeURIComponent(w)}`),x.setAttribute("download",_),x.style.display="none",document.body.appendChild(x),x.click(),document.body.removeChild(x)}const A=G(()=>{var _;return[ce.FAILED,ce.COMPLETED].includes((_=t.value[t.value.length-1])==null?void 0:_.status)});return bs(()=>{var _,w;return(w=(_=m.value)==null?void 0:_.$el)==null?void 0:w.firstElementChild},"scroll",i,{passive:!0}),d({pushProgress:D}),pt(()=>{o()}),(_,w)=>{const x=na,L=It,W=xs,E=_s;return b(),N(E,{ref_key:"logRef",ref:m,"body-style":{overflow:"auto",width:"100%",height:"100%",backgroundColor:"#101015",borderRadius:"0.5rem",padding:"16px !important","scrollbar-color":"var(--scrollbar-thumb) var(--scrollbar-track)","scrollbar-width":"thin","--scrollbar-thumb":"#E7E7E9","--scrollbar-track":"transparent"}},{default:p(()=>[(b(!0),B(Le,null,ws(e(t),({msg:V,status:Y},$)=>(b(),B("div",{key:$},[Y===e(ce).FAILED?(b(),B("div",la,[(b(),N(He(e(qe).closeCircle),{class:"text-red-500"})),v("span",ia,k(V),1)])):(b(),B("div",ra,[g(x,{class:"text-green-500"}),v("span",ca,k(V),1)]))]))),128)),e(A)?X("",!0):(b(),B("div",ua,[(b(),N(He(e(qe).loading),{class:"text-green-500 animate-spin"})),w[1]||(w[1]=v("span",{class:"text-green-500 ml-2"},"Loading...",-1))])),e(A)?(b(),N(W,{key:1,class:"!absolute z-1 right-2 bottom-2 opacity-75 hover:opacity-100 !rounded-md !w-8 !h-8",size:"small",onClick:w[0]||(w[0]=V=>h("logs.txt"))},{default:p(()=>[g(L,null,{title:p(()=>w[2]||(w[2]=[P("Download Logs")])),default:p(()=>[(b(),N(He(e(qe).download)))]),_:1})]),_:1})):X("",!0)]),_:1},512)}}}),ma=Object.assign(ft(da,[["__scopeId","data-v-9be40849"]]),{__name:"GeneralProgressPanel"}),pa={key:0,class:"flex-1"},fa={key:1,class:"flex-1"},ha={key:2,class:"flex-1"},ga={key:3,href:"https://nocodb.com/docs/product-docs/bases/import-base-from-airtable#get-airtable-credentials",class:"!text-nc-content-gray-subtle2 text-sm font-weight-500 ml-auto",target:"_blank",rel:"noopener"},ya={key:4,class:"flex items-center gap-2"},va={key:0},ba={class:"flex items-end"},_a={class:"text-nc-content-gray text-sm"},wa={href:"https://nocodb.com/docs/product-docs/bases/import-base-from-airtable#get-airtable-credentials",class:"!text-brand text-sm ml-auto",target:"_blank",rel:"noopener"},xa={class:"text-nc-content-gray text-sm"},ka={class:"my-5"},Da={class:"mb-2"},Ta={class:"my-2"},Sa={class:"my-2"},$a={class:"my-2"},Ca={class:"my-2"},Ia={class:"my-2"},La={key:1},Ra={class:"flex items-center gap-2"},Ua={class:"truncate"},Ea={key:2,class:"flex items-center gap-3"},Oa={key:0,class:"text-right mt-5"},Fa={key:0,class:"flex justify-between mt-5"},Na=mt({__name:"AirtableImport",props:{modelValue:{type:Boolean},baseId:{},sourceId:{},transition:{},showBackBtn:{type:Boolean},showSourceSelector:{type:Boolean,default:!0}},emits:["update:modelValue","back"],setup(T,{emit:d}){const t=d,{$api:m}=lt(),u=m.instance.defaults.baseURL,{$state:o,$poller:D}=lt(),i=Lt(),{activeWorkspace:h}=it(i),A=Ds(),{refreshCommandPalette:_}=Ts(),{loadTables:w}=A,{getJobsForBase:x,loadJobsForBase:L}=Zs(),W=U(!1),E=U(1),V=U(),Y=U(),$=U(!1),C=U(!1),O=U(!1),r=U({id:"",type:"Airtable",details:{syncInterval:"15mins",syncDirection:"Airtable to NocoDB",syncRetryCount:1,apiKey:"",appId:"",shareId:"",syncSourceUrlOrId:"",options:{syncViews:!0,syncData:!0,syncRollup:!1,syncLookup:!0,syncFormula:!1,syncAttachment:!0,syncUsers:!1}}}),y=U(),S=G(()=>{var n;return((n=y.value)==null?void 0:n.customSourceId)||T.sourceId}),M=n=>{var l;(l=V.value)==null||l.pushProgress(n.message,"progress"),Y.value={msg:n.message,status:"progress"}},z=async(n,l)=>{var q,J,ge;Y.value={msg:l==null?void 0:l.message,status:n},n===ce.COMPLETED?(W.value=!0,await w(),(q=V.value)==null||q.pushProgress("Done!",n),_(),(J=h.value)!=null&&J.id&&i.loadWorkspace(h.value.id)):n===ce.FAILED&&(await w(),C.value=!0,(ge=V.value)==null||ge.pushProgress(l.error.message,n),_())},Z=G(()=>({"details.apiKey":[_t()],"details.syncSourceUrlOrId":[_t()]})),H=G({get:()=>T.modelValue,set:n=>t("update:modelValue",n)}),Ee=Ge.useForm,{validateInfos:fe}=Ee(r,Z),Te=G(()=>{var n,l;return!r.value.details.apiKey||!r.value.details.syncSourceUrlOrId||((l=(n=y.value)==null?void 0:n.selectedSource)==null?void 0:l.ncItemDisabled)}),de=U(!1);async function ae(){de.value=!0,await Se(),await Ke()}async function Se(){try{const{id:n,...l}=r.value;n!==""?await $fetch(`/api/v1/db/meta/syncs/${n}`,{baseURL:u,method:"PATCH",headers:{"xc-auth":o.token.value},body:l}):r.value=await $fetch(`/api/v1/db/meta/projects/${T.baseId}/syncs/${S.value}`,{baseURL:u,method:"POST",headers:{"xc-auth":o.token.value},body:l})}catch(n){Pe.error(await Ue(n))}}async function me(n){if(O.value)return;O.value=!0,await L(T.baseId);const l=await x(T.baseId),q=n?{id:n}:l.sort((J,ge)=>new Date(ge.created_at).getTime()-new Date(J.created_at).getTime()).find(J=>J.base_id===T.baseId&&J.status!==ce.COMPLETED&&J.status!==ce.FAILED);if(!q){O.value=!1;return}D.subscribe({id:q.id},J=>{J.status!=="close"?(E.value=2,J.status?z(J.status,J.data):M(J.data)):(O.value=!1,de.value=!1)})}async function Oe(){const n=await $fetch(`/api/v1/db/meta/projects/${T.baseId}/syncs/${S.value}`,{baseURL:u,method:"GET",headers:{"xc-auth":o.token.value}}),{list:l}=n;l&&l[0]?(l[0].details=l[0].details||{},r.value=We(l[0]),r.value.details.syncSourceUrlOrId=l[0].details.appId&&l[0].details.appId.length>0?l[0].details.syncSourceUrlOrId:l[0].details.shareId,me()):r.value={id:"",type:"Airtable",details:{syncInterval:"15mins",syncDirection:"Airtable to NocoDB",syncRetryCount:1,apiKey:"",appId:"",shareId:"",syncSourceUrlOrId:"",options:{syncViews:!0,syncData:!0,syncRollup:!1,syncLookup:!0,syncFormula:!1,syncAttachment:!0,syncUsers:!1}}}}async function Ke(){try{const n=await $fetch(`/api/v1/db/meta/syncs/${r.value.id}/trigger`,{baseURL:u,method:"POST",headers:{"xc-auth":o.token.value}});O.value=!1,me(n.id)}catch(n){Pe.error(await Ue(n))}}function We(n){var l;return(l=n.details)!=null&&l.options||(n.details.options={syncViews:!1,syncData:!0,syncRollup:!1,syncLookup:!0,syncFormula:!1,syncAttachment:!0},n.details.options.syncViews=n.syncViews,delete n.syncViews),n}rt(()=>r.value.details.syncSourceUrlOrId,n=>{if(r.value.details){const l=n&&n.match(/(exp|shr).{14}/g);r.value.details.shareId=l?l[0]:"";const q=n&&n.match(/(app).{14}/g);r.value.details.appId=q?q[0]:""}}),pt(async()=>{r.value.id&&me(),await Oe()});const he=G(()=>{var n;return!Y.value||![ce.COMPLETED,ce.FAILED].includes((n=Y.value)==null?void 0:n.status)}),f=U(!1),ye=U("");return(n,l)=>{const q=Rt,J=ct,ge=ct,$e=Cs,le=Ut,pe=Et,Ce=Ot,oe=Ft,Ae=Yt,te=Gt,je=Ge,ve=ma,Qe=Nt,Xe=Pt,Me=jt,Be=Ss("e");return b(),N(Me,{visible:e(H),"onUpdate:visible":l[16]||(l[16]=xe=>Re(H)?H.value=xe:null),class:ue(["!top-[25vh]",{active:e(H)}]),closable:!1,"transition-name":n.transition,keyboard:e(E)!==2,"mask-closable":e(E)!==2,width:"448px","wrap-class-name":"nc-modal-airtable-import",hide:"",onKeydown:l[17]||(l[17]=At(xe=>H.value=!1,["esc"]))},{footer:p(()=>[e(E)===1?(b(),B("div",Fa,[g(J,{key:"back",type:"text",size:"small",onClick:l[15]||(l[15]=()=>{H.value=!1,t("back")})},{default:p(()=>[n.showBackBtn?(b(),N(q,{key:0,icon:"chevronLeft",class:"mr-1"})):X("",!0),P(" "+k(n.showBackBtn?n.$t("general.back"):n.$t("general.cancel")),1)]),_:1}),at((b(),N(J,{key:"submit",type:"primary",class:"nc-btn-airtable-import",size:"small",loading:e(de),disabled:e(Te),onClick:ae},{default:p(()=>[P(k(n.$t("activity.import"))+" Base ",1)]),_:1},8,["loading","disabled"])),[[Be,["c:sync-airtable:save-and-sync"]]])])):X("",!0)]),default:p(()=>{var xe,ie,ze,Fe;return[v("div",{class:"text-base font-weight-bold flex items-center gap-4 mb-6",onDblclick:l[2]||(l[2]=j=>$.value=!0)},[g(q,{icon:"airtable",class:"w-6 h-6"}),e(E)===1?(b(),B("span",pa,k(n.$t("title.quickImportAirtable")),1)):e(he)?(b(),B("span",fa,k(`${n.$t("labels.importingFromAirtable")}...`),1)):(b(),B("span",ha,k(n.$t("labels.airtableBaseImported")),1)),e(E)===1?(b(),B("a",ga," Docs ")):e(E)===2?(b(),B("div",ya,[g(J,{type:"text",size:"xs",class:"ml-auto",onClick:l[0]||(l[0]=j=>f.value=!e(f))},{default:p(()=>[P(k(e(f)?"Hide":"Show")+" Details ",1),g(q,{icon:"chevronDown",class:ue(["ml-2 transition-all transform",{"rotate-180":e(f)}])},null,8,["class"])]),_:1}),e(he)?X("",!0):(b(),N(ge,{key:0,"icon-only":"",type:"text",size:"xs",onClick:l[1]||(l[1]=$s(j=>H.value=!1,["stop"]))},{icon:p(()=>[g(q,{icon:"close",class:"text-gray-600"})]),_:1}))])):X("",!0)],32),e(E)===1?(b(),B("div",va,[g(je,{ref:"form",model:e(r),name:"quick-import-airtable-form",layout:"vertical",class:"m-0 !text-nc-content-gray"},{default:p(()=>[g(le,ut(e(fe)["details.apiKey"],{class:"!my-5"}),{default:p(()=>[v("div",ba,[v("label",_a,k(n.$t("labels.personalAccessToken")),1),v("a",wa,k(n.$t("labels.whereToFind")),1)]),g($e,{value:e(r).details.apiKey,"onUpdate:value":l[3]||(l[3]=j=>e(r).details.apiKey=j),placeholder:"Enter your Airtable Personal Access Token",class:"!rounded-lg mt-2 nc-input-api-key nc-input-shadow !text-nc-content-gray"},{iconRender:p(j=>[g(q,{icon:j?"ncEyeOff":"ncEye"},null,8,["icon"])]),_:1},8,["value"])]),_:1},16),g(le,ut(e(fe)["details.syncSourceUrlOrId"],{class:"!my-5"}),{default:p(()=>[v("label",xa,k(`${n.$t("labels.sharedBase")} ID/URL`),1),g(pe,{value:e(r).details.syncSourceUrlOrId,"onUpdate:value":l[4]||(l[4]=j=>e(r).details.syncSourceUrlOrId=j),placeholder:"Paste the Base URL or Base ID from Airtable",class:"!rounded-lg !mt-2 nc-input-shared-base nc-input-shadow !text-nc-content-gray"},null,8,["value"])]),_:1},16),v("div",ka,[g(Ce,{ref_key:"sourceSelectorRef",ref:y,"base-id":n.baseId,"source-id":n.sourceId,"show-source-selector":n.showSourceSelector,"force-layout":"vertical"},null,8,["base-id","source-id","show-source-selector"])]),g(J,{type:"text",size:"small",onClick:l[5]||(l[5]=j=>ye.value=e(ye)?"":"advanced-settings")},{default:p(()=>[P(k(n.$t("title.advancedSettings"))+" ",1),g(q,{icon:"chevronDown",class:ue(["ml-2 !transition-all !transform",{"!rotate-180":e(ye)==="advanced-settings"}])},null,8,["class"])]),_:1}),g(te,{"active-key":e(ye),"onUpdate:activeKey":l[12]||(l[12]=j=>Re(ye)?ye.value=j:null),ghost:"",class:"nc-import-collapse"},{default:p(()=>[g(Ae,{key:"advanced-settings"},{default:p(()=>[v("div",Da,[g(oe,{checked:e(r).details.options.syncData,"onUpdate:checked":l[6]||(l[6]=j=>e(r).details.options.syncData=j)},{default:p(()=>[P(k(n.$t("labels.importData")),1)]),_:1},8,["checked"])]),v("div",Ta,[g(oe,{checked:e(r).details.options.syncViews,"onUpdate:checked":l[7]||(l[7]=j=>e(r).details.options.syncViews=j)},{default:p(()=>[P(k(n.$t("labels.importSecondaryViews")),1)]),_:1},8,["checked"])]),v("div",Sa,[g(oe,{checked:e(r).details.options.syncRollup,"onUpdate:checked":l[8]||(l[8]=j=>e(r).details.options.syncRollup=j)},{default:p(()=>[P(k(n.$t("labels.importRollupColumns")),1)]),_:1},8,["checked"])]),v("div",$a,[g(oe,{checked:e(r).details.options.syncLookup,"onUpdate:checked":l[9]||(l[9]=j=>e(r).details.options.syncLookup=j)},{default:p(()=>[P(k(n.$t("labels.importLookupColumns")),1)]),_:1},8,["checked"])]),v("div",Ca,[g(oe,{checked:e(r).details.options.syncAttachment,"onUpdate:checked":l[10]||(l[10]=j=>e(r).details.options.syncAttachment=j)},{default:p(()=>[P(k(n.$t("labels.importAttachmentColumns")),1)]),_:1},8,["checked"])]),v("div",Ia,[g(oe,{checked:e(r).details.options.syncFormula,"onUpdate:checked":l[11]||(l[11]=j=>e(r).details.options.syncFormula=j),disabled:""},{default:p(()=>[P(k(n.$t("labels.importFormulaColumns")),1)]),_:1},8,["checked"])])]),_:1})]),_:1},8,["active-key"])]),_:1},8,["model"])])):X("",!0),e(E)===2?(b(),B("div",La,[at(g(ve,{ref_key:"progressRef",ref:V,class:"w-full h-[200px]"},null,512),[[wt,e(f)]]),at(v("div",Ra,[e(he)?(b(),B(Le,{key:0},[g(Qe,{size:"large",class:"!mr-1"}),v("span",Ua,k(((xe=e(Y))==null?void 0:xe.msg)??"---"),1)],64)):((ie=e(Y))==null?void 0:ie.status)===e(ce).FAILED?(b(),N(Xe,{key:1,align:"center",type:"error","show-icon":"","message-class":"!text-sm","description-class":"!text-small !leading-[18px]","copy-text":(ze=e(Y))==null?void 0:ze.msg,message:n.$t("msg.error.importError"),description:n.$t("msg.error.anErrorOccuredWhileAirtableBaseImport")},null,8,["copy-text","message","description"])):(b(),B("div",Ea,[g(q,{icon:"checkFill",class:"text-white w-4 h-4"}),v("span",null,k(n.$t("msg.airtableImportSuccess")),1)]))],512),[[wt,!e(f)]]),e(he)?X("",!0):(b(),B("div",Oa,[((Fe=e(Y))==null?void 0:Fe.status)===e(ce).FAILED?(b(),N(J,{key:0,size:"small",onClick:l[13]||(l[13]=j=>E.value=1)},{default:p(()=>l[18]||(l[18]=[P(" Retry import ")])),_:1,__:[18]})):(b(),N(J,{key:1,size:"small",onClick:l[14]||(l[14]=j=>H.value=!1)},{default:p(()=>l[19]||(l[19]=[P(" Go to base ")])),_:1,__:[19]}))]))])):X("",!0)]}),_:1},8,["visible","class","transition-name","keyboard","mask-closable"])}}}),Ro=Object.assign(ft(Na,[["__scopeId","data-v-899cc93c"]]),{__name:"DlgAirtableImport"});class Kt{constructor(d){F(this,"progressCallback");this.progressCallback=d}progress(d){var t;(t=this.progressCallback)==null||t.call(this,d)}init(){}parse(){throw new Error("'parse' method is not implemented")}parseData(){throw new Error("'parseData' method is not implemented")}parseTemplate(){throw new Error("'parseTemplate' method is not implemented")}getColumns(){throw new Error("'getColumns' method is not implemented")}getTemplate(){throw new Error("'getTemplate' method is not implemented")}getData(){throw new Error("'getData' method is not implemented")}}const Pa={number:c.Number,string:c.SingleLineText,date:c.DateTime,boolean:c.Checkbox,object:c.JSON},St=(T,d)=>d.reduce((t,m)=>t&&t[m],T);class $t extends Kt{constructor(t,m={},u){super(u);F(this,"config");F(this,"data");F(this,"_jsonData");F(this,"jsonData");F(this,"base");F(this,"columns");this.config=m,this._jsonData=t,this.base={tables:[]},this.jsonData=[],this.data=[],this.columns={}}async init(){this.progress("Initializing json parser");const t=typeof this._jsonData=="string"?JSON.parse(this._jsonData):JSON.parse(new TextDecoder().decode(this._jsonData));this.jsonData=Array.isArray(t)?t:[t]}getColumns(){return this.columns}getData(){return this.data}parse(){this.progress("Reading json data");const t=this.jsonData,m="table",u={table_name:m,ref_table_name:m,columns:[]};this.data[m]=[];for(const o of Object.keys(t[0])){const D=this._parseColumn([o],t);u.columns.push(...D)}this.config.shouldImportData&&this._parseTableData(u),this.base.tables.push(u)}getTemplate(){return this.base}_parseColumn(t=[],m=this.jsonData,u=t.reduce((o,D)=>o&&o[D],this.jsonData[0])){const o=[];if(u&&typeof u=="object"&&!Array.isArray(u)&&this.config.normalizeNested)for(const D of Object.keys(u)){const i=this._parseColumn([...t,D],this.jsonData,u[D]);o.push(...i)}else{const D=t.join(" ").trim(),i=t.join("_").replace(/\W/g,"_").trim(),h={title:D,column_name:i,ref_column_name:i,uidt:c.SingleLineText,path:t};if(this.config.autoSelectFieldTypes){h.uidt=Pa[typeof u]||c.SingleLineText;const A=m.map(_=>St(_,t));Object.assign(h,Is(A,h.uidt))}o.push(h)}return o}_parseTableData(t){for(const m of this.jsonData){const u={};for(let o=0;o<t.columns.length;o++){const D=St(m,t.columns[o].path||[]);t.columns[o].uidt===c.Checkbox?u[t.columns[o].ref_column_name]=ht(D):t.columns[o].uidt===c.SingleSelect||t.columns[o].uidt===c.MultiSelect?u[t.columns[o].ref_column_name]=(D||"").toString().trim()||null:t.columns[o].uidt===c.JSON?u[t.columns[o].ref_column_name]=JSON.stringify(D):u[t.columns[o].column_name]=D}this.data[t.ref_table_name].push(u)}}}class Ct{constructor(d,t={},m,u){F(this,"config");F(this,"source");F(this,"detectedColumnTypes");F(this,"distinctValues");F(this,"headers");F(this,"tables");F(this,"base");F(this,"data",{});F(this,"columnValues");F(this,"existingColumnMap",{});F(this,"tableNames");F(this,"progressCallback");if(this.config=t,this.source=d,this.base={tables:[]},this.detectedColumnTypes={},this.distinctValues={},this.headers={},this.columnValues={},this.tables={},this.tableNames=[],this.progressCallback=m,u&&u.length)for(const o of u)this.existingColumnMap[o.title]=o,this.existingColumnMap[o.column_name]=o}async init(){}initTemplate(d,t,m){const u=+m.every(h=>h===null||typeof h=="string"),o={id:0,Id:0},D={id:0,Id:0},i={table_name:t,ref_table_name:t,columns:[]};this.headers[d]=[],this.tables[d]=[];for(const[h,A]of m.entries()){let _=(u&&A.toString().trim()||`Field ${h+1}`).trim(),w=(u&&A.toString().trim()||`field_${h+1}`).replace(/[` ~!@#$%^&*()_|+\-=?;:'",.<>\{\}\[\]\\\/]/g,"_").trim();for(;w in o;)w=`${w}${++o[w]}`;for(;_ in D;)_=`${_}${++D[_]}`;o[w]=0,D[_]=0,this.detectedColumnTypes[h]={},this.distinctValues[h]=new Set,this.columnValues[h]=[],i.columns.push({title:_,column_name:w,ref_column_name:w,meta:{},uidt:c.SingleLineText,key:h}),this.headers[d].push(w),this.tables[d]=i}}detectInitialUidt(d){return!isNaN(Number(d))&&!isNaN(parseFloat(d))?c.Number:Ls(d)?c.DateTime:dt(d)?c.Checkbox:c.SingleLineText}detectColumnType(d,t){for(let m=0;m<t.length;m++){if(!t[m])continue;const u=[t[m]],o={uidt:this.detectInitialUidt(t[m])};Mt(u)?o.uidt=c.LongText:o.uidt===c.SingleLineText?Bt(u)?o.uidt=c.Email:zt(u)?o.uidt=c.URL:dt(u)?o.uidt=c.Checkbox:t[m]&&m<this.config.maxRowsToParse&&(this.columnValues[m].push(t[m]),o.uidt=c.SingleSelect):o.uidt===c.Number?Rs(u)&&(o.uidt=c.Decimal):o.uidt===c.DateTime&&t[m]&&m<this.config.maxRowsToParse&&this.columnValues[m].push(t[m]),o.uidt in this.detectedColumnTypes[m]||(this.detectedColumnTypes[m]={...this.detectedColumnTypes[m],[o.uidt]:0}),this.detectedColumnTypes[m][o.uidt]+=1,t[m]&&this.distinctValues[m].add(t[m])}}getPossibleUidt(d){const t=this.detectedColumnTypes[d],m=Object.keys(t).length;return m===0?c.SingleLineText:m===2&&c.Number in t&&c.Decimal in t?c.Decimal:m>1?c.LongText in t?c.LongText:c.SingleLineText:Object.keys(t)[0]}updateTemplate(d){for(let t=0;t<this.headers[d].length;t++){const m=this.existingColumnMap[this.headers[d][t]];let u=m==null?void 0:m.uidt;if(u||(u=this.getPossibleUidt(t)),this.columnValues[t].length>0){if(u===c.DateTime){const o={};if(this.columnValues[t].slice(1,this.config.maxRowsToParse).every(D=>{const i=D.split(" ").length===1;return i&&(o[Ye(D)]=(o[Ye(D)]||0)+1),i})){this.tables[d].columns[t].uidt=c.Date;const D=Object.keys(o);this.tables[d].columns[t].meta.date_format=D.length?D.reduce((i,h)=>o[i]>o[h]?i:h):"YYYY/MM/DD"}else this.tables[d].columns[t].uidt=u}else u===c.SingleSelect||u===c.MultiSelect?(this.tables[d].columns[t].uidt=c.SingleLineText,Object.assign(this.tables[d].columns[t],Vt(this.columnValues[t]))):this.tables[d].columns[t].uidt=u;delete this.columnValues[t]}else this.tables[d].columns[t].uidt=u}}async _parseTableData(d,t,m,u){return new Promise((o,D)=>{const i=this;let h=0;if(i.config.shouldImportData){i.progress(`Preparing ${u} data`),i.progress({title:u,value:"Preparing..."}),h=0;const A=this.config.importFromURL?t:t.originFileObj;Tt.parse(A,{download:i.config.importFromURL,skipEmptyLines:"greedy",encoding:t==null?void 0:t.encoding,step(_){if(h+=1,_&&h>=+i.config.firstRowAsHeaders+1){const w={};for(let x=0;x<i.headers[d].length;x++){const L=i.tables[d].columns[x],W=i.existingColumnMap[i.headers[d][x]],E=_.data[x]===""?null:_.data[x];if(L.uidt===c.Checkbox)w[L.column_name]=ht(E);else if(L.uidt===c.SingleSelect||L.uidt===c.MultiSelect)w[L.column_name]=(E||"").toString().trim()||null;else if([c.Date,c.DateTime].includes(L.uidt)&&W)if(E instanceof Date)w[L.column_name]=E;else{const V=Jt(W.meta),Y=Ht(i.config.isEeUI,V==null?void 0:V.timezone).dayjsTz(E,V!=null&&V.date_format&&V.time_format?`${V.date_format} ${V.time_format}`:void 0);w[L.column_name]=Y!=null&&Y.isValid()?Y.format("YYYY-MM-DD HH:mm:ss Z"):E}else w[L.column_name]=E}i.data[m].push(w)}h%1e3===0&&(i.progress(`Prepared ${h} rows of ${u}`),i.progress({title:u,value:`Prepared ${h} rows`}))},complete(){i.progress(`Prepared ${u} data`),i.progress({title:u,value:"Prepared"}),o(!0)},error(_){D(_)}})}else o(!0)})}async _parseTableMeta(d,t){return new Promise((m,u)=>{const o=this;let D=0;const i=this.config.importFromURL?t.split("/").pop()??"":t.name;let h=(this.config.importFromURL?t.split("/").pop():t.name).replace(/[` ~!@#$%^&*()_|+\-=?;:'",.<>\{\}\[\]\\\/]/g,"_").trim();this.tableNames.includes(h)&&(h=Us(h,this.tableNames.map(_=>({title:_})),"title","_")),this.tableNames.push(h),this.data[h]=[];const A=this.config.importFromURL?t:t.originFileObj;Tt.parse(A,{download:o.config.importFromURL,skipEmptyLines:"greedy",step(_){D+=1,_&&(D===1?o.config.firstRowAsHeaders?o.initTemplate(d,h,_.data):(o.initTemplate(d,h,[...Array(_.data.length)].map((w,x)=>`field_${x+1}`)),o.config.autoSelectFieldTypes&&o.detectColumnType(d,_.data)):o.config.autoSelectFieldTypes&&o.detectColumnType(d,_.data))},async complete(){o.updateTemplate(d),o.base.tables.push(o.tables[d]),o.progress(`Prepared ${i} metadata`),o.progress({title:i,value:"Prepared metadata"}),await o._parseTableData(d,t,h,i),m(!0)},error(_){u(_)}})})}async parse(){this.config.importFromURL?await this._parseTableMeta(0,this.source):await Promise.all(this.source.map((d,t)=>(async(m,u)=>{this.progress(`Reading ${m.name}`),this.progress({title:m.name,value:"Reading..."}),await this._parseTableMeta(u,m)})(d,t)))}getColumns(){return this.base.tables.map(d=>d.columns)}getData(){return this.data}getTemplate(){return this.base}progress(d){var t;(t=this.progressCallback)==null||t.call(this,d)}}const Aa={d:c.DateTime,b:c.Checkbox,n:c.Number,s:c.SingleLineText};class Wt extends Kt{constructor(t={},m={},u=null,o,D){super(o);F(this,"config");F(this,"excelData");F(this,"base");F(this,"data",{});F(this,"wb");F(this,"xlsx");F(this,"existingColumnMap",{});if(this.config=m,this.excelData=t,this.base={tables:[]},this.xlsx=u,D&&D.length)for(const i of D)this.existingColumnMap[i.title]=i,this.existingColumnMap[i.column_name]=i}async init(){this.progress("Initializing excel parser"),this.xlsx=this.xlsx||await gt(()=>import("./D1WdcQcK.js"),[],import.meta.url);const t={cellText:!0,cellDates:!0};this.wb=this.xlsx.read(new Uint8Array(this.excelData),{type:"array",...t})}async parse(){this.progress("Reading excel file");const t={};await Promise.all(this.wb.SheetNames.map(m=>(async u=>{this.progress(`Reading sheet ${m}`),await new Promise(o=>{var Y;const D={id:0,Id:0};let i=(u||"table").replace(/[` ~!@#$%^&*()_|+\-=?;:'",.<>\{\}\[\]\\\/]/g,"_").trim();for(;i in t;)i=`${i}${++t[i]}`;t[i]=0;const h={table_name:i,ref_table_name:i,columns:[]},A=this.wb.Sheets[u],_={};if(!A||!A["!ref"])return o(!0);const w=this.xlsx.utils.decode_range(A["!ref"]);let x=this.xlsx.utils.sheet_to_json(A,{header:1,blankrows:!1,defval:null});const L=new Date(1899,11,30,0,0,0),W=L.getTime()+(new Date().getTimezoneOffset()-L.getTimezoneOffset())*6e4,E=24*60*60*1e3,V=$=>{const C=this.xlsx.SSF.parse_date_code(($.getTime()-W)/E,{date1904:this.wb.Workbook.WBProps.date1904});return new Date(C.y,C.m,C.d,C.H,C.M,C.S)};if(x[0]&&x[0].length)for(let $=0;$<x[0].length;$++){const C=(this.config.firstRowAsHeaders&&x[0]&&x[0][$]&&x[0][$].toString().trim()||`Field ${$+1}`).trim();let O=(this.config.firstRowAsHeaders&&x[0]&&x[0][$]&&x[0][$].toString().trim()||`field_${$+1}`).replace(/[` ~!@#$%^&*()_|+\-=?;:'",.<>\{\}\[\]\\\/]/g,"_").trim();for(;O in D;)O=`${O}${++D[O]}`;D[O]=0;const r={title:C,column_name:O,ref_column_name:O,meta:{},uidt:c.SingleLineText};h.columns.push(r);const y=this.existingColumnMap[r.title]??this.existingColumnMap[r.column_name];y&&((Y=y.meta)!=null&&Y.date_format)?_[$]=S=>{if(S instanceof Date)return S;const M=Jt(y.meta),z=Ht(this.config.isEeUI,M==null?void 0:M.timezone).dayjsTz(S,M.date_format&&M.time_format?`${M.date_format} ${M.time_format}`:void 0);return z!=null&&z.isValid()?z.format("YYYY-MM-DD HH:mm:ss Z"):S}:y&&[c.Number,c.Decimal,c.Currency].includes(y.uidt)&&(_[$]=S=>Number(S))}if(x=x.map($=>$.map((C,O)=>C instanceof Date?V(C):_[O]?_[O](C):C)),this.config.autoSelectFieldTypes)for(let $=0;$<x[0].length;$++){const C=h.columns[$],O=this.xlsx.utils.encode_cell({c:w.s.c+$,r:+this.config.firstRowAsHeaders}),r=A[O]||{};if(C.uidt=this.config.importDataOnly?Aa[r.t]||c.SingleLineText:c.SingleLineText,C.uidt===c.SingleLineText&&this.config.importDataOnly)if(Mt(x,$))C.uidt=c.LongText;else if(Bt(x,$))C.uidt=c.Email;else if(zt(x,$))C.uidt=c.URL;else{const y=x.slice(+this.config.firstRowAsHeaders).map(S=>S[$]).filter(S=>S!=null&&S.toString().trim()!=="");dt(y)?C.uidt=c.Checkbox:Object.assign(C,Vt(y))}else if(C.uidt===c.Number)x.slice(1,this.config.maxRowsToParse).some(y=>y&&y[$]&&parseInt(y[$])!==+y[$])&&(C.uidt=c.Decimal),x.slice(1,this.config.maxRowsToParse).every((y,S)=>{const M=this.xlsx.utils.encode_cell({c:w.s.c+$,r:S+ +this.config.firstRowAsHeaders}),z=A[M];return!z||z.w&&z.w.startsWith("$")})&&(C.uidt=c.Currency),x.slice(1,this.config.maxRowsToParse).some((y,S)=>{const M=this.xlsx.utils.encode_cell({c:w.s.c+$,r:S+ +this.config.firstRowAsHeaders}),z=A[M];return!z||z.w&&!(!isNaN(Number(z.w))&&!isNaN(parseFloat(z.w)))})&&(C.uidt=c.SingleLineText);else if(C.uidt===c.DateTime){const y={};x.slice(1,this.config.maxRowsToParse).every((S,M)=>{const z=this.xlsx.utils.encode_cell({c:w.s.c+$,r:M+ +this.config.firstRowAsHeaders}),Z=A[z],H=!Z||Z.w&&Z.w.split(" ").length===1;return H&&Z&&(y[Ye(Z.w)]=(y[Ye(Z.w)]||0)+1),H})&&(C.uidt=c.Date,C.meta.date_format=Object.keys(y).reduce((S,M)=>y[S]>y[M]?S:M)||"YYYY/MM/DD")}}if(this.base.tables.push(h),this.data[i]=[],this.config.shouldImportData){this.progress(`Reading data from ${i}`);let $=0;for(const C of x.slice(1)){const O={};for(let r=0;r<h.columns.length;r++)if(!this.config.autoSelectFieldTypes||!this.config.importDataOnly){const y=this.xlsx.utils.encode_cell({c:w.s.c+r,r:$+ +this.config.firstRowAsHeaders}),S=A[y];O[h.columns[r].column_name]=S&&S.w||C[r]}else if(h.columns[r].uidt===c.Checkbox)O[h.columns[r].column_name]=ht(C[r]);else if(h.columns[r].uidt===c.Currency){const y=this.xlsx.utils.encode_cell({c:w.s.c+r,r:$+ +this.config.firstRowAsHeaders}),S=A[y];O[h.columns[r].column_name]=S&&typeof(S==null?void 0:S.w)=="string"&&S.w.replace(/[^\d.]+/g,"")||C[r]}else if(h.columns[r].uidt===c.SingleSelect||h.columns[r].uidt===c.MultiSelect)O[h.columns[r].column_name]=(C[r]||"").toString().trim()||null;else if(h.columns[r].uidt===c.Date){const y=this.xlsx.utils.encode_cell({c:w.s.c+r,r:$+ +this.config.firstRowAsHeaders}),S=A[y];O[h.columns[r].column_name]=S&&S.w||C[r]}else if(h.columns[r].uidt===c.SingleLineText||h.columns[r].uidt===c.LongText){const y=C[r];O[h.columns[r].column_name]=y==null?null:typeof y=="number"?y:`${y}`}else O[h.columns[r].column_name]=C[r];this.data[i].push(O),$++}}o(!0)})})(m)))}getTemplate(){return this.base}getData(){return this.data}getColumns(){return this.base.tables.map(t=>t.columns)}}class ja extends Wt{constructor(t,m,u,o=null,D,i){super({},m,o,D,i);F(this,"url");F(this,"excelData");F(this,"$api");this.url=t,this.excelData=null,this.$api=u}async init(){this.progress("Downloading excel file");const t=await this.$api.utils.axiosRequestMake({apiMeta:{url:this.url}});this.excelData=t.data,await super.init()}}const Ma=qt(()=>gt(()=>import("./CEywAgwo.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12]),import.meta.url).then(T=>T.default||T)),Ba=qt(()=>gt(()=>import("./CtCRqrd3.js"),__vite__mapDeps([13,1,2,14,15]),import.meta.url).then(T=>T.default||T)),za={class:"text-base font-weight-700 m-0 flex items-center gap-3"},Va={key:1},Ja={class:"flex gap-2 items-center"},Ha={class:"text-sm"},qa={class:"relative mt-5"},Ga={class:"!mt-2 text-[13px]"},Ya={class:"text-nc-content-brand hover:underline"},Ka={class:"!mt-3 text-[13px] text-gray-500"},Wa={class:"ant-upload-hint"},Qa={class:"flex items-center gap-4"},Xa={class:"bg-nc-bg-gray-extralight h-9 w-9 flex flex-none items-center justify-center rounded-lg"},Za={class:"flex flex-col flex-grow min-w-[0px] w-[calc(100%_-_233px)]"},eo={class:"flex-none"},to={class:"text-small text-nc-content-gray-muted font-weight-500"},so={class:"!text-small text-nc-content-gray-muted"},ao={class:"flex gap-2 items-center"},oo={class:"text-sm"},no={class:"relative mt-5 mb-1 px-1"},lo={class:"flex items-center space-x-2 w-full"},io={class:"flex-1 text-nc-content-gray text-sm"},ro={class:"!text-small text-nc-content-gray-muted"},co={class:"flex gap-2 items-center"},uo={class:"text-sm"},mo={class:"relative mt-5"},po={class:"flex items-end gap-2"},fo={class:"!text-small text-nc-content-gray-muted"},ho={key:0,class:"text-nc-content-red-medium text-small mt-2"},go={key:1},yo={key:0,class:"mt-5"},vo={class:"mb-4"},bo={class:"caption"},_o={class:"caption"},wo={class:"flex items-center gap-2 pt-5"},xo=mt({__name:"QuickImport",props:{modelValue:{type:Boolean},importType:{},baseId:{},sourceId:{},importDataOnly:{type:Boolean,default:!1},transition:{},showBackBtn:{type:Boolean},wrapClassName:{default:""},showSourceSelector:{type:Boolean,default:!0}},emits:["update:modelValue","back"],setup(T,{expose:d,emit:t}){const m=zs(T,["importType","importDataOnly","baseId","sourceId","transition","showBackBtn","wrapClassName","showSourceSelector"]),u=t,{$api:o,$importWorker:D}=lt();let i;const{appInfo:h}=xt(),A=Ks(),_=Es(Os,U()),w=G(()=>{var s,a;return((a=(s=_.value)==null?void 0:s.columns)==null?void 0:a.filter(I=>!I.system))||[]}),x=typeof Worker<"u",{t:L}=Fs(),W=U("Reading data ..."),E=U({}),V=Lt(),{activeWorkspace:Y}=it(V),$=Ns(),{loadProjectTables:C}=$,{baseTables:O}=it($),r=U(),y=U(!1),S=U(!1),M=U(),z=U(),Z=U([]),H=U(!1),Ee=U(!1),fe=U(""),Te=U({}),de=U(""),ae=U("upload"),Se=U(!1),me=U(),Oe=U(),Ke=G(()=>{var s;return((s=Oe.value)==null?void 0:s.customSourceId)||T.sourceId}),We=Ge.useForm,he={fileList:[],url:"",jsonEditor:{},parserConfig:{maxRowsToParse:500,normalizeNested:!0,autoSelectFieldTypes:!0,firstRowAsHeaders:!0,shouldImportData:!0,importDataOnly:!0}},f=Ps(structuredClone(he)),{token:ye}=xt(),n=G(()=>T.importType==="json"),l=G(()=>T.importType==="csv"),q=G(()=>T.importType==="excel"),J=G(()=>({url:[As,l.value?js:Ms]})),{validate:ge,validateInfos:$e}=We(f,J),le=G(()=>q.value?{header:T.importDataOnly?L("activity.uploadExcel"):L("title.quickImportExcel"),icon:"importExcel",uploadHint:"",urlInputLabel:L("msg.info.excelURL"),loadUrlDirective:["c:quick-import:excel:load-url"],acceptTypes:".xls, .xlsx, .xlsm, .ods, .ots"}:l.value?{header:T.importDataOnly?L("activity.uploadCSV"):L("title.quickImportCSV"),icon:"importCsv",uploadHint:"",urlInputLabel:L("msg.info.csvURL"),loadUrlDirective:["c:quick-import:csv:load-url"],acceptTypes:".csv"}:n.value?{header:`${L("title.quickImportJSON")}`,icon:"importJson",uploadHint:"",acceptTypes:".json"}:{}),pe=Bs(m,"modelValue",u);rt(pe,async s=>{s&&(Object.assign(f,structuredClone(he)),x&&(i=await(D==null?void 0:D.get())))},{immediate:!0});const Ce=G(()=>{var s;return((s=f.fileList)==null?void 0:s.length)>0}),oe=G(()=>{var s;return((s=$e==null?void 0:$e.url)==null?void 0:s.validateStatus)==="success"&&!!f.url}),Ae=G(()=>{try{return me.value.isValid&&JSON.stringify(f.jsonEditor).length>2}catch{return!1}}),te=U(""),je=G(()=>{var s;return te.value??((s=r.value)==null?void 0:s.importError)??""}),ve=G(()=>l.value?3:1),Qe=G(()=>y.value||f.fileList.length>=ve.value),Xe=G(()=>ae.value==="upload"?!Ce.value:ae.value==="uploadFromUrl"?!oe.value:ae.value==="uploadJSON"?!Ae.value:!0),Me=(s=!1)=>{if(H.value)return s?"":T.importDataOnly?L("activity.upload"):L("activity.import");const a=n.value?L("labels.jsonCapitalized"):L("objects.files");return s?"":T.importDataOnly?`${L("activity.upload")} ${a}`:`${L("activity.import")} ${a}`},Be=G(()=>Me(S.value||y.value)),xe=G(()=>{var s;return!((s=r.value)!=null&&s.isValid)||Se.value});let ie;async function ze(){y.value=!0,Ee.value=!0,te.value="",O.value.get(T.baseId)||await C(T.baseId);const s=Ce.value&&ae.value==="upload";if(l.value){if(s)await be(f.fileList);else if(oe.value)try{await ge(),await be(f.url)}catch(a){te.value=await Ue(a)}}else if(n.value)s?x&&i?await be(f.fileList):await be(f.fileList[0].data):Ae.value&&await be(JSON.stringify(f.jsonEditor));else if(q){if(s)x&&i?await be(f.fileList):await be(f.fileList[0].data);else if(oe.value)try{await ge(),await be(f.url)}catch(a){te.value=await Ue(a)}}Ee.value=!1,y.value=!1}async function Fe(){var s;te.value="";try{if(!ie&&!i){te.value=L("msg.error.templateGeneratorNotFound");return}S.value=!0,await r.value.importTemplate(),H.value=!1,Object.assign(f,he),pe.value=!1,(s=Y.value)!=null&&s.id&&V.loadWorkspace(Y.value.id)}catch(a){console.log(a);const I=await Ue(a);te.value=I;return}finally{S.value=!1}}function j(s){s.map(a=>Pe.error(`${L("msg.error.fileUploadFailed")} ${a.name}`))}function Ze(s){const a=s.file.status;if(a&&a!=="uploading"&&a!=="removed")if(l.value||x&&i)f.fileList.find(I=>I.uid===s.file.uid)?f.fileList.find(I=>I.uid===s.file.uid).encoding="utf-8":f.fileList.push({...s.file,status:"done",encoding:"utf-8"});else{const I=new FileReader;I.onload=Q=>{const K=f.fileList.find(ee=>ee.uid===s.file.uid);Q.target&&Q.target.result&&(K?K.data=Q.target.result:K||f.fileList.push({...s.file,status:"done",data:Q.target.result,encoding:"utf-8"}))},I.readAsArrayBuffer(s.file.originFileObj)}a==="error"&&Pe.error(`${L("msg.error.fileUploadFailed")} ${s.file.name}`)}function Qt(){var s;(s=me.value)==null||s.format()}function Xt(s,a=[]){var Q;let I=1;for(;a.includes(s)||(Q=O.value.get(T.baseId))!=null&&Q.some(K=>{const ee=K.table_name.split("___");let _e=K.table_name;return ee.length>1&&(_e=ee[1]),_e===`${s}`||K.table_name===`${s}`});)s=`${s}_${I++}`;return s}function Zt(s){const a=Ce.value&&ae.value==="upload";return l.value?a?new Ct(s,{...f.parserConfig,importFromURL:!1},void 0,e(w)):new Ct(s,{...f.parserConfig,importFromURL:!0},void 0,e(w)):q.value?a?new Wt(s,f.parserConfig,void 0,void 0,e(w)):new ja(s,f.parserConfig,o,void 0,void 0,e(w)):n.value?a?new $t(s,f.parserConfig):new $t(s,f.parserConfig):null}d({handleChange:Ze});const es=s=>{f.fileList.forEach(a=>{a.uid===s.file.uid&&(a.status="done",Ze({file:a,fileList:f.fileList}))}),s.onSuccess()},ke=U(!1),ts=(s,a)=>{f.fileList.length+a.length>ve.value&&(ke.value=!0);const I=s.size/1024/1024>25;return I&&Pe.error(`File ${s.name} is too big. The accepted file size is less than 25MB.`),!I||sa.LIST_IGNORE};function ss(s){let a;l.value?a=Ie.CSV:q.value?a=Ie.EXCEL:n.value&&(a=Ie.JSON),a=a??Ie.CSV;let I;return Ce.value&&ae.value==="upload"?I=Ne.FILE:oe.value&&a!==Ie.JSON?I=Ne.URL:a===Ie.JSON&&(I=Ne.STRING),I=I??Ne.FILE,{config:{...ot(f.parserConfig),importFromURL:I===Ne.URL,isEeUI:Dt},existingColumns:Xs()(e(w)),value:s,importType:a,importSource:I}}async function be(s){M.value=null,z.value=null,Z.value=[];try{if(x&&i){i.postMessage([Je.INIT_SDK,{baseURL:A.public.ncBackendUrl||h.value.ncSiteUrl||Ws,token:ye.value}]);let a=ot(s);Array.isArray(a)&&(a=a.map(K=>ot(K)));const I=ss(a);i.postMessage([Je.SET_TABLES,e(O.value.get(T.baseId)??[]).map(K=>({table_name:K.table_name,title:K.title}))]),i.postMessage([Je.SET_CONFIG,{importDataOnly:T.importDataOnly,importColumns:!!Z.value,importData:!!z.value,isEeUI:Dt}]);const Q=await new Promise((K,ee)=>{const _e=et=>{const[De,ne]=et.data;switch(De){case nt.PROCESSED_DATA:K(ne),i==null||i.removeEventListener("message",_e,!1);break;case nt.PROGRESS:Qs(ne,["title","value"])?E.value={...E.value,[ne.title]:(ne==null?void 0:ne.value)??""}:W.value=ne;break;case nt.ERROR:ee(ne),i==null||i.removeEventListener("message",_e,!1);break}};i==null||i.addEventListener("message",_e,!1),i==null||i.postMessage([Je.PROCESS,I])});M.value=Q.templateData,Z.value=Q.importColumns,z.value=Q.importData}else{if(ie=Zt(s),!ie){te.value=L("msg.error.templateGeneratorNotFound");return}if(await ie.init(),await ie.parse(),M.value=ie.getTemplate(),T.importDataOnly)Z.value=ie.getColumns();else{const a=[];M.value.tables=M.value.tables.map(I=>{const Q=Xt(I.table_name,a);return a.push(Q),{...I,table_name:Q}})}z.value=ie.getData()}H.value=!0,ke.value=!1}catch(a){console.log(a),typeof a=="string"&&oe.value&&ae.value==="uploadFromUrl"?te.value=a.replace(f.url,"").replace(/''/,""):te.value=await Ue(a)||(a==null?void 0:a.toString())}}const as=()=>{Se.value=!0},os=()=>{Se.value=!1};pt(()=>{f.parserConfig.importDataOnly=T.importDataOnly,f.parserConfig.autoSelectFieldTypes=T.importDataOnly});const yt=()=>{D.terminate(),Object.assign(f,he),y.value=!1,S.value=!1,M.value=void 0,z.value=void 0,Z.value=[],H.value=!1,Ee.value=!1,Te.value={},de.value="",Se.value=!1,te.value=""};Vs(()=>{yt()});const ns=()=>{pe.value=!1,u("back"),yt()};function ls(s){try{Te.value=s,f.jsonEditor=JSON.parse(JSON.stringify(s)),de.value=""}catch(a){de.value=a.message||"Invalid JSON"}}function vt(){var s,a;te.value="",(a=(s=r.value)==null?void 0:s.updateImportError)==null||a.call(s,"")}return rt(()=>f.fileList,()=>{n.value&&setTimeout(()=>{var a,I;const s=(I=(a=f.fileList)==null?void 0:a[0])==null?void 0:I.data;if(s&&"TextDecoder"in window)try{Te.value=JSON.parse(new TextDecoder().decode(s)),f.jsonEditor=JSON.parse(new TextDecoder().decode(s))}catch(Q){console.log(Q)}},500),f.fileList.length<ve.value&&ke.value&&(ke.value=!1)}),(s,a)=>{const I=Rt,Q=Ma,K=It,ee=ct,_e=Gs,et=qs,De=Ut,ne=Nt,is=ta,bt=Pt,tt=Hs,rs=Et,cs=Ge,us=Ba,ds=Js,ms=Ot,st=Ft,ps=Yt,fs=Gt,hs=jt;return b(),N(hs,{visible:e(pe),"onUpdate:visible":a[12]||(a[12]=R=>Re(pe)?pe.value=R:null),class:ue([{active:e(pe)},"!top-[12.5vh]"]),closable:!1,width:e(H)&&s.importDataOnly?"640px":"448px","wrap-class-name":`nc-modal-quick-import ${s.wrapClassName}`,"transition-name":s.transition,onKeydown:a[13]||(a[13]=At(R=>pe.value=!1,["esc"]))},{footer:p(()=>{var R,re;return[v("div",wo,[e(H)?(b(),N(ee,{key:"back",type:"text",size:"small",disabled:e(S),onClick:a[11]||(a[11]=we=>H.value=!1)},{default:p(()=>[g(I,{icon:"chevronLeft",class:"mr-1"}),P(" "+k(s.$t("general.back")),1)]),_:1},8,["disabled"])):(b(),N(ee,{key:"cancel",type:"text",size:"small",onClick:ns},{default:p(()=>[s.showBackBtn?(b(),N(I,{key:0,icon:"chevronLeft",class:"mr-1"})):X("",!0),P(" "+k(s.showBackBtn?s.$t("general.back"):s.$t("general.cancel")),1)]),_:1})),a[18]||(a[18]=v("div",{class:"flex-1"},null,-1)),e(H)?(b(),N(ee,{key:"import",size:"small",loading:e(S),disabled:e(xe)||e(S),onClick:Fe},{default:p(()=>[P(k(e(Be)),1)]),_:1},8,["loading","disabled"])):(b(),N(ee,{key:"pre-import",size:"small",class:"nc-btn-import",loading:e(y),disabled:e(Xe)||e(y)||((re=(R=e(Oe))==null?void 0:R.selectedSource)==null?void 0:re.ncItemDisabled),onClick:ze},{default:p(()=>[P(k(e(Be)),1)]),_:1},8,["loading","disabled"]))])]}),default:p(()=>[v("div",{class:ue(["relative",{"cursor-wait":e(y)||e(S)}])},[v("div",za,[g(I,{icon:e(le).icon,class:"w-6 h-6"},null,8,["icon"]),P(" "+k(e(le).header)+" ",1),a[14]||(a[14]=v("a",{href:"https://nocodb.com/docs/product-docs/tables/create-table-via-import",class:"!text-nc-content-gray-subtle2 text-sm font-weight-500 ml-auto",target:"_blank",rel:"noopener"}," Docs ",-1))]),v("div",{class:ue(["mt-5",{"pointer-events-none":e(S)}])},[e(H)?(b(),N(Q,{key:0,ref_key:"templateEditorRef",ref:r,"base-template":e(M),"import-data":e(z),"import-columns":e(Z),"import-data-only":s.importDataOnly,"quick-import-type":s.importType,"max-rows-to-parse":e(f).parserConfig.maxRowsToParse,"base-id":s.baseId,"source-id":e(Ke),"import-worker":e(i),"table-icon":e(le).icon,class:"nc-quick-import-template-editor",onImport:Fe,onError:as,onChange:os},null,8,["base-template","import-data","import-columns","import-data-only","quick-import-type","max-rows-to-parse","base-id","source-id","import-worker","table-icon"])):(b(),B("div",Va,[g(ds,{"active-key":e(ae),"onUpdate:activeKey":[a[5]||(a[5]=R=>Re(ae)?ae.value=R:null),vt],class:"nc-quick-import-tabs"},{default:p(()=>[(b(),N(tt,{key:"upload",disabled:e(y),class:"!h-full"},{tab:p(()=>[v("div",Ja,[v("span",Ha,k(s.$t("general.upload")),1)])]),default:p(()=>[v("div",qa,[g(is,{"file-list":e(f).fileList,"onUpdate:fileList":a[0]||(a[0]=R=>e(f).fileList=R),name:"file",class:ue(["nc-modern-drag-import nc-input-import !scrollbar-thin-dull !py-4 !transition !rounded-lg !border-gray-200",{hidden:e(Qe)}]),"list-type":"picture",accept:e(le).acceptTypes,"max-count":e(ve),multiple:!0,disabled:e(y),"custom-request":es,"before-upload":ts,onChange:Ze,onReject:j},{itemRender:p(({file:R,actions:re})=>[v("div",Qa,[v("div",Xa,[g(I,{icon:e(le).icon,class:"w-5 h-5 flex-none"},null,8,["icon"])]),v("div",Za,[v("div",eo,[g(K,{"show-on-truncate-only":"",class:"truncate text-sm text-nc-content-gray font-weight-500"},{title:p(()=>[P(k(R.name),1)]),default:p(()=>[P(" "+k(R.name),1)]),_:2},1024)]),v("div",to,k(("getReadableFileSize"in s?s.getReadableFileSize:e(ea))(R.size)),1)]),e(y)?(b(),B(Le,{key:1},[(b(),N(K,{key:e(E)[R.name]||e(W),class:"!max-w-[120px] min-w-[120p] !leading-[18px] truncate","show-on-truncate-only":""},{title:p(()=>[P(k(e(E)[R.name]||e(W)),1)]),default:p(()=>[v("span",so,k(e(E)[R.name]||e(W)),1)]),_:2},1024)),g(ne,{class:"flex text-nc-content-brand",size:"medium"})],64)):(b(),B(Le,{key:0},[g(De,{class:"flex-1 !my-0 max-w-[120px] min-w-[120px]"},{default:p(()=>[g(et,{placement:"bottomRight","overlay-class-name":"overflow-hidden !w-[170px]"},{default:p(({visible:we})=>[g(ee,{size:"small",type:"secondary",class:"w-[120px] children:children:w-full !text-small"},{default:p(()=>[g(K,{class:"flex-none w-[85px] truncate text-left !leading-[20px]","show-on-truncate-only":""},{title:p(()=>{var se;return[P(k(((se=e(kt)[R.encoding])==null?void 0:se.sortLabel)??""),1)]}),default:p(()=>{var se,Ve;return[P(" "+k(((Ve=(se=e(kt)[R.encoding])==null?void 0:se.sortLabel)==null?void 0:Ve.replace("Windows","Win"))??""),1)]}),_:2},1024),g(I,{icon:"chevronDown",class:ue(["flex-none transform",{"rotate-180":we}])},null,8,["class"])]),_:2},1024)]),overlay:p(({visible:we,onChange:se})=>[g(_e,{value:R.encoding,"onUpdate:value":Ve=>R.encoding=Ve,open:we,list:e(Ys),"search-input-placeholder":"Search","option-label-key":"sortLabel","option-value-key":"value",class:"!w-full",variant:"small","onUpdate:open":se},null,8,["value","onUpdate:value","open","list","onUpdate:open"])]),_:2},1024)]),_:2},1024),g(ee,{type:"text",size:"xsmall",class:"flex-shrink",onClick:we=>{var se;return(se=re==null?void 0:re.remove)==null?void 0:se.call(re)}},{default:p(()=>[g(I,{icon:"deleteListItem"})]),_:2},1032,["onClick"])],64))])]),default:p(()=>[(b(),N(He(("iconMap"in s?s.iconMap:e(qe)).upload),{class:"w-6 h-6"})),v("p",Ga,[P(k(s.$t("msg.dropYourDocHere"))+" "+k(s.$t("general.or").toLowerCase())+" ",1),v("span",Ya,k(s.$t("labels.browseFiles")),1)]),v("p",Ka,k(s.$t("general.supported"))+": "+k(e(le).acceptTypes),1),v("p",Wa,k(e(le).uploadHint),1)]),_:1},8,["file-list","class","accept","max-count","disabled"]),g(bt,{visible:e(ke),"onUpdate:visible":a[1]||(a[1]=R=>Re(ke)?ke.value=R:null),closable:"",align:"center",type:"warning","show-icon":"","message-class":"!text-sm","description-class":"!text-small !leading-[18px]",class:"mt-5",message:s.$t("msg.warning.reachedUploadLimit"),description:s.$t(`msg.warning.${e(ve)>1?"youCanOnlyUploadMaxLimitFilesAtATimePlural":"youCanOnlyUploadMaxLimitFilesAtATime"}`,{limit:e(ve),type:s.$t(`labels.${s.importType}`)})},null,8,["visible","message","description"])])]),_:1},8,["disabled"])),e(n)?X("",!0):(b(),N(tt,{key:"uploadFromUrl",disabled:e(y),class:"!h-full"},{tab:p(()=>[v("div",ao,[v("span",oo,k(s.$t("labels.addFromUrl")),1)])]),default:p(()=>[v("div",no,[g(cs,{model:e(f),name:"quick-import-url-form",layout:"vertical",class:"!my-0"},{default:p(()=>[g(De,ut(e($e).url,{required:!1,class:"!my-0 quick-import-url-form"}),{label:p(()=>[v("div",lo,[v("span",io,k(e(le).urlInputLabel),1),e(y)?(b(),B(Le,{key:0},[(b(),N(K,{key:e(E)[e(f).url.split("/").pop()??""]||e(W),class:"!max-w-1/2 min-w-[120p] !leading-[18px] truncate","show-on-truncate-only":""},{title:p(()=>[P(k(e(E)[e(f).url.split("/").pop()??""]||e(W)),1)]),default:p(()=>[v("span",ro,k(e(E)[e(f).url.split("/").pop()??""]||e(W)),1)]),_:1})),g(ne,{class:"flex text-nc-content-brand",size:"medium"})],64)):X("",!0)])]),default:p(()=>[g(rs,{value:e(f).url,"onUpdate:value":a[2]||(a[2]=R=>e(f).url=R),class:"!rounded-md",placeholder:"Paste file link here...",disabled:e(y)},null,8,["value","disabled"])]),_:1},16)]),_:1},8,["model"])])]),_:1},8,["disabled"])),e(n)?(b(),N(tt,{key:"uploadJSON",disabled:e(y),class:"!h-full"},{tab:p(()=>[v("div",co,[v("span",uo,k(s.$t("labels.enterJson")),1)])]),default:p(()=>{var R,re,we;return[v("div",mo,[v("div",po,[a[16]||(a[16]=v("label",{class:"text-nc-content-gray text-sm"}," Enter Json ",-1)),a[17]||(a[17]=v("div",{class:"flex-1"},null,-1)),e(y)?(b(),B(Le,{key:0},[(b(),N(K,{key:e(E)[e(f).url.split("/").pop()??""]||e(W),class:"!max-w-1/2 min-w-[120p] !leading-[25px] truncate","show-on-truncate-only":""},{title:p(()=>[P(k(e(E)[e(f).url.split("/").pop()??""]||e(W)),1)]),default:p(()=>[v("span",fo,k(e(E)[e(f).url.split("/").pop()??""]||e(W)),1)]),_:1})),g(ne,{class:"flex text-nc-content-brand",size:"medium"})],64)):(b(),N(ee,{key:1,type:"text",size:"xsmall",class:"!px-2",onClick:a[3]||(a[3]=se=>Qt())},{default:p(()=>a[15]||(a[15]=[P(" Format ")])),_:1,__:[15]}))]),v("div",{class:ue(["mx-0.5 mb-0.5 h-30 min-h-30 resize-y overflow-y-auto h-[calc(100%_-_8px)] max-h-[400px] border-1 rounded-lg mt-2 transition duration-300 focus-within:shadow-selected focus-within:border-primary",{"border-nc-border-red focus-within:shadow-error focus-within:border-nc-border-red ":e(de)||((R=e(me))==null?void 0:R.error)}])},[g(us,{ref_key:"refMonacoEditor",ref:me,class:"nc-import-monaco-editor !h-full min-h-30","auto-focus":!1,"hide-minimap":"","monaco-config":{lineNumbers:"on"},"model-value":e(Te),"onUpdate:modelValue":a[4]||(a[4]=se=>ls(se))},null,8,["model-value"])],2),e(de)||(re=e(me))!=null&&re.error?(b(),B("div",ho,k(e(de)||((we=e(me))==null?void 0:we.error)),1)):(b(),B("div",go))])]}),_:1},8,["disabled"])):X("",!0)]),_:1},8,["active-key"])]))],2),g(bt,{visible:!!e(je),closable:"",align:"center",type:"error","show-icon":"",class:"mt-5","message-class":"!text-sm","description-class":"!text-small !leading-[18px]","copy-text":e(je),message:s.$t("msg.error.importError"),description:s.$t("msg.error.anErrorOccuredWhileImporting",{type:Me(!0)}),onClose:vt},null,8,["visible","copy-text","message","description"]),e(H)?X("",!0):(b(),B("div",yo,[v("div",vo,[g(ms,{ref_key:"sourceSelectorRef",ref:Oe,"base-id":s.baseId,"source-id":s.sourceId,"show-source-selector":s.showSourceSelector,"force-layout":"vertical"},null,8,["base-id","source-id","show-source-selector"])]),g(ee,{type:"text",size:"small",onClick:a[6]||(a[6]=R=>fe.value=e(fe)?"":"advanced-settings")},{default:p(()=>[P(k(s.$t("title.advancedSettings"))+" ",1),g(I,{icon:"chevronDown",class:ue(["ml-2 !transition-all !transform",{"!rotate-180":e(fe)==="advanced-settings"}])},null,8,["class"])]),_:1}),g(fs,{"active-key":e(fe),"onUpdate:activeKey":a[10]||(a[10]=R=>Re(fe)?fe.value=R:null),ghost:"",class:ue(["nc-import-collapse",{"pointer-events-none":e(y)||e(S)}])},{default:p(()=>[g(ps,{key:"advanced-settings"},{default:p(()=>[e(l)||e(q)?(b(),N(De,{key:0,class:"!my-2 nc-dense-checkbox-container"},{default:p(()=>[g(st,{checked:e(f).parserConfig.firstRowAsHeaders,"onUpdate:checked":a[7]||(a[7]=R=>e(f).parserConfig.firstRowAsHeaders=R)},{default:p(()=>[v("span",bo,k(s.$t("labels.firstRowAsHeaders")),1)]),_:1},8,["checked"])]),_:1})):X("",!0),e(n)?(b(),N(De,{key:1,class:"!my-2 nc-dense-checkbox-container"},{default:p(()=>[g(st,{checked:e(f).parserConfig.normalizeNested,"onUpdate:checked":a[8]||(a[8]=R=>e(f).parserConfig.normalizeNested=R)},{default:p(()=>[v("span",_o,k(s.$t("labels.flattenNested")),1)]),_:1},8,["checked"])]),_:1})):X("",!0),s.importDataOnly?X("",!0):(b(),N(De,{key:2,class:"!my-2 nc-dense-checkbox-container"},{default:p(()=>[g(st,{checked:e(f).parserConfig.shouldImportData,"onUpdate:checked":a[9]||(a[9]=R=>e(f).parserConfig.shouldImportData=R)},{default:p(()=>[P(k(s.$t("labels.importData")),1)]),_:1},8,["checked"])]),_:1}))]),_:1})]),_:1},8,["active-key","class"])]))],2)]),_:1},8,["visible","class","width","wrap-class-name","transition-name"])}}}),ko=Object.assign(ft(xo,[["__scopeId","data-v-0cfc11ce"]]),{__name:"DlgQuickImport"}),Uo=Object.freeze(Object.defineProperty({__proto__:null,default:ko},Symbol.toStringTag,{value:"Module"}));export{Uo as Q,Ro as _,ko as a,ma as b};
