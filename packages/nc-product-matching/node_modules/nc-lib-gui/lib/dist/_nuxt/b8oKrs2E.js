import{e as de,G as U,r as x,bd as ce,f as re,bc as ue,b5 as _e,bX as me,n as $,gd as fe,aj as m,ie as pe,aG as G,ac as ve,I as f,K as v,L as n,o as s,w as i,b as u,ap as we,ad as ke,N as he,a as c,c as w,b9 as q,bo as H,t as p,d as D,O as L,an as N,aq as R,es as ye,eJ as be,o1 as ge,M as xe,ah as J,ae as De,Q as K,aH as Te,a4 as Q}from"./DRA9KN5F.js";import{_ as Ce}from"./GU4raMbz.js";import{u as Ie}from"./D7poRkS0.js";import{a as Me}from"./15xfm8CF.js";import"./DWLi1ZcL.js";import"./DkDj6Z7Z.js";import"./CQa0sIfA.js";import"./C2xdh4Xe.js";import"./gAYHr7Gr.js";import"./boyBAVNN.js";const Se={class:"flex items-center gap-2"},Ue={key:0,class:"text-capitalize !text-[13px] font-medium"},$e={class:"text-gray-800"},Ve=["title"],Ee={class:"flex items-center gap-1 max-w-[calc(100%_-_20px)]"},Ne={key:0,class:"w-full space-y-2"},Oe={class:"flex gap-1 items-center"},je={class:"flex"},ze=["title"],Le={class:"flex items-center gap-1 max-w-[calc(100%_-_20px)]"},Re={key:0,class:"flex items-center gap-2 !mt-2"},Be={class:"text-gray-800 font-semibold"},Fe=de({__name:"Range",setup(Ae){const V=U(ce,x()),{$api:W}=re(),k=U(ue,x()),g=U(_e,x(!1)),X=U(me,x(!1)),B=U(fe,$(()=>!1)),{loadViewColumns:Y}=Ie(),{loadCalendarMeta:Z,loadCalendarData:ee,loadSidebarData:ae,fetchActiveDates:te,updateCalendarMeta:le,viewMetaProperties:ne}=Me(),b=x(!1),O=$({get:()=>{var e;return!((e=ne.value)!=null&&e.hide_weekend)},set:e=>{le({meta:{hide_weekend:!e}})}}),E=$(()=>{var e,a;return(((a=(e=V.value)==null?void 0:e.columns)==null?void 0:a.filter(t=>{var _,d;return[m.DateTime,m.Date,m.CreatedTime,m.LastModifiedTime].includes(t.uidt)||t.uidt===m.Formula&&((d=(_=t.colOptions)==null?void 0:_.parsed_tree)==null?void 0:d.dataType)===pe.DATE}).map(t=>({label:t.title,value:t.id,uidt:t.uidt})))??[]).sort((t,_)=>{const d={[m.DateTime]:1,[m.Date]:2,[m.Formula]:3,[m.CreatedTime]:4,[m.LastModifiedTime]:5};return(d[t.uidt]||6)-(d[_.uidt]||6)})});G(()=>{var e;return(e=k.value)==null?void 0:e.id},async(e,a)=>{e!==a&&V.value&&await Y()},{immediate:!0});const F=$(()=>{var a;const e=[];return!k.value||!k.value.view||(a=k.value.view.calendar_range)==null||a.forEach(t=>{e.push({fk_from_column_id:t.fk_from_column_id,fk_to_column_id:t.fk_to_column_id})}),e}),h=x(F.value),A=$(()=>h.value.length>0&&h.value[0].fk_from_column_id);G(b,e=>{!e&&!A.value&&(b.value=!0,h.value.length===0&&h.value.push({fk_from_column_id:void 0,fk_to_column_id:null}))},{immediate:!0});const P=async()=>{var e;if(k.value)try{const a=h.value.filter(t=>t.fk_from_column_id).map(t=>({fk_from_column_id:t.fk_from_column_id,fk_to_column_id:t.fk_to_column_id}));await W.dbView.calendarUpdate((e=k.value)==null?void 0:e.id,{calendar_range:a}),k.value.view&&(k.value.view.calendar_range=a),await Z(),await Promise.all([ee(),ae(),te()])}catch(a){console.log(a),Q.error("There was an error while updating view!")}else Q.error("Please select a view first")},se=(e,a)=>{var d,T,C;if(!e||!a)return[];const t=(T=(d=V.value)==null?void 0:d.columns)==null?void 0:T.find(y=>y.id===a),_=(C=t==null?void 0:t.meta)==null?void 0:C.timezone;return e.filter(y=>{var o,S,l;const I=E.value.find(r=>r.value===a),j=(I==null?void 0:I.uidt)===y.uidt,M=(S=(o=V.value)==null?void 0:o.columns)==null?void 0:S.find(r=>r.id===y.value),z=((l=M==null?void 0:M.meta)==null?void 0:l.timezone)===_;return j&&y.value!==a&&z})},oe=async()=>{h.value=h.value.map((e,a)=>a===0?{fk_from_column_id:e.fk_from_column_id,fk_to_column_id:void 0}:e)};return(e,a)=>{const t=he,_=we,d=xe,T=ge,C=be,y=ye,I=De,j=Ce,M=Te,z=ve("e");return n(X)?v("",!0):(s(),f(M,{key:0,visible:n(b),"onUpdate:visible":a[6]||(a[6]=o=>K(b)?b.value=o:null),trigger:["click"],class:"!xs:hidden","overlay-class-name":"overflow-hidden"},{overlay:i(()=>[n(b)?(s(),w("div",{key:0,class:"w-108 space-y-6 rounded-2xl p-6","data-testid":"nc-calendar-range-menu",onClick:a[5]||(a[5]=L(()=>{},["stop"]))},[(s(!0),w(N,null,R(n(h),(o,S)=>(s(),w("div",{key:S,class:"flex flex-col w-full gap-2 mb-2","data-testid":"nc-calendar-range-option"},[c("span",$e,p(e.$t("labels.organiseBy")),1),u(y,{value:o.fk_from_column_id,"onUpdate:value":l=>o.fk_from_column_id=l,class:"nc-select-shadow w-full !rounded-lg","dropdown-class-name":"!rounded-lg",placeholder:e.$t("placeholder.notSelected"),"data-testid":"nc-calendar-range-from-field-select",disabled:n(g),onChange:a[0]||(a[0]=()=>{oe(),P()}),onClick:a[1]||(a[1]=L(()=>{},["stop"]))},{suffixIcon:i(()=>[u(d,{icon:"arrowDown",class:"text-gray-700"})]),default:i(()=>[(s(!0),w(N,null,R([...n(E)??[]].filter(l=>{if(S===0)return!0;const r=(n(E)??[]).find(ie=>ie.value===n(F)[0].fk_from_column_id);return(r==null?void 0:r.uidt)===l.uidt}),(l,r)=>(s(),f(C,{key:r,value:l.value},{default:i(()=>[c("div",{class:"w-full flex gap-2 items-center justify-between",title:l.label},[c("div",Ee,[u(T,{column:l},null,8,["column"]),u(_,{class:"flex-1 max-w-[calc(100%_-_20px)] truncate","show-on-truncate-only":""},{title:i(()=>[D(p(l.label),1)]),default:i(()=>[D(p(l.label),1)]),_:2},1024)]),l.value===o.fk_from_column_id?(s(),f(d,{key:0,id:"nc-selected-item-icon",icon:"check",class:"flex-none text-primary w-4 h-4"})):v("",!0)],8,Ve)]),_:2},1032,["value"]))),128))]),_:2},1032,["value","onUpdate:value","placeholder","disabled"]),("isEeUI"in e?e.isEeUI:n(J))?(s(),w("div",Ne,[o.fk_to_column_id===null?(s(),f(t,{key:0,size:"small","data-testid":"nc-calendar-range-add-end-date",class:"w-23",type:"text",shadow:!1,disabled:n(g),onClick:l=>o.fk_to_column_id=void 0},{default:i(()=>[c("div",Oe,[(s(),f(q(("iconMap"in e?e.iconMap:n(H)).plus),{class:"h-4 w-4"})),D(" "+p(e.$t("activity.endDate")),1)])]),_:2},1032,["disabled","onClick"])):("isEeUI"in e?e.isEeUI:n(J))?(s(),w(N,{key:1},[c("span",null,p(e.$t("activity.withEndDate")),1),c("div",je,[u(y,{value:o.fk_to_column_id,"onUpdate:value":l=>o.fk_to_column_id=l,class:"!rounded-r-none nc-select-shadow w-full flex-1","allow-clear":"",disabled:!o.fk_from_column_id||n(g),placeholder:e.$t("placeholder.notSelected"),"data-testid":"nc-calendar-range-to-field-select","dropdown-class-name":"!rounded-lg",onChange:P,onClick:a[2]||(a[2]=L(()=>{},["stop"]))},{suffixIcon:i(()=>[u(d,{icon:"arrowDown",class:"text-gray-700"})]),default:i(()=>[(s(!0),w(N,null,R(se(n(E),o.fk_from_column_id),(l,r)=>(s(),f(C,{key:r,value:l.value},{default:i(()=>[c("div",{class:"w-full flex gap-2 items-center justify-between",title:l.label},[c("div",Le,[u(T,{column:l},null,8,["column"]),u(_,{class:"flex-1 max-w-[calc(100%_-_20px)] truncate","show-on-truncate-only":""},{title:i(()=>[D(p(l.label),1)]),default:i(()=>[D(p(l.label),1)]),_:2},1024)]),l.value===o.fk_from_column_id?(s(),f(d,{key:0,id:"nc-selected-item-icon",icon:"check",class:"flex-none text-primary w-4 h-4"})):v("",!0)],8,ze)]),_:2},1032,["value"]))),128))]),_:2},1032,["value","onUpdate:value","disabled","placeholder"])])],64)):v("",!0)])):v("",!0)]))),128)),n(A)?v("",!0):(s(),w("div",Re,[u(d,{icon:"warning",class:"text-sm mt-0.5 text-orange-500"}),a[7]||(a[7]=c("span",{class:"text-sm text-gray-500"}," Date field is required! ",-1))])),c("div",null,[u(I,{checked:n(O),"onUpdate:checked":a[3]||(a[3]=o=>K(O)?O.value=o:null),disabled:n(g)},{default:i(()=>[c("span",Be,p(e.$t("activity.showSaturdaysAndSundays")),1)]),_:1},8,["checked","disabled"])]),n(g)?(s(),f(j,{key:1,class:"!-mb-4 -mx-4",onOnOpen:a[4]||(a[4]=o=>b.value=!1)})):v("",!0)])):v("",!0)]),default:i(()=>[u(_,{disabled:!n(B),class:"nc-calendar-btn"},{title:i(()=>[D(p(e.$t("activity.settings")),1)]),default:i(()=>[ke((s(),f(t,{class:"nc-toolbar-btn !border-0 group !h-7",size:"small",type:"secondary","data-testid":"nc-calendar-range-btn","show-as-disabled":n(g)},{default:i(()=>[c("div",Se,[(s(),f(q(("iconMap"in e?e.iconMap:n(H)).calendar),{class:"h-4 w-4"})),n(B)?v("",!0):(s(),w("span",Ue,p(e.$t("activity.settings")),1))])]),_:1},8,["show-as-disabled"])),[[z,["c:calendar:change-calendar-range"]]])]),_:1},8,["disabled"])]),_:1},8,["visible"]))}}}),Ze=Object.assign(Fe,{__name:"SmartsheetToolbarCalendarRange"});export{Ze as default};
