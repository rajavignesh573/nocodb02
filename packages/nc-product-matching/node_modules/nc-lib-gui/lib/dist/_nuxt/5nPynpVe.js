import{kb as ne,r as _,aG as ae,kf as le,e as ie,a9 as re,G as d,j1 as ce,kk as de,kL as ue,fO as me,n as m,gz as pe,kl as fe,j9 as _e,bd as ve,gX as W,g as ge,c as u,o as a,b as i,K as y,I as j,w as s,L as e,a as l,t as r,ap as ye,N as he,d as $,by as we,M as Ce,b9 as xe,j as be,ag as R,Q as ke,bU as Ie,cf as je,bK as $e,an as Re,fW as Ee,fX as Qe,fV as Ne}from"./DRA9KN5F.js";import{Q as Oe}from"./C1XMFoVa.js";import{u as Fe,b as Le,c as Be}from"./D0nVnAxk.js";import{u as Me}from"./BJUOFlKy.js";import"./CbX26EBz.js";function A(F,E){const h=ne(F),w=_("");return ae(h,async v=>{h.value&&le&&(w.value=await Oe.toDataURL(v,E))},{immediate:!0}),w}const qe={class:"flex gap-2 items-center w-full"},Te={class:"font-weight-700 m-0"},De={class:"h-5 px-1 bg-nc-bg-gray-medium text-nc-content-gray-subtle2 rounded-md justify-center items-center flex"},ze={class:"text-sm font-medium"},Pe={class:"flex flex-row items-center justify-end"},Se={class:"flex flex-row flex-grow mr-2 !overflow-y-auto py-2 hidden","data-testid":"nc-qr-code-large-value-label"},Ue={key:0,class:"flex gap-2"},Ge={class:"flex children:flex-none relative h-4 w-4"},Ve=["href","download"],He=["src","alt"],We=["src","alt"],Ae=["src","alt"],Ke={key:1,class:"text-left text-wrap mt-2 text-[#e65100] text-xs"},Xe={key:2,class:"text-left text-wrap mt-2 text-[#e65100] text-xs"},O=2e3,Je=ie({__name:"QrCode",setup(F){const{t:E}=re(),h=d(ce,!1),w=d(de,_(!1)),v=d(ue),C=d(me),o=m(()=>String((v==null?void 0:v.value)??"")),K=d(pe,_(!1)),x=d(fe,_(!1)),p=m(()=>K.value&&!x.value),L=m(()=>(o==null?void 0:o.value.length)>O),f=m(()=>{var t;return((t=o==null?void 0:o.value)==null?void 0:t.length)>0&&!L.value&&(o==null?void 0:o.value)!=="ERR!"}),B=m(()=>{var t;return o.value.length>O?(t=o==null?void 0:o.value)==null?void 0:t.slice(0,O):o.value}),M={errorCorrectionLevel:"M",margin:1,rendererOpts:{quality:1}},b=d(_e,_(void 0)),q=A(B,{...M,width:150}),k=A(B,{...M,width:600}),c=_(!1),Q=t=>{f.value&&(t==null||t.stopPropagation(),c.value=!0)},X=()=>c.value=!1,T=d(ve),D=m(()=>{var t;return(t=C==null?void 0:C.value.colOptions)==null?void 0:t.fk_qr_value_column_id}),{showClearNonEditableFieldWarning:J}=Me({onEnter:Q}),Y=t=>be(Ne(t)?Ee:Qe,{columnMeta:t}),{isCopied:z,performCopy:Z}=Fe(),ee=async()=>{if(!k.value)return;const t=await Le(k.value);if(!await Be(t))throw new Error(E("msg.error.notSupported"))},te=m(()=>{if(!p.value)return b.value?`${b.value===1?W[1]-4:W[`${b.value}`]-20}px`:"1.8rem"});return ge(()=>{h&&!w.value&&!p.value&&!x.value&&f.value&&(c.value=!0)}),(t,n)=>{const I=Ce,N=he,P=ye,oe=Ie,se=$e;return a(),u(Re,null,[i(oe,{visible:e(c),"onUpdate:visible":n[2]||(n[2]=g=>ke(c)?c.value=g:null),class:R({active:e(c)}),"wrap-class-name":"nc-qr-code-large qrcode-modal","body-style":{padding:"0px",display:"flex",justifyContent:"center"},closable:!1,onOk:X},{title:s(()=>{var g,S,U,G,V,H;return[l("div",qe,[l("h1",Te,r((g=e(C))==null?void 0:g.title),1),l("div",De,[(a(),j(xe(Y((U=(S=e(T))==null?void 0:S.columnsById)==null?void 0:U[e(D)])),{class:"h-4"})),l("div",ze,r((H=(V=(G=e(T))==null?void 0:G.columnsById)==null?void 0:V[e(D)])==null?void 0:H.title),1)]),n[3]||(n[3]=l("div",{class:"flex-1"},null,-1)),i(N,{class:"nc-qrcode-close !px-1",type:"text",size:"xs",onClick:n[0]||(n[0]=Ye=>c.value=!1)},{default:s(()=>[i(I,{class:"text-md text-gray-700 h-4 w-4",icon:"close"})]),_:1})])]}),footer:s(()=>[l("div",Pe,[l("div",Se,r(e(o)),1),e(f)?(a(),u("div",Ue,[i(P,null,{title:s(()=>[$(r(t.$t("labels.clickToCopy")),1)]),default:s(()=>[i(N,{size:"small",type:"secondary",onClick:n[1]||(n[1]=g=>e(Z)(ee))},{icon:s(()=>[l("div",Ge,[i(we,{name:"icon-fade",duration:200},{default:s(()=>[e(z)?(a(),j(I,{key:0,icon:"check",class:"h-4 w-4 opacity-80"})):(a(),j(I,{key:1,icon:"copy",class:"h-4 w-4 opacity-80"}))]),_:1})])]),default:s(()=>[$(" "+r(e(z)?t.$t("general.copied"):t.$t("general.copy")),1)]),_:1})]),_:1}),l("a",{href:e(k),download:`${e(o)}.png`},[i(P,null,{title:s(()=>[$(r(t.$t("labels.clickToDownload")),1)]),default:s(()=>[i(N,{size:"small",type:"secondary"},{icon:s(()=>[i(I,{icon:"download",class:"w-4 h-4"})]),default:s(()=>[$(" "+r(t.$t("general.download")),1)]),_:1})]),_:1})],8,Ve)])):y("",!0)])]),default:s(()=>[e(f)?(a(),u("img",{key:0,src:e(k),alt:t.$t("title.qrCode"),class:"h-[156px] mt-8 mb-4"},null,8,He)):y("",!0)]),_:1},8,["visible","class"]),e(f)?(a(),u("div",{key:0,class:R(["nc-qrcode-container w-full flex",{"flex-start h-20":e(p),"justify-center":!e(p)&&!e(x)}])},[e(b)?(a(),u("img",{key:0,style:je({height:e(te)}),class:R([{"border-1":e(p)},"min-w-[1.4em]"]),src:e(q),alt:t.$t("title.qrCode"),onClick:Q},null,14,We)):(a(),u("img",{key:1,class:R(["flex-none min-w-[1.4em]",!e(p)&&!e(x)?"mx-auto":""]),src:e(q),alt:t.$t("title.qrCode"),onClick:Q},null,10,Ae))],2)):y("",!0),e(L)?(a(),u("div",Ke,r(t.$t("labels.qrCodeValueTooLong")),1)):y("",!0),e(J)?(a(),u("div",Xe,r(t.$t("msg.warning.nonEditableFields.qrFieldsCannotBeDirectlyChanged")),1)):!e(f)&&e(o)==="ERR!"?(a(),j(se,{key:3,placement:"bottom",class:"text-orange-700"},{title:s(()=>n[4]||(n[4]=[l("span",{class:"font-bold"},"Please select a target field!",-1)])),default:s(()=>[n[5]||(n[5]=l("span",null,"ERR!",-1))]),_:1,__:[5]})):y("",!0)],64)}}}),nt=Object.assign(Je,{__name:"VirtualCellQrCode"});export{nt as default};
