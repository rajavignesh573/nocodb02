import{_ as k}from"./CRQxmmPY.js";import{e as V,f as g,J as D,G as c,r as p,bX as A,bc as I,j5 as L,ac as M,c as j,o as r,b as B,ad as T,w as m,d as _,t as $,I as u,a as F,L as d,b3 as N,b9 as P,bo as O,O as G,nY as J,an as R,a4 as l,ai as v,a5 as U,nZ as Z,y as z,aZ as H,df as K}from"./DRA9KN5F.js";import{_ as W}from"./C2UaKEE0.js";const X={class:"flex flex-row items-center nc-base-menu-item !py-0 children:flex-none"},Y=V({__name:"ExportSubActions",setup(q){const{$api:f,$poller:b}=g(),{appInfo:w}=D(),x=c(A,p(!1)),n=c(I),y=c(L,p(null)),E=e=>e.startsWith("http")?e:`${w.value.ncSiteUrl||K}/${e}`,S=async e=>{if(e=E(e),await Z(e)){z(e,{open:H});return}const a=document.createElement("a");a.href=e,a.style.display="none",document.body.appendChild(a),a.click(),document.body.removeChild(a)},t=p(!1),h=async e=>{try{if(t.value||!n.value.id)return;t.value=!0;let s;if(x.value){if(!n.value.uuid)return;const a={headers:{"xc-password":y.value||""}};s=await f.public.exportData(n.value.uuid,e,{},a)}else s=await f.export.data(n.value.id,e,{});l.info("Preparing CSV for download..."),b.subscribe({id:s.id},async a=>{var o,i;a.status!=="close"&&(a.status===v.COMPLETED?(l.info("Successfully exported data!"),S((i=(o=a.data)==null?void 0:o.result)==null?void 0:i.url),t.value=!1):a.status===v.FAILED&&(l.error("Failed to export data!"),t.value=!1))})}catch(s){l.error(await U(s)),t.value=!1}};return(e,s)=>{const a=k,o=N,i=W,C=M("e");return r(),j(R,null,[B(a,null,{default:m(()=>[_($(e.$t("labels.downloadData")),1)]),_:1}),T((r(),u(i,{onClick:s[0]||(s[0]=G(Q=>h(d(J).CSV),["stop"]))},{default:m(()=>[F("div",X,[d(t)?(r(),u(o,{key:0,size:"regular"})):(r(),u(P(("iconMap"in e?e.iconMap:d(O)).ncFileTypeCsvSmall),{key:1,class:"w-4"})),s[1]||(s[1]=_(" CSV "))])]),_:1})),[[C,["a:download:csv"]]])],64)}}}),te=Object.assign(Y,{__name:"SmartsheetToolbarExportSubActions"});export{te as default};
